Project Path: Qubespec

Source Tree:

```txt
Qubespec
├── CLAUDE.md
├── QubeSpec
│   ├── Background.py
│   ├── Dust
│   │   ├── Dust_attenuation.py
│   │   └── __init__.py
│   ├── Example_cubes
│   │   └── readme.md
│   ├── Fitting
│   │   ├── __init__.py
│   │   ├── fits_r.py
│   │   └── priors.py
│   ├── Graph_setup.py
│   ├── Header_fix.py
│   ├── MSA.py
│   ├── Maps
│   │   ├── Map_creation.py
│   │   └── __init__.py
│   ├── Models
│   │   ├── Custom_model.py
│   │   ├── FeII_comp.py
│   │   ├── FeII_models.py
│   │   ├── FeII_templates
│   │   │   └── FeII_Tsuzuki_opttemp.txt
│   │   ├── Full_optical.py
│   │   ├── Halpha_OIII_models.py
│   │   ├── Halpha_models.py
│   │   ├── Halpha_models_v2.py
│   │   ├── OIII_models.py
│   │   ├── OIII_models_old.py
│   │   └── QSO_models.py
│   ├── Plotting
│   │   ├── __init__.py
│   │   └── plots.py
│   ├── QubeSpec.py
│   ├── README.md
│   ├── Spaxel_fitting
│   │   ├── Spaxel.py
│   │   └── __init__.py
│   ├── Utils
│   │   ├── Support.py
│   │   └── __init__.py
│   ├── Visualizations
│   │   ├── __init__.py
│   │   └── viz.py
│   ├── Voronoi
│   │   ├── __init__.py
│   │   └── vor_bin.py
│   ├── __init__.py
│   ├── detection
│   │   └── Detection.py
│   └── jadify_temp
│       └── r100_jades_deep_hst_v3.1.1_template.yaml
├── README.md
├── Tutorial
│   ├── cdfs_38_H_inner_1Dspectrum.txt
│   └── cdfs_701_YJ_inner_1Dspectrum.txt
├── docs
│   ├── conf.py
│   └── requirements.txt
├── setup.py
└── workshop_nested_sampling.py

```

`Qubespec/CLAUDE.md`:

```md
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

QubeSpec is a Python package for fitting optical astronomical spectra and analyzing IFS (Integral Field Spectroscopy) cubes from JWST/NIRSpec, JWST/MIRI, VLT/KMOS, and VLT/SINFONI. The code provides built-in models for fitting emission lines (Halpha, [OIII], Hbeta, [SII], [NII]) in galaxies, AGN, and quasars.

## Installation and Setup

The package is installed as an editable package:
```bash
conda create -n qubespec python=3.9
conda activate qubespec
pip install -e .
```

Import the package in Python:
```python
import QubeSpec
```

## Core Architecture

### Main Components

- **QubeSpec/QubeSpec.py** - Main Cube class for data handling and analysis
- **QubeSpec/Models/** - Spectral models for different emission line scenarios
- **QubeSpec/Fitting/** - MCMC fitting routines using emcee
- **QubeSpec/Plotting/** - Visualization tools
- **QubeSpec/Maps/** - Functions for creating emission line maps
- **QubeSpec/Background.py** - Background subtraction algorithms
- **QubeSpec/Dust/** - Dust attenuation correction tools

### Key Classes

- **Cube** - Primary data container and analysis class
- **Fitting** - MCMC fitting framework for spectral models
- **Map_creation** - Spaxel-by-spaxel fitting and map generation

## Typical Workflow

1. **Data Initialization**: Create Cube object with instrument-specific parameters
2. **Data Preparation**: Mask outliers, subtract background, extract spectra
3. **Spectral Fitting**: Fit emission lines using predefined or custom models
4. **Mapping**: Generate flux and kinematic maps from spaxel fitting
5. **Analysis**: Calculate fluxes, velocities, and physical properties

## Models and Fitting

### Built-in Models

- **Halpha models**: Single, outflow, BLR components
- **[OIII] models**: Narrow and broad components with outflow detection
- **Combined models**: Simultaneous Halpha + [OIII] fitting
- **QSO models**: Quasar-specific emission line profiles
- **Custom models**: User-defined emission line combinations

### Fitting Framework

Uses emcee for MCMC sampling with:
- Configurable priors via dictionary interface
- Multi-core processing support
- Automatic convergence checking
- Corner plot generation for parameter visualization

## Instrument Support

- **JWST/NIRSpec**: Both F_nu and F_lambda units supported
- **JWST/MIRI**: Medium resolution spectroscopy
- **VLT/KMOS**: H and K band IFS
- **VLT/SINFONI**: AO-assisted IFS observations

## Key Dependencies

- numpy, matplotlib, scipy
- astropy (FITS handling, WCS, cosmology)
- emcee (MCMC sampling)
- corner (parameter visualization)
- tqdm (progress bars)
- numba (performance optimization)
- spectres (spectral resampling)

## Data Processing Notes

- Error handling for JWST data requires custom scaling due to pipeline issues
- Background subtraction uses median filtering with source masking
- PSF matching available for wavelength-dependent resolution
- Supports both manual and automated source detection

## Tutorial and Examples

The `Tutorial/` directory contains comprehensive Jupyter notebooks:
- `QubeSpec_tutorial.ipynb` - Complete workflow demonstration
- `Emission_line_tutorial.ipynb` - Detailed emission line fitting examples
- Example data files for testing and learning

## File Structure Notes

- Models are organized by emission line type in `QubeSpec/Models/`
- FeII templates stored in `QubeSpec/Models/FeII_templates/`
- Pre-convolved templates cached for performance
- Spaxel fitting results saved as pickle files for resuming analysis
```

`Qubespec/QubeSpec/Background.py`:

```py

import matplotlib.pyplot as plt
import numpy as np
from scipy.signal import medfilt
import tqdm
from astropy.io import fits

def background_sub_spec_depricated(self, center, rad=0.6, manual_mask=[],smooth=25, plot=0):
    '''
    Background subtraction used when the NIRSPEC cube has still flux in the blank field.

    Parameters
    ----------
    center : TYPE
        DESCRIPTION.
    rad : TYPE, optional
        DESCRIPTION. The default is 0.6.
    plot : TYPE, optional
        DESCRIPTION. The default is 0
    Returns
    -------
    None.

    '''

    # Creating a mask for all spaxels.
    shapes = self.dim
    mask_catch = self.flux.mask.copy()
    mask_catch[:,:,:] = True
    header  = self.header
    #arc = np.round(1./(header['CD2_2']*3600))
    arc = np.round(1./(header['CDELT2']*3600))

    if len(manual_mask)==0:
        # This choose spaxel within certain radius. Then sets it to False since we dont mask those pixels
        for ix in range(shapes[0]):
            for iy in range(shapes[1]):
                dist = np.sqrt((ix- center[1])**2+ (iy- center[0])**2)
                if dist< arc*rad:
                    mask_catch[:,ix,iy] = False
    else:
        mask_3d = np.dstack([manual_mask]*self.flux.shape[0])
        # Rearranging the mask so the order of the axis is the same as the cube - moving wavelength axis first 
        mask_catch = np.moveaxis(mask_3d, -1, 0)
        # Creating the mask array across the whole cube - spectra of masked spaxels will be ignored in other actions 

    mask_spax = mask_catch.copy()
    # Loading mask of the sky lines an bad features in the spectrum
    mask_sky_1D = self.sky_clipped_1D.copy()
    total_mask = np.logical_or( mask_spax, self.sky_clipped)

    background = np.ma.array(data=self.flux.data, mask= total_mask)
    backgroerr =  np.ma.array(data=self.error_cube, mask= total_mask)
    weights = 1/backgroerr**2; weights /= np.ma.sum(weights, axis=(1,2))[:, None, None]                       
    
    master_background_sum = np.ma.sum(background*weights, axis=(1,2))
    Sky = master_background_sum
    '''
    Sky = np.ma.median(flux, axis=(1,2))
    Sky = np.ma.array(data = Sky.data, mask=mask_sky_1D)
    '''

    Sky_smooth = medfilt(Sky, smooth)
    self.flux_old = self.flux.copy()
    for ix in range(shapes[0]):
        for iy in range(shapes[1]):
            self.flux[:,ix,iy] = self.flux[:,ix,iy] - Sky_smooth

    self.background = Sky_smooth
    

    if plot==1:
        plt.figure()
        plt.title('Median Background spectrum')
        plt.plot(self.obs_wave, np.ma.array(data= Sky_smooth , mask=self.sky_clipped_1D), drawstyle='steps-mid')
        plt.ylabel('Flux')
        plt.xlabel('Observed wavelength')
        plt.savefig(self.savepath+'Diagnostics/Background_spextrum.pdf')


def background_subtraction(self, box_size=(21,21), filter_size=(5,5), sigma_clip=5,\
                source_mask=[], wave_smooth=25, wave_range=None, plot=0, detection_threshold=3, **kwargs):
    '''
    Background subtraction used when the NIRSPEC cube has still flux in the blank field.

    Parameters
    ----------
    center : TYPE
        DESCRIPTION.
    rad : TYPE, optional
        DESCRIPTION. The default is 0.6.
    plot : TYPE, optional
        DESCRIPTION. The default is 0.

    Returns
    ------
    None.

    '''
    from photutils.background import Background2D, MedianBackground
    from astropy.stats import SigmaClip

    n_wave, n_x, n_y = self.flux.shape
    self.background = np.full((n_wave, n_x, n_y), np.nan)
    self.coverage_mask = self.flux.data==np.nan
    self.coverage_mask = self.coverage_mask[100,:,:]
    if len(source_mask) !=0:
        print('Using supplied source mask')
        source_mask_temp = source_mask.copy()
        source_mask[source_mask_temp==0] = True
        source_mask[source_mask_temp==1] = False
    else:
        from .detection import Detection as dtn
        if any(wave_range):
            print('Using sextractor to find the source. ')
            obj, seg = dtn.source_detection(self.flux, self.error_cube, self.obs_wave, wave_range=wave_range,noise_type='nominal', detection_threshold=detection_threshold)
            plt.savefig(self.savepath+'Diagnostics/Source_detection.pdf')
            source_mask = self.coverage_mask.copy()
            source_mask[seg !=0] = True
            source_mask[seg ==0] = False       
        else:
            raise Exception('Define wave_range or source_mask ')
            

    for _wave_,_image_ in tqdm.tqdm(enumerate(self.flux)):
        mask = ~np.isfinite(_image_)
        mask = mask if source_mask is None else mask | source_mask

        #plt.figure()
        #plt.imshow(mask, origin='lower')
        #plt.show()
        try:
            background2d = Background2D(
                    _image_, box_size, filter_size=filter_size, mask=mask,
                    coverage_mask=self.coverage_mask, sigma_clip=SigmaClip(sigma=sigma_clip),
                    bkg_estimator=MedianBackground(), **kwargs)
            
            self.background[_wave_,:,:] = background2d.background
        except Exception as _exc_:
            print(_wave_, _exc_)
            background2d = np.full(_image_.shape, np.nan)

            self.background[_wave_,:,:] = background2d

    # For wavelength slices where all spaxels were invalid, interpolate linearly
    # between nearby wavelengths.
    wave_mask = np.all(np.isnan(self.background), axis=(1,2))
    wave_indx = np.linspace(0., 1, n_wave) # Dummy variable.

    if np.any(wave_mask):
        for i in range(n_x):
            for j in range(n_y):
                if self.coverage_mask[i, j]:
                        continue
                self.background[wave_mask, i, j] = np.interp(
                        wave_indx[wave_mask], wave_indx[~wave_mask],
                        self.background[~wave_mask, i, j])   
    
    from scipy import signal
    if wave_smooth:
        self.backgrond = signal.medfilt(self.background, (wave_smooth, 1, 1))
    
    self.flux_old = self.flux.copy()
    self.flux = self.flux-self.background

    primary_hdu = fits.PrimaryHDU(np.zeros((3,3,3)), header=self.header)
    hdus = [primary_hdu]
    hdus.append(fits.ImageHDU(self.flux.data, name='flux_bkg_sub',header=self.header))
    hdus.append(fits.ImageHDU(self.error_cube, name='error', header=self.header))
    hdus.append(fits.ImageHDU(self.background.data, name='background',header=self.header))
    

    hdulist = fits.HDUList(hdus)
    hdulist.writeto(self.savepath+'/'+self.ID+'_BKG.fits', overwrite=True)

    if plot==1:
        f, ax = plt.subplots(1)
        ax.plot(self.obs_wave, np.median(self.background[:, int(n_x/2)-5:int(n_x/2)+5, int(n_y/2)-5:int(n_y/2)+5], axis=(1,2)), drawstyle='steps-mid')
        ax.set_xlabel('obs_wave')
        ax.set_ylabel('Flux density')
        plt.savefig(self.savepath+'Diagnostics/Background_spectrum.pdf')
    

def background_sub_spec_gnz11(Cube, center, rad=0.6, manual_mask=[],smooth=25, plot=0):
    '''
    Background subtraction used when the NIRSPEC cube has still flux in the blank field.

    Parameters
    ----------
    center : TYPE
        DESCRIPTION.
    rad : TYPE, optional
        DESCRIPTION. The default is 0.6.
    plot : TYPE, optional
        DESCRIPTION. The default is 0.

    Returns
    -------
    None.

    '''
    # Creating a mask for all spaxels.
    shapes = Cube.dim
    mask_catch = Cube.flux.mask.copy()
    mask_catch[:,:,:] = True
    header  = Cube.header
    #arc = np.round(1./(header['CD2_2']*3600))
    arc = np.round(1./(header['CDELT2']*3600))

    if len(manual_mask)==0:
        # This choose spaxel within certain radius. Then sets it to False since we dont mask those pixels
        for ix in range(shapes[0]):
            for iy in range(shapes[1]):
                dist = np.sqrt((ix- center[1])**2+ (iy- center[0])**2)
                if dist< arc*rad:
                    mask_catch[:,ix,iy] = False
    else:
        for ix in range(shapes[0]):
            for iy in range(shapes[1]):
                
                if manual_mask[ix,iy]==False:
                    mask_catch[:,ix,iy] = False

    mask_spax = mask_catch.copy()
    # Loading mask of the sky lines an bad features in the spectrum
    mask_sky_1D = Cube.sky_clipped_1D.copy()
    total_mask = np.logical_or( mask_spax, Cube.sky_clipped)

    background = np.ma.array(data=Cube.flux.data, mask= total_mask)
    backgroerr =  np.ma.array(data=Cube.error_cube, mask= total_mask)
    weights = 1/backgroerr**2; weights /= np.ma.sum(weights, axis=(1,2))[:, None, None]                       
    
    master_background_sum = np.ma.sum(background*weights, axis=(1,2))
    Sky = master_background_sum
    '''
    Sky = np.ma.median(flux, axis=(1,2))
    Sky = np.ma.array(data = Sky.data, mask=mask_sky_1D)
    '''
    from scipy.signal import medfilt
    Sky_smooth = medfilt(Sky, smooth)

    Cube.collapsed_bkg = Sky_smooth
    
    use = np.where( (Cube.obs_wave<1.38) & (Cube.obs_wave>1.30) )[0]
    white_image = np.ma.median(Cube.flux[use, :,:], axis=(0))
    white_bkg = np.ma.median(Sky_smooth[use])
    norm = white_image/white_bkg

    plt.figure()
    plt.imshow(norm,vmin=0.5,vmax=1.5, origin='lower')
    plt.colorbar()
    plt.savefig(Cube.savepath+'Diagnostics/1D_spectrum_Selected_pixel.pdf')
    Cube.flux_orig = Cube.flux.copy()
    for ix in range(shapes[0]):
        for iy in range(shapes[1]):
            Cube.flux[:,ix,iy] = Cube.flux[:,ix,iy] - Sky_smooth*norm[ix,iy]

    return Cube.collapsed_bkg, Cube.flux

    
```

`Qubespec/QubeSpec/Dust/Dust_attenuation.py`:

```py
"""
Example: Ext
from ext import extinct_car, wavelengths

wa=wavelengths()
OIIIWav, HaWav, HbWav, NIIWav, OIIWav, SIIWav=wa.wavs()
OIII, Av1=extinct_car(self.OIII, Ha1, Hb1, OIIIWav, 3.1)
NII, Av2=extinct_car(self.NII, Ha1, Hb1, NIIWav, 3.1)
"""

__author__='Jan Scholtz, William M. Baker, Ignas'

import numpy as np
from numba import jit, float32
from scipy.optimize import curve_fit
import pyneb as pn 

Balmer_lines = {'Halpha': [6562.819e-10, 2.863]}
Balmer_lines['Hbeta'] = [4861.333e-10, 1]
Balmer_lines['Hgamma'] = [4340e-10, 0.468]
Balmer_lines['Hdelta'] = [4101.734e-10, 0.259]
Balmer_lines['H10'] = [3970.075e-10, 0.0533]



class Model:
    def __init__(self,kb1s, kb2s, Balmer_rats, ):
        self.kb1= kb1s
        self.kb2 = kb2s
        self.Balmer_rats = Balmer_rats

        
    def rat_calc(self, x, Av):
        dkb = self.kb1-self.kb2
        exp = dkb*Av/-2.5
        #Av1= -2.5 * np.log10((fb1/fb2)/Balmer_rat) * 1/(Kb1- Kb2)
        rats = 10**(exp)*self.Balmer_rats
        return rats

class Dust_cor:

    def __init__(self): 
        self.Balmer_lines = Balmer_lines
    
    def flux_cor_pn(self, F, wav, fb1, fb2, fb_names, law=None):

        fb1_name, fb2_name = fb_names.split('_')        
        fb1_wave = self.Balmer_lines[fb1_name][0]
        fb2_wave = self.Balmer_lines[fb2_name][0]

        Balmer_rat = self.Balmer_lines[fb1_name][1]/self.Balmer_lines[fb2_name][1]
        if law:
            la=law
        else:
            law = 'G03 LMC'
        rc = pn.RedCorr(law=law, R_V=2.505)
        rc.setCorr((fb1/fb2)/Balmer_rat, wave1=fb1_wave*1e10, wave2=fb2_wave*1e10)
        F *=  rc.getCorr(wav)

        return F, rc.AV

    
    def flux_cor(self, F, wav, fb1, fb2, fb_names, R_v=None, curve='smc', curve_fce=None):
        fb1_name, fb2_name = fb_names.split('_')
        self.R_v = R_v
        
        fb1_wave = self.Balmer_lines[fb1_name][0]
        fb2_wave = self.Balmer_lines[fb2_name][0]

        Balmer_rat = self.Balmer_lines[fb1_name][1]/self.Balmer_lines[fb2_name][1]
        if curve_fce ==None:
            if curve=='smc':
                curve_fce = self.smc
            elif curve=='calzetti2000':
                curve_fce = self.calzetti2000
            elif curve=='cardonelli1989':
                curve_fce = self.cardelli1989

        Kb1=curve_fce(fb1_wave, R_v = self.R_v)
        Kb2=curve_fce(fb2_wave, R_v = self.R_v)
        K= curve_fce(wav*1e-10, R_v = self.R_v)
        Av=[]
        f=[]

        
        for i in range(F.shape[0]):
            try:
                Av1= -2.5 * np.log10((fb1[i]/fb2[i])/Balmer_rat) * K/(Kb1- Kb2)
                f1=F[i]*10**(Av1/2.5)
                Av.append(Av1)
                f.append(f1)
            except Exception as _exc_:
                print(_exc_)
                f.append(np.nan)
                Av.append(np.nan)
        f=np.array(f)
        Av=np.array(Av)
        return f, Av
    
    def flux_cor_fit(self, F, wav, ratios, fb_names,eratios=None, R_v=None, curve='smc', curve_fce=None):

        if curve_fce ==None:
            if curve=='smc':
                self.curve_fce = self.smc
            elif curve=='calzetti2000':
                self.curve_fce = self.calzetti2000
            elif curve=='cardonelli1989':
                self.curve_fce = self.cardelli1989
        else:
            self.curve_fce= curve_fce
        self.R_v = R_v

        Balmer_rats = []
        Kb1s = []
        Kb2s = []
        for name in fb_names:
            fb1_name, fb2_name = name.split('_')
            
            Balmer_rats.append(self.Balmer_lines[fb1_name][1]/self.Balmer_lines[fb2_name][1])
            
            fb1_wave = self.Balmer_lines[fb1_name][0]
            fb2_wave = self.Balmer_lines[fb2_name][0]

        
            Kb1s.append(self.curve_fce(fb1_wave, R_v = self.R_v))
            Kb2s.append(self.curve_fce(fb2_wave, R_v = self.R_v))
        Kb1s= np.array(Kb1s)
        Kb2s = np.array(Kb2s)
        K = self.curve_fce(wav*1e-10, R_v = self.R_v)

        from scipy.optimize import curve_fit
        Ext_model = Model(Kb1s, Kb2s, Balmer_rats)
        Av_fit, err  = curve_fit(Ext_model.rat_calc, np.zeros_like(ratios), ratios, p0=0.5, sigma=eratios)
        
        Av = Av_fit*K
        f=F*10**(Av/2.5)
        return f, Av, Av_fit, np.sqrt(err)
    
    
    @staticmethod
    @jit(nopython=True, cache=True)
    def calzetti2000(wav, R_v=None):
        if R_v:
            R_v = R_v
        else: 
            R_v = 3.1
        wav=wav/(1.0e-6)
        if 0.12 < wav < 0.63:
            return 2.659 * (-2.156 + 1.509/wav - 0.198/(wav**2) 
                                                +0.011/(wav **3)) + R_v
        elif 0.63 < wav < 2.20:
            return 2.659*(-1.857 + 1.040/wav ) + R_v
        else:
            return 0

    @staticmethod
    @jit(nopython=True, cache=True)
    def F_a(x):
        if x < 5.9:
            return 0.
        elif 5.9 < x <8.:
            return -0.04473 * ( x - 5.9)**2 - 0.009779 * ( x- 5.9 )**3

    @staticmethod
    @jit(nopython=True, cache=True)
    def F_b(x):
        if x < 5.9:
            return 0.
        elif 5.9 < x <8.:
            return 0.2130 * ( x - 5.9)**2 + 0.1207 * ( x- 5.9 )**3

    @staticmethod
    @jit(nopython=True, cache=True)
    def cardelli1989(wav, R_v=None):
        if R_v:
            R_v = R_v
        else: 
            R_v = 3.1
        xc=(1./wav) * 1.0e-6
        #For a(x)
        if 0.3 < xc < 1.1:
            a=0.574 * (xc**1.61)
        elif 1.1 < xc < 3.3:
            a=(1 + 0.17699 * (xc-1.82) - 0.50447 * (xc-1.82)**2 - 0.02427 * (xc-1.82)**3 + 0.72085 * 
            (xc-1.82)**4 + 0.01979 * (xc-1.82)**5 - 0.77530 * (xc-1.82)**6 + 0.32999 * (xc-1.82)**7)
        elif 3.3 < xc < 8.:
            a=1.752 - 0.316 * xc - 0.104/((xc - 4.67)**2 + 0.341) + self.F_a(xc)
        elif 8.0 < xc <10.:
            a=-1.073 -0.628*(xc-8) +0.137*(xc-8)**2 - 0.07*(xc-8)**3

        #For b(x)
        if 0.3 < xc < 1.1:
            b=-0.527 * (xc**1.61)
        elif 1.1 < xc <3.3:
            b=(1.41338*(xc-1.82) + 2.28305 * (xc-1.82)**2 + 1.07233 * (xc-1.82)**3 - 5.38434 * 
                (xc-1.82)**4 - 0.62251 * (xc-1.82)**5 + 5.30260 * 
                (xc-1.82)**6 - 2.09002*(xc-1.82)**7)
        elif 3.3 < xc < 8.:
            b=-3.090 + 1.825 * xc + 1.206/((xc - 4.62)**2 +0.263) + self.F_b(xc)
        elif 8. < xc <10.:
            b=13.67 + 4.257*(xc-8) -0.42*(xc-8)**2 +0.374*(xc-8)**3

        return a + b/R_v

    @staticmethod
    @jit(nopython=True, cache=True)
    def smc(wav, R_v=None):
        if R_v:
            R_v = R_v
        else: 
            R_v = 1.475
        xc = (1/wav)*10**-6
        D = xc**2/((xc**2 - 4.558**2)**2+xc**2*0.945**2)
        if xc < 5.9: F = 0
        else: F = 0.5392*(xc-5.9)**2 + 0.05644*(xc-5.9)**2
        b = -1.475 + 1.132*xc + 1.463*D + 0.294*F
        return 1 + b/R_v

#cls = Dust_cor()
#res = cls.flux_cor(np.array([1]), 5008., np.array([5e-18]), np.array([5e-18*0.43]), R_v = 3.1, curve='calzetti2000', fb_names='Hbeta_Hgamma')
#print(res)
```

`Qubespec/QubeSpec/Dust/__init__.py`:

```py
from .Dust_attenuation import *

```

`Qubespec/QubeSpec/Example_cubes/readme.md`:

```md
3 example cubes: XID 208, XID 587 and xuds 481. All in Scholtz et al 2020. 


```

`Qubespec/QubeSpec/Fitting/__init__.py`:

```py
from .fits_r import *
```

`Qubespec/QubeSpec/Fitting/fits_r.py`:

```py
#!/usr/bin/env python2
# -*- coding: utf-8 -*-
"""
Created on Wed Aug 16 17:35:45 2017

@author: jscholtz
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt

import pickle
from scipy.optimize import curve_fit
import os
import emcee
import corner
from astropy.modeling.powerlaws import PowerLaw1D
nan= float('nan')

pi= np.pi
e= np.e

c= 3.*10**8
h= 6.62*10**-34
k= 1.38*10**-23


def gauss(x, k, mu,FWHM):
    sig = FWHM/3e5/2.35*mu
    expo= -((x-mu)**2)/(2*sig*sig)
    
    y= k* e**expo
    
    return y

import warnings
warnings.filterwarnings("ignore")

from ..Models import OIII_models as O_models
from ..Models import Halpha_OIII_models as HO_models
from ..Models import QSO_models as QSO_models
from ..Models import Halpha_models as H_models
from ..Models import Full_optical as FO_models
from ..Models import Custom_model
import numba
from .. import Utils as sp

from .priors import * 

class Fitting:
    """ Simple class containing everything that we need to fit a spectrum and also all of its results. 


    Parameters
    ----------
 
    wave : array
      observed wavelength in microns

    flux : array
        flux of the spectrum

    error : array
        error on the spectrum
    z : float
        redshift of the source

    N: int - optional 
        number of points in the chain - default 5000

    ncpu: int - optional
        number of cpus used to fit - I find that the overheads can be bigger what using multipleprocessing then the speed up. Experiment or keep to 1

    progress : bool - optional
        progress bar for the emcee bit

    priors: dict - optional
        dictionary with all of the priors to update
        
    """
       
    def __init__(self, wave='', flux='', error='', z='', N=5000,ncpu=1, progress=True,sampler='emcee', priors= {'z':[0, 'normal_hat', 0,0.003,0,0]}):
        priors_update = priors.copy()
        priors= {'z':[0, 'normal_hat', 0,0.003,0.01,0.01],\
                'cont':[0,'loguniform',-4,1],\
                'cont_grad':[0,'normal',0,0.3], \
                'Hal_peak':[0,'loguniform',-3,1],\
                'BLR_Hal_peak':[0,'loguniform',-3,1],\
                'NII_peak':[0,'loguniform',-3,1],\
                'Nar_fwhm':[300,'uniform',100,900],\
                'BLR_fwhm':[4000,'uniform', 2000,9000],\
                'zBLR':[0, 'normal', 0,0.003],\
                'Hal_out_peak':[0,'loguniform',-3,1],\
                'NII_out_peak':[0,'loguniform',-3,1],\
                'outflow_fwhm':[600,'uniform', 300,1500],\
                'outflow_vel':[-50,'normal', 0,300],\
                'OIII_peak':[0,'loguniform',-3,1],\
                'OIII_out_peak':[0,'loguniform',-3,1],\
                'Hbeta_peak':[0,'loguniform',-3,1],\
                'Hbeta_out_peak':[0,'loguniform',-3,1],\
                'Fe_peak':[0,'loguniform',-3,1],\
                'Fe_fwhm':[3000,'uniform',2000,6000],\
                'SIIr_peak':[0,'loguniform', -3,1],\
                'SIIb_peak':[0,'loguniform', -3,1],\
                'BLR_Hbeta_peak':[0,'loguniform', -3,1]}
        
        for name in list(priors_update.keys()):
            priors[name] = priors_update[name]

        self.N = N # Number of points in the chains
        self.priors = priors # storing priors
        self.progress = progress # progress bar?
        self.z = z  # redshift
        self.wave = wave # wavelength 
        self.fluxs = flux # flux density
        self.error = error # errors
        self.ncpu= ncpu # number of cpus to use in the fit 
        self.sampler = sampler
    
    # =============================================================================
    #  Primary function to fit Halpha both with or without BLR - data prep and fit 
    # =============================================================================
    def fitting_optical(self, model='gal'):
        """ Method to fit Halpha+[NII +[SII]]
        
        Parameters
        ----------

        model - str
            current valid models names and their variable names/also prior names:

            gal -  'z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'Nar_fwhm', 'SIIr_peak', 'SIIb_peak'

            outflow - 'z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'Nar_fwhm', 'SIIr_peak', 'SIIb_peak', 'Hal_out_peak', 'NII_out_peak', 'outflow_fwhm', 'outflow_vel'
           
        """
        self.model= model
        self.template = None
        
        if self.priors['z'][0]==0:
            self.priors['z'][0]=self.z
            if (self.priors['z'][1]=='normal_hat') & (self.priors['z'][2]==0):
                self.priors['z'][2] = self.z
                self.priors['z'][3] = 200/3e5*(1+self.z)
                self.priors['z'][4] = self.z-1000/3e5*(1+self.z)
                self.priors['z'][5] = self.z+1000/3e5*(1+self.z)
        
        self.fluxs[np.isnan(self.fluxs)] = 0
        self.flux = self.fluxs.data[np.invert(self.fluxs.mask)]
        self.wave = self.wave[np.invert(self.fluxs.mask)]
         
        self.fit_loc = np.where((self.wave>(6564.52-170)*(1+self.z)/1e4)&(self.wave<(6564.52+170)*(1+self.z)/1e4))[0]
        sel=  np.where(((self.wave<(6564.52+20)*(1+self.z)/1e4))& (self.wave>(6564.52-20)*(1+self.z)/1e4))[0]
        
        self.flux_zoom = self.flux[sel]
        self.wave_zoom = self.wave[sel]
        
        peak = np.ma.max(self.flux_zoom)
        nwalkers=64

        if self.model=='gal':
            self.fitted_model = FO_models.Full_optical
            self.log_prior_fce = logprior_general
            self.labels= ['z', 'cont','cont_grad',  'Hal_peak', 'NII_peak', 'OIII_peak', 'Hbeta_peak','Hgamma_peak', 'Hdelta_peak','NeIII_peak','OII_peak','OII_rat','OIIIaur_peak', 'HeI_peak','HeII_peak', 'Nar_fwhm']

            self.pr_code = self.prior_create()
            cont = np.median(self.flux[self.fit_loc])
            if cont<0:
                cont=0.01
            pos_l = np.array([self.z,cont,0.01, peak/2, peak/4,self.priors['Nar_fwhm'][0],peak/6, peak/6 ])
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 

            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)

            self.res = {'name': 'Full_optical'}
            
                
        elif self.model=='outflow':
            self.fitted_model = FO_models.Full_optical_outflow
            self.log_prior_fce = logprior_general
            self.labels= ['z', 'cont','cont_grad',  'Hal_peak', 'NII_peak', 'OIII_peak', 'Hbeta_peak','Hgamma_peak',\
                          'Hdelta_peak','NeIII_peak','OII_peak','OII_rat','OIIIaur_peak', 'HeI_peak','HeII_peak', 'Nar_fwhm',\
                          'Hal_out_peak', 'OIII_out_peak', 'NII_out_peak', 'Hbeta_out_peak', \
                                  'outflow_vel', 'outflow_fwhm']
            
            self.pr_code = self.prior_create()
            
            cont = np.median(self.flux[self.fit_loc])
            if cont<0:
                cont=0.01
            pos_l = np.array([self.z,cont,0.01, peak/2, peak/4, self.priors['Nar_fwhm'][0],peak/6, peak/6,peak/8, peak/8, self.priors['outflow_fwhm'][0],self.priors['outflow_vel'][0] ])
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
            
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
            
            self.res = {'name': 'Full_optical_outflow'}
        
        self.flux_fitloc = self.flux
        self.wave_fitloc = self.wave
        self.error_fitloc = self.error
        
        if (self.log_prior_fce(pos_l, self.pr_code)==-np.inf) | (self.log_prior_fce(pos_l, self.pr_code)== np.nan):
            print(logprior_general_scipy_test(pos_l, self.pr_code))
                
            raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your priors\
                            boundries are sensible')
        self.pos = pos
        self.pos_l = pos_l
        nwalkers, ndim = pos.shape
        sampler = emcee.EnsembleSampler(
             nwalkers, ndim, self.log_probability_general, args=())
     
        sampler.run_mcmc(pos, self.N, progress=self.progress)
        self.flat_samples = sampler.get_chain(discard=int(0.5*self.N), thin=15, flat=True)      
        
        self.chains = {'name': 'Full_optical'}
        for i in range(len(self.labels)):
            self.chains[self.labels[i]] = self.flat_samples[:,i]
            
        self.props = self.prop_calc()
        try:
            self.chi2, self.BIC = sp.BIC_calc(self.wave, self.fluxs, self.error, self.fitted_model, self.props, 'Halpha')
        except:
            self.chi2, self.BIC = np.nan, np.nan
        
        self.like_chains = sampler.get_log_prob(discard=int(0.5*self.N),thin=15, flat=True)
        self.yeval = self.fitted_model(self.wave, *self.props['popt'])

    def fitting_Halpha(self, model='gal'):
        """ Method to fit Halpha+[NII +[SII]]
        
        Parameters
        ----------

        model - str
            current valid models names and their variable names/also prior names:

            gal -  'z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'Nar_fwhm', 'SIIr_peak', 'SIIb_peak'

            outflow - 'z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'Nar_fwhm', 'SIIr_peak', 'SIIb_peak', 'Hal_out_peak', 'NII_out_peak', 'outflow_fwhm', 'outflow_vel'
            
            BLR_simple - 'z', 'cont','cont_grad', 'Hal_peak','BLR_Hal_peak', 'NII_peak', 'Nar_fwhm', 'BLR_fwhm', 'zBLR', 'SIIr_peak', 'SIIb_peak'

            BLR - 'z', 'cont','cont_grad', 'Hal_peak','BLR_Hal_peak', 'NII_peak', 'Nar_fwhm', 'BLR_fwhm', 'zBLR', 'SIIr_peak', 'SIIb_peak'

            QSO_BKPL - 'z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'Nar_fwhm',
                    'Hal_out_peak', 'NII_out_peak', \
                    'outflow_fwhm', 'outflow_vel', \
                    'BLR_Hal_peak', 'zBLR', 'BLR_alp1', 'BLR_alp2', 'BLR_sig'
        
        
        """
        self.model= model
        self.template = None
        if self.priors['z'][0]==0:
            self.priors['z'][0]=self.z
            if (self.priors['z'][1]=='normal_hat') & (self.priors['z'][2]==0):
                self.priors['z'][2] = self.z
                self.priors['z'][3] = 200/3e5*(1+self.z)
                self.priors['z'][4] = self.z-1000/3e5*(1+self.z)
                self.priors['z'][5] = self.z+1000/3e5*(1+self.z)
        try:
            if self.priors['zBLR'][0]==0:
                self.priors['zBLR'][0]=self.z
        except:
            lksdf=0
            
        self.fluxs[np.isnan(self.fluxs)] = 0
        self.flux = self.fluxs.data[np.invert(self.fluxs.mask)]
        self.wave = self.wave[np.invert(self.fluxs.mask)]
         
        self.fit_loc = np.where((self.wave>(6564.52-170)*(1+self.z)/1e4)&(self.wave<(6564.52+170)*(1+self.z)/1e4))[0]
        sel=  np.where(((self.wave<(6564.52+20)*(1+self.z)/1e4))& (self.wave>(6564.52-20)*(1+self.z)/1e4))[0]
        
        self.flux_zoom = self.flux[sel]
        self.wave_zoom = self.wave[sel]

        if isinstance(self.error, np.ma.MaskedArray) == True:
            self.error = self.error.data
        self.error[~np.isfinite(self.error)] = 10000*np.nanmedian(self.error)
        self.error[self.error==0] = 10000*np.nanmedian(self.error)
        
        peak = abs(np.ma.max(self.flux_zoom))
        nwalkers=32
        
        cont = np.median(self.flux[self.fit_loc])
        if cont<0:
            cont=0.01

        if self.model=='BLR_simple':
            self.labels=['z', 'cont','cont_grad', 'Hal_peak','BLR_Hal_peak', 'NII_peak', 'Nar_fwhm', 'BLR_fwhm', 'zBLR', 'SIIr_peak', 'SIIb_peak']
            
            self.fitted_model = H_models.Halpha_wBLR
            self.log_prior_fce = logprior_general
            self.pr_code = self.prior_create()
            
            pos_l = np.array([self.z,cont,0.001, peak/2, peak/4, peak/4, self.priors['Nar_fwhm'][0], self.priors['BLR_fwhm'][0],self.priors['zBLR'][0],peak/6, peak/6])
            self.pos_l = pos_l
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
                
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)

            for i,lb in enumerate(self.labels):
                if lb =='zBLR':
                    pos[:,i] = np.random.normal(self.z,0.001, nwalkers)

            self.pos =pos
            
            self.res = {'name': 'Halpha_wth_BLR'}
        
        elif self.model=='BLR':
            self.labels=['z', 'cont','cont_grad', 'Hal_peak','BLR_Hal_peak', 'NII_peak', 'Nar_fwhm', 'BLR_fwhm', 'zBLR', 'SIIr_peak', 'SIIb_peak',\
                         'Hal_out_peak', 'NII_out_peak', 'outflow_fwhm', 'outflow_vel']
            
            self.fitted_model = H_models.Halpha_BLR_outflow
            self.log_prior_fce = logprior_general
            self.pr_code = self.prior_create()
            
            pos_l = np.array([self.z,cont,0.001, peak/2, peak/4, peak/4, self.priors['Nar_fwhm'][0], self.priors['BLR_fwhm'][0],self.priors['zBLR'][0],peak/6, peak/6,\
                              peak/6, peak/6, 700, -100])
            self.pos_l = pos_l
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
                
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
            
            self.res = {'name': 'Halpha_wth_BLR'}
        
        elif self.model=='gal':
            self.fitted_model = H_models.Halpha
            self.log_prior_fce = logprior_general
            self.labels=['z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'Nar_fwhm', 'SIIr_peak', 'SIIb_peak']
            self.pr_code = self.prior_create()
            
            pos_l = np.array([self.z,cont,0.01, peak/1.3, peak/10,self.priors['Nar_fwhm'][0],peak/6, peak/6 ])
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 

            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)

            self.res = {'name': 'Halpha_wth_BLR'}
            
                
        elif self.model=='outflow':
            self.fitted_model = H_models.Halpha_outflow
            self.log_prior_fce = logprior_general
            self.labels=['z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'Nar_fwhm', 'SIIr_peak', 'SIIb_peak', 'Hal_out_peak', 'NII_out_peak', 'outflow_fwhm', 'outflow_vel']
            self.pr_code = self.prior_create()
            
            pos_l = np.array([self.z,cont,0.01, peak/2, peak/4, self.priors['Nar_fwhm'][0],peak/6, peak/6,peak/8, peak/8, self.priors['outflow_fwhm'][0],self.priors['outflow_vel'][0] ])
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
            
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
            
            
            self.res = {'name': 'Halpha_wth_out'}
            
        
        elif self.model=='QSO_BKPL':
            
            self.labels=['z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'Nar_fwhm',
                    'Hal_out_peak', 'NII_out_peak', 
                    'outflow_fwhm', 'outflow_vel', \
                    'BLR_Hal_peak', 'zBLR', 'BLR_alp1', 'BLR_alp2', 'BLR_sig']
                
            pos_l = np.array([self.z,cont,0.01, peak/2, peak/4, self.priors['Nar_fwhm'][0],\
                              peak/6, peak/6,\
                              self.priors['outflow_fwhm'][0],self.priors['outflow_vel'][0], \
                              peak, self.priors['zBLR'][0], self.priors['BLR_alp1'][0], self.priors['BLR_alp2'][0],self.priors['BLR_sig'][0], \
                              ])
            
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0]    
            
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
            
            self.pr_code = self.prior_create()
            self.fitted_model = QSO_models.Hal_QSO_BKPL
            self.log_prior_fce = logprior_general
            self.res = {'name': 'Halpha_QSO_BKPL'}
            
        else:
            raise Exception('self.model variable not understood. Available model keywords: BLR, BLR_simple, outflow, gal, QSO_BKPL')
        
        self.flux_fitloc = self.flux[self.fit_loc]
        self.wave_fitloc = self.wave[self.fit_loc]
        self.error_fitloc = self.error[self.fit_loc]
        
        if (self.log_prior_fce(pos_l, self.pr_code)==-np.inf) | (self.log_prior_fce(pos_l, self.pr_code)== np.nan):
            print(logprior_general_test(pos_l, self.pr_code,self.labels))
                
            raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your priors\
                            boundries are sensible')

        self.init_value = pos_l
        if self.sampler =='emcee':
            nwalkers, ndim = pos.shape
            sampler = emcee.EnsembleSampler(
                nwalkers, ndim, self.log_probability_general, args=())
        
            sampler.run_mcmc(pos, self.N, progress=self.progress)
            self.flat_samples = sampler.get_chain(discard=int(0.5*self.N), thin=15, flat=True)      
            
            self.chains = {'name': 'Halpha'}
            for i in range(len(self.labels)):
                self.chains[self.labels[i]] = self.flat_samples[:,i]
                
            self.props = self.prop_calc()
            self.like_chains = sampler.get_log_prob(discard=int(0.5*self.N),thin=15, flat=True)

        elif self.sampler=='leastsq':
            from scipy.optimize import curve_fit
            popt, pcov = curve_fit(self.fitted_model, self.wave_fitloc, self.flux_fitloc, p0= pos_l, sigma=self.error_fitloc, bounds = self.bounds_est())
            errs = np.sqrt(np.diag(pcov))

            self.props = {'name': 'Halpha'}
            self.chains = {'name': 'Halpha'}
            self.props['popt'] = popt
            for i, name in enumerate(self.labels):
                self.props[name] = [popt[i], errs[i], errs[i]]
                self.chains[name] = np.random.normal(popt[i], errs[i], size=1000)
        
        else:
            raise ValueError('Sampler value not understood. Should be emcee or leastsq')

        self.chi2 = np.nansum(((self.flux_fitloc-self.fitted_model(self.wave_fitloc, *self.props['popt']))**2)/self.error_fitloc**2)
        self.BIC = self.chi2+ len(self.props['popt'])*np.log(len(self.flux_fitloc))
        
        self.yeval = self.fitted_model(self.wave, *self.props['popt'])
        
    # =============================================================================
    # Primary function to fit [OIII] with and without outflows. 
    # =============================================================================
    
    def fitting_OIII(self, model, Fe_template=0, plot=0, expand_prism=0):
        """ Method to fit [OIII] + Hbeta
        
        Parameters
        ----------

        model - str
            current valid models names and their variable names/also prior names:

            gal - 'z', 'cont','cont_grad', 'OIII_peak', 'Nar_fwhm', 'Hbeta_peak' - Hbeta and [OIII] kinematics are linked together

            outflow - 'z', 'cont','cont_grad', 'OIII_peak', 'OIII_out_peak', 'Nar_fwhm', 'outflow_fwhm', 'outflow_vel', 'Hbeta_peak', 'Hbeta_out_peak' - Hbeta and [OIII] kinematics are linked together
        
        template - str
            name of the FeII template you want to fit - Tsuzuki, BG92, Veron

        """
        
        self.model = model
        self.template = Fe_template
        if self.priors['z'][0]==0:
            self.priors['z'][0]=self.z
            if (self.priors['z'][1]=='normal_hat') & (self.priors['z'][2]==0):
                self.priors['z'][2] = self.z
                self.priors['z'][3] = 200/3e5*(1+self.z)
                self.priors['z'][4] = self.z-1000/3e5*(1+self.z)
                self.priors['z'][5] = self.z+1000/3e5*(1+self.z)
        
        if self.priors['zBLR'][0]==0:
            self.priors['z'][0]=self.z
            if (self.priors['zBLR'][1]=='normal_hat') & (self.priors['zBLR'][2]==0):
                self.priors['zBLR'][2] = self.z
                self.priors['zBLR'][3] = 200/3e5*(1+self.z)
                self.priors['zBLR'][4] = self.z-1000/3e5*(1+self.z)
                self.priors['zBLR'][5] = self.z+1000/3e5*(1+self.z)

        self.flux = self.fluxs.data[np.invert(self.fluxs.mask)]
        self.wave = self.wave[np.invert(self.fluxs.mask)]
        
        self.fit_loc = np.where((self.wave>4700*(1+self.z)/1e4)&(self.wave<5100*(1+self.z)/1e4))[0]
        if expand_prism==1:
            self.fit_loc = np.where((self.wave>4600*(1+self.z)/1e4)&(self.wave<5600*(1+self.z)/1e4))[0]

        sel=  np.where((self.wave<5025*(1+self.z)/1e4)& (self.wave>4980*(1+self.z)/1e4))[0]
        self.flux_zoom = self.flux[sel]
        self.wave_zoom = self.wave[sel]
        
        try:
            peak_loc = np.argmax(self.flux_zoom)
            peak = abs((np.max(self.flux_zoom)))
        except:
            peak_loc = np.argmax(self.flux[self.fit_loc])
            peak = abs((np.max(self.flux[self.fit_loc])))

        selb =  np.where((self.wave<4880*(1+self.z)/1e4)& (self.wave>4820*(1+self.z)/1e4))[0]
        self.flux_zoomb = self.flux[selb]
        self.wave_zoomb = self.wave[selb]
        try:
            peak_loc_beta = np.argmax(self.flux_zoomb)
            peak_beta = abs((np.max(self.flux_zoomb)))
        except:
            peak_beta = abs(peak/3)

        if isinstance(self.error, np.ma.MaskedArray) == True:
            self.error = self.error.data
        self.error[~np.isfinite(self.error)] = 10000*np.nanmedian(self.error)
        self.error[self.error==0] = 10000*np.nanmedian(self.error)

        nwalkers=64

        if  (self.model=='outflow_simple') | (self.model=='outflow'):
            self.labels=['z', 'cont','cont_grad', 'OIII_peak', 'OIII_out_peak', 'Nar_fwhm', 'outflow_fwhm', 'outflow_vel', 'Hbeta_peak', 'Hbeta_out_peak']
            self.fitted_model = O_models.OIII_outflow
            self.log_prior_fce = logprior_general
            self.pr_code = self.prior_create()
            
            cont_init = abs(np.median(self.flux[self.fit_loc]))
            pos_l = np.array([self.z,cont_init,0.001, peak/2, peak/6, self.priors['Nar_fwhm'][0], self.priors['outflow_fwhm'][0],self.priors['outflow_vel'][0], peak_beta, peak_beta/3])
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
            
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)

            if (self.log_prior_fce(pos_l, self.pr_code)==-np.inf) | (self.log_prior_fce(pos_l, self.pr_code)== np.nan):
                print(logprior_general_test(pos_l, self.pr_code,self.labels))
                
                raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your priors\
                            boundries are sensible')
            
            self.res = {'name': 'OIII_outflow_simple'}
        
        elif (self.model== 'gal_simple') | (self.model== 'gal'):
            self.labels=['z', 'cont','cont_grad', 'OIII_peak', 'Nar_fwhm', 'Hbeta_peak']
            self.fitted_model = O_models.OIII_gal
            self.log_prior_fce = logprior_general
            self.pr_code = self.prior_create()
            cont_init = abs(np.median(self.flux[self.fit_loc]))
            pos_l = np.array([self.z,cont_init,0.001, peak/2, self.priors['Nar_fwhm'][0], peak_beta])
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
            
            self.res = {'name': 'OIII_simple'}

            if (self.log_prior_fce(pos_l, self.pr_code)==-np.inf) | (self.log_prior_fce(pos_l, self.pr_code)== np.nan):
                print(logprior_general_test(pos_l, self.pr_code,self.labels))
                
                raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your priors\
                            boundries are sensible')
            
        elif (self.model=='BLR_simple'):
            
            self.labels=['z', 'cont','cont_grad', 'OIII_peak', 'Nar_fwhm', 'Hbeta_peak', 'zBLR', 'BLR_Hbeta_peak', 'BLR_fwhm']
            
            if Fe_template != 0:
                self.labels.append('Fe_peak')
                self.labels.append('Fe_fwhm')
                self.fitted_model = O_models.OIII_fe_models(self.template)
                self.fitted_model = self.fitted_model.OIII_gal_BLR_Fe

                self.res = {'name': 'OIII_BLR_simple_fe'}
                pos_l = np.array([self.z,np.median(self.flux[self.fit_loc]),0.001, peak/2, self.priors['Nar_fwhm'][0], peak_beta, self.z, peak_beta/2, self.priors['BLR_fwhm'][0],\
                                np.median(self.flux[self.fit_loc]), self.priors['Fe_fwhm'][0]])

            else:
                pos_l = np.array([self.z,np.median(self.flux[self.fit_loc]),0.001, peak/2, self.priors['Nar_fwhm'][0], peak_beta, self.z, peak_beta/2, self.priors['BLR_fwhm'][0]])
                self.fitted_model = O_models.OIII_gal_BLR
                self.res = {'name': 'OIII_BLR_simple'}
                
            self.log_prior_fce = logprior_general
            self.pr_code = self.prior_create()
                    
            
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
            
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)

            if (self.log_prior_fce(pos_l, self.pr_code)==-np.inf) | (self.log_prior_fce(pos_l, self.pr_code)== np.nan):
                print(logprior_general_test(pos_l, self.pr_code,self.labels))
                
                raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your priors\
                            boundries are sensible')
            
            self.res = {'name': 'OIII_BLR_simple'}
        
        elif (self.model== 'BLR_outflow'):

            self.labels=['z', 'cont','cont_grad', 'OIII_peak', 'OIII_out_peak', 'Nar_fwhm', 'outflow_fwhm', 'outflow_vel', 'Hbeta_peak', 'Hbeta_out_peak','zBLR', 'BLR_Hbeta_peak', 'BLR_fwhm']
            
            if Fe_template != 0:
                self.labels.append('Fe_peak')
                self.labels.append('Fe_fwhm')
                self.fitted_model = O_models.OIII_fe_models(self.template)
                self.fitted_model = self.fitted_model.OIII_outflow_BLR_Fe

                pos_l = np.array([self.z,np.median(self.flux[self.fit_loc]),0.001, peak/2, peak/6, self.priors['Nar_fwhm'][0], self.priors['outflow_fwhm'][0],self.priors['outflow_vel'][0], peak_beta, peak_beta/3,\
                                  self.z, peak_beta/2, self.priors['BLR_fwhm'][0],\
                                  np.median(self.flux[self.fit_loc]), self.priors['Fe_fwhm'][0]])
                self.res = {'name': 'BLR_outflow_Fe'}
                
                
            else:
                self.fitted_model = O_models.OIII_outflow_BLR
                pos_l = np.array([self.z,np.median(self.flux[self.fit_loc]),0.001, peak/2, peak/6, self.priors['Nar_fwhm'][0], self.priors['outflow_fwhm'][0],self.priors['outflow_vel'][0], peak_beta, peak_beta/3,\
                                 self.z, peak_beta/2, self.priors['BLR_fwhm'][0]])
                self.res = {'name': 'BLR_outflow'}
                
            self.log_prior_fce = logprior_general
            self.pr_code = self.prior_create()
                        
                
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
            
            if (self.log_prior_fce(pos_l, self.pr_code)==-np.inf) | (self.log_prior_fce(pos_l, self.pr_code)== np.nan):
                print(logprior_general_test(pos_l, self.pr_code,self.labels))
                
                raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your priors\
                            boundries are sensible')
                  
        elif self.model=='QSO_BKPL':
            self.labels=('z', 'cont','cont_grad', 'OIII_peak', 'OIII_out_peak', 'Nar_fwhm', 'outflow_fwhm',\
                        'outflow_vel', 'BLR_peak', 'zBLR', 'BLR_alp1', 'BLR_alp2','BLR_sig' ,\
                        'Hb_nar_peak', 'Hb_out_peak')
                
            pos_l = np.array([self.z,np.median(self.flux[self.fit_loc]),0.001, peak/2, peak/6,\
                    self.priors['Nar_fwhm'][0], self.priors['outflow_fwhm'][0],self.priors['outflow_vel'][0],\
                    peak_beta, self.priors['zBLR'][0], self.priors['BLR_alp1'][0], self.priors['BLR_alp2'][0],self.priors['BLR_sig'][0], \
                    peak_beta/4, peak_beta/4])
            
                
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0]    
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
            pos[:,9] = np.random.normal(self.z,0.001, nwalkers)
            
            self.pr_code = self.prior_create()
            self.fitted_model = QSO_models.OIII_QSO_BKPL
            self.log_prior_fce = logprior_general_scipy
            self.res = {'name': 'OIII_QSO_BKP'}
            
        else:
            raise Exception('self.model variable not understood. Available self.model keywords: outflow_simple, BLR_simple, BLR_outflow,  gal_simple, QSO_BKPL')
         
        nwalkers, ndim = pos.shape

        self.flux_fitloc = self.flux[self.fit_loc]
        self.wave_fitloc = self.wave[self.fit_loc]
        self.error_fitloc = self.error[self.fit_loc]
        if self.sampler =='emcee':
            
            sampler = emcee.EnsembleSampler(
                        nwalkers, ndim, self.log_probability_general, args=())
            
            sampler.run_mcmc(pos, self.N, progress=self.progress)
            self.flat_samples = sampler.get_chain(discard=int(0.5*self.N), thin=15, flat=True)      
            
            self.chains = {'name': 'OIII'}
            for i in range(len(self.labels)):
                self.chains[self.labels[i]] = self.flat_samples[:,i]
            
            self.like_chains = sampler.get_log_prob(discard=int(0.5*self.N),thin=15, flat=True)
            self.props = self.prop_calc()
        elif self.sampler=='leastsq':
            from scipy.optimize import curve_fit

            use = pos_l < self.bounds_est()[0]
            if True in use:
                raise ValueError(f'Initial guess is outside of the lower bounds {print(self.labels[use])}')
            use = pos_l > self.bounds_est()[1]
            if True in use:
                raise ValueError(f'Initial guess is outside of the higher bounds in {print(self.labels[use])}')
            
            popt, pcov = curve_fit(self.fitted_model, self.wave_fitloc, self.flux_fitloc, p0= pos_l, sigma=self.error_fitloc, bounds = self.bounds_est())
            errs = np.sqrt(np.diag(pcov))

            self.props = {'name': 'OIII'}
            self.chains = {'name': 'OIII'}
            self.props['popt'] = popt
            for i, name in enumerate(self.labels):
                self.props[name] = [popt[i], errs[i], errs[i]]
                self.chains[name] = np.random.normal(popt[i], errs[i], size=1000)
        
        else:
            raise ValueError('Sampler value not understood. Should be emcee or leastsq')
        
        self.yeval = self.fitted_model(self.wave, *self.props['popt'])
        self.yeval_fitloc = self.fitted_model(self.wave_fitloc, *self.props['popt'])

        self.chi2 = np.nansum(((self.flux_fitloc-self.yeval[self.fit_loc])/self.error_fitloc)**2)
        self.BIC = self.chi2+ len(self.props['popt'])*np.log(len(self.flux_fitloc))
        
    def fitting_Halpha_OIII(self, model, template=0):
        """ Method to fit Halpha + [OIII] + Hbeta+ [NII] + [SII]
        
        Parameters
        ----------

        model - str
            current valid models names and their variable names/also prior names:

            gal - 'z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'Nar_fwhm', 'SIIr_peak', 'SIIb_peak', 'OIII_peak', 'Hbeta_peak'

            outflow - 'z', 'cont','cont_grad', 'Hal_peak', 'NII_peak','OIII_peak', 'Hbeta_peak','SIIr_peak', 'SIIb_peak','Nar_fwhm', 'outflow_fwhm', 'outflow_vel', 'Hal_out_peak','NII_out_peak', 'OIII_out_peak', 'Hbeta_out_peak' 
            
            BLR - 'z', 'cont','cont_grad', 'Hal_peak', 'NII_peak','OIII_peak', 'Hbeta_peak','SIIr_peak', 'SIIb_peak',\
                    'Nar_fwhm', 'outflow_fwhm', 'outflow_vel', 'Hal_out_peak','NII_out_peak', 'OIII_out_peak', 'Hbeta_out_peak' ,\
                    'BLR_fwhm', 'zBLR', 'BLR_Hal_peak', 'BLR_Hbeta_peak'

            BLR_simple - 'z', 'cont','cont_grad', 'Hal_peak', 'NII_peak','OIII_peak', 'Hbeta_peak','SIIr_peak', 'SIIb_peak',\
                    'Nar_fwhm', 'BLR_fwhm', 'zBLR', 'BLR_Hal_peak', 'BLR_Hbeta_peak'
        
        """
        self.template = template
        self.model = model
        
        if self.priors['z'][0]==0:
            self.priors['z'][0]=self.z
            if (self.priors['z'][1]=='normal_hat') & (self.priors['z'][2]==0):
                self.priors['z'][2] = self.z
                self.priors['z'][3] = 200/3e5*(1+self.z)
                self.priors['z'][4] = self.z-1000/3e5*(1+self.z)
                self.priors['z'][5] = self.z+1000/3e5*(1+self.z)
        try:
            if self.priors['zBLR'][2]==0:
                self.priors['zBLR'][2]=self.z
        except:
            lksdf=0
            
            
        self.flux = self.fluxs.data[np.invert(self.fluxs.mask)]
        self.waves = self.wave.copy()
        self.wave = self.wave[np.invert(self.fluxs.mask)]
        
        self.fit_loc = np.where((self.wave>4700*(1+self.z)/1e4)&(self.wave<5100*(1+self.z)/1e4))[0]
        self.fit_loc = np.append(self.fit_loc, np.where((self.wave>(6300-50)*(1+self.z)/1e4)&(self.wave<(6300+50)*(1+self.z)/1e4))[0])
        self.fit_loc = np.append(self.fit_loc, np.where((self.wave>(6564.52-170)*(1+self.z)/1e4)&(self.wave<(6564.52+170)*(1+self.z)/1e4))[0])

        if isinstance(self.error, np.ma.MaskedArray) == True:
            self.error = self.error.data
        self.error[~np.isfinite(self.error)] = 10000*np.nanmedian(self.error)
        self.error[self.error==0] = 10000*np.nanmedian(self.error)
    # =============================================================================
    #     Finding the initial conditions
    # =============================================================================
        sel=  np.where((self.wave<5025*(1+self.z)/1e4)& (self.wave>4980*(1+self.z)/1e4))[0]
        self.flux_zoom = self.flux[sel]
        self.wave_zoom = self.wave[sel]
        try:
            peak_loc_OIII = np.argmax(self.flux_zoom)
            peak_OIII = (np.max(self.flux_zoom))
        except:
            peak_OIII = np.max(self.flux[self.fit_loc])
        
        sel=  np.where(((self.wave<(6564.52+20)*(1+self.z)/1e4))& (self.wave>(6564.52-20)*(1+self.z)/1e4))[0]
        self.flux_zoom = self.flux[sel]
        self.wave_zoom = self.wave[sel]
        
        peak_loc = np.ma.argmax(self.flux_zoom)
        
        znew = self.wave_zoom[peak_loc]/0.656452-1
        peak_hal = np.ma.max(self.flux_zoom)
        if peak_hal<0:
            peak_hal==3e-3
        
    # =============================================================================
    #   Setting up fitting  
    # =============================================================================
        if self.model=='gal':
            #self.priors['z'] = [z, z-zcont, z+zcont]
            nwalkers=64
            self.fitted_model = HO_models.Halpha_OIII
            self.log_prior_fce = logprior_general
            self.labels=['z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'Nar_fwhm', 'SIIr_peak', 'SIIb_peak', 'OIII_peak', 'Hbeta_peak']
            self.pr_code = self.prior_create()
            
            cont_init = np.median(self.flux[self.fit_loc])
            if cont_init<0:
                cont_init = abs(cont_init)
            pos_l = np.array([self.z, cont_init, -0.1, peak_hal*0.7, peak_hal*0.3, self.priors['Nar_fwhm'][0], peak_hal*0.15, peak_hal*0.2, peak_OIII*0.8,\
                              peak_hal*0.2])  
            
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
                
            if (self.log_prior_fce(pos_l, self.pr_code)==-np.inf):
                logprior_general_test(pos_l, self.pr_code, self.labels)
                
                raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your self.priors\
                                boundries are sensible. {pos_l}')
               
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
            
            self.res = {'name': 'Halpha_OIII'}
            
            
        elif self.model=='outflow':
            nwalkers=64
            self.fitted_model = HO_models.Halpha_OIII_outflow
            
            self.labels=('z', 'cont','cont_grad', 'Hal_peak', 'NII_peak','OIII_peak', 'Hbeta_peak','SIIr_peak', 'SIIb_peak',\
                    'Nar_fwhm', 'outflow_fwhm', 'outflow_vel', 'Hal_out_peak','NII_out_peak', 'OIII_out_peak', 'Hbeta_out_peak' )
            
            self.pr_code = self.prior_create()
            self.log_prior_fce = logprior_general
            cont_init = np.median(self.flux[self.fit_loc])
            if cont_init<0:
                cont_init = abs(cont_init)

            pos_l = np.array([self.z,cont_init, -0.1, peak_hal*0.7, peak_hal*0.3, \
                              peak_OIII*0.8, peak_hal*0.2, peak_hal*0.2, peak_hal*0.2, \
                              self.priors['Nar_fwhm'][0], self.priors['outflow_fwhm'][0], self.priors['outflow_vel'][0],
                              peak_hal*0.3, peak_hal*0.3, peak_OIII*0.2, peak_hal*0.05])
            
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
                
            if (self.log_prior_fce(pos_l, self.pr_code)==-np.inf):
                
                logprior_general_test(pos_l, self.pr_code, self.labels)
                
                raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your self.priors\
                                boundries are sensible. {%pos_l}')
                                
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
            
            self.res = {'name': 'Halpha_OIII_outflow'}
            
            
        elif self.model=='BLR':
            self.labels=('z', 'cont','cont_grad', 'Hal_peak', 'NII_peak','OIII_peak', 'Hbeta_peak','SIIr_peak', 'SIIb_peak',\
                    'Nar_fwhm', 'outflow_fwhm', 'outflow_vel', 'Hal_out_peak','NII_out_peak', 'OIII_out_peak', 'Hbeta_out_peak' ,\
                    'BLR_fwhm', 'zBLR', 'BLR_Hal_peak', 'BLR_Hbeta_peak')
                
            nwalkers=64
            
            if self.priors['BLR_Hal_peak'][2]=='self.error':
                self.priors['BLR_Hal_peak'][2]=self.error[-2]; self.priors['BLR_Hal_peak'][3]=self.error[-2]*2
            if self.priors['BLR_Hbeta_peak'][2]=='self.error':
                self.priors['BLR_Hbeta_peak'][2]=self.error[2]; self.priors['BLR_Hbeta_peak'][3]=self.error[2]*2
            
            self.pr_code = self.prior_create()
            self.log_prior_fce = logprior_general
            self.fitted_model = HO_models.Halpha_OIII_BLR
            cont_init = np.median(self.flux[self.fit_loc])
            if cont_init<0:
                cont_init = abs(cont_init)
            pos_l = np.array([self.z,cont_init, -0.1, peak_hal*0.7, peak_hal*0.3, \
                              peak_OIII*0.8, peak_hal*0.3 , peak_hal*0.2, peak_hal*0.2,\
                              self.priors['Nar_fwhm'][0], self.priors['outflow_fwhm'][0], self.priors['outflow_vel'][0],
                              peak_hal*0.3, peak_hal*0.3, peak_OIII*0.2, peak_hal*0.1,\
                              self.priors['BLR_fwhm'][0], self.priors['zBLR'][0], peak_hal*0.3, peak_hal*0.1])
                
            for i in enumerate(self.labels):
                pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
                 
            
            
            if (self.log_prior_fce(pos_l, self.pr_code)==np.nan)|\
                (self.log_prior_fce(pos_l, self.pr_code)==-np.inf):
                print(logprior_general_test(pos_l, self.pr_code, self.labels))
                raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your self.priors\
                                boundries are sensible. {pos_l} ')
            
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
            pos[:,-3] = np.random.normal(self.priors['zBLR'][0],0.00001, nwalkers)
           
            self.res = {'name': 'Halpha_OIII_BLR'}
            
        elif self.model=='BLR_simple':
            if self.template==0:
                self.labels=('z', 'cont','cont_grad', 'Hal_peak', 'NII_peak','OIII_peak', 'Hbeta_peak','SIIr_peak', 'SIIb_peak',\
                        'Nar_fwhm', 'BLR_fwhm', 'zBLR', 'BLR_Hal_peak', 'BLR_Hbeta_peak')
                    
                nwalkers=64
                
                if self.priors['BLR_Hal_peak'][2]=='self.error':
                    self.priors['BLR_Hal_peak'][2]=self.error[-2]; self.priors['BLR_Hal_peak'][3]=self.error[-2]*2
                if self.priors['BLR_Hbeta_peak'][2]=='self.error':
                    self.priors['BLR_Hbeta_peak'][2]=self.error[2]; self.priors['BLR_Hbeta_peak'][3]=self.error[2]*2
                
                self.pr_code = self.prior_create(self.labels, self.priors) 
                self.log_prior_fce = logprior_general
                self.fitted_model = HO_models.Halpha_OIII_BLR_simple
                
                cont_init = np.median(self.flux[self.fit_loc])
                if cont_init<0:
                    cont_init = abs(cont_init)

                pos_l = np.array([self.z,cont_init, -0.1, peak_hal*0.7, peak_hal*0.3, \
                                peak_OIII*0.8, peak_hal*0.3 , peak_hal*0.2, peak_hal*0.2,\
                                self.priors['Nar_fwhm'][0], self.priors['BLR_fwhm'][0], self.priors['zBLR'][0], peak_hal*0.3, peak_hal*0.1])
                    
                for i in enumerate(self.labels):
                    pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
                
                if (self.log_prior_fce(pos_l, self.pr_code)==np.nan)|\
                    (self.log_prior_fce(pos_l, self.pr_code)==-np.inf):
                    print(logprior_general_test(pos_l, self.pr_code, self.labels))
                    raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your self.priors\
                                    boundries are sensible. {pos_l} ')
                
                pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
                pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
                pos[:,-3] = np.random.normal(self.priors['zBLR'][0],0.00001, nwalkers)
            
                self.res = {'name': 'Halpha_OIII_BLR_simple'}
            
            else:
                self.labels=('z', 'cont','cont_grad', 'Hal_peak', 'NII_peak','OIII_peak', 'Hbeta_peak','SIIr_peak', 'SIIb_peak',\
                        'Nar_fwhm', 'BLR_fwhm', 'zBLR', 'BLR_Hal_peak', 'BLR_Hbeta_peak', 'Fe_peak', 'Fe_FWHM')
                    
                nwalkers=64
                
                if self.priors['BLR_Hal_peak'][2]=='self.error':
                    self.priors['BLR_Hal_peak'][2]=self.error[-2]; self.priors['BLR_Hal_peak'][3]=self.error[-2]*2
                if self.priors['BLR_Hbeta_peak'][2]=='self.error':
                    self.priors['BLR_Hbeta_peak'][2]=self.error[2]; self.priors['BLR_Hbeta_peak'][3]=self.error[2]*2
                
                self.pr_code = self.prior_create(self.labels, self.priors) 
                self.log_prior_fce = logprior_general
                self.fitted_model = HO_models.Halpha_OIII_BLR_simple
                
                cont_init = np.median(self.flux[self.fit_loc])
                if cont_init<0:
                    cont_init = abs(cont_init)

                pos_l = np.array([self.z,cont_init, -0.1, peak_hal*0.7, peak_hal*0.3, \
                                peak_OIII*0.8, peak_hal*0.3 , peak_hal*0.2, peak_hal*0.2,\
                                self.priors['Nar_fwhm'][0], self.priors['BLR_fwhm'][0], self.priors['zBLR'][0], peak_hal*0.3, peak_hal*0.1, cont_init, self.priors['Fe_FWHM'][0]])
                    
                for i in enumerate(self.labels):
                    pos_l[i[0]] = pos_l[i[0]] if self.priors[i[1]][0]==0 else self.priors[i[1]][0] 
                
                if (self.log_prior_fce(pos_l, self.pr_code)==np.nan)|\
                    (self.log_prior_fce(pos_l, self.pr_code)==-np.inf):
                    print(logprior_general_test(pos_l, self.pr_code, self.labels))
                    raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your self.priors\
                                    boundries are sensible. {pos_l} ')
                
                pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
                pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
                pos[:,-3] = np.random.normal(self.priors['zBLR'][0],0.00001, nwalkers)
            
                self.res = {'name': 'Halpha_OIII_BLR_simple'}
            
            
        elif self.model=='QSO_BKPL':
            self.labels =[ 'z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'OIII_peak','Hbeta_peak', 'Nar_fwhm', \
                                  'Hal_out_peak', 'NII_out_peak','OIII_out_peak', 'Hbeta_out_peak',\
                                  'outflow_fwhm', 'outflow_vel',\
                                  'Hal_BLR_peak', 'Hbeta_BLR_peak',  'BLR_vel', 'BLR_alp1', 'BLR_alp2', 'BLR_sig']
        
        
            nwalkers=64
            self.pr_code = self.prior_create(self.labels, self.priors)   
            self.log_prior_fce = logprior_general
            self.fitted_model =  QSO_models.Halpha_OIII_QSO_BKPL
            cont_init = np.median(self.flux[self.fit_loc])
            if cont_init<0:
                cont_init = abs(cont_init)

            pos_l = np.array([self.z,cont_init, -0.1, peak_hal*0.7, peak_hal*0.3, \
                              peak_OIII*0.8, peak_OIII*0.3,self.priors['Nar_fwhm'][0],\
                              peak_hal*0.2, peak_hal*0.3, peak_OIII*0.4, peak_OIII*0.2   ,\
                              self.priors['outflow_fwhm'][0], self.priors['outflow_vel'][0],\
                              peak_hal*0.4, peak_OIII*0.4, self.priors['BLR_vel'][0], 
                              self.priors['BLR_alp1'][0], self.priors['BLR_alp2'][0],self.priors['BLR_sig'][0]])
            
            if (self.log_prior_fce(pos_l, self.pr_code)==np.nan)|\
                (self.log_prior_fce(pos_l, self.pr_code)==-np.inf):
                raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your self.priors\
                                boundries are sensible: {pos_l}')
                                
            pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
            pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
            
            self.res = {'name': 'Halpha_OIII_BLR'}
            
        else:
            raise Exception('self.model variable not understood. Available self.model keywords: outflow, gal, QSO_BKPL')
        
        self.flux_fitloc = self.flux[self.fit_loc]
        self.wave_fitloc = self.wave[self.fit_loc]
        self.error_fitloc = self.error[self.fit_loc]

        if self.sampler =='emcee':
            nwalkers, ndim = pos.shape
            sampler = emcee.EnsembleSampler(
                nwalkers, ndim, self.log_probability_general, args=())
        
            sampler.run_mcmc(pos, self.N, progress=self.progress)
            self.flat_samples = sampler.get_chain(discard=int(0.5*self.N), thin=15, flat=True)      
            
            self.chains = {'name': 'Halpha_OIII'}
            for i in range(len(self.labels)):
                self.chains[self.labels[i]] = self.flat_samples[:,i]
                
            self.props = self.prop_calc()
        elif self.sampler=='leastsq':
            from scipy.optimize import curve_fit
            popt, pcov = curve_fit(self.fitted_model, self.wave_fitloc, self.flux_fitloc, p0= pos_l, sigma=self.error_fitloc, bounds = self.bounds_est())
            errs = np.sqrt(np.diag(pcov))

            self.props = {'name': 'Halpha_OIII'}
            self.chains = {'name': 'Halpha_OIII'}
            self.props['popt'] = popt
            for i, name in enumerate(self.labels):
                self.props[name] = [popt[i], errs[i], errs[i]]
                self.chains[name] = np.random.normal(popt[i], errs[i], size=1000)
        
        else:
            raise ValueError('Sampler value not understood. Should be emcee or leastsq')


        self.yeval = self.fitted_model(self.wave, *self.props['popt'])
        
        self.chi2 = np.nansum(((self.flux_fitloc-self.yeval[self.fit_loc])/self.error_fitloc)**2)
        self.BIC = self.chi2+ len(self.props['popt'])*np.log(len(self.flux_fitloc))

        
    def fitting_general(self, fitted_model, labels, logprior=None, nwalkers=64, skip_check=False, zscale=0.001, odd=False):
        """ Fitting any general function that you pass. You need to put in fitted_model, labels and
        you can pass logprior function or number of walkers.  

        Parameters
        ----------

        fitted_model : callable
            Function to fit

        labels : list
            list of the name of the paramters in the same order as in the fitted_function

        priors: dict - optional
            dictionary with all of the priors to update
        
        logprior: callable function
            logprior evaluation function - use emfit.logprior_general or emfit.logprior_general_scipy
        
        nwalkers : int - optional
            default 64 walkers for the MCMC
                 
        """
        self.template= None
        self.labels= labels
        if logprior !=None:
            self.log_prior_fce = logprior_general
        else: 
            self.log_prior_fce = logprior
        self.fitted_model = fitted_model
        
        if self.priors['z'][2]==0:
            self.priors['z'][2]=self.z

        if isinstance(self.error, np.ma.MaskedArray) == True:
            self.error = self.error.data
        self.error[~np.isfinite(self.error)] = 10000*np.nanmedian(self.error)
        self.error[self.error==0] = 10000*np.nanmedian(self.error)
            
        self.flux = self.fluxs.data[np.invert(self.fluxs.mask)]
        self.waves = self.wave[np.invert(self.fluxs.mask)]
        self.errors = self.error[np.invert(self.fluxs.mask)]

        self.flux_fitloc = self.flux.copy()
        self.wave_fitloc = self.waves.copy()
        self.error_fitloc = self.errors.copy()

        if odd==True:
            if len(self.flux_fitloc) % 2 == 0:
                self.flux_fitloc = self.flux_fitloc[:-1]
                self.wave_fitloc = self.wave_fitloc[:-1]
                self.error_fitloc = self.error_fitloc[:-1]

        self.pr_code = self.prior_create()
       
        pos_l = np.zeros(len(self.labels))
            
        for i, name in enumerate(self.labels):
            pos_l[i] = self.priors[name][0] 

            if ('_peak' in name) & (self.priors[name][0] ==0):
                pos_l[i] = np.nanmean(self.error_fitloc)*np.random.uniform(5,10)
            
            if ('cont' == name) & (self.priors[name][0] ==0):
                pos_l[i] = np.nanmedian(self.flux_fitloc)*5
            
                
        if (self.log_prior_fce(pos_l, self.pr_code)==-np.inf) | (self.log_prior_fce(pos_l, self.pr_code)== np.nan):
            logprior_general_test(pos_l, self.pr_code, self.labels)
                
            raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your priors\
                            boundries are sensible')
                
        pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
        pos[:,0] = np.random.normal(self.z,zscale, nwalkers)

        self.pos = pos
        self.pos_l = pos_l

        if self.sampler =='emcee':
            nwalkers, ndim = pos.shape
        
            if self.ncpu==1:
                sampler = emcee.EnsembleSampler(
                    nwalkers, ndim, self.log_probability_general, args=()) 
                sampler.run_mcmc(pos, self.N, progress=self.progress,skip_initial_state_check=skip_check)
            
            elif self.ncpu>1:
                from multiprocess import Pool
                with Pool(self.ncpu) as pool:
                    sampler = emcee.EnsembleSampler(
                        nwalkers, ndim, self.log_probability_general, args=(), pool=pool) 
                
                    sampler.run_mcmc(pos, self.N, progress=self.progress)

            self.flat_samples = sampler.get_chain(discard=int(0.5*self.N), thin=15, flat=True)
            self.like_chains = sampler.get_log_prob(discard=int(0.5*self.N),thin=15, flat=True)
            self.chains = {'name': 'Custom model'}
            for i in range(len(self.labels)):
                self.chains[self.labels[i]] = self.flat_samples[:,i]
            
            self.props = self.prop_calc()
        elif self.sampler=='leastsq':
            from scipy.optimize import curve_fit
            use = ~(np.isnan(self.flux_fitloc) | np.isinf(self.flux_fitloc))
            self.error_fitloc[np.isnan(self.error_fitloc)] = 1e6
            
            #print(self.bounds_est())
            #print ( np.sum( (self.wave_fitloc[use]-self.fitted_model(self.wave_fitloc[use],*pos_l ))/self.error_fitloc[use]))
            #print ( np.sum( (self.wave_fitloc[use]-self.fitted_model(self.wave_fitloc[use],*self.bounds_est()[0] ))/self.error_fitloc[use]))
            #print ( np.sum( (self.wave_fitloc[use]-self.fitted_model(self.wave_fitloc[use],*self.bounds_est()[1] ))/self.error_fitloc[use]))

            popt, pcov = curve_fit(self.fitted_model, self.wave_fitloc[use], self.flux_fitloc[use], p0= pos_l, sigma=self.error_fitloc[use], bounds = self.bounds_est())
            errs = np.sqrt(np.diag(pcov))

            self.props = {'name': 'Custom model'}
            self.chains = {'name': 'Custom model'}
            self.props['popt'] = popt
            for i, name in enumerate(self.labels):
                self.props[name] = [popt[i], errs[i], errs[i]]
                self.chains[name] = np.random.normal(popt[i], errs[i], size=1000)
        
        else:
            raise ValueError('Sampler value not understood. Should be emcee or leastsq')

        try:
            self.yeval = self.fitted_model(self.wave, *self.props['popt'])
        except:
            self.yeval = np.zeros_like(self.wave)

        try:
            self.yeval_fitloc = self.fitted_model(self.wave_fitloc, *self.props['popt'])
        except:
            self.yeval_fitloc = np.zeros_like(self.wave_fitloc)
        
        self.chi2 = np.nansum(((self.flux_fitloc-self.yeval_fitloc)/self.error_fitloc)**2)
        self.BIC = self.chi2+ len(self.props['popt'])*np.log(len(self.flux_fitloc))


    def fitting_general_test(self, fitted_model, labels, logprior=None, nwalkers=64, template=None):
        """ Fitting any general function that you pass. You need to put in fitted_model, labels and
        you can pass logprior function or number of walkers.        
        """
        self.template= template
        self.labels= labels
        if logprior !=None:
            self.log_prior_fce = logprior_general_scipy
        else: 
            self.log_prior_fce = logprior
        self.fitted_model = fitted_model
        
        if self.priors['z'][2]==0:
            self.priors['z'][2]=self.z

        if isinstance(self.error, np.ma.MaskedArray) == True:
            self.error = self.error.data
        self.error[~np.isfinite(self.error)] = 10000*np.nanmedian(self.error)
        self.error[self.error==0] = 10000*np.nanmedian(self.error)
            
        self.flux = self.fluxs.data[np.invert(self.fluxs.mask)]
        self.waves = self.wave[np.invert(self.fluxs.mask)]
        self.errors = self.error[np.invert(self.fluxs.mask)]

        self.flux_fitloc = self.flux.copy()
        self.wave_fitloc = self.waves.copy()
        self.error_fitloc = self.errors.copy()

        self.pr_code = self.prior_create()
       
        pos_l = np.zeros(len(self.labels))
            
        for i in enumerate(self.labels):
            pos_l[i[0]] = self.priors[i[1]][0] 
                
        if (self.log_prior_fce(pos_l, self.pr_code)==-np.inf) | (self.log_prior_fce(pos_l, self.pr_code)== np.nan):
            logprior_general_test(pos_l, self.pr_code, self.labels)
                
            raise Exception('Logprior function returned nan or -inf on initial conditions. You should double check that your priors\
                            boundries are sensible')
                
        pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
        pos[:,0] = np.random.normal(self.z,0.001, nwalkers)
        
        nwalkers, ndim = pos.shape
        
        if self.ncpu==1:
            sampler = emcee.EnsembleSampler(
                nwalkers, ndim, self.log_probability_general, args=()) 
            sampler.run_mcmc(pos, self.N, progress=self.progress)
        
        elif self.ncpu>1:
            from multiprocess import Pool
            with Pool(self.ncpu) as pool:
                sampler = emcee.EnsembleSampler(
                    nwalkers, ndim, self.log_probability_general, args=(), pool=pool) 
            
                sampler.run_mcmc(pos, self.N, progress=self.progress)

        self.flat_samples = sampler.get_chain(discard=int(0.5*self.N), thin=15, flat=True)
        self.like_chains = sampler.get_log_prob(discard=int(0.5*self.N),thin=15, flat=True)
        self.chains = {'name': 'Custom model'}
        for i in range(len(self.labels)):
            self.chains[self.labels[i]] = self.flat_samples[:,i]
        
        self.props = self.prop_calc()
        try:
            self.yeval = self.fitted_model(self.wave, *self.props['popt'])
        except:
            self.yeval = np.zeros_like(self.wave)


    def fitting_custom(self, model_inputs,model_name, nwalkers=64, template=None):
        """ Fitting any custom model that you pass with a dictionary. You need to put in fitted_model, labels and
        you can pass logprior function or number of walkers.        
        """
        self.template= template
        self.model_inputs = model_inputs
        self.model_name = model_name 
        
        
        if self.priors['z'][2]==0:
            self.priors['z'][2]=self.z
            
        self.flux = self.fluxs.data[np.invert(self.fluxs.mask)]
        self.waves = self.wave[np.invert(self.fluxs.mask)]
        self.errors = self.error[np.invert(self.fluxs.mask)]

        self.flux_fitloc = self.flux.copy()
        self.wave_fitloc = self.waves.copy()
        self.error_fitloc = self.errors.copy()
        
        self.Model = Custom_model.Model(self.model_name, model_inputs)
        self.Model.fit_to_data(self.wave_fitloc, self.flux_fitloc, self.error_fitloc, N=self.N, nwalkers=nwalkers, ncpu=1)

        self.labels= self.Model.labels
        self.chains = self.Model.chains
        self.props = self.Model.props
        self.yeval = self.Model.calculate_values(self.waves)
        self.comps = self.Model.lines


    def save(self, file_path):
        import pickle
        """save class as self.name.txt"""
        with open(file_path, "wb") as file:
            file.write(pickle.dumps(self.__dict__))
        
    def load(self, file_path):
        """try load self.name.txt"""
        import pickle
        with open(file_path, "rb") as file:
            dataPickle = file.read()
            self.__dict__ = pickle.loads(dataPickle)
    
    def log_probability_general(self, theta):
        """ Basic log probability function used in the emcee. Theta are the variables supplied by the emcee 
        """
        lp = self.log_prior_fce(theta,self.pr_code) 
        try:
            if not np.isfinite(lp):
                return -np.inf
        except:
            lp[np.isnan(lp)] = -np.inf

        try:
            evalm = self.fitted_model(self.wave_fitloc,*theta)
        except:
            evalm = self.fitted_model(self.wave_fitloc,theta)


        sigma2 = self.error_fitloc**2
        
        log_likelihood = -0.5 * np.nansum((self.flux_fitloc - evalm) ** 2 / sigma2) #+ np.log(2*np.pi*sigma2))

        
        return lp + log_likelihood
    
    def log_probability_custom(self, theta):
        """ Basic log probability function used in the emcee. Theta are the variables supplied by the emcee 
        """

        lp = self.log_prior_fce(theta,self.pr_code)
        
        try:
            if not np.isfinite(lp):
                return -np.inf
        except:
            lp[np.isnan(lp)] = -np.inf

        
        theta_dict = {}
        for i,name in enumerate(self.labels):
            theta_dict[name] = theta[i]

        evalm = self.fitted_model(self.wave_fitloc,theta_dict)


        sigma2 = self.error_fitloc**2
        log_likelihood = -0.5 * np.nansum((self.flux_fitloc - evalm) ** 2 / sigma2) #+ np.log(2*np.pi*sigma2))
        
        return lp + log_likelihood
    
    def prior_create(self):
        """ Function that takes the prior dictionary and create a priote code that the prior function as using.         
        """
        pr_code = np.zeros((len(self.labels),5))
        
        for key in enumerate(self.labels):
            if self.priors[key[1]][1]== 'normal':
                pr_code[key[0]][0] = 0
            
            elif self.priors[key[1]][1]== 'lognormal':
                pr_code[key[0]][0] = 2
            
            elif self.priors[key[1]][1]== 'uniform':
                pr_code[key[0]][0] = 1
            
            elif self.priors[key[1]][1]== 'loguniform':
                pr_code[key[0]][0] = 3
            
            elif self.priors[key[1]][1]== 'normal_hat':
                pr_code[key[0]][0] = 4
                pr_code[key[0]][3] = self.priors[key[1]][4]
                pr_code[key[0]][4] = self.priors[key[1]][5]

            elif self.priors[key[1]][1]== 'lognormal_hat':
                pr_code[key[0]][0] = 5
                pr_code[key[0]][3] = self.priors[key[1]][4]
                pr_code[key[0]][4] = self.priors[key[1]][5]
                
            else:
                raise Exception('Sorry mode in prior type not understood: ', key )
            
            pr_code[key[0]][1] = self.priors[key[1]][2]
            pr_code[key[0]][2] = self.priors[key[1]][3]

        return pr_code
    
    def prop_calc(self): 
        """ Take the dictionary with the results chains and calculates the values 
        and 1 sigma confidence interval
        
        """
        labels = list(self.chains.keys())[1:]
        res_plt = []
        res_dict = {'name': self.chains['name']}
        for lbl in labels:
            
            array = self.chains[lbl]
            
            p50,p16,p84 = np.percentile(array, (50,16,84))
            p16 = p50-p16
            p84 = p84-p50
            
            res_plt.append(p50)
            res_dict[lbl] = np.array([p50,p16,p84])
            
        res_dict['popt'] = res_plt
        return res_dict
    
    def corner(self,):
        import corner

        fig = corner.corner(
            sp.unwrap_chain(self.chains), 
            labels = self.labels,
            quantiles=[0.16, 0.5, 0.84],
            show_titles=True,
            title_kwargs={"fontsize": 12})
        return fig
    
    def bounds_est(self):
        up = np.array([])
        do = np.array([])
  
        for key in enumerate(self.labels):
            if self.priors[key[1]][1]== 'normal':
                up = np.append(up, self.priors[key[1]][2]+4*self.priors[key[1]][3])
                do = np.append(do, self.priors[key[1]][2]-4*self.priors[key[1]][3])
            
            elif self.priors[key[1]][1]== 'lognormal':
                up = np.append(up, 10**(self.priors[key[1]][2]+4*self.priors[key[1]][3]))
                do = np.append(do, 10**(self.priors[key[1]][2]-4*self.priors[key[1]][3]))
            
            elif self.priors[key[1]][1]== 'uniform':
                up = np.append(up, self.priors[key[1]][3])
                do = np.append(do, self.priors[key[1]][2])
            
            elif self.priors[key[1]][1]== 'loguniform':
                up = np.append(up, 10**self.priors[key[1]][3])
                do = np.append(do, 10**self.priors[key[1]][2])
            
            elif self.priors[key[1]][1]== 'normal_hat':
                up = np.append(up, self.priors[key[1]][5])
                do = np.append(do, self.priors[key[1]][4])

            elif self.priors[key[1]][1]== 'lognormal_hat':
                up = np.append(up, 10**self.priors[key[1]][5])
                do = np.append(do, 10**self.priors[key[1]][4])
            
    
            else:
                raise Exception('Sorry mode in prior type not understood: ', key )
        self.bounds = (do, up)
        #print(do)
        #print(up)
        return self.bounds
    
        



```

`Qubespec/QubeSpec/Fitting/priors.py`:

```py
from scipy.stats import norm
from scipy.stats import uniform
from scipy.stats import truncnorm
from scipy.stats import lognorm
from scipy.stats import loguniform
import numpy as np
#import numba
#@numba.njit
def logprior_general_scipy_test(theta, priors):
    results = []
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results.append(norm.logpdf(t, p[1], p[2]))
        elif p[0]==1:
            results.append(uniform.logpdf(t, p[1], p[2]-p[1]))
        elif p[0]==2:
            results.append(  norm.logpdf(np.log10(t), p[1], p[2]))
        elif p[0]==3:
            results.append( uniform.logpdf(np.log10(t), p[1], p[2]-p[1]))
        elif p[0]==4:
            results.append(truncnorm.logpdf(t, a= (p[3]-p[1])/p[2], b= (p[4]-p[1])/p[2], loc=p[1], scale=p[2]))
        elif p[0]==5:
            results.append( truncnorm.logpdf(np.log10(t),a= (p[3]-p[1])/p[2], b= (p[4]-p[1])/p[2], loc=p[1], scale=p[2]))
    return results

def logprior_general_scipy(theta, priors):
    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results+= norm.logpdf(t, p[1], p[2]) # normal
        elif p[0]==1:
            results+= uniform.logpdf(t, p[1], p[2]-p[1]) #  uniform 
        elif p[0]==2:
            results+=  norm.logpdf(np.log10(t), p[1], p[2])
        elif p[0]==3:
            results+= uniform.logpdf(np.log10(t), p[1], p[2]-p[1])
        elif p[0]==4:
            results += truncnorm.logpdf(t, a= (p[3]-p[1])/p[2], b= (p[4]-p[1])/p[2], loc=p[1], scale=p[2]) # Truncated normal
        elif p[0]==5:
            results += truncnorm.logpdf(np.log10(t),a= (p[3]-p[1])/p[2], b= (p[4]-p[1])/p[2], loc=p[1], scale=p[2])
    return results


import numba
@numba.njit
def logprior_general(theta, priors):
    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
            #results+= norm.pdf(t, p[1], p[2])
        elif p[0]==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1])) 
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))
        elif p[0]==4:
            if p[3]<t<p[4]:
                results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
            else:
                results += -np.inf
        elif p[0]==5:
            if p[3]<np.log10(t)<p[4]:
                results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
            else:
                results += -np.inf
    
    return results


@numba.njit
def logprior_general_test(theta, priors, labels):
    for t,p,lb in zip( theta, priors, labels):
        print(p)
        if p[0] ==0:
            results = -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0]==1:
            results= np.log((p[1]<t<p[2])/(p[2]-p[1])) 
        elif p[0]==2:
            results= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))
        elif p[0]==4:
            if p[3]<t<p[4]:
                results = -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
            else:
                results = -np.inf
        elif p[0]==5:
            if p[3]<np.log10(t)<p[4]:
                results= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
            else:
                results = -np.inf
    
        print(lb, t, results)

```

`Qubespec/QubeSpec/Graph_setup.py`:

```py
def clean_slate_protocol():
    import matplotlib
    matplotlib.rcdefaults()
    matplotlib.rcParams['figure.figsize'] = (5.5,4.5)


def graph_format(Labelsize=12):
    import matplotlib as mpl
    mpl.rcParams['xtick.major.width'] =1.5
    mpl.rcParams['ytick.major.width'] =1.5
    mpl.rcParams['xtick.major.size'] = 5.
    mpl.rcParams['ytick.major.size'] = 5.
    
    mpl.rcParams['xtick.minor.size'] = 3.5
    mpl.rcParams['ytick.minor.size'] = 3.5
    mpl.rcParams['xtick.minor.width'] = 1.5
    mpl.rcParams['ytick.minor.width'] = 1.5
    
    mpl.rcParams['ytick.direction'] = 'in'
    mpl.rcParams['xtick.direction'] = 'in'
    

    mpl.rcParams['xtick.labelsize']= Labelsize
    mpl.rcParams['ytick.labelsize']=Labelsize
   
    mpl.rcParams['axes.linewidth'] = 2.
    
    mpl.rcParams['axes.labelsize']=15
    

def move_figure(f, x, y):
    import matplotlib
    """Move figure's upper left corner to pixel (x, y)"""
    backend = matplotlib.get_backend()
    if backend == 'TkAgg':
        f.canvas.manager.window.wm_geometry("+%d+%d" % (x, y))
    elif backend == 'WXAgg':
        f.canvas.manager.window.SetPosition((x, y))
    else:
        # This works for QT and GTK
        # You can also use window.setGeometry
        f.canvas.manager.window.move(x, y)
```

`Qubespec/QubeSpec/Header_fix.py`:

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Tue Mar 21 16:24:16 2023

@author: jansen
"""


import shutil
from astropy.io import fits

def astronometry_cor(JWST_FILE, new_val):
    altered_file=JWST_FILE.replace(JWST_FILE,\
                               JWST_FILE[:-4]+'_shifted.fits')
    shutil.copyfile(JWST_FILE, altered_file)

    [CRV1,CRV2,CRP1,CRP2]=new_val
    fits.setval(altered_file, 'CRPIX1', value=float(CRP1),ext=1)
    fits.setval(altered_file, 'CRPIX2', value=float(CRP2),ext=1)
    fits.setval(altered_file, 'CRVAL1', value=float(CRV1),ext=1)
    fits.setval(altered_file, 'CRVAL2', value=float(CRV2),ext=1)


```

`Qubespec/QubeSpec/MSA.py`:

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Tue Apr  4 14:16:53 2023

@author: jansen
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt; plt.ioff()

from astropy.io import fits as pyfits

nan= float('nan')

pi= np.pi
e= np.e

c=3e8


PATH='/Users/jansen/My Drive/Astro/'

from . import Utils as sp
from . import Plotting as emplot
from . import Fitting as emfit



paths = {}
paths['medium_jwst_gn'] = ['/Users/jansen/JADES/GOODS-N/NIRSpec/medium_jwst_gn/Final_products_v3.1/', '3.1','']
paths['medium_hst_gn'] = ['/Users/jansen/JADES/GOODS-N/NIRSpec/medium_hst_gn/Final_products_v3.0/', '3.0','']


paths['deep_hst_gs'] = ['/Users/jansen/JADES/GOODS-S/NIRSpec/deep_hst_gs/Final_products_v3.0/', '3.0','']
paths['medium_hst_gs_shorts'] = ['/Users/jansen/JADES/GOODS-S/NIRSpec/medium_hst_gs_shorts/Final_products_v3.0_extr3/', '3.0','_extr3']
paths['medium_jwst_gs_1180'] = ['/Users/jansen/JADES/GOODS-S/NIRSpec/medium_jwst_gs_1180/Final_products_v3.0_extr3/', '3.0','_extr3']
paths['medium_jwst_gs'] = ['/Users/jansen/JADES/GOODS-S/NIRSpec/medium_jwst_gs/', '','']



def load_data(path):
    with pyfits.open(path, memmap=False) as hdulist:
        flux_orig = hdulist['DATA'].data*1e-7*1e4
        error =  hdulist['ERR'].data*1e-7*1e4
        flux = np.ma.masked_invalid(flux_orig.copy())
        obs_wave = hdulist['wavelength'].data*1e6
    return obs_wave, flux, error

def gauss(x, k, mu, fwhm):
    sig= fwhm/3e5*mu/2.35482
    expo= -((x-mu)**2)/(2*sig*sig)
    y= k* e**expo
    return y


class R1000:  
    def __init__(self, path, z, ID, wave_custom=None, version ='3.0', add='_extr3', data_hdu='DATA', rev=False):
        # Store basic stuff
        self.z = z
        self.ID = ID
        self.path = path
        self.add = add
        self.data_hdu = data_hdu
        
        if version != '':
            version= '_v'+version
        self.version = version

        # Set boundries of the R1000 boundries 
        B1M = [0.7, 2.2]
        B2M = [1.66, 4.0]
        B3M = [2.87, 5.5]
        
        # Caluclating the redshifted wavelength of Halpha and OIII
        self.Hal_wv = 0.6563*(1+self.z)
        self.O3_wv = 0.5008*(1+self.z)
        if wave_custom:
            self.wave_custom = wave_custom
            self.wave_custom_obs = self.wave_custom*(1+self.z)/1e4
        
        
        # Set to Halpha gratings
        if (self.Hal_wv<B3M[1]) and (self.Hal_wv>B3M[0]):
            self.Hal_band = 'g395m_f290lp'
        elif (self.Hal_wv<B2M[1]) and (self.Hal_wv>B2M[0]):
            self.Hal_band = 'g235m_f170lp'
        elif (self.Hal_wv<B1M[1]) and (self.Hal_wv>B1M[0]):
            self.Hal_band = 'g140m_f070lp'
        else:
            self.Hal_band = None
          
        # Set OIII gratings
        if (self.O3_wv<B3M[1]) and (self.O3_wv>B3M[0]):
            self.O3_band = 'g395m_f290lp'
        elif (self.O3_wv<B2M[1]) and (self.O3_wv>B2M[0]):
            self.O3_band = 'g235m_f170lp'
        elif (self.O3_wv<B1M[1]) and (self.O3_wv>B1M[0]):
            self.O3_band = 'g140m_f070lp'
        else:
            self.O3_band = None
            
        if wave_custom:
            # Set custom gratings
            if (self.wave_custom_obs<B3M[1]) and (self.wave_custom_obs>B3M[0]):
                self.band_custom = 'g395m_f290lp'
            elif (self.wave_custom_obs<B2M[1]) and (self.wave_custom_obs>B2M[0]):
                self.band_custom = 'g235m_f170lp'
            elif (self.wave_custom_obs<B1M[1]) and (self.wave_custom_obs>B1M[0]):
                self.band_custom = 'g140m_f070lp'
            else:
                self.band_custom = None
            if rev==True:
                if (self.wave_custom_obs<B1M[1]) and (self.wave_custom_obs>B1M[0]):
                    self.band_custom = 'g140m_f070lp'
                elif (self.wave_custom_obs<B2M[1]) and (self.wave_custom_obs>B2M[0]):
                    self.band_custom = 'g235m_f170lp'
                elif (self.wave_custom_obs<B3M[1]) and (self.wave_custom_obs>B3M[0]):
                    self.band_custom = 'g395m_f290lp'
                else:
                    self.band_custom = None

            
            self.Full_path_custom = self.path + self.band_custom +'/'+ self.ID + '_' + self.band_custom +self.version+self.add+'_1D.fits'

        else:
            self.band_custom= None
            
            
            
        
        
    def load_data(self):
        try:
            if self.Hal_band != None:  
                Full_path = self.path + self.Hal_band +'/'+ self.ID + '_' + self.Hal_band+self.version +self.add+'_1D.fits'
                with pyfits.open(Full_path, memmap=False) as hdulist:
                    flux_orig = hdulist[self.data_hdu].data*1e-7*1e4*1e15
                    self.Hal_error =  hdulist['ERR'].data*1e-7*1e4*1e15
                    self.Hal_flux = np.ma.masked_invalid(flux_orig.copy())
                    self.Hal_obs_wave = hdulist['wavelength'].data*1e6
                    
                    #plt.figure()
                    #plt.plot(self.Hal_obs_wave, self.Hal_flux, drawstyle='steps-mid')
        except:
            ls =  0 
        try: 
            if self.O3_band != None:  
                Full_path = self.path + self.O3_band +'/'+ self.ID + '_' + self.O3_band +self.version+self.add+'_1D.fits'
                with pyfits.open(Full_path, memmap=False) as hdulist:
                    flux_orig = hdulist[self.data_hdu].data*1e-7*1e4*1e15
                    self.O3_error =  hdulist['ERR'].data*1e-7*1e4*1e15
                    self.O3_flux = np.ma.masked_invalid(flux_orig.copy())
                    self.O3_obs_wave = hdulist['wavelength'].data*1e6
                    #plt.figure()
                    #plt.plot(self.O3_obs_wave, self.O3_flux, drawstyle='steps-mid')
        except:
            ls = 0
        if self.band_custom:  
            try:
                Full_path = self.path + self.band_custom +'/'+ self.ID + '_' + self.band_custom +self.version+self.add+'_1D.fits'
                with pyfits.open(Full_path, memmap=False) as hdulist:
                    flux_orig = hdulist[self.data_hdu].data*1e-7*1e4*1e15
                    self.custom_error =  hdulist['ERR'].data*1e-7*1e4*1e15
                    self.custom_flux = np.ma.masked_invalid(flux_orig.copy())
                    self.custom_obs_wave = hdulist['wavelength'].data*1e6
            except:
                Full_path = self.path + self.band_custom +'/'+ self.ID + '_' + self.band_custom +self.version+self.add+'_1D.fits'
                with pyfits.open(Full_path, memmap=False) as hdulist:
                    flux_orig = hdulist[self.data_hdu].data*1e-7*1e4*1e15
                    self.custom_error =  hdulist['ERR'].data*1e-7*1e4*1e15
                    self.custom_flux = np.ma.masked_invalid(flux_orig.copy())
                    self.custom_obs_wave = hdulist['wavelength'].data*1e6
                
                
                '''
                f,ax = plt.subplots()
                ax.plot(self.custom_obs_wave, self.custom_flux, drawstyle='steps-mid')
                ax.vlines(self.wave_custom_obs, 0,1, color='red')
                
                yer = np.ma.median( np.ma.masked_invalid( self.custom_error))
                
                ax.set_ylim(-yer, 5*yer)
                
                ax.set_title(self.ID)
                '''
                
    def Fitting_Halpha(self, N=10000, progress=True,sampler='emcee',priors= {'z':[0, 'normal', 0,0.003],\
                                                   'cont':[0,'loguniform',-5,1.7],\
                                                   'cont_grad':[0,'normal',0,0.3], \
                                                   'Hal_peak':[0,'loguniform',-3,2.],\
                                                   'Nar_fwhm':[300,'uniform',100,900],\
                                                   'SIIr_peak':[0,'loguniform',-5,1.7],\
                                                   'SIIb_peak':[0,'loguniform',-5,1.7],\
                                                   'NII_peak':[0,'loguniform',-5,1.7]}):
        if self.Hal_band != None:  
            dvstd = 300/3e5*(1+self.z)
            if priors['z'][2] ==0:
                
                priors['z'] = [self.z, 'normal', self.z, dvstd]
            
            
            self.Hal_fits = emfit.Fitting(self.Hal_obs_wave, self.Hal_flux, self.Hal_error, self.z, N=N, progress=progress, priors=priors, sampler=sampler)
            self.Hal_fits.fitting_Halpha(model='gal')
            
            self.Halpha_flux = sp.flux_calc_mcmc(self.Hal_fits, 'Han', norm=1e-15)
            self.N2_flux = sp.flux_calc_mcmc(self.Hal_fits, 'NIIt', norm=1e-15)
            self.S2b_flux = sp.flux_calc_mcmc(self.Hal_fits, 'SIIb', norm=1e-15)
            self.S2r_flux = sp.flux_calc_mcmc(self.Hal_fits, 'SIIr', norm=1e-15)
        
        else:
            self.Hal_fits = None
            self.Halpha_flux = [0,0,0]
            self.N2_flux = [0,0,0]
            self.S2b_flux = [0,0,0]
            self.S2r_flux = [0,0,0]
        
    def Fitting_O3(self, N=10000, progress=True,sampler='emcee', priors= {'z':[0, 'normal', 0,0.003],\
                                                          'cont':[0,'loguniform',-4,1.7],\
                                                          'cont_grad':[0,'normal',0,0.3], \
                                                          'Nar_fwhm':[300,'uniform',200,900],\
                                                          'outflow_fwhm':[600,'uniform', 300,1500],\
                                                          'outflow_vel':[-50,'normal', 0,300],\
                                                          'OIII_peak':[0,'loguniform',-4,2.0],\
                                                          'OIII_out_peak':[0,'loguniform',-3,1.7],\
                                                          'Hbeta_peak':[0,'loguniform',-4,1.7],\
                                                          'Hbeta_fwhm':[200,'uniform',120,900],\
                                                          'Hbeta_vel':[10,'normal', 0,10]}):

        if self.O3_band != None:  
            dvstd = 300/3e5*(1+self.z)
            if priors['z'][2] ==0:
                priors['z'] = [self.z, 'normal', self.z, dvstd]
            self.O3_fits = emfit.Fitting(self.O3_obs_wave, self.O3_flux, self.O3_error, self.z, N=N, progress=progress, priors=priors, sampler=sampler)
            self.O3_fits.fitting_OIII(model='gal')

            self.O3_flux = sp.flux_calc_mcmc(self.O3_fits, 'OIIIt', norm=1e-15)
            self.Hbeta_flux = sp.flux_calc_mcmc(self.O3_fits, 'Hbeta', norm=1e-15)
        else:
            self.O3_fits = None
            self.O3_flux = [0,0,0]
            self.O3_flux = [0,0,0]
    
    def Fitting_custom(self,model, N=10000, progress=True, labels=['z', 'cont', 'cont_grad', 'peak', 'Nar_fwhm'], plot=1, useb=[-150,150], use=np.array([0]), \
                       sampler='emcee', priors= {'z':[0, 'normal', 0,0.001],\
                                                          'cont':[0.1,'loguniform',-3,1],\
                                                          'cont_grad':[-0.1,'normal',0,0.3], \
                                                          'Nar_fwhm':[300,'uniform',100,900],\
                                                          'peak':[0.2, 'loguniform', -3,1]}):
        self.model = model
        self.labels= labels
        self.priors = priors
        if len(use) ==1:
            use = np.where( (self.custom_obs_wave>((self.wave_custom+useb[0])*(1+self.z)/1e4)) & (self.custom_obs_wave< ((self.wave_custom+useb[1])*(1+self.z)/1e4))   )[0]

        self.use = use
        self.Fitting = emfit.Fitting(self.custom_obs_wave[use], self.custom_flux[use], self.custom_error[use],z=self.z, priors=self.priors,N=10000, progress=progress, sampler=sampler)
        self.Fitting.fitting_general(self.model, labels, emfit.logprior_general)
        
        self.yeval = self.model(self.custom_obs_wave, *self.Fitting.props['popt'])
        
        
        if plot==1:
            f,ax = plt.subplots(1)
            ax.plot(self.custom_obs_wave, self.custom_flux, drawstyle='steps-mid')
            ax.plot(self.custom_obs_wave, self.yeval, 'r--' )
            ax.vlines(self.wave_custom_obs, 0,1, color='red')
            
            ax.set_xlim((self.wave_custom-200)*(1+self.z)/1e4, (self.wave_custom+150)*(1+self.z)/1e4 )
            
            ylim = 1.11*max(self.yeval)
            yer = np.ma.median( np.ma.masked_invalid( self.custom_error))
            if ylim<yer*3:
                ylim= yer*3
            
            ax.set_ylim(-yer, ylim)  
            
            ax.set_title(self.ID + ', wave = '+str(self.wave_custom))
        
        
        return self.Fitting
    
    def weed_out(self, N=1000):

        for key in self.Fitting.labels:
            self.Fitting.chains[key] = np.random.choice(self.Fitting.chains[key], N, replace=False)
        self.Fitting.like_chains = np.random.choice(self.Fitting.like_chains, N, replace=False)
                   

class R100:  
    def __init__(self, path='', z=0, ID='', version ='4.0', add='', full_path=None):
        # Store basic stuff
        self.z = z
        self.ID = ID
        self.path = path
        self.band = 'prism_clear'
        if version != '':
            version= '_v'+version
        self.version = version

        self.version = version
        self.add = add 
        self.Full_path = full_path

        if self.Full_path == None:
            self.Full_path = self.path +'prism_clear/'+ self.ID + '_prism_clear' +self.version+self.add+'_1D.fits'

        with pyfits.open(self.Full_path, memmap=False) as hdulist:
            flux_orig = hdulist['DATA'].data*1e-7*1e4*1e15
            self.error =  hdulist['ERR'].data*1e-7*1e4*1e15
            self.flux = np.ma.masked_invalid(flux_orig.copy())
            self.obs_wave = hdulist['wavelength'].data*1e6
            
         
    def load_data(self):
        if self.Full_path == None:
            self.Full_path = self.path +'prism_clear/'+ self.ID + '_prism_clear' +self.version+self.add+'_1D.fits'

        with pyfits.open(self.Full_path, memmap=False) as hdulist:
            flux_orig = hdulist['DATA'].data*1e-7*1e4*1e15
            self.error =  hdulist['ERR'].data*1e-7*1e4*1e15
            self.flux = np.ma.masked_invalid(flux_orig.copy())
            self.obs_wave = hdulist['wavelength'].data*1e6
            
            plt.figure()
            plt.plot(self.obs_wave, self.flux, drawstyle='steps-mid')
        
                  
                
    def Fitting_Halpha(self, N=10000, progress=True,priors= {'z':[0, 'normal', 0,0.003],\
                                                   'cont':[0,'loguniform',-5,1],\
                                                   'cont_grad':[0,'normal',0,0.3], \
                                                   'Hal_peak':[0,'loguniform',-3,1],\
                                                   'Nar_fwhm':[1000,'uniform',500,3000],\
                                                   'SIIr_peak':[0,'loguniform',-3,1],\
                                                   'SIIb_peak':[0,'loguniform',-3,1],\
                                                   'NII_peak':[0,'loguniform',-3,1]}):
         
        z_std = 200/3e5*(1+self.z)
        zlim = 600/3e5*(1+self.z)
        priors['z'] = [self.z, 'normal_hat', self.z, z_std, self.z-zlim, self.z+zlim]
        
        
        self.Hal_fits = emfit.Fitting(self.obs_wave, self.flux, self.error, self.z, N=N, progress=progress, priors=priors)
        self.Hal_fits.fitting_Halpha(model='gal')
        
        f,ax = plt.subplots(1)
        emplot.plotting_Halpha(self.obs_wave, self.flux, ax, self.Hal_fits.props, self.Hal_fits.fitted_model)
        
        
        
        self.Halpha_flux = sp.flux_calc_mcmc(self.Hal_fits.props, self.Hal_fits.chains, 'Han', norm=1e-15)
        self.N2_flux = sp.flux_calc_mcmc(self.Hal_fits.props, self.Hal_fits.chains, 'NIIt', norm=1e-15)
        
    def Fitting_O3(self, N=10000, progress=True, priors= {'z':[0, 'normal', 0,0.003],\
                                                          'cont':[0,'loguniform',-3,1],\
                                                          'cont_grad':[0,'normal',0,0.3], \
                                                          'Nar_fwhm':[300,'uniform',100,900],\
                                                          'outflow_fwhm':[600,'uniform', 300,1500],\
                                                          'outflow_vel':[-50,'normal', 0,300],\
                                                          'OIII_peak':[0,'loguniform',-3,1],\
                                                          'OIII_out_peak':[0,'loguniform',-3,1],\
                                                          'Hbeta_peak':[0,'loguniform',-3,1],\
                                                          'Hbeta_fwhm':[200,'uniform',120,900],\
                                                          'Hbeta_vel':[10,'normal', 0,10]}):
        
        
        priors['z'] = [self.z, 'uniform', self.z-0.01, self.z+0.01]
        self.O3_fits = emfit.Fitting(self.obs_wave, self.flux, self.error, self.z, N=N, progress=progress, priors=priors)
        
        self.O3_fits.fitting_OIII(model='gal')
        
        f,ax = plt.subplots(1)
        #ax.plot(self.O3_obs_wave, self.O3_flux)
        #ax.plot(self.O3_obs_wave, O3_fits.fitted_model(self.O3_obs_wave, *O3_fits.props['popt']), 'r--')
        emplot.plotting_OIII(self.obs_wave, self.flux, ax, self.O3_fits.props, self.O3_fits.fitted_model)
        
        self.O3_flux = sp.flux_calc_mcmc(self.O3_fits.props, self.O3_fits.chains, 'OIIIt', norm=1e-15)
        self.Hbeta_flux = sp.flux_calc_mcmc(self.O3_fits.props, self.O3_fits.chains, 'Hbeta', norm=1e-15)

    def cal_1500_mag(self, z, lmin=1475, lmax=1525):
        """
        Input: MPDAF Spectrum object, redshift
        Output: UV mag, upper bound, lower bound, F(1500), Error F(1500)

        Calculate the 1500 magnitude.
        Reference here: https://astronomy.stackexchange.com/questions/35396/how-to-convert-luminosity-at-rest-frame-wavelength-of-1450-a-to-absolute-magnitu
        """
        from astropy.stats import sigma_clipped_stats
        import astropy.units as u
        from astropy.cosmology import Planck18 as cosmo 

        self.rest_wave = self.obs_wave/(1+z)*1e4
        self.rest_flux = self.flux*1e-15/1e4*(1+z)
        use =(self.rest_wave>lmin) & (self.rest_wave<lmax)

        ### start by calculating the flux at 1500A rest-frame
        f1500, median, std = sigma_clipped_stats( self.rest_flux[use], sigma=3)
        err_f1500 = np.std(self.rest_flux[use])

        f1500 = f1500 * u.erg/u.s/u.cm**2/u.AA
        err_f1500 = err_f1500 * u.erg/u.s/u.cm**2/u.AA
        lumdist = cosmo.luminosity_distance(z).to(u.parsec)
        
        ### flux_density at a distance of 10 parsec (definition of UV mag)
        fnu_1500 = (f1500 * (lumdist/(10.*u.parsec))**2).to(u.erg/u.s/u.cm**2/u.Hertz, 
                                                            equivalencies=u.spectral_density(1500*u.AA))
        fnu_1500_u = ((f1500 + err_f1500) * (lumdist/(10.*u.parsec))**2).to(u.erg/u.s/u.cm**2/u.Hertz, 
                                                                            equivalencies=u.spectral_density(1500*u.AA))
        fnu_1500_l = ((f1500 - err_f1500) * (lumdist/(10.*u.parsec))**2).to(u.erg/u.s/u.cm**2/u.Hertz, 
                                                                            equivalencies=u.spectral_density(1500*u.AA))
        
        ### UV absolute mag calculation
        mab_1500 = (-2.5 * np.log10(fnu_1500.value)) - 48.60
        mab_1500_u = abs((-2.5 * np.log10(fnu_1500_u.value) - 48.60) - mab_1500)
        mab_1500_l = abs((-2.5 * np.log10(fnu_1500_l.value) - 48.60) - mab_1500)

        ### UV observed mag calculation
        mab_1500_obs = mab_1500 + 5 * np.log10(lumdist/(10.*u.parsec))
        mab_1500_obs_u = mab_1500_u + 5 *np.log10 (lumdist/(10.*u.parsec))
        mab_1500_obs_l = mab_1500 + 5 * np.log10(lumdist/(10.*u.parsec))

        ### return the results
        return(mab_1500, mab_1500_u, mab_1500_l, f1500, err_f1500, mab_1500_obs, mab_1500_obs_u, mab_1500_obs_l)
    
       
      
   
```

`Qubespec/QubeSpec/Maps/Map_creation.py`:

```py
from astropy.io import fits
import numpy as np
import pickle
import tqdm
import matplotlib.pyplot as plt
from astropy.table import Table
from matplotlib.backends.backend_pdf import PdfPages
from brokenaxes import brokenaxes

from .. import Utils as sp
from .. import Plotting as emplot
from .. import Fitting as emfit

from ..Models import Halpha_OIII_models as HaO_models


def Map_creation_OIII(Cube,SNR_cut = 3 , fwhmrange = [100,500], velrange=[-100,100],dbic=12, flux_max=0, width_upper=300,add='',):
    """ Function to post process fits. The function will load the fits results and determine which model is more likely,
        based on BIC. It will then calculate the W80 of the emission lines, V50 etc and create flux maps, velocity maps eyc.,
        Afterwards it saves all of it as .fits file. 

        Parameters
        ----------
    
        Cube : QubeSpec.Cube class instance
            Cube class from the main part of the QubeSpec. 

        SNR_cut : float
            SNR cutoff to detect emission lines 

        fwhmrange : list
            list of the two values to use as vmin and vmax in imshow of FWHM range

        velrange : list
            list of the two values to use as vmin and vmax in imshow of velocity range
        
        width_upper : float
            FWHM value used in the flux upper limit calculation.
        
        dbic : float
            delta bic to decide which model to use. 
        
        add : str
            additional string to use to load the results and save maps/pdf
            
        """
    z0 = Cube.z
    failed_fits=0
    # =============================================================================
    #         Importing all the data necessary to post process
    # =============================================================================
    with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_OIII'+add+'.txt', "rb") as fp:
        results= pickle.load(fp)

    # =============================================================================
    #         Setting up the maps
    # =============================================================================
    map_oiii = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    map_oiii_w80 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_v10 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_v90 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_v50 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)

    map_outflow_fwhm = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_outflow_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_narrow_fwhm = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_narrow_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)

    map_oiii_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hb_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)


    Result_cube = np.zeros_like(Cube.flux.data)
    Result_cube_data = Cube.flux.data
    Result_cube_error = Cube.error_cube.data

    Result_cube_narrow = np.zeros_like(Cube.flux.data)
    Result_cube_broad = np.zeros_like(Cube.flux.data)
    # =============================================================================
    #        Filling these maps
    # =============================================================================
    f,ax= plt.subplots(1)

    Spax = PdfPages(Cube.savepath+Cube.ID+'_Spaxel_OIII_fit_detection_only'+add+'.pdf')


    for row in tqdm.tqdm(range(len(results))):
        if len(results[row])==3:
            i,j, Fits= results[row]
            if str(type(Fits)) != "<class 'QubeSpec.Fitting.fits_r.Fitting'>":
                failed_fits+=1
                continue

        else:
            i,j, Fits_sig, Fits_out= results[row]

            if str(type(Fits_sig)) != "<class 'QubeSpec.Fitting.fits_r.Fitting'>":
                failed_fits+=1
                continue

            if (Fits_sig.BIC-Fits_out.BIC) >dbic:
                Fits = Fits_out
            else:
                Fits = Fits_sig
                
        if 'outflow_fwhm' in list(Fits.props.keys()):
            flag= 'outflow'
        else:
            flag='single'
           
        
        try:
            Result_cube_data[:,i,j] = Fits.fluxs.data
            Result_cube_error[:,i,j] = Fits.error.data
            Result_cube[:,i,j] = Fits.yeval
        except:
            lds=0
        

        z = Fits.props['popt'][0]
        SNR = sp.SNR_calc_obj(Fits, 'OIII')
        flux_oiii, p16_oiii,p84_oiii = sp.flux_calc_mcmc(Fits, 'OIIIt', Cube.flux_norm)

        map_oiii[0,i,j]= SNR

        if SNR>SNR_cut:
            map_oiii[1,i,j] = flux_oiii.copy()
            map_oiii[2,i,j] = p16_oiii.copy()
            map_oiii[3,i,j] = p84_oiii.copy()


            kins_par = sp.W80_OIII_calc( Fits, z=Cube.z, N=100)

            map_oiii_w80[:,i,j] = kins_par['w80']
            map_oiii_v10[:,i,j] = kins_par['v10']
            map_oiii_v90[:,i,j] = kins_par['v90']
            map_oiii_v50[:,i,j] = kins_par['v50']
            map_oiii_vel[:,i,j] = kins_par['vel_peak']

            map_narrow_fwhm[:,i,j] = np.percentile(Fits.chains['Nar_fwhm'], (16,50,84) )
            map_narrow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

            map_narrow_vel[:,i,j] = np.percentile((Fits.chains['z']-z0)/(1+z0)*3e5, (16,50,84) )
            map_narrow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])

            Result_cube_narrow[:,i,j] = 0

            if flag=='outflow':
                map_outflow_fwhm[:,i,j] = np.percentile(Fits.chains['outflow_fwhm'], (16,50,84) )
                map_outflow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

                map_outflow_vel[:,i,j] = np.percentile(Fits.chains['outflow_vel'], (16,50,84) )
                map_outflow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])


            p = ax.get_ylim()[1]

            ax.text(4810, p*0.9 , 'OIII W80 = '+str(np.round(kins_par['w80'][0],2)) )
        else:
            map_oiii[2,i,j] = p16_oiii.copy()
            map_oiii[3,i,j] = p84_oiii.copy()
            

        
        if SNR>SNR_cut:
            try:
                emplot.plotting_OIII(Fits, ax)
            except:
                print(Fits.props)
                break
            ax.set_title('x = '+str(j)+', y='+ str(i) + ', SNR = ' +str(np.round(SNR,2)))
            plt.tight_layout()
            Spax.savefig()
            ax.clear()

    Spax.close()

    from mpl_toolkits.axes_grid1 import make_axes_locatable

    x = int(Cube.center_data[1]); y= int(Cube.center_data[2])
    f = plt.figure( figsize=(10,10))

    IFU_header = Cube.header

    deg_per_pix = IFU_header['CDELT2']
    arc_per_pix = deg_per_pix*3600


    Offsets_low = -Cube.center_data[1:3][::-1]
    Offsets_hig = Cube.dim[0:2] - Cube.center_data[1:3][::-1]

    lim = np.array([ Offsets_low[0], Offsets_hig[0],
                        Offsets_low[1], Offsets_hig[1] ])

    lim_sc = lim*arc_per_pix

    ax1 = f.add_axes([0.1, 0.55, 0.38,0.38])
    ax2 = f.add_axes([0.1, 0.1, 0.38,0.38])
    ax3 = f.add_axes([0.55, 0.1, 0.38,0.38])
    ax4 = f.add_axes([0.55, 0.55, 0.38,0.38])

    flx = ax1.imshow(map_oiii[1,:,:],vmax=map_oiii[1,y,x], origin='lower', extent= lim_sc)
    ax1.set_title('Flux map')
    divider = make_axes_locatable(ax1)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(flx, cax=cax, orientation='vertical')

    #lims =
    #emplot.overide_axes_labels(f, axes[0,0], lims)


    vel = ax2.imshow(map_oiii_vel[0,:,:], cmap='coolwarm', origin='lower', vmin=velrange[0], vmax=velrange[1], extent= lim_sc)
    ax2.set_title('v50')
    divider = make_axes_locatable(ax2)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(vel, cax=cax, orientation='vertical')


    fw = ax3.imshow(map_oiii_w80[0,:,:],vmin=fwhmrange[0], vmax=fwhmrange[1], origin='lower', extent= lim_sc)
    ax3.set_title('W80 map')
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    snr = ax4.imshow(map_oiii[0,:,:],vmin=3, vmax=20, origin='lower', extent= lim_sc)
    ax4.set_title('SNR map')
    divider = make_axes_locatable(ax4)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(snr, cax=cax, orientation='vertical')

    f.savefig(Cube.savepath+'Diagnostics/OIII_maps.pdf')

    hdr = Cube.header.copy()

    primary_hdu = fits.PrimaryHDU(np.zeros((3,3,3)), header=hdr)

    hdu_data=fits.ImageHDU(Result_cube_data, name='flux')
    hdu_err = fits.ImageHDU(Result_cube_error, name='error')
    hdu_yeval = fits.ImageHDU(Result_cube, name='yeval')
    hdu_resid = fits.ImageHDU(Result_cube_data-Result_cube, name='residuals')


    oiii_hdu = fits.ImageHDU(map_oiii, name='OIII')
    oiii_w80 = fits.ImageHDU(map_oiii_w80, name='OIII_w80')
    oiii_v10 = fits.ImageHDU(map_oiii_v10, name='OIII_v10')
    oiii_v90 = fits.ImageHDU(map_oiii_v90, name='OIII_v90')
    oiii_v50 = fits.ImageHDU(map_oiii_v50, name='OIII_v50')
    oiii_vel = fits.ImageHDU(map_oiii_vel, name='OIII_vel')

    outflow_fwhm = fits.ImageHDU(map_outflow_fwhm, name='outflow_fwhm')
    outflow_vel = fits.ImageHDU(map_outflow_vel, name='outflow_vel')

    Nar_vel = fits.ImageHDU(map_narrow_vel, name='narrow_vel')
    Nar_fwhm = fits.ImageHDU(map_narrow_fwhm, name='narrow_fwhm')


    hdulist = fits.HDUList([primary_hdu,hdu_data, hdu_err, hdu_yeval,hdu_resid,\
                            oiii_hdu,oiii_w80, oiii_v10, oiii_v90, oiii_vel, oiii_v50 ,Nar_vel, Nar_fwhm, outflow_fwhm,outflow_vel])

    hdulist.writeto(Cube.savepath+Cube.ID+'_OIII_fits_maps'+add+'.fits', overwrite=True)

def Map_creation_Halpha(Cube, SNR_cut = 3 , fwhmrange = [100,500], velrange=[-100,100],dbic=10, flux_max=0, add=''):
    """ 
     Function to post process fits. The function will load the fits results and determine which model is more likely,
        based on BIC. It will then calculate the W80 of the emission lines, V50 etc and create flux maps, velocity maps eyc.,
        Afterwards it saves all of it as .fits file. 

        Parameters
        ----------
    
        Cube : QubeSpec.Cube class instance
            Cube class from the main part of the QubeSpec. 

        SNR_cut : float
            SNR cutoff to detect emission lines 

        fwhmrange : list
            list of the two values to use as vmin and vmax in imshow of FWHM range

        velrange : list
            list of the two values to use as vmin and vmax in imshow of velocity range
        
        width_upper : float
            FWHM value used in the flux upper limit calculation.
        
        dbic : float
            delta bic to decide which model to use. 
        
        add : str
            additional string to use to load the results and save maps/pdf
            
    """
    z0 = Cube.z

    wvo3 = 6563*(1+z0)/1e4
    # =============================================================================
    #         Importing all the data necessary to post process
    # =============================================================================
    with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_Halpha'+add+'.txt', "rb") as fp:
        results= pickle.load(fp)

    # =============================================================================
    #         Setting up the maps
    # =============================================================================
    map_hal = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    map_hal_w80 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_v10 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_v90 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_v50 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)


    map_nii = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_siir = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_siib = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)

    map_outflow_fwhm = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_outflow_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_narrow_fwhm = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_narrow_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)

    map_oiii_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hb_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_nii_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    Result_cube = np.zeros_like(Cube.flux.data)
    Result_cube_data = Cube.flux.data
    Result_cube_error = Cube.error_cube.data
    # =============================================================================
    #        Filling these maps
    # =============================================================================
    gf,ax= plt.subplots(1)

    Spax = PdfPages(Cube.savepath+Cube.ID+'_Spaxel_Halpha_fit_detection_only'+add+'.pdf')

    failed_fits = 0
    for row in tqdm.tqdm(range(len(results))):
        if len(results[row])==3:
            i,j, Fits= results[row]
            if str(type(Fits)) != "<class 'QubeSpec.Fitting.fits_r.Fitting'>":
                failed_fits+=1
                continue

        else:
            i,j, Fits_sig, Fits_out= results[row]

            if str(type(Fits_sig)) != "<class 'QubeSpec.Fitting.fits_r.Fitting'>":
                failed_fits+=1
                continue

            if (Fits_sig.BIC-Fits_out.BIC) >dbic:
                Fits = Fits_out
            else:
                Fits = Fits_sig
        
        if 'outflow_fwhm' in list(Fits.props.keys()):
            flag= 'outflow'
        else:
            flag='single'

        Result_cube_data[:,i,j] = Fits.fluxs.data
        try:
            Result_cube_error[:,i,j] = Fits.error.data
        except:
            lds=0
        Result_cube[:,i,j] = Fits.yeval

        res_spx = Fits.props
        flx_spax_m = Fits.fluxs
        error = Fits.error
        z = res_spx['popt'][0]
        SNR = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'Hn')
        map_hal[0,i,j] = SNR
        if SNR>SNR_cut:
            map_hal[0,i,j] = SNR
            map_hal[1:,i,j] = sp.flux_calc_mcmc(Fits, 'Hat',Cube.flux_norm)

            kins_par = sp.W80_Halpha_calc( Fits, z=Cube.z, N=100)

            map_hal_w80[:,i,j] = kins_par['w80']
            map_hal_v10[:,i,j] = kins_par['v10']
            map_hal_v90[:,i,j] = kins_par['v90']
            map_hal_v50[:,i,j] = kins_par['v50']
            map_hal_vel[:,i,j] = kins_par['vel_peak']

            map_narrow_fwhm[:,i,j] = np.percentile(Fits.chains['Nar_fwhm'], (16,50,84) )
            map_narrow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

            map_narrow_vel[:,i,j] = np.percentile((Fits.chains['z']-z0)/(1+z0)*3e5, (16,50,84) )
            map_narrow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])

            if flag=='outflow':
                map_outflow_fwhm[:,i,j] = np.percentile(Fits.chains['outflow_fwhm'], (16,50,84) )
                map_outflow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

                map_outflow_vel[:,i,j] = np.percentile(Fits.chains['outflow_vel'], (16,50,84) )
                map_outflow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])

        else:
            flux_hal, p16_hal, p84_hal = sp.flux_calc_mcmc(Fits, 'Hat',Cube.flux_norm)
            map_hal[2,i,j] = p16_hal.copy()
            map_hal[3,i,j] = p84_hal.copy()


        SNR_n2 = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'NII')
        map_nii[0,i,j] = SNR_n2
        if SNR_n2>SNR_cut:
            map_nii[1:,i,j] = sp.flux_calc_mcmc(Fits, 'NIIt', Cube.flux_norm)
        else:
            flux_nii, p16_nii, p84_nii = sp.flux_calc_mcmc(Fits, 'NIIt',Cube.flux_norm)
            map_nii[2,i,j] = p16_nii.copy()
            map_nii[3,i,j] = p84_nii.copy()

        emplot.plotting_Halpha(Fits, ax, errors=True)
        ax.set_title('x = '+str(j)+', y='+ str(i) + ', SNR = ' +str(np.round(SNR,2)))

        if res_spx['Hal_peak'][0]<3*error[0]:
            ax.set_ylim(-error[0], 5*error[0])
        if (res_spx['SIIr_peak'][0]>res_spx['Hal_peak'][0]) & (res_spx['SIIb_peak'][0]>res_spx['Hal_peak'][0]):
            ax.set_ylim(-error[0], 5*error[0])
        Spax.savefig()
        ax.clear()
    plt.close(gf)
    Spax.close()

    from mpl_toolkits.axes_grid1 import make_axes_locatable

    x = int(Cube.center_data[1]); y= int(Cube.center_data[2])
    f = plt.figure( figsize=(10,10))

    IFU_header = Cube.header

    deg_per_pix = IFU_header['CDELT2']
    arc_per_pix = deg_per_pix*3600


    Offsets_low = -Cube.center_data[1:3][::-1]
    Offsets_hig = Cube.dim[0:2] - Cube.center_data[1:3][::-1]

    lim = np.array([ Offsets_low[0], Offsets_hig[0],
                        Offsets_low[1], Offsets_hig[1] ])

    lim_sc = lim*arc_per_pix

    ax1 = f.add_axes([0.1, 0.55, 0.38,0.38])
    ax2 = f.add_axes([0.1, 0.1, 0.38,0.38])
    ax3 = f.add_axes([0.55, 0.1, 0.38,0.38])
    ax4 = f.add_axes([0.55, 0.55, 0.38,0.38])

    if flux_max==0:
        flx_max = map_hal[1,y,x]
    else:
        flx_max = flux_max

    print(lim_sc)
    flx = ax1.imshow(map_hal[1,:,:],vmax=flx_max, origin='lower', extent= lim_sc)
    ax1.set_title('Halpha Flux map')
    divider = make_axes_locatable(ax1)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(flx, cax=cax, orientation='vertical')
    cax.set_ylabel('Flux (arbitrary units)')
    ax1.set_xlabel('RA offset (arcsecond)')
    ax1.set_ylabel('Dec offset (arcsecond)')

    #lims =
    #emplot.overide_axes_labels(f, axes[0,0], lims)


    vel = ax2.imshow(map_hal_vel[0,:,:], cmap='coolwarm', origin='lower', vmin=velrange[0],vmax=velrange[1], extent= lim_sc)
    ax2.set_title('Velocity offset map')
    divider = make_axes_locatable(ax2)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(vel, cax=cax, orientation='vertical')

    cax.set_ylabel('Velocity (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')


    fw = ax3.imshow(map_hal_w80[0,:,:],vmin=fwhmrange[0],vmax=fwhmrange[1], origin='lower', extent= lim_sc)
    ax3.set_title('FWHM map')
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    cax.set_ylabel('FWHM (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    snr = ax4.imshow(map_hal[0,:,:],vmin=3, vmax=20, origin='lower', extent= lim_sc)
    ax4.set_title('SNR map')
    divider = make_axes_locatable(ax4)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(snr, cax=cax, orientation='vertical')

    cax.set_ylabel('SNR')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    fnii,axnii = plt.subplots(1)
    axnii.set_title('[NII] map')
    fw= axnii.imshow(map_nii[1,:,:], vmax=flx_max ,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    fnii.colorbar(fw, cax=cax, orientation='vertical')

    f.savefig(Cube.savepath+'Diagnostics/Halpha_maps.pdf')


    hdr = Cube.header.copy()

    primary_hdu = fits.PrimaryHDU(np.zeros((3,3,3)), header=hdr)

    hdu_data=fits.ImageHDU(Result_cube_data, name='flux')
    hdu_err = fits.ImageHDU(Result_cube_error, name='error')
    hdu_yeval = fits.ImageHDU(Result_cube, name='yeval')
    hdu_resid = fits.ImageHDU(Result_cube_data-Result_cube, name='residuals')

    hal_hdu = fits.ImageHDU(map_hal, name='Hal')
    hal_w80 = fits.ImageHDU(map_hal_w80, name='Hal_w80')
    hal_v10 = fits.ImageHDU(map_hal_v10, name='Hal_v10')
    hal_v90 = fits.ImageHDU(map_hal_v90, name='Hal_v90')
    hal_v50 = fits.ImageHDU(map_hal_v50, name='Hal_v50')
    hal_vel = fits.ImageHDU(map_hal_vel, name='Hal_vel')

    nii_hdu = fits.ImageHDU(map_nii, name='Hal')

    hdulist = fits.HDUList([primary_hdu,hdu_data, hdu_err, hdu_yeval,hdu_resid,\
                            hal_hdu,hal_w80, hal_v10, hal_v90, hal_vel, hal_v50, nii_hdu ])

    hdulist.writeto(Cube.savepath+Cube.ID+'_Halpha_fits_maps'+add+'.fits', overwrite=True)

    return f


def Map_creation_Halpha_OIII(Cube, SNR_cut = 3 , fwhmrange = [100,500], velrange=[-100,100],dbic=10, flux_max=0, width_upper=300,add=''):
    """ Function to post process fits. The function will load the fits results and determine which model is more likely,
        based on BIC. It will then calculate the W80 of the emission lines, V50 etc and create flux maps, velocity maps etc.,
        Afterwards it saves all of it as .fits file. 

        Parameters
        ----------
    
        Cube : QubeSpec.Cube class instance
            Cube class from the main part of the QubeSpec. 

        SNR_cut : float
            SNR cutoff to detect emission lines 

        fwhmrange : list
            list of the two values to use as vmin and vmax in imshow of FWHM range

        velrange : list
            list of the two values to use as vmin and vmax in imshow of velocity range
        
        width_upper : float
            FWHM value used in the flux upper limit calculation.
        
        dbic : float
            delta bic to decide which model to use. 
        
        add : str
            additional string to use to load the results and save maps/pdf
            
    """
    z0 = Cube.z
    failed_fits=0
    wv_hal = 6564.52*(1+z0)/1e4
    wv_oiii = 5008.24*(1+z0)/1e4
    # =============================================================================
    #         Importing all the data necessary to post process
    # =============================================================================
    with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_Halpha_OIII'+add+'.txt', "rb") as fp:
        results= pickle.load(fp)

    # =============================================================================
    #         Setting up the maps
    # =============================================================================

    map_oiii = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    map_oiii_w80 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_v10 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_v90 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_v50 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)

    map_hal = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    map_hal_w80 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_v10 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_v90 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_v50 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)

    map_hb = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_nii = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_siir = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_siib = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    map_outflow_fwhm = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_outflow_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_narrow_fwhm = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_narrow_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)

    map_oiii_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_nar = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    map_hal_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hb_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_nii_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    Result_cube_narrow = np.zeros_like(Cube.flux.data)
    Result_cube_broad = np.zeros_like(Cube.flux.data)

    from ..Models import Halpha_OIII_models as HO
    # =============================================================================
    #        Filling these maps
    # =============================================================================
    Result_cube = np.zeros_like(Cube.flux.data)
    Result_cube_data = Cube.flux.data
    Result_cube_error = Cube.error_cube.data

    Spax = PdfPages(Cube.savepath+Cube.ID+'_Spaxel_Halpha_OIII_fit_detection_only'+add+'.pdf')

    from ..Models import Halpha_OIII_models as HO_models
    for row in tqdm.tqdm(range(len(results))):
        
        if len(results[row])==3:
            i,j, Fits= results[row]
            if str(type(Fits)) != "<class 'QubeSpec.Fitting.fits_r.Fitting'>":
                failed_fits+=1
                continue

        else:
            i,j, Fits_sig, Fits_out= results[row]
            if str(type(Fits_sig)) != "<class 'QubeSpec.Fitting.fits_r.Fitting'>":
                failed_fits+=1
                continue

            if (Fits_sig.BIC-Fits_out.BIC) >dbic:
                Fits = Fits_out
                
            else:
                Fits = Fits_sig
                
        
        if 'outflow_fwhm' in list(Fits.props.keys()):
            flag= 'outflow'
        else:
            flag='single'


        Result_cube_data[:,i,j] = Fits.fluxs.data
        try:
            Result_cube_error[:,i,j] = Fits.error.data
        except:
            lds=0
        Result_cube[:,i,j] = Fits.yeval

        z = Fits.props['popt'][0]
        res_spx = Fits.props
        chains = Fits.chains
        flx_spax_m = Fits.fluxs
        error = Fits.error
        lists= Fits.props.keys()
    

# =============================================================================
#             Halpha
# =============================================================================
        #print(sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'Hn'))
        flux_hal, p16_hal,p84_hal = sp.flux_calc_mcmc(Fits, 'Hat', Cube.flux_norm)
        SNR_hal = flux_hal/p16_hal
        map_hal[0,i,j]= SNR_hal

        #SNR_hal = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'Hn')
        #SNR_oiii = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'OIII')
        #SNR_nii = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'NII')

        if SNR_hal>SNR_cut:
            map_hal[1,i,j] = flux_hal
            map_hal[2,i,j] = p16_hal
            map_hal[3,i,j] = p84_hal

            kins_par= sp.W80_Halpha_calc( Fits, z=Cube.z, N=100)

            map_hal_w80[:,i,j] = kins_par['w80']
            map_hal_v10[:,i,j] = kins_par['v10']
            map_hal_v90[:,i,j] = kins_par['v90']
            map_hal_v50[:,i,j] = kins_par['v50']
            map_hal_vel[:,i,j] = kins_par['vel_peak']

            map_narrow_fwhm[:,i,j] = np.percentile(Fits.chains['Nar_fwhm'], (16,50,84) )
            map_narrow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

            map_narrow_vel[:,i,j] = np.percentile((Fits.chains['z']-z0)/(1+z0)*3e5, (16,50,84) )
            map_narrow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])
            ptp = [Fits.props['z'][0], Fits.props['cont'][0], Fits.props['cont_grad'][0],\
                   Fits.props['Hal_peak'][0], Fits.props['NII_peak'][0], Fits.props['Nar_fwhm'][0],\
                     Fits.props['SIIr_peak'][0],Fits.props['SIIb_peak'][0], Fits.props['OIII_peak'][0],\
                         Fits.props['Hbeta_peak'][0] ]

            Result_cube_narrow[:,i,j] = HO.Halpha_OIII(Cube.obs_wave, *ptp)

            if flag=='outflow':
                map_outflow_fwhm[:,i,j] = np.percentile(Fits.chains['outflow_fwhm'], (16,50,84) )
                map_outflow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

                map_outflow_vel[:,i,j] = np.percentile(Fits.chains['outflow_vel'], (16,50,84) )
                map_outflow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])
                zout =  Fits.props['z'][0]+ Fits.props['outflow_vel'][0]/3e5*(1+Fits.props['z'][0])
                ptp = [zout, 0, 0,\
                   Fits.props['Hal_out_peak'][0], Fits.props['NII_out_peak'][0], Fits.props['outflow_fwhm'][0],\
                     0,0, Fits.props['OIII_out_peak'][0],\
                         Fits.props['Hbeta_out_peak'][0] ]

                Result_cube_broad[:,i,j] = HO.Halpha_OIII(Cube.obs_wave, *ptp)



        else:     
            map_hal[2,i,j] = p16_hal.copy()
            map_hal[3,i,j] = p84_hal.copy()

# =============================================================================
#             Plotting
# =============================================================================
        f = plt.figure(figsize=(10,4))
        baxes = brokenaxes(xlims=((4800,5050),(6500,6800)),  hspace=.01)
        emplot.plotting_Halpha_OIII(Fits,  baxes)

        #if res_spx['Hal_peak'][0]<3*error[0]:
        #    baxes.set_ylim(-error[0], 5*error[0])
        #if (res_spx['SIIr_peak'][0]>res_spx['Hal_peak'][0]) & (res_spx['SIIb_peak'][0]>res_spx['Hal_peak'][0]):
        #    baxes.set_ylim(-error[0], 5*error[0])

        SNRs = np.array([SNR_hal])

# =============================================================================
#             NII
# =============================================================================
        #SNR = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'NII')
        flux_NII, p16_NII,p84_NII = sp.flux_calc_mcmc(Fits, 'NIIt', Cube.flux_norm)
        SNR_nii = flux_NII/p16_NII
        map_nii[0,i,j]= SNR_nii
        if SNR_nii>SNR_cut:
            map_nii[1,i,j] = flux_NII
            map_nii[2,i,j] = p16_NII
            map_nii[3,i,j] = p84_NII

        else:
            map_nii[2,i,j] = p16_NII.copy()
            map_nii[3,i,j] = p84_NII.copy()
# =============================================================================
#             OIII
# =============================================================================
        flux_oiii, p16_oiii,p84_oiii = sp.flux_calc_mcmc(Fits, 'OIIIt', Cube.flux_norm)
        SNR_oiii = flux_oiii/p16_oiii
        map_oiii[0,i,j]= SNR_oiii

        if SNR_oiii>SNR_cut:
            map_oiii[1,i,j] = flux_oiii
            map_oiii[2,i,j] = p16_oiii
            map_oiii[3,i,j] = p84_oiii

            kins_par = sp.W80_OIII_calc( Fits, z=Cube.z, N=100)

            map_oiii_w80[:,i,j] = kins_par['w80']
            map_oiii_v10[:,i,j] = kins_par['v10']
            map_oiii_v90[:,i,j] = kins_par['v90']
            map_oiii_v50[:,i,j] = kins_par['v50']
            map_oiii_vel[:,i,j] = kins_par['vel_peak']

            flux_oiiin, p16_oiiin,p84_oiiin = sp.flux_calc_mcmc(Fits, 'OIIIn', Cube.flux_norm)
            map_oiii_nar[1,i,j],map_oiii_nar[2,i,j],map_oiii_nar[3,i,j] = flux_oiiin, p16_oiiin,p84_oiiin

            if (map_narrow_fwhm[0,i,j]==np.nan):
                map_narrow_fwhm[:,i,j] = np.percentile(Fits.chains['Nar_fwhm'], (16,50,84) )
                map_narrow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

                map_narrow_vel[:,i,j] = np.percentile((Fits.chains['z']-z0)/(1+z0)*3e5, (16,50,84) )
                map_narrow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])

            if (flag=='outflow') & (map_outflow_fwhm[0,i,j]==np.nan):
                map_outflow_fwhm[:,i,j] = np.percentile(Fits.chains['outflow_fwhm'], (16,50,84) )
                map_outflow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

                map_outflow_vel[:,i,j] = np.percentile(Fits.chains['outflow_vel'], (16,50,84) )
                map_outflow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])
            if (flag=='outflow'):
                flux_oiiiw, p16_oiiiw,p84_oiiiw = sp.flux_calc_mcmc(Fits, 'OIIIw', Cube.flux_norm)
                map_oiii_out[1,i,j],map_oiii_out[2,i,j],map_oiii_out[3,i,j] = flux_oiiiw, p16_oiiiw,p84_oiiiw

            p = baxes.get_ylim()[0][1]
            baxes.text(4810, p*0.9 , 'OIII W80 = '+str(np.round(kins_par['w80'][0],2)) )
        else:
            map_oiii[2,i,j] = p16_oiii.copy()
            map_oiii[3,i,j] = p84_oiii.copy()

# =============================================================================
#             Hbeta
# =============================================================================
        flux_hb, p16_hb,p84_hb = sp.flux_calc_mcmc(Fits, 'Hbeta', Cube.flux_norm)
        SNR_hb = flux_hb/ p16_hb
        map_hb[0,i,j]= SNR_hb
        if SNR_hb>SNR_cut:
            map_hb[1,i,j] = flux_hb
            map_hb[2,i,j] = p16_hb
            map_hb[3,i,j] = p84_hb

        else:
            map_hb[2,i,j] = p16_hb.copy()
            map_hb[3,i,j] = p84_hb.copy()
# =============================================================================
#           SII
# =============================================================================
        fluxr, p16r,p84r = sp.flux_calc_mcmc(Fits, 'SIIr', Cube.flux_norm)
        fluxb, p16b,p84b = sp.flux_calc_mcmc(Fits, 'SIIb', Cube.flux_norm)

        SNR_SII = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'SII')

        if SNR_SII>SNR_cut:
            map_siir[0,i,j] = SNR_SII.copy()
            map_siib[0,i,j] = SNR_SII.copy()

            map_siir[1,i,j] = fluxr
            map_siir[2,i,j] = p16r
            map_siir[3,i,j] = p84r

            map_siib[1,i,j] = fluxb
            map_siib[2,i,j] = p16b
            map_siib[3,i,j] = p84b

        else:
            map_siir[2,i,j] = p16r
            map_siib[2,i,j] = p16b
            map_siir[3,i,j] = p84r
            map_siib[3,i,j] = p84b

        baxes.set_title('xy='+str(j)+' '+ str(i) + ', SNR = '+ str(np.round([SNR_hal, SNR_oiii, SNR_nii, SNR_SII],1)))
        baxes.set_xlabel('Restframe wavelength (ang)')
        baxes.set_ylabel(r'$10^{-16}$ ergs/s/cm2/mic')
        wv0 = 5008.24*(1+z0)
        wv0 = wv0/(1+z)
        baxes.vlines(wv0, 0,10, linestyle='dashed', color='k')
        Spax.savefig()
        plt.close(f)

    print('Failed fits', failed_fits)
    Spax.close()

# =============================================================================
#         Plotting maps
# =============================================================================
    from mpl_toolkits.axes_grid1 import make_axes_locatable
    x = int(Cube.center_data[1]); y= int(Cube.center_data[2])
    IFU_header = Cube.header
    deg_per_pix = IFU_header['CDELT2']
    arc_per_pix = deg_per_pix*3600

    Offsets_low = -Cube.center_data[1:3][::-1]
    Offsets_hig = Cube.dim[0:2] - Cube.center_data[1:3][::-1]

    lim = np.array([ Offsets_low[0], Offsets_hig[0],
                        Offsets_low[1], Offsets_hig[1] ])

    lim_sc = lim*arc_per_pix

    if flux_max==0:
        flx_max = map_hal[1,y,x]
    else:
        flx_max = flux_max

    
    print(lim_sc)

# =============================================================================
#         Plotting Stuff
# =============================================================================
    f,axes = plt.subplots(6,3, figsize=(10,20))
    ax1 = axes[0,0]
    # =============================================================================
    # Halpha SNR
    snr = ax1.imshow(map_hal[0,:,:],vmin=3, vmax=20, origin='lower', extent= lim_sc)
    ax1.set_title('Hal SNR map')
    divider = make_axes_locatable(ax1)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(snr, cax=cax, orientation='vertical')
    ax1.set_xlabel('RA offset (arcsecond)')
    ax1.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Halpha flux
    ax1 = axes[0,1]
    flx = ax1.imshow(map_hal[1,:,:],vmax=flx_max, origin='lower', extent= lim_sc)
    ax1.set_title('Halpha Flux map')
    divider = make_axes_locatable(ax1)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(flx, cax=cax, orientation='vertical')
    cax.set_ylabel('Flux (arbitrary units)')
    ax1.set_xlabel('RA offset (arcsecond)')
    ax1.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Halpha  velocity
    ax2 = axes[0,2]
    vel = ax2.imshow(map_hal_vel[0,:,:], cmap='coolwarm', origin='lower', vmin=velrange[0],vmax=velrange[1], extent= lim_sc)
    ax2.set_title('Hal Velocity offset map')
    divider = make_axes_locatable(ax2)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(vel, cax=cax, orientation='vertical')

    cax.set_ylabel('Velocity (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Halpha fwhm
    ax3 = axes[1,2]
    fw = ax3.imshow(map_hal_w80[0,:,:],vmin=fwhmrange[0],vmax=fwhmrange[1], origin='lower', extent= lim_sc)
    ax3.set_title('Hal FWHM map')
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    cax.set_ylabel('W80 (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [NII] SNR
    axes[1,0].set_title('[NII] SNR')
    fw= axes[1,0].imshow(map_nii[0,:,:],vmin=3, vmax=10,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[1,0])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[1,0].set_xlabel('RA offset (arcsecond)')
    axes[1,0].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [NII] flux
    axes[1,1].set_title('[NII] map')
    fw= axes[1,1].imshow(map_nii[1,:,:] ,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[1,1])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[1,1].set_xlabel('RA offset (arcsecond)')
    axes[1,1].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Hbeta] SNR
    axes[2,0].set_title('Hbeta SNR')
    fw= axes[2,0].imshow(map_hb[0,:,:],vmin=3, vmax=10,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[2,0])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[2,0].set_xlabel('RA offset (arcsecond)')
    axes[2,0].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Hbeta flux
    axes[2,1].set_title('Hbeta map')
    fw= axes[2,1].imshow(map_hb[1,:,:] ,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[2,1])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[2,1].set_xlabel('RA offset (arcsecond)')
    axes[2,1].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [OIII] SNR
    axes[3,0].set_title('[OIII] SNR')
    fw= axes[3,0].imshow(map_oiii[0,:,:],vmin=3, vmax=20,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[3,0])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[3,0].set_xlabel('RA offset (arcsecond)')
    axes[3,0].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [OIII] flux
    axes[3,1].set_title('[OIII] map')
    fw= axes[3,1].imshow(map_oiii[1,:,:] ,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[3,1])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[3,1].set_xlabel('RA offset (arcsecond)')
    axes[3,1].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # OIII  velocity
    ax2 = axes[2,2]
    vel = ax2.imshow(map_oiii_vel[0,:,:], cmap='coolwarm', origin='lower', vmin=velrange[0],vmax=velrange[1], extent= lim_sc)
    ax2.set_title('OIII Velocity offset map')
    divider = make_axes_locatable(ax2)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(vel, cax=cax, orientation='vertical')

    cax.set_ylabel('Velocity (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # OIII fwhm
    ax3 = axes[3,2]
    fw = ax3.imshow(map_oiii_w80[0,:,:],vmin=fwhmrange[0],vmax=fwhmrange[1], origin='lower', extent= lim_sc)
    ax3.set_title('OIII W80 map')
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    cax.set_ylabel('FWHM (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # SII SNR
    ax3 = axes[5,0]
    ax3.set_title('[SII] SNR')
    fw = ax3.imshow(map_siir[0,:,:],vmin=3, vmax=10, origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    # =============================================================================
    # SII Ratio
    ax3 = axes[5,1]
    ax3.set_title('[SII]r/[SII]b')
    fw = ax3.imshow(map_siir[1,:,:]/map_siib[1,:,:] ,vmin=0.3, vmax=1.5, origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    f.savefig(Cube.savepath+'Diagnostics/Halpha_OIII_maps.pdf')

    plt.tight_layout()

    Cube.map_hal = map_hal

    hdr = Cube.header.copy()

    primary_hdu = fits.PrimaryHDU(np.zeros((3,3,3)), header=hdr)

    hdu_data=fits.ImageHDU(Result_cube_data, name='flux')
    hdu_err = fits.ImageHDU(Result_cube_error, name='error')
    hdu_yeval = fits.ImageHDU(Result_cube, name='yeval')
    hdu_resid = fits.ImageHDU(Result_cube_data-Result_cube, name='residuals')

    hdu_nar = fits.ImageHDU(Result_cube_narrow, name='yeval_nar')
    hdu_bro = fits.ImageHDU(Result_cube_broad, name='yeval_bro')

    hal_hdu = fits.ImageHDU(map_hal, name='Hal')
    hal_w80 = fits.ImageHDU(map_hal_w80, name='Hal_w80')
    hal_v10 = fits.ImageHDU(map_hal_v10, name='Hal_v10')
    hal_v90 = fits.ImageHDU(map_hal_v90, name='Hal_v90')
    hal_v50 = fits.ImageHDU(map_hal_v50, name='Hal_v50')
    hal_vel = fits.ImageHDU(map_hal_vel, name='Hal_vel')

    nii_hdu = fits.ImageHDU(map_nii, name='NII')

    oiii_hdu = fits.ImageHDU(map_oiii, name='OIII')
    oiii_w80 = fits.ImageHDU(map_oiii_w80, name='OIII_w80')
    oiii_v10 = fits.ImageHDU(map_oiii_v10, name='OIII_v10')
    oiii_v90 = fits.ImageHDU(map_oiii_v90, name='OIII_v90')
    oiii_v50 = fits.ImageHDU(map_oiii_v50, name='OIII_v50')
    oiii_vel = fits.ImageHDU(map_oiii_vel, name='OIII_vel')

    oiii_nar = fits.ImageHDU(map_oiii_nar, name='OIII_nar')
    oiii_out = fits.ImageHDU(map_oiii_out, name='OIII_out')

    outflow_fwhm = fits.ImageHDU(map_outflow_fwhm, name='outflow_fwhm')
    outflow_vel = fits.ImageHDU(map_outflow_vel, name='outflow_vel')

    Nar_vel = fits.ImageHDU(map_narrow_vel, name='narrow_vel')
    Nar_fwhm = fits.ImageHDU(map_narrow_fwhm, name='narrow_fwhm')

    hb_hdu = fits.ImageHDU(map_hb, name='Hbeta')

    hdulist = fits.HDUList([primary_hdu,hdu_data,hdu_err, hdu_yeval, hdu_nar, hdu_bro, hdu_resid,\
                            oiii_hdu,oiii_w80, oiii_v10, oiii_v90, oiii_vel, oiii_v50, oiii_nar, oiii_out,\
                            hal_hdu,hal_w80, hal_v10, hal_v90, hal_vel, hal_v50, nii_hdu, hb_hdu,Nar_vel, Nar_fwhm, outflow_fwhm,outflow_vel ])
    
   
    hdulist.writeto(Cube.savepath+Cube.ID+'_Halpha_OIII_fits_maps'+add+'.fits', overwrite=True)

    return f

def Map_creation_Halpha_OIII_SNR(Cube, SNR_cut = 3 , fwhmrange = [100,500], velrange=[-100,100], flux_max=0, width_upper=300,add=''):
    """ Function to post process fits. The function will load the fits results and determine which model is more likely,
        based on BIC. It will then calculate the W80 of the emission lines, V50 etc and create flux maps, velocity maps etc.,
        Afterwards it saves all of it as .fits file. 

        Parameters
        ----------
    
        Cube : QubeSpec.Cube class instance
            Cube class from the main part of the QubeSpec. 

        SNR_cut : float
            SNR cutoff to detect emission lines 

        fwhmrange : list
            list of the two values to use as vmin and vmax in imshow of FWHM range

        velrange : list
            list of the two values to use as vmin and vmax in imshow of velocity range
        
        width_upper : float
            FWHM value used in the flux upper limit calculation.
        
        dbic : float
            delta bic to decide which model to use. 
        
        add : str
            additional string to use to load the results and save maps/pdf
            
    """
    z0 = Cube.z
    failed_fits=0
    wv_hal = 6564.52*(1+z0)/1e4
    wv_oiii = 5008.24*(1+z0)/1e4

    from ..Models import Halpha_OIII_models as HO
    # =============================================================================
    #         Importing all the data necessary to post process
    # =============================================================================
    with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_Halpha_OIII'+add+'.txt', "rb") as fp:
        results= pickle.load(fp)

    # =============================================================================
    #         Setting up the maps
    # =============================================================================

    map_oiii = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    map_oiii_w80 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_v10 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_v90 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_oiii_v50 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)

    map_hal = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    map_hal_w80 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_v10 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_v90 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_v50 = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)

    map_hb = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_nii = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_siir = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_siib = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    map_outflow_fwhm = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_outflow_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_narrow_fwhm = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)
    map_narrow_vel = np.full((3,Cube.dim[0], Cube.dim[1]), np.nan)

    map_oiii_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hal_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_hb_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)
    map_nii_out = np.full((4,Cube.dim[0], Cube.dim[1]), np.nan)

    # =============================================================================
    #        Filling these maps
    # =============================================================================
    Result_cube = np.zeros_like(Cube.flux.data)
    Result_cube_data = Cube.flux.data
    Result_cube_error = Cube.error_cube.data

    Result_cube_narrow = np.zeros_like(Cube.flux.data)
    Result_cube_broad = np.zeros_like(Cube.flux.data)

    Spax = PdfPages(Cube.savepath+Cube.ID+'_Spaxel_Halpha_OIII_fit_detection_only'+add+'.pdf')

    from ..Models import Halpha_OIII_models as HO_models
    for row in tqdm.tqdm(range(len(results))):
        
        if len(results[row])==3:
            i,j, Fits= results[row]
            if str(type(Fits)) != "<class 'QubeSpec.Fitting.fits_r.Fitting'>":
                failed_fits+=1
                continue

        else:
            i,j, Fits_sig, Fits_out= results[row]
            if str(type(Fits_sig)) != "<class 'QubeSpec.Fitting.fits_r.Fitting'>":
                failed_fits+=1
                continue

            Fits = Fits_out
        
        if 'outflow_fwhm' in list(Fits.props.keys()):
            flag= 'outflow'
        else:
            flag='single'


        Result_cube_data[:,i,j] = Fits.fluxs.data
        try:
            Result_cube_error[:,i,j] = Fits.error.data
        except:
            lds=0
        Result_cube[:,i,j] = Fits.yeval

        z = Fits.props['popt'][0]
        res_spx = Fits.props
        chains = Fits.chains
        flx_spax_m = Fits.fluxs
        error = Fits.error
        lists= Fits.props.keys()
    

# =============================================================================
#             Halpha
# =============================================================================
        #print(sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'Hn'))
        flux_hal, p16_hal,p84_hal = sp.flux_calc_mcmc(Fits, 'Hat', Cube.flux_norm)
        SNR_hal = flux_hal/p16_hal
        map_hal[0,i,j]= SNR_hal

        #SNR_hal = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'Hn')
        #SNR_oiii = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'OIII')
        #SNR_nii = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'NII')

        if SNR_hal>SNR_cut:
            map_hal[1,i,j] = flux_hal
            map_hal[2,i,j] = p16_hal
            map_hal[3,i,j] = p84_hal

            kins_par= sp.W80_Halpha_calc( Fits, z=Cube.z, N=100)

            map_hal_w80[:,i,j] = kins_par['w80']
            map_hal_v10[:,i,j] = kins_par['v10']
            map_hal_v90[:,i,j] = kins_par['v90']
            map_hal_v50[:,i,j] = kins_par['v50']
            map_hal_vel[:,i,j] = kins_par['vel_peak']

            map_narrow_fwhm[:,i,j] = np.percentile(Fits.chains['Nar_fwhm'], (16,50,84) )
            map_narrow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

            map_narrow_vel[:,i,j] = np.percentile((Fits.chains['z']-z0)/(1+z0)*3e5, (16,50,84) )
            map_narrow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])

            ptp = [Fits.props['z'][0], Fits.props['cont'][0], Fits.props['cont_grad'][0],\
                   Fits.props['Hal_peak'][0], Fits.props['NII_peak'][0], Fits.props['Nar_fwhm'][0],\
                     Fits.props['SIIr_peak'][0],Fits.props['SIIb_peak'][0], Fits.props['OIII_peak'][0],\
                         Fits.props['Hbeta_peak'][0] ]

            Result_cube_narrow[:,i,j] = HO.Halpha_OIII(Cube.obs_wave, *ptp)

            flux_brd = sp.flux_calc_mcmc(Fits, 'Haw', Cube.flux_norm)
            if flux_brd[0]/flux_brd[1]>3:
                map_outflow_fwhm[:,i,j] = np.percentile(Fits.chains['outflow_fwhm'], (16,50,84) )
                map_outflow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

                map_outflow_vel[:,i,j] = np.percentile(Fits.chains['outflow_vel'], (16,50,84) )
                map_outflow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])


        else:     
            map_hal[2,i,j] = p16_hal.copy()
            map_hal[3,i,j] = p84_hal.copy()

# =============================================================================
#             Plotting
# =============================================================================
        f = plt.figure(figsize=(10,4))
        baxes = brokenaxes(xlims=((4800,5050),(6500,6800)),  hspace=.01)
        emplot.plotting_Halpha_OIII(Fits,  baxes)

        #if res_spx['Hal_peak'][0]<3*error[0]:
        #    baxes.set_ylim(-error[0], 5*error[0])
        #if (res_spx['SIIr_peak'][0]>res_spx['Hal_peak'][0]) & (res_spx['SIIb_peak'][0]>res_spx['Hal_peak'][0]):
        #    baxes.set_ylim(-error[0], 5*error[0])

        SNRs = np.array([SNR_hal])

# =============================================================================
#             NII
# =============================================================================
        #SNR = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'NII')
        flux_NII, p16_NII,p84_NII = sp.flux_calc_mcmc(Fits, 'NIIt', Cube.flux_norm)
        SNR_nii = flux_NII/p16_NII
        map_nii[0,i,j]= SNR_nii
        if SNR_nii>SNR_cut:
            map_nii[1,i,j] = flux_NII
            map_nii[2,i,j] = p16_NII
            map_nii[3,i,j] = p84_NII

        else:
            map_nii[2,i,j] = p16_NII.copy()
            map_nii[3,i,j] = p84_NII.copy()
# =============================================================================
#             OIII
# =============================================================================
        flux_oiii, p16_oiii,p84_oiii = sp.flux_calc_mcmc(Fits, 'OIIIt', Cube.flux_norm)
        SNR_oiii = flux_oiii/p16_oiii
        map_oiii[0,i,j]= SNR_oiii

        if SNR_oiii>SNR_cut:
            map_oiii[1,i,j] = flux_oiii
            map_oiii[2,i,j] = p16_oiii
            map_oiii[3,i,j] = p84_oiii

            kins_par = sp.W80_OIII_calc( Fits, z=Cube.z, N=100)

            map_oiii_w80[:,i,j] = kins_par['w80']
            map_oiii_v10[:,i,j] = kins_par['v10']
            map_oiii_v90[:,i,j] = kins_par['v90']
            map_oiii_v50[:,i,j] = kins_par['v50']
            map_oiii_vel[:,i,j] = kins_par['vel_peak']

            if (map_narrow_fwhm[0,i,j]==np.nan):
                map_narrow_fwhm[:,i,j] = np.percentile(Fits.chains['Nar_fwhm'], (16,50,84) )
                map_narrow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

                map_narrow_vel[:,i,j] = np.percentile((Fits.chains['z']-z0)/(1+z0)*3e5, (16,50,84) )
                map_narrow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])

            flux_brd = sp.flux_calc_mcmc(Fits, 'OIIIw', Cube.flux_norm)
            if (flux_brd[0]/flux_brd[1]>3) & (map_outflow_fwhm[0,i,j]==np.nan): #if (flag=='outflow') & (map_outflow_fwhm[0,i,j]==np.nan):
                map_outflow_fwhm[:,i,j] = np.percentile(Fits.chains['outflow_fwhm'], (16,50,84) )
                map_outflow_fwhm[1:,i,j] = abs(map_narrow_fwhm[1:,i,j]-map_narrow_fwhm[0,i,j])

                map_outflow_vel[:,i,j] = np.percentile(Fits.chains['outflow_vel'], (16,50,84) )
                map_outflow_vel[1:,i,j] = abs(map_narrow_vel[1:,i,j]-map_narrow_vel[0,i,j])

            p = baxes.get_ylim()[0][1]
            baxes.text(4810, p*0.9 , 'OIII W80 = '+str(np.round(kins_par['w80'][0],2)) )
        else:
            map_oiii[2,i,j] = p16_oiii.copy()
            map_oiii[3,i,j] = p84_oiii.copy()

# =============================================================================
#             Hbeta
# =============================================================================
        flux_hb, p16_hb,p84_hb = sp.flux_calc_mcmc(Fits, 'Hbeta', Cube.flux_norm)
        SNR_hb = flux_hb/ p16_hb
        map_hb[0,i,j]= SNR_hb
        if SNR_hb>SNR_cut:
            map_hb[1,i,j] = flux_hb
            map_hb[2,i,j] = p16_hb
            map_hb[3,i,j] = p84_hb

        else:
            map_hb[2,i,j] = p16_hb.copy()
            map_hb[3,i,j] = p84_hb.copy()
# =============================================================================
#           SII
# =============================================================================
        fluxr, p16r,p84r = sp.flux_calc_mcmc(Fits, 'SIIr', Cube.flux_norm)
        fluxb, p16b,p84b = sp.flux_calc_mcmc(Fits, 'SIIb', Cube.flux_norm)

        SNR_SII = sp.SNR_calc(Cube.obs_wave, flx_spax_m, error, res_spx, 'SII')

        if SNR_SII>SNR_cut:
            map_siir[0,i,j] = SNR_SII.copy()
            map_siib[0,i,j] = SNR_SII.copy()

            map_siir[1,i,j] = fluxr
            map_siir[2,i,j] = p16r
            map_siir[3,i,j] = p84r

            map_siib[1,i,j] = fluxb
            map_siib[2,i,j] = p16b
            map_siib[3,i,j] = p84b

        else:
            map_siir[2,i,j] = p16r
            map_siib[2,i,j] = p16b
            map_siir[3,i,j] = p84r
            map_siib[3,i,j] = p84b

        baxes.set_title('xy='+str(j)+' '+ str(i) + ', SNR = '+ str(np.round([SNR_hal, SNR_oiii, SNR_nii, SNR_SII],1)))
        baxes.set_xlabel('Restframe wavelength (ang)')
        baxes.set_ylabel(r'$10^{-16}$ ergs/s/cm2/mic')
        wv0 = 5008.24*(1+z0)
        wv0 = wv0/(1+z)
        baxes.vlines(wv0, 0,10, linestyle='dashed', color='k')
        Spax.savefig()
        plt.close(f)

    print('Failed fits', failed_fits)
    Spax.close()

# =============================================================================
#         Plotting maps
# =============================================================================
    from mpl_toolkits.axes_grid1 import make_axes_locatable
    x = int(Cube.center_data[1]); y= int(Cube.center_data[2])
    IFU_header = Cube.header
    deg_per_pix = IFU_header['CDELT2']
    arc_per_pix = deg_per_pix*3600

    Offsets_low = -Cube.center_data[1:3][::-1]
    Offsets_hig = Cube.dim[0:2] - Cube.center_data[1:3][::-1]

    lim = np.array([ Offsets_low[0], Offsets_hig[0],
                        Offsets_low[1], Offsets_hig[1] ])

    lim_sc = lim*arc_per_pix

    if flux_max==0:
        flx_max = map_hal[1,y,x]
    else:
        flx_max = flux_max

    
    print(lim_sc)

# =============================================================================
#         Plotting Stuff
# =============================================================================
    f,axes = plt.subplots(6,3, figsize=(10,20))
    ax1 = axes[0,0]
    # =============================================================================
    # Halpha SNR
    snr = ax1.imshow(map_hal[0,:,:],vmin=3, vmax=20, origin='lower', extent= lim_sc)
    ax1.set_title('Hal SNR map')
    divider = make_axes_locatable(ax1)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(snr, cax=cax, orientation='vertical')
    ax1.set_xlabel('RA offset (arcsecond)')
    ax1.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Halpha flux
    ax1 = axes[0,1]
    flx = ax1.imshow(map_hal[1,:,:],vmax=flx_max, origin='lower', extent= lim_sc)
    ax1.set_title('Halpha Flux map')
    divider = make_axes_locatable(ax1)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(flx, cax=cax, orientation='vertical')
    cax.set_ylabel('Flux (arbitrary units)')
    ax1.set_xlabel('RA offset (arcsecond)')
    ax1.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Halpha  velocity
    ax2 = axes[0,2]
    vel = ax2.imshow(map_hal_vel[0,:,:], cmap='coolwarm', origin='lower', vmin=velrange[0],vmax=velrange[1], extent= lim_sc)
    ax2.set_title('Hal Velocity offset map')
    divider = make_axes_locatable(ax2)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(vel, cax=cax, orientation='vertical')

    cax.set_ylabel('Velocity (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Halpha fwhm
    ax3 = axes[1,2]
    fw = ax3.imshow(map_hal_w80[0,:,:],vmin=fwhmrange[0],vmax=fwhmrange[1], origin='lower', extent= lim_sc)
    ax3.set_title('Hal FWHM map')
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    cax.set_ylabel('W80 (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [NII] SNR
    axes[1,0].set_title('[NII] SNR')
    fw= axes[1,0].imshow(map_nii[0,:,:],vmin=3, vmax=10,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[1,0])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[1,0].set_xlabel('RA offset (arcsecond)')
    axes[1,0].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [NII] flux
    axes[1,1].set_title('[NII] map')
    fw= axes[1,1].imshow(map_nii[1,:,:] ,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[1,1])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[1,1].set_xlabel('RA offset (arcsecond)')
    axes[1,1].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Hbeta] SNR
    axes[2,0].set_title('Hbeta SNR')
    fw= axes[2,0].imshow(map_hb[0,:,:],vmin=3, vmax=10,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[2,0])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[2,0].set_xlabel('RA offset (arcsecond)')
    axes[2,0].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Hbeta flux
    axes[2,1].set_title('Hbeta map')
    fw= axes[2,1].imshow(map_hb[1,:,:] ,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[2,1])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[2,1].set_xlabel('RA offset (arcsecond)')
    axes[2,1].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [OIII] SNR
    axes[3,0].set_title('[OIII] SNR')
    fw= axes[3,0].imshow(map_oiii[0,:,:],vmin=3, vmax=20,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[3,0])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[3,0].set_xlabel('RA offset (arcsecond)')
    axes[3,0].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [OIII] flux
    axes[3,1].set_title('[OIII] map')
    fw= axes[3,1].imshow(map_oiii[1,:,:] ,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[3,1])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[3,1].set_xlabel('RA offset (arcsecond)')
    axes[3,1].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # OIII  velocity
    ax2 = axes[2,2]
    vel = ax2.imshow(map_oiii_vel[0,:,:], cmap='coolwarm', origin='lower', vmin=velrange[0],vmax=velrange[1], extent= lim_sc)
    ax2.set_title('OIII Velocity offset map')
    divider = make_axes_locatable(ax2)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(vel, cax=cax, orientation='vertical')

    cax.set_ylabel('Velocity (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # OIII fwhm
    ax3 = axes[3,2]
    fw = ax3.imshow(map_oiii_w80[0,:,:],vmin=fwhmrange[0],vmax=fwhmrange[1], origin='lower', extent= lim_sc)
    ax3.set_title('OIII W80 map')
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    cax.set_ylabel('FWHM (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # SII SNR
    ax3 = axes[5,0]
    ax3.set_title('[SII] SNR')
    fw = ax3.imshow(map_siir[0,:,:],vmin=3, vmax=10, origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    # =============================================================================
    # SII Ratio
    ax3 = axes[5,1]
    ax3.set_title('[SII]r/[SII]b')
    fw = ax3.imshow(map_siir[1,:,:]/map_siib[1,:,:] ,vmin=0.3, vmax=1.5, origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    f.savefig(Cube.savepath+'Diagnostics/Halpha_OIII_maps.pdf')



    plt.tight_layout()

    Cube.map_hal = map_hal

    hdr = Cube.header.copy()

    primary_hdu = fits.PrimaryHDU(np.zeros((3,3,3)), header=hdr)

    hdu_data=fits.ImageHDU(Result_cube_data, name='flux')
    hdu_err = fits.ImageHDU(Result_cube_error, name='error')
    hdu_yeval = fits.ImageHDU(Result_cube, name='yeval')
    hdu_resid = fits.ImageHDU(Result_cube_data-Result_cube, name='residuals')
    hdu_nar = fits.ImageHDU(Result_cube_narrow, name='yeval_nar')
    hdu_bro = fits.ImageHDU(Result_cube_broad, name='yeval_bro')
    hal_hdu = fits.ImageHDU(map_hal, name='Hal')
    hal_w80 = fits.ImageHDU(map_hal_w80, name='Hal_w80')
    hal_v10 = fits.ImageHDU(map_hal_v10, name='Hal_v10')
    hal_v90 = fits.ImageHDU(map_hal_v90, name='Hal_v90')
    hal_v50 = fits.ImageHDU(map_hal_v50, name='Hal_v50')
    hal_vel = fits.ImageHDU(map_hal_vel, name='Hal_vel')

    nii_hdu = fits.ImageHDU(map_nii, name='NII')

    oiii_hdu = fits.ImageHDU(map_oiii, name='OIII')
    oiii_w80 = fits.ImageHDU(map_oiii_w80, name='OIII_w80')
    oiii_v10 = fits.ImageHDU(map_oiii_v10, name='OIII_v10')
    oiii_v90 = fits.ImageHDU(map_oiii_v90, name='OIII_v90')
    oiii_v50 = fits.ImageHDU(map_oiii_v50, name='OIII_v50')
    oiii_vel = fits.ImageHDU(map_oiii_vel, name='OIII_vel')

    outflow_fwhm = fits.ImageHDU(map_outflow_fwhm, name='outflow_fwhm')
    outflow_vel = fits.ImageHDU(map_outflow_vel, name='outflow_vel')

    Nar_vel = fits.ImageHDU(map_narrow_vel, name='narrow_vel')
    Nar_fwhm = fits.ImageHDU(map_narrow_fwhm, name='narrow_fwhm')

    hb_hdu = fits.ImageHDU(map_hb, name='Hbeta')

    hdulist = fits.HDUList([primary_hdu,hdu_data,hdu_err, hdu_yeval, hdu_resid,\
                            oiii_hdu,oiii_w80, oiii_v10, oiii_v90, oiii_vel, oiii_v50,\
                            hal_hdu,hal_w80, hal_v10, hal_v90, hal_vel, hal_v50, nii_hdu, hb_hdu,Nar_vel, Nar_fwhm, outflow_fwhm,outflow_vel ])
    
   
    hdulist.writeto(Cube.savepath+Cube.ID+'_Halpha_OIII_fits_maps_snr'+add+'.fits', overwrite=True)

    return f

def Map_creation_general(Cube,info, SNR_cut = 3 , width_upper=300,add='',\
                            brokenaxes_xlims= ((2.820,3.45),(3.75,4.05),(5,5.3)), use=np.array([]) ):
    """ Function to post process fits. The function will load the fits results and determine which model is more likely,
        based on BIC. It will then calculate the W80 of the emission lines, V50 etc and create flux maps, velocity maps eyc.,
        Afterwards it saves all of it as .fits file. 

        Parameters
        ----------
    
        Cube : QubeSpec.Cube class instance
            Cube class from the main part of the QubeSpec. 
        
        info : dict
            dictionary containing information on what to extract. 

        SNR_cut : float
            SNR cutoff to detect emission lines 
        
        add : str
            additional string to use to load the results and save maps/pdf
        
        brokenaxes_xlims: list
            list of wavelength ranges to use for broken axes when plotting

            
        """
    z0 = Cube.z
    failed_fits=0
    
    # =============================================================================
    #         Importing all the data necessary to post process
    # =============================================================================
    with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_general'+add+'.txt', "rb") as fp:
        results= pickle.load(fp)

    # =============================================================================
    #         Setting up the maps
    # =============================================================================
    Result_cube = np.zeros_like(Cube.flux.data)
    Result_cube_data = Cube.flux.data
    Result_cube_error = Cube.error_cube.data
    
    info_keys = list(info.keys())

    if len(use) ==0:
        use = np.arange(Result_cube.shape[0])
    
    for key in info_keys:
        if key=='params':
            info[key] = {'extract':info[key]}
            for param in info[key]['extract']:
                info[key][param] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)

        else:
            map_flx = np.zeros((6,Cube.dim[0], Cube.dim[1]))
            map_flx[:,:,:] = np.nan
                
            info[key]['flux_map'] = map_flx
            
            if 'kin' in list(info[key]):
                info[key]['W80'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)
                info[key]['peak_vel'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)

                info[key]['v10'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)
                info[key]['v90'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)


    BIC_map = np.zeros((Cube.dim[0], Cube.dim[1]))
    BIC_map[:,:] = np.nan

    chi2_map = np.zeros((Cube.dim[0], Cube.dim[1]))
    chi2_map[:,:] = np.nan
    # =============================================================================
    #        Filling these maps
    # =============================================================================
    for row in tqdm.tqdm(range(len(results))):

        try:
            i,j, Fits = results[row]
        except:
            ls=0
        if str(type(Fits)) == "<class 'dict'>":
            failed_fits+=1
            continue

        Result_cube_data[use,i,j] = Fits.fluxs.data.copy()
        try:
            Result_cube_error[use,i,j] = Fits.error.data.copy()
        except:
            lds=0
        Result_cube[use,i,j] = Fits.yeval
        try:
            chi2_map[i,j], BIC_map[i,j] = Fits.chi2, Fits.BIC
        except:
            chi2_map[i,j], BIC_map[i,j] = 0,0

        for key in info_keys:
            if key=='params':
                for param in info[key]['extract']:
                    info[key][param][:,i,j] = np.percentile(Fits.chains[param], (16,50,84))
            
            else:
                if 'kin' not in key:
                    if 'lsf' in list(info[key].keys()):
                        lsf = info[key]['lsf']
                    else:
                        lsf = 0
                    SNR= sp.SNR_calc(Cube.obs_wave[use], Fits.fluxs, Fits.error, Fits.props, 'general',\
                                        wv_cent = info[key]['wv'],\
                                        peak_name = key+'_peak', \
                                            fwhm_name = info[key]['fwhm'], lsf=lsf)
                    
                    info[key]['flux_map'][0,i,j] = SNR

                    flux, p16,p84,std = sp.flux_calc_mcmc(Fits, 'general', Cube.flux_norm,\
                                                            wv_cent = info[key]['wv'],\
                                                            peak_name = key+'_peak', \
                                                                fwhm_name = info[key]['fwhm'], lsf=lsf,std=1)
                    
                    info[key]['flux_map'][4,i,j] = flux/p16
                    
                    if SNR>SNR_cut:
                        
                        info[key]['flux_map'][1,i,j] = flux
                        info[key]['flux_map'][2,i,j] = p16
                        info[key]['flux_map'][3,i,j] = p84
                        info[key]['flux_map'][5,i,j] = std

                        if 'kin' in list(info[key]):
                            kins_par = sp.vel_kin_percentiles(Fits, peak_names=info[key]['kin']['peaks'], \
                                                                                fwhm_names=info[key]['kin']['fwhms'],\
                                                                                vel_names=info[key]['kin']['vels'],\
                                                                                rest_wave=info[key]['wv'],\
                                                                                N=100,z=Cube.z)
                    
                            info[key]['W80'][:,i,j] = kins_par['w80']
                            info[key]['peak_vel'][:,i,j] = kins_par['vel_peak']

                            info[key]['v10'][:,i,j] = kins_par['v10']
                            info[key]['v90'][:,i,j] = kins_par['v90']
                            
                    else:
                        flux, p16,p84,std = sp.flux_calc_mcmc(Fits, 'general', Cube.flux_norm,\
                                                            wv_cent = info[key]['wv'],\
                                                            peak_name = key+'_peak', \
                                                                fwhm_name = info[key]['fwhm'],std=1)
                        #upper_lim = sp.upper_limit(Fits, 'general', Cube.flux_norm,\
                        info[key]['flux_map'][2,i,j] = p16
                        info[key]['flux_map'][3,i,j] = p84
                        info[key]['flux_map'][5,i,j] = std
                        #info[key]['flux_map'][1,i,j] = -flux
                        #info[key]['flux_map'][1,i,j] = flux


# =============================================================================
#         Plotting maps
# =============================================================================
    primary_hdu = fits.PrimaryHDU(np.zeros((3,3,3)), header=Cube.header)
    hdus = [primary_hdu]
    hdus.append(fits.ImageHDU(Result_cube_data, name='flux'))
    hdus.append(fits.ImageHDU(Result_cube_error, name='error'))
    hdus.append(fits.ImageHDU(Result_cube, name='yeval'))
    hdus.append(fits.ImageHDU(Result_cube_data-Result_cube, name='residuals'))


    for key in info_keys:
        if key=='params':
            for param in info[key]['extract']:
                hdus.append(fits.ImageHDU(info[key][param], name=param))
            
        else: 
            hdus.append(fits.ImageHDU(info[key]['flux_map'], name=key))
            
            if 'kin' in list(info[key]):
                hdus.append(fits.ImageHDU(info[key]['peak_vel'], name=key+'_peakvel'))
                hdus.append(fits.ImageHDU(info[key]['W80'], name=key+'_W80'))
                hdus.append(fits.ImageHDU(info[key]['v10'], name=key+'_v10'))
                hdus.append(fits.ImageHDU(info[key]['v90'], name=key+'_v90'))


    hdus.append(fits.ImageHDU(chi2_map, name='chi2'))
    hdus.append(fits.ImageHDU(BIC_map, name='BIC'))
    hdulist = fits.HDUList(hdus)
    hdulist.writeto(Cube.savepath+Cube.ID+'_general_fits_maps'+add+'.fits', overwrite=True)
    return hdus


def Map_creation_general_197(Cube,info, SNR_cut = 3 , width_upper=300,add='',\
                            brokenaxes_xlims= ((2.820,3.45),(3.75,4.05),(5,5.3)), use=np.array([]) ):
    """ Function to post process fits. The function will load the fits results and determine which model is more likely,
        based on BIC. It will then calculate the W80 of the emission lines, V50 etc and create flux maps, velocity maps eyc.,
        Afterwards it saves all of it as .fits file. 

        Parameters
        ----------
    
        Cube : QubeSpec.Cube class instance
            Cube class from the main part of the QubeSpec. 
        
        info : dict
            dictionary containing information on what to extract. 

        SNR_cut : float
            SNR cutoff to detect emission lines 
        
        add : str
            additional string to use to load the results and save maps/pdf
        
        brokenaxes_xlims: list
            list of wavelength ranges to use for broken axes when plotting

            
        """
    z0 = Cube.z
    failed_fits=0
    
    # =============================================================================
    #         Importing all the data necessary to post process
    # =============================================================================
    with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_general'+add+'.txt', "rb") as fp:
        results= pickle.load(fp)

    # =============================================================================
    #         Setting up the maps
    # =============================================================================
    Result_cube = np.zeros_like(Cube.flux.data)
    Result_cube_data = Cube.flux.data
    Result_cube_error = Cube.error_cube.data
    
    info_keys = list(info.keys())

    if len(use) ==0:
        use = np.arange(Result_cube.shape[0])
    
    for key in info_keys:
        if key=='params':
            info[key] = {'extract':info[key]}
            for param in info[key]['extract']:
                info[key][param] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)

        else:
            map_flx = np.zeros((7,Cube.dim[0], Cube.dim[1]))
            map_flx[:,:,:] = np.nan
                
            info[key]['flux_map'] = map_flx

            upper_test = np.zeros((Cube.dim[0], Cube.dim[1]))
            info[key]['upper_map'] = upper_test.copy()
            
            if 'kin' in list(info[key]):
                info[key]['W80'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)
                info[key]['peak_vel'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)

                info[key]['v10'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)
                info[key]['v90'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)


    BIC_map = np.zeros((Cube.dim[0], Cube.dim[1]))
    BIC_map[:,:] = np.nan

    chi2_map = np.zeros((Cube.dim[0], Cube.dim[1]))
    chi2_map[:,:] = np.nan
    # =============================================================================
    #        Filling these maps
    # =============================================================================
    for row in tqdm.tqdm(range(len(results))):

        try:
            i,j, Fits = results[row]
        except:
            ls=0
        if str(type(Fits)) == "<class 'dict'>":
            failed_fits+=1
            continue

        Result_cube_data[use,i,j] = Fits.fluxs.data.copy()
        try:
            Result_cube_error[use,i,j] = Fits.error.data.copy()
        except:
            lds=0
        Result_cube[use,i,j] = Fits.yeval
        try:
            chi2_map[i,j], BIC_map[i,j] = Fits.chi2, Fits.BIC
        except:
            chi2_map[i,j], BIC_map[i,j] = 0,0

        for key in info_keys:
            if key=='params':
                for param in info[key]['extract']:
                    info[key][param][:,i,j] = np.percentile(Fits.chains[param], (16,50,84))
            
            else:
                if 'kin' not in key:
                    if 'lsf' in list(info[key].keys()):
                        lsf = info[key]['lsf']
                    else:
                        lsf = 0
                    SNR= sp.SNR_calc(Cube.obs_wave[use], Fits.fluxs, Fits.error, Fits.props, 'general',\
                                        wv_cent = info[key]['wv'],\
                                        peak_name = key+'_peak', \
                                            fwhm_name = info[key]['fwhm'], lsf=lsf)
                    
                    info[key]['flux_map'][0,i,j] = SNR

                    flux, p16,p84,std = sp.flux_calc_mcmc(Fits, 'general', Cube.flux_norm,\
                                                            wv_cent = info[key]['wv'],\
                                                            peak_name = key+'_peak', \
                                                                fwhm_name = info[key]['fwhm'], lsf=lsf,std=1)
                    
                    info[key]['flux_map'][4,i,j] = flux/p16
                    '''
                    res = Fits.props
                    popt = Fits.props['popt']
                    labels = list(Fits.chains.keys())    
                    res_new = {'name': res['name']}
                    for i in range(len(Fits.props['popt'])): 
                        
                        popt[i] = Fits.chains[labels[i+1]][j]
                        res_new[labels[i+1]] = [popt[i], 0,0 ]
                        if '_peak' in labels[i+1]:
                            z = Fits.props['z'][0]
                            err_peak = Fits.errors[sp.find_nearest(Fits.waves, info[key]['wv']*(1+z)/1e4)]
                            popt[i] = err_peak
                            res_new[labels[i+1]] = [err_peak, 0,0 ]

                    res_new['popt'] = popt
                    
                    flux_rms = sp.flux_calc_general(info[key]['wv'],res, peak_name = key+'_peak', \
                                                            fwhm_name = info[key]['fwhm'])  *Cube.flux_norm      
                    info[key]['flux_map'][6,i,j] = flux_rms.copy()
                    info[key]['upper_map'][i,j] = flux_rms.copy()
                    '''
                    info[key]['flux_map'][2,i,j] = p16
                    info[key]['flux_map'][3,i,j] = p84
                    info[key]['flux_map'][5,i,j] = std
                    if SNR>SNR_cut:
                        
                        info[key]['flux_map'][1,i,j] = flux
                        

                        if 'kin' in list(info[key]):
                            kins_par = sp.vel_kin_percentiles(Fits, peak_names=info[key]['kin']['peaks'], \
                                                                                fwhm_names=info[key]['kin']['fwhms'],\
                                                                                vel_names=info[key]['kin']['vels'],\
                                                                                rest_wave=info[key]['wv'],\
                                                                                N=100,z=Cube.z)
                    
                            info[key]['W80'][:,i,j] = kins_par['w80']
                            info[key]['peak_vel'][:,i,j] = kins_par['vel_peak']

                            info[key]['v10'][:,i,j] = kins_par['v10']
                            info[key]['v90'][:,i,j] = kins_par['v90']
                            
                    else:
                        
                        res = Fits.props.copy()
                        popt = Fits.props['popt'].copy()
                        labels = list(Fits.chains.keys())    
                        res_new = {'name': res['name']}
                        for i in range(len(Fits.props['popt'])): 
                            
                            popt[i] = Fits.chains[labels[i+1]][j].copy()
                            res_new[labels[i+1]] = [popt[i], 0,0 ]
                            if '_peak' in labels[i+1]:
                                z = Fits.props['z'][0].copy()
                                err_peak = Fits.errors[sp.find_nearest(Fits.waves, info[key]['wv']*(1+z)/1e4)].copy()
                                popt[i] = err_peak.copy()
                                res_new[labels[i+1]] = [err_peak, 0,0 ]

                        res_new['popt'] = popt.copy()
                        
                        flux_rms = sp.flux_calc_general(info[key]['wv'],res, peak_name = key+'_peak', \
                                                                fwhm_name = info[key]['fwhm'])  *Cube.flux_norm 

                        #print(flux_rms)     
                        info[key]['flux_map'][6,i,j] = flux_rms.copy()
                        info[key]['upper_map'][i,j] = flux_rms.copy()

    plt.figure()
    plt.imshow(info['Hbeta']['upper_map'])          
# =============================================================================
#         Plotting maps
# =============================================================================
    primary_hdu = fits.PrimaryHDU(np.zeros((3,3,3)), header=Cube.header)
    hdus = [primary_hdu]
    hdus.append(fits.ImageHDU(Result_cube_data, name='flux'))
    hdus.append(fits.ImageHDU(Result_cube_error, name='error'))
    hdus.append(fits.ImageHDU(Result_cube, name='yeval'))
    hdus.append(fits.ImageHDU(Result_cube_data-Result_cube, name='residuals'))


    for key in info_keys:
        if key=='params':
            for param in info[key]['extract']:
                hdus.append(fits.ImageHDU(info[key][param], name=param))
            
        else: 
            hdus.append(fits.ImageHDU(info[key]['flux_map'], name=key))
            
            if 'kin' in list(info[key]):
                hdus.append(fits.ImageHDU(info[key]['peak_vel'], name=key+'_peakvel'))
                hdus.append(fits.ImageHDU(info[key]['W80'], name=key+'_W80'))
                hdus.append(fits.ImageHDU(info[key]['v10'], name=key+'_v10'))
                hdus.append(fits.ImageHDU(info[key]['v90'], name=key+'_v90'))


    hdus.append(fits.ImageHDU(chi2_map, name='chi2'))
    hdus.append(fits.ImageHDU(BIC_map, name='BIC'))
    hdulist = fits.HDUList(hdus)
    hdulist.writeto(Cube.savepath+Cube.ID+'_general_fits_maps_experiment'+add+'.fits', overwrite=True)
    return hdus

def Map_creation_ppxf(Cube, info, add=''):
    flux_table = Table.read(Cube.savepath+'PRISM_spaxel/spaxel_R100_ppxf_emlines.fits')
    info_keys = list(info.keys())
    for key in info_keys:
        map_flx = np.zeros((2,Cube.dim[0], Cube.dim[1]))
        map_flx[:,:,:] = np.nan
        
        for k, row in tqdm.tqdm(enumerate(flux_table)):
            ID = str(row['ID'])
            i,j = int(ID[:2]),int(ID[2:])
            map_flx[0,i,j] = (row[key+'_flux'] if row[key+'_flux']>row[key+'_flux_upper'] else np.nan)
            map_flx[0,i,j] = (row[key+'_flux_upper']/3 if row[key+'_flux']>row[key+'_flux_upper'] else np.nan)
        
        info[key]['flux_map'] = map_flx
    
    primary_hdu = fits.PrimaryHDU(np.zeros((3,3,3)), header=Cube.header)
    hdus = [primary_hdu]
    for key in info_keys:
        hdus.append(fits.ImageHDU(info[key]['flux_map'], name=key))
    

    hdulist = fits.HDUList(hdus)
    hdulist.writeto(Cube.savepath+Cube.ID+'_ppxf_fits_maps'+add+'.fits', overwrite=True)
```

`Qubespec/QubeSpec/Maps/__init__.py`:

```py
from .Map_creation import *
```

`Qubespec/QubeSpec/Models/Custom_model.py`:

```py
import numpy as np

#Dependencies
import numpy as np
import emcee
import scipy.stats as stats
from multiprocessing import Pool
from astropy.modeling.powerlaws import PowerLaw1D

#Imports needed for testing
from astropy.io import fits
import matplotlib.pyplot as plt


#Parameter class for storing priors
class Parameter:
    def __init__(self, value, name, prior):
        self.value = value
        self.name = name 
        self.prior_params = prior
    def log_prior(self):
        if self.prior_params[0]== "uniform":
            return stats.uniform.logpdf(self.value, loc = self.prior_params[1], scale= self.prior_params[2]-self.prior_params[1])
        elif self.prior_params[0]== "loguniform":
            return stats.uniform.logpdf(np.log10(self.value), loc=self.prior_params[1], scale=self.prior_params[2]-self.prior_params[1])
        elif self.prior_params[0]== 'normal': 
            return stats.norm.logpdf(self.value,loc= self.prior_params[1], scale= self.prior_params[2])
        elif self.prior_params[0]== 'lognormal':
            return stats.lognorm.logpdf(self.value, loc=self.prior_params[1], scale=self.prior_params[2])
        elif self.prior_params[0]=='normal_hat':
            return stats.truncnorm.logpdf(self.value, a=(self.prior_params[3]-self.prior_params[1])/self.prior_params[2], b=(self.prior_params[4]-self.prior_params[1])/self.prior_params[2], loc=self.prior_params[1],\
                                               scale = self.prior_params[2] )
        else:
            raise NameError("Prior {} not found".format(self.prior_params[0]))
    
    def sample_prior(self, N):
        if self.prior_params[0]== "uniform":
            return stats.uniform.rvs( self.prior_params[1], self.prior_params[2]-self.prior_params[1], N )
        elif self.prior_params[0]== "loguniform":
            return 10**stats.uniform.rvs( self.prior_params[1], self.prior_params[2]-self.prior_params[1],N)
        elif self.prior_params[0]== 'normal': 
            return stats.norm.rvs( self.prior_params[1], self.prior_params[2], N)
        elif self.prior_params[0]== 'lognormal':
            return stats.lognorm.logpdf( self.prior_params[1], self.prior_params[2], N)
        elif self.prior_params[0]=='normal_hat':
            return stats.truncnorm.logpdf(self.prior_params[1], self.prior_params[2], self.prior_params[3],self.prior_params[4],N)
        else:
            raise NameError("Prior {} not found".format(self.prior_params[0]))


###########Line models
class LineModel:
    def __init__(self, name, parameters, rest_wav, width_type=""):
        self.name = name
        self.rest_wav = rest_wav
        self.parameters = parameters
        self.width_type = width_type

    def gauss(self, x, k, mu, sig):
        expo = -((x-mu)**2)/(2*sig*sig)
        y = k * np.e**expo
        return y

    def fwhm_conv(self, fwhm_in, central_wav):
        return (fwhm_in/2.355)*central_wav/(3*10**5)

    def return_value(self, in_wavelenght):
        #print(self.rest_wav)
        cen_wav = self.rest_wav*(1+self.parameters[0])
        sigma = self.fwhm_conv(self.parameters[2], cen_wav)
        return self.gauss(in_wavelenght, self.parameters[1], cen_wav, sigma)

class DoubletModel:
    def __init__(self, name, parameters, rest_wav1, rest_wav2, width_type=""):
        self.name = name
        self.rest_wav1 = rest_wav1
        self.rest_wav2 = rest_wav2
        self.parameters = parameters
        self.width_type = width_type
        
    def gauss(self, x, k, mu, sig):
        expo = -((x-mu)**2)/(2*sig*sig)
        y = k * np.e**expo
        return y

    def fwhm_conv(self, fwhm_in, central_wav):
        return (fwhm_in/2.355)*central_wav/(3*10**5)

    def return_value(self, in_wavelength):
        peak1 = self.parameters[1]
        peak2 = peak1/self.parameters[3]

        cen_wav1 = self.rest_wav1*(1+self.parameters[0])
        sigma1 = self.fwhm_conv(self.parameters[2], cen_wav1)
        cen_wav2 = self.rest_wav2*(1+self.parameters[0])
        sigma2 = self.fwhm_conv(self.parameters[2], cen_wav2)
        flux = self.gauss(in_wavelength, peak1, cen_wav1, sigma1)+\
            self.gauss(in_wavelength, peak2, cen_wav2, sigma2)
        return flux

##############Generic 'build your own line' class:
class Model:
    def __init__(self, model_name, input_parameters):
        self.model_name = model_name #Enter model name
        self.lines = {}
        self.theta = {}
        #input_parameters key format: purpose_narrow/broad_name_type
        line_parameters = {}
        doublet_parameters = {}
        for key in input_parameters.keys():
            split_key = key.split('_')
            value = input_parameters[key][0]
            purpose = split_key[0]
            name = split_key[1]
            #Load a common model parameter
            if purpose == 'm':
                if len(split_key)==2: self.theta[name] = Parameter(value, name, input_parameters[key][1])
                else:
                    self.theta[name+"_"+ split_key[2]] = Parameter(value, name +"_"+split_key[2], 
                    input_parameters[key][1])

            #Load line parameter
            elif purpose =='l':
                name = split_key[2]
                if name not in line_parameters: line_parameters[name] = [0, 0, 0, 0, 0]
                param_name = split_key[3]
                if len(input_parameters[key]) > 1: self.theta[name+'_'+param_name] = Parameter(value, name+'_'+param_name, 
                input_parameters[key][1])
                line_parameters[name][4] = split_key[1]
                if param_name== 'z':
                    line_parameters[name][0] = value
                elif param_name == 'peak':
                    line_parameters[name][1] = value
                elif param_name=='fwhm':
                    line_parameters[name][2] = value
                elif param_name=='wav': 
                    line_parameters[name][3] = value
            
            #Load doublet parameter
            elif purpose=='d':
                name = split_key[2]
                if name not in doublet_parameters: doublet_parameters[name] = [0, 0, 0, -1, -1, 0, 0, 0]
                param_name = split_key[3]
                doublet_parameters[name][7] = split_key[1]

                if len(input_parameters[key]) > 1: 
                    self.theta[name+'_'+param_name] = Parameter(value, name+'_'+param_name, 
                input_parameters[key][1])

                if param_name== 'z': 
                    doublet_parameters[name][0] = value
                if param_name== 'peak1':
                    doublet_parameters[name][1] = value
                if param_name=='fwhm':
                    doublet_parameters[name][2] = value
                if param_name=='ratio': 
                    doublet_parameters[name][3] = value
                if param_name=='peak2': 
                    doublet_parameters[name][4] = value
                if param_name=='wav1':
                    doublet_parameters[name][5] = value
                if param_name=='wav2': 
                    doublet_parameters[name][6] = value
                
        #Initialize lines
        for line_name in line_parameters.keys():
            if line_parameters[line_name][0] == 0:
                line_parameters[line_name][0] = self.theta['z'].value

            if line_parameters[line_name][2] == 0:
                fwhm_type = line_parameters[line_name][4]
                line_parameters[line_name][2] = self.theta["fwhm_"+fwhm_type].value

            self.lines[line_name] = LineModel(line_name, line_parameters[line_name][:-2],
                line_parameters[line_name][-2], width_type=line_parameters[line_name][-1])    

        #Initialize doublets
        for doublet_name in doublet_parameters.keys():
            if doublet_parameters[doublet_name][0] == 0:
                doublet_parameters[doublet_name][0] = self.theta['z'].value

            if doublet_parameters[doublet_name][2] == 0:
                fwhm_type = doublet_parameters[doublet_name][7]
                doublet_parameters[doublet_name][2] = self.theta['fwhm_'+fwhm_type].value

            self.lines[doublet_name] = DoubletModel(doublet_name, doublet_parameters[doublet_name][:-3],
                doublet_parameters[doublet_name][-3], doublet_parameters[doublet_name][-2], width_type=doublet_parameters[doublet_name][-1])

    def prop_calc(self, results):  
        labels = list(results.keys())[1:]
        res_plt = []
        res_dict = {'name': results['name']}
        for lbl in labels:
        
            array = results[lbl]
        
            p50,p16,p84 = np.percentile(array, (50,16,84))
            p16 = p50-p16
            p84 = p84-p50
        
            res_plt.append(p50)
            res_dict[lbl] = np.array([p50,p16,p84])

        res_dict['popt'] = res_plt
        return res_dict

    def calculate_values(self, in_wavelength): #Return model values for plotting
        total = 0
        contm = 0
        for line in self.lines.values():
            total += line.return_value(in_wavelength)
        if ("ContSlope" and "ContNorm") in self.theta.keys():
            contm = PowerLaw1D.evaluate(in_wavelength, self.theta["ContNorm"].value,
            np.min(in_wavelength), alpha=self.theta["ContSlope"].value)
        return total+contm
    
    def update_parameters(self, new_params):
        for index, key in enumerate(self.theta.keys()):
            self.theta[key].value = new_params[index]
            if key == "ContNorm": self.theta[key]

        for key in self.theta.keys():
            split_key = key.split('_')
            if len(split_key) == 2 and split_key[0] != 'fwhm':
                name = split_key[0]
                value = self.theta[key].value
                #Update each line parameter
                if split_key[1]== 'z': 
                    self.lines[name].parameters[0] = value
                elif split_key[1]== 'peak':
                    self.lines[name].parameters[1] = value
                elif split_key[1]== 'peak1':
                    self.lines[name].parameters[1] = value
                elif split_key[1]== 'peak2': 
                    self.lines[name].parameters[4] = value
                elif split_key[1]== 'fwhm':
                    self.lines[name].parameters[2] = value

                self.theta[key].value = value

            #Update fwhm if using global values
            for line in self.lines.values():
                fwhm_type = line.width_type
                if "fwhm_"+fwhm_type in self.theta.keys():
                    line.parameters[2] = self.theta["fwhm_"+fwhm_type].value

    #Evaluat
    def log_prior(self):
        logprior = 0
        for param in self.theta.values():
            logprior += param.log_prior()
        return logprior
    
    def log_prior_test(self):
        l = []
        for param in self.theta.values():
            l.append( param.log_prior())
            if (l[-1]==-np.inf) | (l[-1]==float('nan'))  | (l[-1]==float('nan')) :
                print('Prior returned infinity', param.value,param.prior_params[0] ,param.prior_params[0:], l[-1])
                raise SyntaxError('Prior returned infinity or nan - see above')

    #Chi2 log-likelihood
    def log_likelihood(self,):
        model = self.calculate_values(self.wave)
        sigma2 = self.error**2
        return -0.5*np.sum((self.flux-model)**2/sigma2)

    #Function to be called by mcmc
    def log_probability(self, theta):
        self.update_parameters(theta)
        lp = self.log_prior()
        if not np.isfinite(lp): return -np.inf
        else:
            return lp+self.log_likelihood()

    def fit_to_data(self, wave, flux, error, N=6000, nwalkers=32, ncpu=1, progress=True):
        self.wave = wave
        self.flux = flux
        self.error = error
        self.progress= progress
        self.ncpu = ncpu
        self.N = N 
        pos_l = np.array([par.value for par in self.theta.values()])
        ndim = len(pos_l)
        pos = np.random.normal(pos_l, abs(pos_l*0.1), (nwalkers, len(pos_l)))
        #pos[:,0] = np.random.normal(pos_l[0],0.001, nwalkers)
        
        for i in range(nwalkers):
            self.update_parameters(pos_l)
            self.log_prior_test()
        
        if self.ncpu==1:
            sampler = emcee.EnsembleSampler(
                    nwalkers, ndim, self.log_probability, args=()) 
            
            sampler.run_mcmc(pos, self.N, progress=self.progress)
        
        elif self.ncpu>1:
            from multiprocess import Pool
            with Pool(self.ncpu) as pool:
                sampler = emcee.EnsembleSampler(nwalkers, ndim, self.log_probability, 
            args=(), pool = pool)

                sampler.run_mcmc(pos, self.N, progress=self.progress)

        #Extract chains
        self.flat_samples = sampler.get_chain(discard=int(0.25*N), thin=15, flat=True)
        self.labels = list(self.theta.keys())
        
        self.chains={'name':self.model_name}
        for i in range(len(self.labels)):
            self.chains[self.labels[i]] = self.flat_samples[:,i]
        self.props = self.prop_calc(self.chains) #Calculate properties
        self.update_parameters(self.props['popt']) #Set final parameters to best fit values
        
    
```

`Qubespec/QubeSpec/Models/FeII_comp.py`:

```py

#importing modules
import numpy as np
from astropy.io import fits as pyfits
from . import FeII_templates as pth
import pickle
def find_nearest(array, value):
    """ Find the location of an array closest to a value

	"""
    array = np.asarray(array)
    idx = (np.abs(array - value)).argmin()
    return idx


def preconvolve():
    PATH_TO_FeII = pth.__path__[0]+ '/'
    
    Veron_d = pyfits.getdata(PATH_TO_FeII+ 'Veron-cetty_2004.fits')
    Veron_hd = pyfits.getheader(PATH_TO_FeII+'Veron-cetty_2004.fits')
    Veron_wv = np.arange(Veron_hd['CRVAL1'], Veron_hd['CRVAL1']+ Veron_hd['NAXIS1'])
    
    
    Tsuzuki = np.loadtxt(PATH_TO_FeII+'FeII_Tsuzuki_opttemp.txt')
    Tsuzuki_d = Tsuzuki[:,1]
    Tsuzuki_wv = Tsuzuki[:,0]
    
    
    
    BG92 = np.loadtxt(PATH_TO_FeII+'bg92.con')
    BG92_d = BG92[:,1]
    BG92_wv = BG92[:,0]
    
    # =============================================================================
    # Convolution
    # =============================================================================
    from astropy.convolution import Gaussian1DKernel
    from astropy.convolution import convolve
    from scipy.interpolate import interp1d
    import tqdm
    FWHMs = np.arange(2000,8000,5)
    
    Dict = {'FWHMs':FWHMs}
    Dict['Veron_wavelength'] = Veron_wv
    Dict['Tsuzuki_wavelength'] = Tsuzuki_wv
    Dict['BG92_wavelength'] = BG92_wv
    
    Veron = np.zeros((len(Veron_d), len(FWHMs)))
    Tsuzuki = np.zeros((len(Tsuzuki_d), len(FWHMs)))
    BG92 = np.zeros((len(BG92_d), len(FWHMs)))
    
    
    for i in tqdm.tqdm(range(len(FWHMs))):
        gk = Gaussian1DKernel(stddev=FWHMs[i]/3e5*5008/2.35)
    
        convolved = convolve(Veron_d, gk)
        convolved_veron = convolved/max(convolved[(Veron_wv<5400) &(Veron_wv>4900)])
        Veron[:,i] = convolved_veron
    
        convolved = convolve(Tsuzuki_d, gk)
        convolved_tsuzuki = convolved/max(convolved[(Tsuzuki_wv<5400) &(Tsuzuki_wv>4900)])
        Tsuzuki[:,i] = convolved_tsuzuki
    
        convolved = convolve(BG92_d, gk)
        convolved_bg92 = convolved/max(convolved[(BG92_wv<5400) &(BG92_wv>4900)])
        BG92[:,i] = convolved_bg92
    
    
    Dict['Veron_dat'] = Veron
    Dict['Tsuzuki_dat'] = Tsuzuki
    Dict['BG92_dat'] = BG92
    
    with open(PATH_TO_FeII+'Preconvolved_FeII.txt', "wb") as fp:
        pickle.dump(Dict, fp)
    return True

```

`Qubespec/QubeSpec/Models/FeII_models.py`:

```py
# =============================================================================
# FeII code
# =============================================================================
from astropy.convolution import Gaussian1DKernel
from astropy.convolution import convolve
from scipy.interpolate import interp1d
from astropy.io import fits as pyfits
import numpy as np
import pickle

from . import FeII_templates as pth
PATH_TO_FeII = pth.__path__[0]+ '/'

#Loading the template
Veron_d = pyfits.getdata(PATH_TO_FeII+ 'Veron-cetty_2004.fits')
Veron_hd = pyfits.getheader(PATH_TO_FeII+'Veron-cetty_2004.fits')
Veron_wv = np.arange(Veron_hd['CRVAL1'], Veron_hd['CRVAL1']+ Veron_hd['NAXIS1'])

Tsuzuki = np.loadtxt(PATH_TO_FeII+'FeII_Tsuzuki_opttemp.txt')
Tsuzuki_d = Tsuzuki[:,1]
Tsuzuki_wv = Tsuzuki[:,0]

BG92 = np.loadtxt(PATH_TO_FeII+'bg92.con')
BG92_d = BG92[:,1]
BG92_wv = BG92[:,0]

def find_nearest(array, value):
    """ Find the location of an array closest to a value

	"""
    array = np.asarray(array)
    idx = (np.abs(array - value)).argmin()
    return idx

with open(PATH_TO_FeII+'Preconvolved_FeII.txt', "rb") as fp:
    Templates= pickle.load(fp)

def FeII_Veron(wave,z, FWHM_feii):

    index = find_nearest(Templates['FWHMs'],FWHM_feii)
    convolved = Templates['Veron_dat'][:,index]

    fce = interp1d(Veron_wv*(1+z)/1e4, convolved , kind='cubic',fill_value=0, bounds_error=False)

    return fce(wave)

def FeII_Tsuzuki(wave,z, FWHM_feii):

    index = find_nearest(Templates['FWHMs'],FWHM_feii)
    convolved = Templates['Tsuzuki_dat'][:,index]

    fce = interp1d(Tsuzuki_wv*(1+z)/1e4, convolved , kind='cubic',fill_value=0, bounds_error=False)

    return fce(wave)

def FeII_BG92(wave,z, FWHM_feii):

    index = find_nearest(Templates['FWHMs'],FWHM_feii)
    convolved = Templates['BG92_dat'][:,index]

    fce = interp1d(BG92_wv*(1+z)/1e4, convolved , kind='cubic',fill_value=0, bounds_error=False)

    return fce(wave)
```

`Qubespec/QubeSpec/Models/FeII_templates/FeII_Tsuzuki_opttemp.txt`:

```txt
       4201.2000   1.6038508e-15
       4203.0800   2.1412658e-15
       4204.9500   3.1067311e-15
       4206.8300   3.0618460e-15
       4208.7100   2.9377628e-15
       4210.5800   2.6907355e-15
       4212.4600   2.3109043e-15
       4214.3400   1.5426804e-15
       4216.2100   2.1004185e-15
       4218.0900   2.6055644e-15
       4219.9700   2.3931434e-15
       4221.8400   2.7268916e-15
       4223.7200   3.1364451e-15
       4225.6000   2.8922410e-15
       4227.4700   3.5217885e-15
       4229.3500   4.8908009e-15
       4231.2300   5.9198745e-15
       4233.1000   6.5167090e-15
       4234.9800   5.9623469e-15
       4236.8600   5.0765321e-15
       4238.7300   4.6279240e-15
       4240.6100   4.9130173e-15
       4242.4800   5.6493492e-15
       4244.3600   6.0026832e-15
       4246.2400   5.1368481e-15
       4248.1100   4.2346893e-15
       4249.9900   3.4783862e-15
       4251.8700   3.3483048e-15
       4253.7500   3.1742850e-15
       4255.6200   3.6300556e-15
       4257.5000   3.7790946e-15
       4259.3800   3.2471332e-15
       4261.2500   3.0283120e-15
       4263.1300   3.2518161e-15
       4265.0000   3.4387201e-15
       4266.8800   3.5991521e-15
       4268.7600   3.2657055e-15
       4270.6300   4.0676058e-15
       4272.5100   4.9336253e-15
       4274.3900   4.5736816e-15
       4276.2700   3.9928643e-15
       4278.1400   4.3928008e-15
       4280.0200   4.7548472e-15
       4281.8900   4.9694462e-15
       4283.7700   5.3508104e-15
       4285.6500   5.6276354e-15
       4287.5200   6.1669771e-15
       4289.4000   5.9570861e-15
       4291.2800   6.0022811e-15
       4293.1500   5.8155447e-15
       4295.0300   6.4105446e-15
       4296.9100   6.6180565e-15
       4298.7800   5.9612076e-15
       4300.6600   5.9074846e-15
       4302.5400   5.9467151e-15
       4304.4100   6.0995070e-15
       4306.2900   5.6090213e-15
       4308.1700   5.0561755e-15
       4310.0400   5.4734863e-15
       4311.9200   5.0789364e-15
       4313.8000   4.6647000e-15
       4315.6700   5.7878496e-15
       4317.5500   6.1882469e-15
       4319.4300   5.2689818e-15
       4321.3000   4.5767728e-15
       4323.1800   4.0540766e-15
       4325.0600   3.8499909e-15
       4326.9300   4.9015070e-15
       4328.8100   5.9413369e-15
       4330.6900   5.0955233e-15
       4332.5600   3.4580295e-15
       4334.4400   2.6368198e-15
       4336.3200   2.2309857e-15
       4338.1900   1.1661499e-15
       4340.0700       0.0000000
       4341.9500   3.3272864e-16
       4343.8200   1.0468835e-15
       4345.7000   2.7323116e-15
       4347.5800   5.1579670e-15
       4349.4500   5.9319963e-15
       4351.3300   6.0424247e-15
       4353.2100   6.1991875e-15
       4355.0800   6.7124844e-15
       4356.9600   6.0224116e-15
       4358.8400   4.4244667e-15
       4360.7100   4.3851440e-15
       4362.5900   3.5077986e-15
       4364.4700   2.5325151e-15
       4366.3400   2.7282906e-15
       4368.2200   3.3377747e-15
       4370.1000   3.5947121e-15
       4371.9700   3.2976646e-15
       4373.8500   3.0688661e-15
       4375.7300   2.9227424e-15
       4377.6000   3.2248331e-15
       4379.4800   3.5511171e-15
       4381.3600   4.0642465e-15
       4383.2300   4.8484122e-15
       4385.1100   5.7401079e-15
       4386.9900   5.6838046e-15
       4388.8600   5.0962521e-15
       4390.7400   5.0443720e-15
       4392.6200   5.0571473e-15
       4394.4900   4.7884147e-15
       4396.3700   4.2488049e-15
       4398.2500   3.9558035e-15
       4400.1200   4.0214725e-15
       4402.0000   3.5256923e-15
       4403.8800   3.6041030e-15
       4405.7500   4.4483333e-15
       4407.6300   4.2111242e-15
       4409.5100   4.4088683e-15
       4411.3800   5.7741026e-15
       4413.2600   5.6729226e-15
       4415.1400   5.8187196e-15
       4417.0100   6.3742796e-15
       4418.8900   5.0425960e-15
       4420.7700   4.1514282e-15
       4422.6400   3.1251610e-15
       4424.5200   2.1983565e-15
       4426.4000   2.1538986e-15
       4428.2700   2.2373440e-15
       4430.1500   2.6142683e-15
       4432.0300   2.7291199e-15
       4433.9000   2.0368271e-15
       4435.7800   2.3725439e-15
       4437.6600   3.3743579e-15
       4439.5300   3.6178584e-15
       4441.4100   3.8418650e-15
       4443.2900   3.4294549e-15
       4445.1600   3.5135453e-15
       4447.0400   4.4488862e-15
       4448.9200   4.2601728e-15
       4450.7900   3.6177243e-15
       4452.6700   4.0344907e-15
       4454.5500   4.4007256e-15
       4456.4200   4.4722587e-15
       4458.3000   4.2601476e-15
       4460.1800   4.1427829e-15
       4462.0500   4.3995444e-15
       4463.9300   4.2012893e-15
       4465.8100   3.8161889e-15
       4467.6800   4.0467381e-15
       4469.5600   4.2675950e-15
       4471.4300   4.0037966e-15
       4473.3100   3.8668961e-15
       4475.1900   3.9627398e-15
       4477.0700   4.2622084e-15
       4478.9400   4.3095732e-15
       4480.8200   4.2873903e-15
       4482.7000   4.5897658e-15
       4484.5700   4.8846856e-15
       4486.4500   5.8103592e-15
       4488.3200   6.5884849e-15
       4490.2000   6.5247176e-15
       4492.0800   6.5063799e-15
       4493.9500   5.7007936e-15
       4495.8300   4.7135643e-15
       4497.7100   5.0880340e-15
       4499.5800   5.3090249e-15
       4501.4600   5.6133607e-15
       4503.3400   5.3532063e-15
       4505.2100   5.7099332e-15
       4507.0900   6.2581379e-15
       4508.9700   7.1718154e-15
       4510.8400   8.0691572e-15
       4512.7200   8.5011952e-15
       4514.6000   8.9009558e-15
       4516.4700   8.7217672e-15
       4518.3500   8.3102618e-15
       4520.2300   7.5428254e-15
       4522.1000   7.2560566e-15
       4523.9800   7.7397569e-15
       4525.8600   6.9289600e-15
       4527.7300   6.2826329e-15
       4529.6100   5.8876557e-15
       4531.4900   5.3599332e-15
       4533.3600   4.6811780e-15
       4535.2400   5.2329263e-15
       4537.1200   5.7593084e-15
       4538.9900   5.4406560e-15
       4540.8700   5.3458009e-15
       4542.7500   6.7983676e-15
       4544.6200   8.0708662e-15
       4546.5000   8.0769732e-15
       4548.3800   7.2785913e-15
       4550.2500   7.2135925e-15
       4552.1300   7.6393727e-15
       4554.0100   7.5679821e-15
       4555.8800   7.5230635e-15
       4557.7600   7.0777979e-15
       4559.6400   6.1053795e-15
       4561.5100   6.0189685e-15
       4563.3900   5.9498314e-15
       4565.2700   5.4134887e-15
       4567.1400   4.9578270e-15
       4569.0200   4.7385116e-15
       4570.9000   5.0585965e-15
       4572.7700   4.9924417e-15
       4574.6500   5.6710210e-15
       4576.5300   6.8170823e-15
       4578.4000   7.0375873e-15
       4580.2800   7.6439551e-15
       4582.1600   7.6118368e-15
       4584.0300   8.0620701e-15
       4585.9100   7.9866836e-15
       4587.7900   7.1018992e-15
       4589.6600   5.6936227e-15
       4591.5400   4.4909650e-15
       4593.4200   3.8886937e-15
       4595.2900   3.6735752e-15
       4597.1700   3.3921930e-15
       4599.0500   3.0818676e-15
       4600.9200   3.4964474e-15
       4602.8000   3.5396236e-15
       4604.6800   3.1639642e-15
       4606.5500   2.8698319e-15
       4608.4300   2.9003753e-15
       4610.3100   3.1257642e-15
       4612.1800   3.6197014e-15
       4614.0600   4.2469535e-15
       4617.8100   5.1792284e-15
       4621.5700   6.4976257e-15
       4625.3200   6.4106535e-15
       4627.2000   6.9825490e-15
       4629.0700   7.8265867e-15
       4630.9500   7.7642435e-15
       4632.8300   7.3837421e-15
       4634.7000   6.8950993e-15
       4636.5800   6.6921027e-15
       4638.4600   5.9438501e-15
       4640.3300   4.0666256e-15
       4642.2100   3.1413374e-15
       4644.0900   3.2398032e-15
       4645.9600   2.3388088e-15
       4647.8400   2.3527150e-15
       4649.7200   2.6112358e-15
       4651.5900   3.3879374e-15
       4653.4700   3.8369811e-15
       4655.3500   4.5832400e-15
       4657.2200   4.7190011e-15
       4659.1000   4.5928067e-15
       4660.9800   4.7436636e-15
       4662.8500   4.8994043e-15
       4664.7300   4.6729013e-15
       4666.6100   4.6722646e-15
       4668.4800   4.2239246e-15
       4670.3600   3.6534364e-15
       4672.2400   3.4357797e-15
       4674.1100   2.9223906e-15
       4675.9900   1.3168224e-15
       4677.8700   1.0956724e-15
       4679.7400   1.4056209e-15
       4681.6200   2.0113017e-15
       4683.5000   1.6535528e-15
       4685.3700   1.0018560e-15
       4687.2500   1.3033267e-15
       4689.1300   1.7974733e-15
       4691.0000   1.2556939e-15
       4692.8800   1.0273646e-15
       4694.7500   1.0822018e-15
       4696.6300   1.1523275e-15
       4698.5100   1.3614897e-15
       4700.3900   1.1629414e-15
       4702.2600   1.6405682e-15
       4704.1400   1.4713317e-15
       4706.0200   1.1196898e-15
       4707.8900   1.1947748e-15
       4709.7700   1.4506903e-15
       4711.6400   2.0164453e-15
       4713.5200   1.9218582e-15
       4715.4000   1.0612504e-15
       4717.2700   1.3657788e-15
       4719.1500   1.9602845e-15
       4721.0300   2.2885874e-15
       4722.9000   2.4145640e-15
       4724.7800   2.3613519e-15
       4726.6600   3.0227831e-15
       4728.5400   3.9314845e-15
       4730.4100   3.3933323e-15
       4732.2900   2.8161675e-15
       4734.1600   2.4324242e-15
       4736.0400   2.5743341e-15
       4737.9200   2.3140877e-15
       4739.7900   1.7723417e-15
       4741.6700   1.4618571e-15
       4743.5500   1.1168583e-15
       4745.4200   7.5912205e-16
       4747.3000   8.9904244e-16
       4749.1800   8.5814489e-16
       4751.0500   8.4919803e-16
       4752.9300   1.4615806e-15
       4754.8100   1.2132968e-15
       4756.6800   1.1791681e-15
       4758.5600   1.6541979e-15
       4762.3100   1.9506758e-15
       4766.0700   2.0065853e-15
       4769.8200   2.7122566e-15
       4771.7000   1.9720628e-15
       4773.5700   2.0209690e-15
       4775.4500   2.2570053e-15
       4777.3300   1.9571263e-15
       4779.2000   2.2698811e-15
       4781.0800   2.9021261e-15
       4782.9600   2.7754208e-15
       4784.8300   2.2921645e-15
       4786.7100   1.4956675e-15
       4788.5900   8.0899662e-16
       4790.4600   4.5837342e-16
       4792.3400   1.1597078e-15
       4794.2200   1.7671395e-15
       4796.0900   2.1332404e-15
       4797.9700   2.3442708e-15
       4799.8500   2.5892456e-15
       4801.7200   2.5231075e-15
       4803.6000   2.4430381e-15
       4805.4800   2.3829484e-15
       4807.3500   2.8389619e-15
       4809.2300   3.2085478e-15
       4811.1100   3.7903284e-15
       4812.9800   3.4664486e-15
       4814.8600   3.4454135e-15
       4816.7400   4.3517525e-15
       4818.6100   4.1951405e-15
       4820.4900   3.3297744e-15
       4822.3700   3.5111997e-15
       4824.2400   3.8923461e-15
       4826.1200   3.7921547e-15
       4828.0000   4.3637235e-15
       4829.8700   4.5686050e-15
       4831.7500   3.5195937e-15
       4833.6300   3.3530463e-15
       4835.5000   4.0125089e-15
       4837.3800   3.9937439e-15
       4839.2600   4.1970170e-15
       4841.1300   4.3459303e-15
       4843.0100   4.0668016e-15
       4844.8900   3.2753812e-15
       4846.7600   4.5025004e-15
       4848.6400   6.1248565e-15
       4850.5200   6.4874390e-15
       4852.3900   5.5883882e-15
       4854.2700   4.4339999e-15
       4856.1500   2.2054268e-15
       4858.0200       0.0000000
       4859.9000   1.4344552e-16
       4861.7800   1.0402152e-15
       4863.6500   1.8734547e-15
       4865.5300   2.0534056e-15
       4867.4100   2.1349494e-15
       4869.2800   2.2724110e-15
       4871.1600   1.6208901e-15
       4873.0400   1.9155418e-15
       4874.9100   1.9968426e-15
       4876.7900   1.2214143e-15
       4878.6700   5.2537604e-17
       4880.5400   2.3251791e-17
       4882.4200   9.8167527e-16
       4884.3000   1.8212060e-15
       4886.1700   1.3850967e-15
       4888.0500   1.1090675e-15
       4889.9300   2.3763387e-15
       4891.8000   2.9378549e-15
       4893.6800   2.4942899e-15
       4895.5600   2.0525343e-15
       4897.4300   1.7905538e-15
       4899.3100   2.1970329e-15
       4903.0600   4.0243375e-15
       4906.8200   3.2968687e-15
       4910.5700   4.1852470e-15
       4912.4500   4.0145613e-15
       4914.3200   4.0619428e-15
       4916.2000   3.8859627e-15
       4918.0800   4.0107831e-15
       4919.9500   4.9294366e-15
       4921.8300   6.5883090e-15
       4923.7000   8.0221443e-15
       4925.5800   9.0628873e-15
       4927.4600   8.2858590e-15
       4929.3400   7.3167076e-15
       4931.2100   6.5377693e-15
       4933.0900   6.3625431e-15
       4934.9700   5.8103927e-15
       4936.8400   5.1101918e-15
       4938.7200   4.6875781e-15
       4940.5900   3.9513133e-15
       4942.4700   3.5868292e-15
       4944.3500   3.1689236e-15
       4946.2200   2.5923284e-15
       4948.1000   3.2757749e-15
       4949.9800   3.7604637e-15
       4951.8600   3.7056013e-15
       4953.7300   3.8028775e-15
       4955.6100   3.4683503e-15
       4957.4800   3.2062357e-15
       4959.3600   3.7885776e-15
       4961.2400   3.5770949e-15
       4963.1100   2.8111831e-15
       4964.9900   2.5702126e-15
       4966.8700   3.8625232e-15
       4968.7400   4.5350961e-15
       4970.6200   4.6160451e-15
       4972.5000   5.1692846e-15
       4974.3700   5.5399093e-15
       4976.2500   6.1855326e-15
       4978.1300   6.5785998e-15
       4980.0000   5.8796471e-15
       4981.8800   5.3461527e-15
       4983.7600   6.1650168e-15
       4985.6300   6.9877345e-15
       4987.5100   6.7087733e-15
       4989.3900   7.1602967e-15
       4991.2600   6.5544735e-15
       4993.1400   6.4122787e-15
       4995.0200   7.0198779e-15
       4996.8900   6.9413164e-15
       4998.7700   6.8773731e-15
       5000.6500   6.8139241e-15
       5002.5200   6.7263655e-15
       5004.4000   6.8687446e-15
       5006.2800   6.6407755e-15
       5008.1500   5.6932290e-15
       5010.0300   5.0261348e-15
       5011.9100   4.4068075e-15
       5013.7800   4.3279947e-15
       5015.6600   4.9940333e-15
       5017.5400   5.5317666e-15
       5019.4100   6.1187914e-15
       5021.2900   5.9070909e-15
       5023.1700   5.3907111e-15
       5025.0400   5.1001810e-15
       5026.9200   3.9306132e-15
       5028.8000   2.9902041e-15
       5030.6700   3.0696787e-15
       5032.5500   3.6203129e-15
       5034.4300   3.4028488e-15
       5036.3000   2.2620065e-15
       5038.1800   1.3979473e-15
       5040.0600   8.3837467e-16
       5041.9300   1.2856676e-15
       5043.8100   1.7969875e-15
       5047.5600   1.2880216e-15
       5051.3200   1.1330347e-15
       5055.0700   1.1555359e-15
       5056.9500   1.5607920e-15
       5058.8200   1.3168894e-15
       5060.7000   1.1486080e-15
       5062.5800   1.2613401e-15
       5064.4500   1.0621216e-15
       5066.3300   7.4460686e-16
       5068.2100   4.4456861e-16
       5070.0800   2.2869623e-16
       5071.9600   1.0503014e-16
       5073.8400   2.3201360e-16
       5075.7100   1.2351278e-15
       5077.5900   1.3201314e-15
       5079.4700   5.4898722e-16
       5081.3400   2.8486711e-16
       5083.2200   5.0290501e-16
       5085.1000   7.4193452e-16
       5086.9700   6.8767951e-16
       5088.8500   1.3856998e-15
       5090.7300   1.2013677e-15
       5092.6000   3.5214618e-16
       5094.4800   7.1908065e-16
       5096.3600   1.0757430e-15
       5098.2300   1.0546659e-15
       5100.1100   8.6146227e-16
       5101.9900   1.6882345e-15
       5103.8600   2.2285144e-15
       5105.7400   1.7854939e-15
       5107.6200   1.6742948e-15
       5109.4900   1.4653253e-15
       5111.3700   1.4647053e-15
       5113.2500   1.7094540e-15
       5115.1200   1.8949925e-15
       5117.0000   1.4638425e-15
       5118.8800   1.1511798e-15
       5120.7500   1.6061378e-15
       5122.6300   1.7860217e-15
       5124.5100   1.2301434e-15
       5126.3800   1.8721227e-15
       5128.2600   3.2522349e-15
       5130.1400   3.3427507e-15
       5132.0100   3.3149384e-15
       5133.8900   3.2380356e-15
       5135.7700   3.3523929e-15
       5137.6400   3.5731659e-15
       5139.5200   2.7440900e-15
       5141.4000   2.4504519e-15
       5143.2700   3.5429242e-15
       5145.1500   3.5930786e-15
       5147.0200   2.9358276e-15
       5148.9000   3.3073402e-15
       5150.7800   3.5224587e-15
       5152.6600   2.9145244e-15
       5154.5298   2.2839632e-16
       5156.4102   1.5125979e-15
       5158.2900   2.8377388e-15
       5160.1602   4.3238982e-15
       5162.0400   4.4522371e-15
       5163.9102   3.2102316e-15
       5165.7900   2.6121321e-15
       5167.6700   6.3077897e-15
       5169.5400   7.4686787e-15
       5171.4200   7.1262768e-15
       5173.3000   6.3714481e-15
       5175.1700   5.1199931e-15
       5177.0500   4.2959686e-15
       5178.9300   3.6388014e-15
       5182.6800   2.7383767e-15
       5186.4300   3.4021368e-15
       5195.8200   4.1915383e-15
       5199.5700   4.4559566e-15
       5201.4500   4.6747107e-15
       5203.3200   5.1245922e-15
       5205.2000   3.9455330e-15
       5207.0800   2.5486077e-15
       5208.9500   2.6291463e-15
       5210.8300   2.7843509e-15
       5212.7100   2.5916163e-15
       5214.5800   2.8458815e-15
       5216.4600   2.8145256e-15
       5218.3400   2.4793449e-15
       5220.2100   2.4408098e-15
       5222.0900   2.2177078e-15
       5223.9700   2.9155129e-15
       5225.8400   3.5523151e-15
       5227.7200   4.0421558e-15
       5229.6000   4.4775112e-15
       5231.4700   3.7559986e-15
       5233.3500   3.6790958e-15
       5235.2300   4.6393338e-15
       5237.1000   5.2842284e-15
       5238.9800   4.9742966e-15
       5242.7300   4.8142416e-15
       5246.4900   3.1478800e-15
       5250.2400   4.3930856e-15
       5252.1200   3.6100927e-15
       5253.9900   2.7820304e-15
       5255.8700   3.1816402e-15
       5257.7500   3.3476514e-15
       5259.6201   3.7660178e-15
       5261.5000   3.5748581e-15
       5263.3799   4.1657197e-15
       5265.2500   4.6054061e-15
       5267.1299   4.5609482e-15
       5269.0098   4.6295743e-15
       5270.8799   4.8777828e-15
       5272.7598   5.0161994e-15
       5274.6401   5.1983284e-15
       5276.5098   5.6117941e-15
       5278.3901   5.3984516e-15
       5280.2700   5.8660341e-15
       5282.1401   5.4863370e-15
       5284.0200   4.8475075e-15
       5285.8999   4.3398903e-15
       5287.7700   3.9106503e-15
       5289.6499   3.2591796e-15
       5291.5300   4.5992237e-15
       5293.4000   3.8826453e-15
       5295.2800   2.7952329e-15
       5297.1600   3.7684304e-15
       5299.0300   3.9030941e-15
       5300.9100   3.0756684e-15
       5302.7900   3.2950844e-15
       5304.6600   3.5337260e-15
       5306.5400   3.6566114e-15
       5308.4200   3.9707736e-15
       5310.2900   4.4724094e-15
       5312.1700   4.7305700e-15
       5314.0500   5.4036958e-15
       5315.9200   5.8526390e-15
       5317.8000   6.1069293e-15
       5319.6800   6.9365414e-15
       5321.5500   6.9100777e-15
       5323.4300   5.8416816e-15
       5327.1800   4.5796796e-15
       5336.5700   4.2186972e-15
       5340.3200   4.1134459e-15
       5342.2000   3.5351418e-15
       5344.0700   2.7877939e-15
       5345.9500   2.3254304e-15
       5347.8300   2.7036532e-15
       5349.7000   2.1558673e-15
       5351.5800   2.3239728e-15
       5353.4600   2.1392217e-15
       5355.3300   2.5269526e-15
       5357.2100   2.3982954e-15
       5359.0900   2.1912945e-15
       5360.9600   2.5304711e-15
       5362.8400   2.8648475e-15
       5364.7200   2.8757044e-15
       5366.5900   3.9163217e-15
       5368.4700   4.2103535e-15
       5370.3500   4.6982926e-15
       5372.2200   4.4883513e-15
       5374.1000   3.3773989e-15
       5375.9800   2.0766775e-15
       5377.8500   2.3291164e-15
       5379.7300   2.9620315e-15
       5383.4800   2.3227748e-15
       5387.2400   1.3366178e-15
       5390.9900   6.9045823e-16
       5394.7400   1.6328276e-15
       5396.6200   1.7218020e-15
       5398.4900   1.1777523e-15
       5400.3700   1.6742446e-15
       5402.2500   2.4753155e-15
       5404.1300   1.8478455e-15
       5406.0000   1.1538019e-15
       5407.8800   1.2529462e-15
       5409.7500   1.9570006e-15
       5411.6300   1.6050739e-15
       5413.5100   2.2595520e-15
       5415.3800   2.0406136e-15
       5417.2600   1.4987252e-15
       5419.1400   1.6926074e-15
       5421.0100   2.1074302e-15
       5422.8900   2.7274947e-15
       5424.7700   3.5627698e-15
       5426.6400   3.1353980e-15
       5428.5200   2.6341307e-15
       5430.4000   2.6552999e-15
       5432.2700   2.9289080e-15
       5434.1500   3.7382557e-15
       5436.0300   3.1511052e-15
       5437.9000   2.5662920e-15
       5439.7800   2.8826072e-15
       5441.6600   2.9733408e-15
       5443.5300   2.5300271e-15
       5445.4100   1.3246551e-15
       5447.2900   6.8571589e-16
       5449.1600   1.5064741e-15
       5451.0400   1.6898597e-15
       5452.9200   1.4657274e-15
       5454.7900   7.8705084e-16
       5456.6700   1.0099567e-15
       5458.5500   9.5612477e-16
       5460.4200   4.5931335e-16
       5462.3000   4.7529204e-16
       5464.1800   1.0073514e-15
       5466.0500   5.4343145e-16
       5467.9300   9.9063888e-17
       5471.6800   2.0119803e-16
       5481.0700   1.0894230e-15
       5484.8200   1.8591380e-15
       5486.7000   1.2116130e-15
       5488.5700   1.3284081e-15
       5490.4500   1.1412947e-15
       5492.3300   4.9811576e-16
       5494.2000   7.2721828e-16
       5496.0800   1.3849794e-15
       5497.9600   9.1632463e-16
       5499.8300   8.0649016e-16
       5501.7100   1.3297233e-15
       5503.5900   1.6415650e-15
       5505.4600   2.4635706e-15
       5507.3400   2.2438280e-15
       5509.2200   1.1954617e-15
       5511.0900   1.1250177e-15
       5512.9700   1.7933769e-15
       5514.8500   1.6270725e-15
       5516.7200   8.4286486e-16
       5518.6000   1.1952858e-15
       5520.4800   1.5445318e-15
       5522.3500   1.4027307e-15
       5524.2300   1.7154939e-15
       5527.9800   1.9236761e-15
       5531.7400   2.1913615e-15
       5535.4900   4.0772312e-15
       5537.3700   3.4780343e-15
       5539.2400   3.3278225e-15
       5541.1200   3.5712895e-15
       5543.0000   3.4415432e-15
       5544.8700   2.1421956e-15
       5546.7500   2.5305465e-15
       5548.6300   2.2854125e-15
       5550.5000   2.0567648e-15
       5552.3800   7.6642782e-16
       5554.2600   7.1426711e-16
       5556.1300   1.0684464e-15
       5558.0100   3.0452927e-16
       5559.8900   3.1313015e-16
       5561.7600   3.4405966e-16
       5563.6400       0.0000000
       5565.5200   3.5840815e-16
       5567.3900   1.7385648e-15
       5569.2700   1.5630789e-15
       5571.1500   8.6829807e-16
       5573.0200   1.9409750e-16
       5574.9000   1.2833806e-16
       5576.7800   2.7816031e-16
       5578.6500   5.7214351e-16
       5580.5300   8.3715914e-16
       5582.4100   1.6679365e-16
       5584.2800       0.0000000
       5586.1600       0.0000000
       5588.0400       0.0000000
       5589.9100       0.0000000
       5591.7900   2.7088387e-16
       5593.6700   1.0711690e-15
       5595.5400   3.6629780e-17
       5597.4200   3.9001956e-16
       5599.3000   6.8725227e-16

```

`Qubespec/QubeSpec/Models/Full_optical.py`:

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Fri Nov 11 15:23:35 2022

@author: jansen
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt; plt.ioff()

from astropy.io import fits as pyfits
from astropy import wcs
from astropy.table import Table, join, vstack
from matplotlib.backends.backend_pdf import PdfPages
import pickle

from astropy.modeling.powerlaws import PowerLaw1D
import numba

pi= np.pi
e= np.e

plt.close('all')
c= 3.*10**8
h= 6.62*10**-34
k= 1.38*10**-23

Ken98= (4.5*10**-44)
Conversion2Chabrier=1.7 # Also Madau
Calzetti12= 2.8*10**-44
arrow = u'$\u2193$'

def gauss(x, k, mu,FWHM):
    sig = FWHM/3e5*mu/2.35482
    expo= -((x-mu)**2)/(2*sig*sig)

    y= k* e**expo

    return y
from astropy.modeling.powerlaws import PowerLaw1D

def Full_optical(x, z, cont,cont_grad,  Hal_peak, NII_peak, OIIIn_peak, Hbeta_peak, Hgamma_peak, Hdelta_peak, NeIII_peak, OII_peak, OII_rat,OIIIc_peak, HeI_peak,HeII_peak, Nar_fwhm):
    # Halpha side of things
    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4
    
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4
    Hbeta = 4862.6*(1+z)/1e4

    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_fwhm)
    NII_nar_r = gauss(x, NII_peak, NII_r, Nar_fwhm)
    NII_nar_b = gauss(x, NII_peak/3, NII_b, Nar_fwhm)
    
    Hgamma_wv = 4341.647191*(1+z)/1e4
    Hdelta_wv = 4102.859855*(1+z)/1e4
    
    Hgamma_nar = gauss(x, Hgamma_peak, Hgamma_wv, Nar_fwhm)
    Hdelta_nar = gauss(x, Hdelta_peak, Hdelta_wv, Nar_fwhm)
    
    
    # [OIII] side of things
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4
    Hbeta = 4862.6*(1+z)/1e4

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)
    Hbeta_nar = gauss(x, Hbeta_peak, Hbeta, Nar_fwhm)
    
    NeIII = gauss(x, NeIII_peak, 3869.68*(1+z)/1e4, Nar_fwhm ) + gauss(x, 0.322*NeIII_peak, 3968.68*(1+z)/1e4, Nar_fwhm)
    
    OII = gauss(x, OII_peak, 3727.1*(1+z)/1e4, Nar_fwhm )  + gauss(x, OII_rat*OII_peak, 3729.875*(1+z)/1e4, Nar_fwhm) 
    
    OIIIc = gauss(x, OIIIc_peak, 4364.436*(1+z)/1e4, Nar_fwhm )
    HeI = gauss(x, HeI_peak, 3889.73*(1+z)/1e4, Nar_fwhm )
    HeII = gauss(x, HeII_peak, 4686.0*(1+z)/1e4, Nar_fwhm )

    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)

    return contm+Hal_nar+NII_nar_r+NII_nar_b + OIII_nar + Hbeta_nar + Hgamma_nar + Hdelta_nar + NeIII+ OII + OIIIc+ HeI+HeII

def Full_optical_outflow(x, z, cont,cont_grad,  Hal_peak, NII_peak, OIIIn_peak, Hbeta_peak,\
                          Hgamma_peak, Hdelta_peak, NeIII_peak, OII_peak, OII_rat,OIIIc_peak, \
                            HeI_peak,HeII_peak, Nar_fwhm,\
                                Hal_out_peak, OIII_out_peak, NII_out_peak, Hbeta_out_peak, \
                                  outflow_vel, outflow_fwhm):
    # Halpha side of things
    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4
    
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4
    Hbeta = 4862.6*(1+z)/1e4

    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_fwhm)
    NII_nar_r = gauss(x, NII_peak, NII_r, Nar_fwhm)
    NII_nar_b = gauss(x, NII_peak/3, NII_b, Nar_fwhm)
    
    Hgamma_wv = 4341.647191*(1+z)/1e4
    Hdelta_wv = 4102.859855*(1+z)/1e4
    
    Hgamma_nar = gauss(x, Hgamma_peak, Hgamma_wv, Nar_fwhm)
    Hdelta_nar = gauss(x, Hdelta_peak, Hdelta_wv, Nar_fwhm)
    
    ##### Halpha outflow side
    Hal_out = gauss(x, Hal_out_peak, Hal_wv+outflow_vel/3e5*Hal_wv, outflow_fwhm)
    NII_out_r = gauss(x, NII_out_peak, NII_r+outflow_vel/3e5*NII_r, outflow_fwhm)
    NII_out_b = gauss(x, NII_out_peak/3, NII_b+outflow_vel/3e5*NII_b, outflow_fwhm)
    
    # [OIII] side of things
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4
    Hbeta = 4862.6*(1+z)/1e4

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)
    Hbeta_nar = gauss(x, Hbeta_peak, Hbeta, Nar_fwhm)

    OIII_out = gauss(x, OIII_out_peak, OIIIr+outflow_vel/3e5*OIIIr, outflow_fwhm) + gauss(x, OIII_out_peak/3, OIIIb+outflow_vel/3e5*OIIIb, outflow_fwhm)
    Hbeta_out = gauss(x, Hbeta_out_peak, Hbeta+outflow_vel/3e5*Hbeta, outflow_fwhm)
    
    NeIII = gauss(x, NeIII_peak, 3869.68*(1+z)/1e4, Nar_fwhm ) + gauss(x, 0.322*NeIII_peak, 3968.68*(1+z)/1e4, Nar_fwhm)
    
    OII = gauss(x, OII_peak, 3727.1*(1+z)/1e4, Nar_fwhm )  + gauss(x, OII_rat*OII_peak, 3729.875*(1+z)/1e4, Nar_fwhm) 
    
    OIIIc = gauss(x, OIIIc_peak, 4364.436*(1+z)/1e4, Nar_fwhm )
    HeI = gauss(x, HeI_peak, 3889.73*(1+z)/1e4, Nar_fwhm )
    HeII = gauss(x, HeII_peak, 4686.0*(1+z)/1e4, Nar_fwhm )

    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)

    return contm+Hal_nar+NII_nar_r+NII_nar_b + OIII_nar + Hbeta_nar + Hgamma_nar + Hdelta_nar + NeIII+ OII + OIIIc+ HeI+HeII + \
      Hal_out + NII_out_b + NII_out_r + OIII_out + Hbeta_out

```

`Qubespec/QubeSpec/Models/Halpha_OIII_models.py`:

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Fri Nov 11 15:23:35 2022

@author: jansen
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt; plt.ioff()

from astropy.io import fits as pyfits
from astropy import wcs
from astropy.table import Table, join, vstack
from matplotlib.backends.backend_pdf import PdfPages
import pickle
from astropy.modeling.powerlaws import PowerLaw1D


pi= np.pi
e= np.e

plt.close('all')
c= 3.*10**8
h= 6.62*10**-34
k= 1.38*10**-23

Ken98= (4.5*10**-44)
Conversion2Chabrier=1.7 # Also Madau
Calzetti12= 2.8*10**-44
arrow = u'$\u2193$' 

import numba

def find_nearest(array, value):
    """ Find the location of an array closest to a value

	"""
    array = np.asarray(array)
    idx = (np.abs(array - value)).argmin()
    return idx


def gauss(x, k, mu,sig):

    expo= -((x-mu)**2)/(2*sig*sig)

    y= k* e**expo

    return y

##=============================================================================
# Fitting Halpha + [OIII]
# =============================================================================
def Halpha_OIII(x, z, cont,cont_grad,  Hal_peak, NII_peak, Nar_fwhm, SII_rpk, SII_bpk, OIIIn_peak, Hbeta_peak):
    # Halpha side of things
    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4

    Nar_vel_hal = Nar_fwhm/3e5*Hal_wv/2.35482
    Nar_vel_niir = Nar_fwhm/3e5*NII_r/2.35482
    Nar_vel_niib = Nar_fwhm/3e5*NII_b/2.35482

    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4

    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_vel_hal)

    NII_nar_r = gauss(x, NII_peak, NII_r, Nar_vel_niir)
    NII_nar_b = gauss(x, NII_peak/3, NII_b, Nar_vel_niib)

    SII_rg = gauss(x, SII_rpk, SII_r, Nar_vel_hal)
    SII_bg = gauss(x, SII_bpk, SII_b, Nar_vel_hal)
    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)

    # [OIII] side of things

    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4

    Hbeta = 4862.6*(1+z)/1e4

    OIII_fwhm = Nar_fwhm/3e5*OIIIr/2.35482
    OIII_nar = gauss(x, OIIIn_peak, OIIIr, OIII_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, OIII_fwhm)

    Hbeta_fwhm = Nar_fwhm/3e5*Hbeta/2.35482
    Hbeta_nar = gauss(x, Hbeta_peak, Hbeta, Hbeta_fwhm )

    return contm+Hal_nar+NII_nar_r+NII_nar_b + SII_rg + SII_bg+ OIII_nar + Hbeta_nar 

@numba.njit
def log_prior_Halpha_OIII(theta, priors):
    z, cont,cont_grad,  Hal_peak, NII_peak, Nar_fwhm, SII_rpk, SII_bpk, OIIIn_peak, Hbeta_peak = theta

    if (Hal_peak<0) | (NII_peak<0) | (SII_rpk<0) | (SII_bpk<0) | (Hal_peak/Hbeta_peak<(2.86/1.35)) | \
        (SII_rpk > Hal_peak) | (SII_bpk> Hal_peak) :
        return -np.inf

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
            #results+= norm.pdf(t, p[1], p[2])
        elif p[0]==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1])) 
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))
        elif p[0]==4:
            if p[3]<t<p[4]:
                results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
            else:
                results += -np.inf
        elif p[0]==5:
            if p[3]<np.log10(t)<p[4]:
                results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
            else:
                results += -np.inf

    return results


def Halpha_OIII_outflow(x, z, cont,cont_grad,  Hal_peak, NII_peak, OIIIn_peak, Hbeta_peak, SII_rpk, SII_bpk,\
                        Nar_fwhm, outflow_fwhm, outflow_vel, \
                        Hal_out_peak, NII_out_peak, OIII_out_peak, Hbeta_out_peak):
    # Halpha side of things
    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4
    OIII_r = 5008.24*(1+z)/1e4
    OIII_b = 4960.3*(1+z)/1e4
    Hbeta = 4862.6*(1+z)/1e4
    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4

    Nar_vel_hal = Nar_fwhm/3e5*Hal_wv/2.35482
    Nar_vel_niir = Nar_fwhm/3e5*NII_r/2.35482
    Nar_vel_niib = Nar_fwhm/3e5*NII_b/2.35482
    Nar_vel_oiiir = Nar_fwhm/3e5*OIII_r/2.35482
    Nar_vel_oiiib = Nar_fwhm/3e5*OIII_b/2.35482
    Nar_vel_hbe = Nar_fwhm/3e5*Hbeta/2.35482

    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)

    Nar = gauss(x, Hal_peak, Hal_wv, Nar_vel_hal)  + \
        gauss(x, NII_peak, NII_r, Nar_vel_niir)+  gauss(x, NII_peak/3, NII_b, Nar_vel_niib) + \
        gauss(x, SII_rpk, SII_r, Nar_vel_hal) + gauss(x, SII_bpk, SII_b, Nar_vel_hal)  +\
        gauss(x, OIIIn_peak, OIII_r, Nar_vel_oiiir) + gauss(x, OIIIn_peak/3, OIII_b, Nar_vel_oiiib)+\
        gauss(x, Hbeta_peak, Hbeta, Nar_vel_hbe )



    Out_vel_hal = outflow_fwhm/3e5*Hal_wv/2.35482
    Out_vel_niir = outflow_fwhm/3e5*NII_r/2.35482
    Out_vel_niib = outflow_fwhm/3e5*NII_b/2.35482
    Out_vel_oiiir = outflow_fwhm/3e5*OIII_r/2.35482
    Out_vel_oiiib = outflow_fwhm/3e5*OIII_b/2.35482
    Out_vel_hbe = outflow_fwhm/3e5*Hbeta/2.35482


    Hal_wv = 6564.52*(1+z)/1e4   + outflow_vel/3e5*Hal_wv
    NII_r = 6585.27*(1+z)/1e4 + outflow_vel/3e5*NII_r
    NII_b = 6549.86*(1+z)/1e4 + outflow_vel/3e5*NII_b
    OIII_r = 5008.24*(1+z)/1e4 + outflow_vel/3e5*OIII_r
    OIII_b = 4960.3*(1+z)/1e4  + outflow_vel/3e5*OIII_b
    Hbeta = 4862.6*(1+z)/1e4  + outflow_vel/3e5* Hbeta
    SII_r = 6732.67*(1+z)/1e4  + outflow_vel/3e5*SII_r
    SII_b = 6716.*(1+z)/1e4   + outflow_vel/3e5*SII_b


    Outflow =  gauss(x, Hal_out_peak, Hal_wv, Out_vel_hal)  + \
        gauss(x, NII_out_peak, NII_r, Out_vel_niir)+  gauss(x, NII_out_peak/3, NII_b, Out_vel_niib) + \
        gauss(x, OIII_out_peak, OIII_r, Out_vel_oiiir) + gauss(x, OIII_out_peak/3, OIII_b, Out_vel_oiiib)+\
        gauss(x, Hbeta_out_peak, Hbeta, Out_vel_hbe )


    return contm+Nar+ Outflow

@numba.njit
def log_prior_Halpha_OIII_outflow(theta, priors):
    z, cont,cont_grad,  Hal_peak, NII_peak, OIIIn_peak, Hbeta_peak, SII_rpk, SII_bpk,\
                            Nar_fwhm, outflow_fwhm, outflow_vel, \
                            Hal_out_peak, NII_out_peak, OIII_out_peak, Hbeta_out_peak = theta

    if (Hal_peak<0) | (NII_peak<0) | (SII_rpk<0) | (SII_bpk<0) | (Hal_peak/Hbeta_peak<(2.86/1.35))|\
        (SII_rpk > Hal_peak) | (SII_bpk> Hal_peak):
        return -np.inf

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
            #results+= norm.pdf(t, p[1], p[2])
        elif p[0]==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1])) 
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))
        elif p[0]==4:
            if p[3]<t<p[4]:
                results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
            else:
                results += -np.inf
        elif p[0]==5:
            if p[3]<np.log10(t)<p[4]:
                results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
            else:
                results += -np.inf

    return results






def Halpha_OIII_BLR(x, z, cont,cont_grad,  Hal_peak, NII_peak, OIIIn_peak, Hbeta_peak, SII_rpk, SII_bpk,\
                        Nar_fwhm, outflow_fwhm, outflow_vel, \
                        Hal_out_peak, NII_out_peak, OIII_out_peak,  Hbeta_out_peak,\
                        BLR_fwhm, zBLR, BLR_hal_peak, BLR_hbe_peak):



    NLR = Halpha_OIII(x, z, cont,cont_grad,  Hal_peak, NII_peak, Nar_fwhm, SII_rpk, SII_bpk, OIIIn_peak, Hbeta_peak)


    deltaz = outflow_vel/3e5*(1+z)

    zout = z+ deltaz
    Outflow = Halpha_OIII(x, zout, 0,0,  Hal_out_peak, NII_out_peak, outflow_fwhm , 0, 0, OIII_out_peak, Hbeta_out_peak)

    Hal_wv = 6564.52*(1+z)/1e4
    Hbe_wv = 4862.6*(1+z)/1e4
    BLR_sig_hal = BLR_fwhm/3e5*Hal_wv/2.35482
    BLR_sig_hbe = BLR_fwhm/3e5*Hbe_wv/2.35482

    BLR_wv_hal = 6564.52*(1+zBLR)/1e4
    BLR_wv_hbe = 4862.6*(1+zBLR)/1e4

    Hal_blr = gauss(x, BLR_hal_peak, BLR_wv_hal, BLR_sig_hal)
    Hbe_blr = gauss(x, BLR_hbe_peak, BLR_wv_hbe, BLR_sig_hbe)


    return NLR+Outflow+Hal_blr + Hbe_blr


@numba.njit
def log_prior_Halpha_OIII_BLR(theta, priors):
    z, cont,cont_grad,  Hal_peak, NII_peak, OIIIn_peak, Hbeta_peak, SII_rpk, SII_bpk,\
                            Nar_fwhm, outflow_fwhm, outflow_vel, \
                            Hal_out_peak, NII_out_peak, OIII_out_peak,  Hbeta_out_peak,\
                            BLR_fwhm, zBLR, BLR_hal_peak, BLR_hbe_peak = theta

    if (Hal_peak<0) | (NII_peak<0) | (SII_rpk<0) | (SII_bpk<0) | (Hal_peak/Hbeta_peak<(2.86/1.35)) \
        | (BLR_hal_peak/BLR_hbe_peak<(2.86/1.35)) | (OIII_out_peak>OIIIn_peak) | (NII_out_peak>NII_peak) \
            | (Hbeta_out_peak>Hbeta_peak) | (Hal_out_peak>Hal_peak) | (BLR_hal_peak<0) | (BLR_hbe_peak<0)  :
        return -np.inf

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
            #results+= norm.pdf(t, p[1], p[2])
        elif p[0]==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1])) 
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))
        elif p[0]==4:
            if p[3]<t<p[4]:
                results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
            else:
                results += -np.inf
        elif p[0]==5:
            if p[3]<np.log10(t)<p[4]:
                results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
            else:
                results += -np.inf

    return results


def Halpha_OIII_BLR_simple(x, z, cont,cont_grad,  Hal_peak, NII_peak, OIIIn_peak, Hbeta_peak, SII_rpk, SII_bpk,\
                        Nar_fwhm,\
                        BLR_fwhm, zBLR, BLR_hal_peak, BLR_hbe_peak):

    NLR = Halpha_OIII(x, z, cont,cont_grad,  Hal_peak, NII_peak, Nar_fwhm, SII_rpk, SII_bpk, OIIIn_peak, Hbeta_peak, 0)

    Hal_wv = 6564.52*(1+z)/1e4
    Hbe_wv = 4862.6*(1+z)/1e4
    BLR_sig_hal = BLR_fwhm/3e5*Hal_wv/2.35482
    BLR_sig_hbe = BLR_fwhm/3e5*Hbe_wv/2.35482

    BLR_wv_hal = 6564.52*(1+zBLR)/1e4
    BLR_wv_hbe = 4862.6*(1+zBLR)/1e4

    Hal_blr = gauss(x, BLR_hal_peak, BLR_wv_hal, BLR_sig_hal)
    Hbe_blr = gauss(x, BLR_hbe_peak, BLR_wv_hbe, BLR_sig_hbe)


    return NLR+Hal_blr + Hbe_blr


@numba.njit
def log_prior_Halpha_OIII_BLR_simple(theta, priors):
    z, cont,cont_grad,  Hal_peak, NII_peak, OIIIn_peak, Hbeta_peak, SII_rpk, SII_bpk,\
                            Nar_fwhm, \
                            BLR_fwhm, zBLR, BLR_hal_peak, BLR_hbe_peak = theta

    if (Hal_peak<0) | (NII_peak<0) | (SII_rpk<0) | (SII_bpk<0) | (Hal_peak/Hbeta_peak<(2.86/1.35)) \
        | (BLR_hal_peak/BLR_hbe_peak<(2.86/1.35))  \
           | (BLR_hal_peak<0) | (BLR_hbe_peak<0)  :
        return -np.inf

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
            #results+= norm.pdf(t, p[1], p[2])
        elif p[0]==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1])) 
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))
        elif p[0]==4:
            if p[3]<t<p[4]:
                results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
            else:
                results += -np.inf
        elif p[0]==5:
            if p[3]<np.log10(t)<p[4]:
                results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
            else:
                results += -np.inf

    return results

```

`Qubespec/QubeSpec/Models/Halpha_models.py`:

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Fri Nov 11 15:23:35 2022

@author: jansen
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt; plt.ioff()

from astropy.io import fits as pyfits
from astropy import wcs
from astropy.table import Table, join, vstack
from matplotlib.backends.backend_pdf import PdfPages
import pickle

from astropy.modeling.powerlaws import PowerLaw1D
import numba

pi= np.pi
e= np.e

plt.close('all')
c= 3.*10**8
h= 6.62*10**-34
k= 1.38*10**-23

Ken98= (4.5*10**-44)
Conversion2Chabrier=1.7 # Also Madau
Calzetti12= 2.8*10**-44
arrow = u'$\u2193$'

from scipy.stats import norm, uniform

def gauss(x, k, mu,sig):

    expo= -((x-mu)**2)/(2*sig*sig)

    y= k* e**expo

    return y

# =============================================================================
#  Function for fitting Halpha with BLR
# =============================================================================
def Halpha_wBLR(x,z,cont, cont_grad, Hal_peak, BLR_peak, NII_peak, Nar_fwhm, BLR_fwhm, zBLR, SII_rpk, SII_bpk):
    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4

    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4

    Nar_sig= Nar_fwhm/3e5*Hal_wv/2.35482
    BLR_sig = BLR_fwhm/3e5*Hal_wv/2.35482

    BLR_wv = 6564.52*(1+zBLR)/1e4

    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)
    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_sig)
    Hal_blr = gauss(x, BLR_peak, BLR_wv, BLR_sig)

    NII_rg = gauss(x, NII_peak, NII_r, Nar_sig)
    NII_bg = gauss(x, NII_peak/3, NII_b, Nar_sig)

    SII_rg = gauss(x, SII_rpk, SII_r, Nar_sig)
    SII_bg = gauss(x, SII_bpk, SII_b, Nar_sig)

    return contm + Hal_nar + Hal_blr + NII_rg + NII_bg + SII_rg + SII_bg

def Halpha_BLR_outflow(x,z,cont, cont_grad, Hal_peak, BLR_peak, NII_peak, Nar_fwhm, BLR_fwhm, zBLR, SII_rpk, SII_bpk,Hal_out_peak, NII_out_peak, outflow_fwhm, outflow_vel):
    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4

    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4

    Nar_sig= Nar_fwhm/3e5*Hal_wv/2.35482
    BLR_sig = BLR_fwhm/3e5*Hal_wv/2.35482

    BLR_wv = 6564.52*(1+zBLR)/1e4

    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)
    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_sig)
    Hal_blr = gauss(x, BLR_peak, BLR_wv, BLR_sig)

    NII_rg = gauss(x, NII_peak, NII_r, Nar_sig)
    NII_bg = gauss(x, NII_peak/3, NII_b, Nar_sig)

    SII_rg = gauss(x, SII_rpk, SII_r, Nar_sig)
    SII_bg = gauss(x, SII_bpk, SII_b, Nar_sig)

    Hal_wv_vel = 6564.52*(1+z)/1e4 + outflow_vel/3e5*Hal_wv
    NII_r_vel = 6585.27*(1+z)/1e4 + outflow_vel/3e5*NII_r
    NII_b_vel = 6549.86*(1+z)/1e4 + outflow_vel/3e5*NII_b

    out_vel_hal = outflow_fwhm/3e5*Hal_wv/2.35482
    out_vel_niir = outflow_fwhm/3e5*NII_r/2.35482
    out_vel_niib = outflow_fwhm/3e5*NII_b/2.35482

    Hal_out = gauss(x, Hal_out_peak, Hal_wv_vel, out_vel_hal)
    NII_out_r = gauss(x, NII_out_peak, NII_r_vel, out_vel_niir)
    NII_out_b = gauss(x, NII_out_peak/3, NII_b_vel, out_vel_niib)

    outflow = Hal_out+ NII_out_r + NII_out_b

    return contm + Hal_nar + Hal_blr + NII_rg + NII_bg + SII_rg + SII_bg + outflow

@numba.njit
def log_prior_Halpha_BLR(theta, priors):
    z, cont, cont_grad ,Hal_peak, BLR_peak, NII_peak, Nar_fwhm, BLR_fwhm, BLR_offset, SII_rpk, SII_bpk  = theta

    if (Hal_peak<0) | (NII_peak<0) | (SII_rpk<0) | (SII_bpk<0) | (Hal_peak<SII_rpk) | (Hal_peak<SII_bpk) | (BLR_peak<0):
        return -np.inf

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results



# =============================================================================
# Function to fit just narrow Halpha
# =============================================================================
def Halpha(x, z, cont,cont_grad,  Hal_peak, NII_peak, Nar_fwhm, SII_rpk, SII_bpk):
    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4

    Nar_vel_hal = Nar_fwhm/3e5*Hal_wv/2.35482
    Nar_vel_niir = Nar_fwhm/3e5*NII_r/2.35482
    Nar_vel_niib = Nar_fwhm/3e5*NII_b/2.35482

    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4

    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_vel_hal)

    NII_nar_r = gauss(x, NII_peak, NII_r, Nar_vel_niir)
    NII_nar_b = gauss(x, NII_peak/3, NII_b, Nar_vel_niib)

    SII_rg = gauss(x, SII_rpk, SII_r, Nar_vel_hal)
    SII_bg = gauss(x, SII_bpk, SII_b, Nar_vel_hal)
    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)

    return contm+Hal_nar+NII_nar_r+NII_nar_b + SII_rg + SII_bg

@numba.njit
def log_prior_Halpha(theta, priors):
    z, cont,cont_grad, Hal_peak, NII_peak, Nar_fwhm,  SII_rpk, SII_bpk = theta

    if (Hal_peak<0) | (NII_peak<0) | (SII_rpk<0) | (SII_bpk<0):
        return -np.inf

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results

# =============================================================================
# Function to fit  Halpha with outflow
# =============================================================================
def Halpha_outflow(x, z, cont,cont_grad,  Hal_peak, NII_peak, Nar_fwhm, SII_rpk, SII_bpk, Hal_out_peak, NII_out_peak, outflow_fwhm, outflow_vel):

    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4

    Hal_wv_vel = 6564.52*(1+z)/1e4 + outflow_vel/3e5*Hal_wv
    NII_r_vel = 6585.27*(1+z)/1e4 + outflow_vel/3e5*NII_r
    NII_b_vel = 6549.86*(1+z)/1e4 + outflow_vel/3e5*NII_b


    Nar_vel_hal = Nar_fwhm/3e5*Hal_wv/2.35482
    Nar_vel_niir = Nar_fwhm/3e5*NII_r/2.35482
    Nar_vel_niib = Nar_fwhm/3e5*NII_b/2.35482

    out_vel_hal = outflow_fwhm/3e5*Hal_wv/2.35482
    out_vel_niir = outflow_fwhm/3e5*NII_r/2.35482
    out_vel_niib = outflow_fwhm/3e5*NII_b/2.35482

    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4

    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_vel_hal)
    NII_nar_r = gauss(x, NII_peak, NII_r, Nar_vel_niir)
    NII_nar_b = gauss(x, NII_peak/3, NII_b, Nar_vel_niib)

    Hal_out = gauss(x, Hal_out_peak, Hal_wv_vel, out_vel_hal)
    NII_out_r = gauss(x, NII_out_peak, NII_r_vel, out_vel_niir)
    NII_out_b = gauss(x, NII_out_peak/3, NII_b_vel, out_vel_niib)

    outflow = Hal_out+ NII_out_r + NII_out_b

    SII_rg = gauss(x, SII_rpk, SII_r, Nar_vel_hal)
    SII_bg = gauss(x, SII_bpk, SII_b, Nar_vel_hal)
    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)
    return contm+Hal_nar+NII_nar_r+NII_nar_b + SII_rg + SII_bg + outflow

@numba.njit
def log_prior_Halpha_outflow(theta, priors):
    z, cont,cont_grad, Hal_peak, NII_peak, Nar_fwhm,  SII_rpk, SII_bpk, Hal_out_peak, NII_out_peak, outflow_fwhm, outflow_vel = theta
    if (Hal_peak<0) | (NII_peak<0) | (SII_rpk<0) | (SII_bpk<0) | (Hal_peak<SII_rpk) | (Hal_peak<SII_bpk):
        return -np.inf
    if Hal_peak<Hal_out_peak:
        return -np.inf

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results

```

`Qubespec/QubeSpec/Models/Halpha_models_v2.py`:

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Fri Nov 11 15:23:35 2022

@author: jansen
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt; plt.ioff()

from astropy.io import fits as pyfits
from astropy import wcs
from astropy.table import Table, join, vstack
from matplotlib.backends.backend_pdf import PdfPages
import pickle

from astropy.modeling.powerlaws import PowerLaw1D
import numba

pi= np.pi
e= np.e

plt.close('all')
c= 3.*10**8
h= 6.62*10**-34
k= 1.38*10**-23

Ken98= (4.5*10**-44)
Conversion2Chabrier=1.7 # Also Madau
Calzetti12= 2.8*10**-44
arrow = u'$\u2193$'

from scipy.stats import norm, uniform



class Halpha_gal:

    def __init__(self, z, priors):
        self.z = z
        self.priors = priors
        self.labels=['z', 'cont','cont_grad', 'Hal_peak', 'NII_peak', 'Nar_fwhm', 'SIIr_peak', 'SIIb_peak']


    def gauss(self, x, k, mu,FWHM):
        sig = FWHM/2.35/3e5*mu
        expo= -((x-mu)**2)/(2*sig*sig)
        return k* e**expo
    

    def Halpha(self, x, z, cont,cont_grad,  Hal_peak, NII_peak, Nar_fwhm, SII_rpk, SII_bpk):
        Hal_wv = 6564.52*(1+z)/1e4
        NII_r = 6585.27*(1+z)/1e4
        NII_b = 6549.86*(1+z)/1e4

        SII_r = 6732.67*(1+z)/1e4
        SII_b = 6718.29*(1+z)/1e4

        Hal_nar = self.gauss(x, Hal_peak, Hal_wv, Nar_fwhm)

        NII_nar_r = self.gauss(x, NII_peak, NII_r,  Nar_fwhm)
        NII_nar_b = self.gauss(x, NII_peak/3, NII_b,  Nar_fwhm)

        SII_rg = self.gauss(x, SII_rpk, SII_r,  Nar_fwhm)
        SII_bg = self.gauss(x, SII_bpk, SII_b,  Nar_fwhm)
        contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)

        return contm+Hal_nar+NII_nar_r+NII_nar_b + SII_rg + SII_bg


# =============================================================================
#  Function for fitting Halpha with BLR
# =============================================================================
def Halpha_wBLR(x,z,cont, cont_grad, Hal_peak, BLR_peak, NII_peak, Nar_fwhm, BLR_fwhm, zBLR, SII_rpk, SII_bpk):
    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4

    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4

    Nar_sig= Nar_fwhm/3e5*Hal_wv/2.35482
    BLR_sig = BLR_fwhm/3e5*Hal_wv/2.35482

    BLR_wv = 6564.52*(1+zBLR)/1e4

    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)
    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_sig)
    Hal_blr = gauss(x, BLR_peak, BLR_wv, BLR_sig)

    NII_rg = gauss(x, NII_peak, NII_r, Nar_sig)
    NII_bg = gauss(x, NII_peak/3, NII_b, Nar_sig)

    SII_rg = gauss(x, SII_rpk, SII_r, Nar_sig)
    SII_bg = gauss(x, SII_bpk, SII_b, Nar_sig)

    return contm + Hal_nar + Hal_blr + NII_rg + NII_bg + SII_rg + SII_bg

def Halpha_BLR_outflow(x,z,cont, cont_grad, Hal_peak, BLR_peak, NII_peak, Nar_fwhm, BLR_fwhm, zBLR, SII_rpk, SII_bpk,Hal_out_peak, NII_out_peak, outflow_fwhm, outflow_vel):
    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4

    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4

    Nar_sig= Nar_fwhm/3e5*Hal_wv/2.35482
    BLR_sig = BLR_fwhm/3e5*Hal_wv/2.35482

    BLR_wv = 6564.52*(1+zBLR)/1e4

    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)
    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_sig)
    Hal_blr = gauss(x, BLR_peak, BLR_wv, BLR_sig)

    NII_rg = gauss(x, NII_peak, NII_r, Nar_sig)
    NII_bg = gauss(x, NII_peak/3, NII_b, Nar_sig)

    SII_rg = gauss(x, SII_rpk, SII_r, Nar_sig)
    SII_bg = gauss(x, SII_bpk, SII_b, Nar_sig)

    Hal_wv_vel = 6564.52*(1+z)/1e4 + outflow_vel/3e5*Hal_wv
    NII_r_vel = 6585.27*(1+z)/1e4 + outflow_vel/3e5*NII_r
    NII_b_vel = 6549.86*(1+z)/1e4 + outflow_vel/3e5*NII_b

    out_vel_hal = outflow_fwhm/3e5*Hal_wv/2.35482
    out_vel_niir = outflow_fwhm/3e5*NII_r/2.35482
    out_vel_niib = outflow_fwhm/3e5*NII_b/2.35482

    Hal_out = gauss(x, Hal_out_peak, Hal_wv_vel, out_vel_hal)
    NII_out_r = gauss(x, NII_out_peak, NII_r_vel, out_vel_niir)
    NII_out_b = gauss(x, NII_out_peak/3, NII_b_vel, out_vel_niib)

    outflow = Hal_out+ NII_out_r + NII_out_b

    return contm + Hal_nar + Hal_blr + NII_rg + NII_bg + SII_rg + SII_bg + outflow

@numba.njit
def log_prior_Halpha_BLR(theta, priors):
    z, cont, cont_grad ,Hal_peak, BLR_peak, NII_peak, Nar_fwhm, BLR_fwhm, BLR_offset, SII_rpk, SII_bpk  = theta

    if (Hal_peak<0) | (NII_peak<0) | (SII_rpk<0) | (SII_bpk<0) | (Hal_peak<SII_rpk) | (Hal_peak<SII_bpk) | (BLR_peak<0):
        return -np.inf

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results



# =============================================================================
# Function to fit just narrow Halpha
# =============================================================================
def Halpha(x, z, cont,cont_grad,  Hal_peak, NII_peak, Nar_fwhm, SII_rpk, SII_bpk):
    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4

    Nar_vel_hal = Nar_fwhm/3e5*Hal_wv/2.35482
    Nar_vel_niir = Nar_fwhm/3e5*NII_r/2.35482
    Nar_vel_niib = Nar_fwhm/3e5*NII_b/2.35482

    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4

    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_vel_hal)

    NII_nar_r = gauss(x, NII_peak, NII_r, Nar_vel_niir)
    NII_nar_b = gauss(x, NII_peak/3, NII_b, Nar_vel_niib)

    SII_rg = gauss(x, SII_rpk, SII_r, Nar_vel_hal)
    SII_bg = gauss(x, SII_bpk, SII_b, Nar_vel_hal)
    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)

    return contm+Hal_nar+NII_nar_r+NII_nar_b + SII_rg + SII_bg

@numba.njit
def log_prior_Halpha(theta, priors):
    z, cont,cont_grad, Hal_peak, NII_peak, Nar_fwhm,  SII_rpk, SII_bpk = theta

    if (Hal_peak<0) | (NII_peak<0) | (SII_rpk<0) | (SII_bpk<0):
        return -np.inf

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results

# =============================================================================
# Function to fit  Halpha with outflow
# =============================================================================
def Halpha_outflow(x, z, cont,cont_grad,  Hal_peak, NII_peak, Nar_fwhm, SII_rpk, SII_bpk, Hal_out_peak, NII_out_peak, outflow_fwhm, outflow_vel):

    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4

    Hal_wv_vel = 6564.52*(1+z)/1e4 + outflow_vel/3e5*Hal_wv
    NII_r_vel = 6585.27*(1+z)/1e4 + outflow_vel/3e5*NII_r
    NII_b_vel = 6549.86*(1+z)/1e4 + outflow_vel/3e5*NII_b


    Nar_vel_hal = Nar_fwhm/3e5*Hal_wv/2.35482
    Nar_vel_niir = Nar_fwhm/3e5*NII_r/2.35482
    Nar_vel_niib = Nar_fwhm/3e5*NII_b/2.35482

    out_vel_hal = outflow_fwhm/3e5*Hal_wv/2.35482
    out_vel_niir = outflow_fwhm/3e5*NII_r/2.35482
    out_vel_niib = outflow_fwhm/3e5*NII_b/2.35482

    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4

    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_vel_hal)
    NII_nar_r = gauss(x, NII_peak, NII_r, Nar_vel_niir)
    NII_nar_b = gauss(x, NII_peak/3, NII_b, Nar_vel_niib)

    Hal_out = gauss(x, Hal_out_peak, Hal_wv_vel, out_vel_hal)
    NII_out_r = gauss(x, NII_out_peak, NII_r_vel, out_vel_niir)
    NII_out_b = gauss(x, NII_out_peak/3, NII_b_vel, out_vel_niib)

    outflow = Hal_out+ NII_out_r + NII_out_b

    SII_rg = gauss(x, SII_rpk, SII_r, Nar_vel_hal)
    SII_bg = gauss(x, SII_bpk, SII_b, Nar_vel_hal)
    contm = PowerLaw1D.evaluate(x, cont,Hal_wv, alpha=cont_grad)
    return contm+Hal_nar+NII_nar_r+NII_nar_b + SII_rg + SII_bg + outflow

@numba.njit
def log_prior_Halpha_outflow(theta, priors):
    z, cont,cont_grad, Hal_peak, NII_peak, Nar_fwhm,  SII_rpk, SII_bpk, Hal_out_peak, NII_out_peak, outflow_fwhm, outflow_vel = theta
    if (Hal_peak<0) | (NII_peak<0) | (SII_rpk<0) | (SII_bpk<0) | (Hal_peak<SII_rpk) | (Hal_peak<SII_bpk):
        return -np.inf
    if Hal_peak<Hal_out_peak:
        return -np.inf

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results

```

`Qubespec/QubeSpec/Models/OIII_models.py`:

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Fri Nov 11 15:23:35 2022

@author: jansen
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt; plt.ioff()

from astropy.io import fits as pyfits
from astropy.table import Table, join, vstack
from astropy.modeling.powerlaws import PowerLaw1D

pi= np.pi
e= np.e

plt.close('all')
c= 3.*10**8
h= 6.62*10**-34
k= 1.38*10**-23

Ken98= (4.5*10**-44)
Conversion2Chabrier=1.7 # Also Madau
Calzetti12= 2.8*10**-44
arrow = u'$\u2193$'

from . import FeII_templates as pth
PATH_TO_FeII = pth.__path__[0]+ '/'

from . import FeII_models as Fem

def gauss(x, k, mu,FWHM):
    sig = FWHM/3e5*mu/2.35482
    expo= -((x-mu)**2)/(2*sig*sig)
    y= k* e**expo
    return y

def OIII_gal(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbeta_peak):
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = OIIIr- (48.*(1+z)/1e4)

    Hbeta = 4862.6*(1+z)/1e4
    OIII_nar = gauss(x, OIIIn_peak, OIIIr,OIII_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, OIII_fwhm)

    Hbeta_wv = Hbeta 
    Hbeta_nar = gauss(x, Hbeta_peak, Hbeta_wv, OIII_fwhm )
    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)
    return contm+ OIII_nar + Hbeta_nar

def OIII_outflow(x, z, cont,cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbeta_peak, Hbeta_out_peak):

    y = OIII_gal(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbeta_peak)
    z_out = z+ out_vel/3e5*(1+z)
    y += OIII_gal(x, z_out, 0, 0, OIIIw_peak,  OIII_out, Hbeta_out_peak)

    return y

def OIII_gal_BLR(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbeta_peak,\
                  zBLR, Hbeta_blr_peak, BLR_fwhm):
    y = OIII_gal(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbeta_peak)

    Hbeta_blr = 4862.6*(1+zBLR)/1e4
    y += gauss(x, Hbeta_blr_peak, Hbeta_blr, BLR_fwhm )
    return y

def OIII_outflow_BLR(x, z, cont,cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbeta_peak, Hbeta_out_peak,\
                      zBLR, Hbeta_blr_peak, BLR_fwhm):

    y = OIII_gal(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbeta_peak)
    z_out = z+ out_vel/3e5*(1+z)
    y += OIII_gal(x, z_out, 0, 0, OIIIw_peak,  OIII_out, Hbeta_out_peak)
    
    Hbeta_blr = 4862.6*(1+zBLR)/1e4
    y += gauss(x, Hbeta_blr_peak, Hbeta_blr, BLR_fwhm )

    return y


class OIII_fe_models:
    def __init__(self, template):
        self.template = template

    def OIII_gal_BLR_Fe(self, x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbeta_peak,\
                    zBLR, Hbeta_blr_peak, BLR_fwhm,\
                        FeII_peak, FeII_fwhm):
        
        y = OIII_gal(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbeta_peak)

        Hbeta_blr = 4862.6*(1+zBLR)/1e4
        y += gauss(x, Hbeta_blr_peak, Hbeta_blr, BLR_fwhm )

        if self.template=='BG92':
            FeII_fce = Fem.FeII_BG92
        if self.template=='Tsuzuki':
            FeII_fce = Fem.FeII_Tsuzuki
        if self.template=='Veron':
            FeII_fce = Fem.FeII_Veron

        y += FeII_peak*FeII_fce(x, z, FeII_fwhm)

        return y

    def OIII_outflow_BLR_Fe(self, x, z, cont,cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbeta_peak, Hbeta_out_peak,\
                        zBLR, Hbeta_blr_peak, BLR_fwhm,\
                            FeII_peak, FeII_fwhm):

        y = OIII_gal(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbeta_peak)
        z_out = z+ out_vel/3e5*(1+z)
        y += OIII_gal(x, z_out, 0, 0, OIIIw_peak,  OIII_out, Hbeta_out_peak)
        
        Hbeta_blr = 4862.6*(1+zBLR)/1e4
        y += gauss(x, Hbeta_blr_peak, Hbeta_blr, BLR_fwhm )

        if self.template=='BG92':
            FeII_fce = Fem.FeII_BG92
        if self.template=='Tsuzuki':
            FeII_fce = Fem.FeII_Tsuzuki
        if self.template=='Veron':
            FeII_fce = Fem.FeII_Veron

        y += FeII_peak*FeII_fce(x, z, FeII_fwhm)

        return y

```

`Qubespec/QubeSpec/Models/OIII_models_old.py`:

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Fri Nov 11 15:23:35 2022

@author: jansen
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt; plt.ioff()

from astropy.io import fits as pyfits
from astropy import wcs
from astropy.table import Table, join, vstack
from matplotlib.backends.backend_pdf import PdfPages
import pickle
from astropy.modeling.powerlaws import PowerLaw1D


pi= np.pi
e= np.e

plt.close('all')
c= 3.*10**8
h= 6.62*10**-34
k= 1.38*10**-23

Ken98= (4.5*10**-44)
Conversion2Chabrier=1.7 # Also Madau
Calzetti12= 2.8*10**-44
arrow = u'$\u2193$'

from . import FeII_templates as pth
PATH_TO_FeII = pth.__path__[0]+ '/'

def find_nearest(array, value):
    """ Find the location of an array closest to a value

	"""
    array = np.asarray(array)
    idx = (np.abs(array - value)).argmin()
    return idx


def gauss(x, k, mu,sig):

    expo= -((x-mu)**2)/(2*sig*sig)

    y= k* e**expo

    return y

def OIII_simple(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbeta_peak):
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = OIIIr- (48.*(1+z)/1e4)

    Hbeta = 4862.6*(1+z)/1e4
    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)

    Hbeta_fwhm = OIII_fwhm/3e5*Hbeta/2.35482
    Hbeta_wv = Hbeta 
    Hbeta_nar = gauss(x, Hbeta_peak, Hbeta_wv, Hbeta_fwhm )
    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)
    return contm+ OIII_nar + Hbeta_nar

def OIII_outflow_simple(x, z, cont,cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbeta_peak, Hbeta_out_peak):
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = OIIIr- (48.*(1+z)/1e4)
    Hbeta = 4862.6*(1+z)/1e4


    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482
    Out_fwhm = OIII_out/3e5*OIIIr/2.35482

    out_vel_wv = out_vel/3e5*OIIIr

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)
    OIII_out = gauss(x, OIIIw_peak, OIIIr+out_vel_wv, Out_fwhm) + gauss(x, OIIIw_peak/3, OIIIb+out_vel_wv, Out_fwhm)

    Hbeta_fwhm = OIII_fwhm/3e5*Hbeta/2.35482
    Hbeta_nar = gauss(x, Hbeta_peak, Hbeta, Hbeta_fwhm )

    out_vel_wv = out_vel/3e5*Hbeta
    Hbeta_fwhm_out = OIII_fwhm/3e5*Hbeta/2.35482
    Hbeta_out = gauss(x, Hbeta_out_peak, Hbeta+out_vel_wv, Hbeta_fwhm_out )

    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)
    return contm+ OIII_nar + OIII_out + Hbeta_nar + Hbeta_out

def log_prior_OIII_outflow_simple(theta,priors):
    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results

def log_prior_OIII_simple(theta,priors):
    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results


# =============================================================================
#    functions to fit [OIII] only with outflow
# =============================================================================
def OIII_outflow(x, z, cont,cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbeta_peak, Hbeta_fwhm, Hbeta_vel):
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = OIIIr- (48.*(1+z)/1e4)
    Hbeta = 4862.6*(1+z)/1e4


    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482
    Out_fwhm = OIII_out/3e5*OIIIr/2.35482

    out_vel_wv = out_vel/3e5*OIIIr

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)
    OIII_out = gauss(x, OIIIw_peak, OIIIr+out_vel_wv, Out_fwhm) + gauss(x, OIIIw_peak/3, OIIIb+out_vel_wv, Out_fwhm)

    Hbeta_fwhm = Hbeta_fwhm/3e5*Hbeta/2.35482

    Hbeta_wv = Hbeta + Hbeta_vel/3e5*Hbeta
    Hbeta_nar = gauss(x, Hbeta_peak, Hbeta_wv, Hbeta_fwhm )
    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)
    return contm+ OIII_nar + OIII_out + Hbeta_nar

def log_prior_OIII_outflow(theta,priors):
    z, cont, cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbeta_peak, Hbeta_fwhm, Hbeta_vel, = theta

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results

# =============================================================================
#    functions to fit [OIII] only with outflow with nar Hbeta
# =============================================================================
def OIII_outflow_narHb(x, z, cont,cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbetab_peak, Hbetab_fwhm,Hbetab_vel, Hbetan_peak, Hbetan_fwhm, Hbetan_vel):
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = OIIIr- (48.*(1+z)/1e4)
    Hbeta = 4862.6*(1+z)/1e4


    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482
    Out_fwhm = OIII_out/3e5*OIIIr/2.35482

    out_vel_wv = out_vel/3e5*OIIIr

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)
    OIII_out = gauss(x, OIIIw_peak, OIIIr+out_vel_wv, Out_fwhm) + gauss(x, OIIIw_peak/3, OIIIb+out_vel_wv, Out_fwhm)

    Hbetab_fwhm = Hbetab_fwhm/3e5*Hbeta/2.35482
    Hbetab_wv = Hbeta + Hbetab_vel/3e5*Hbeta
    Hbetab_blr = gauss(x, Hbetab_peak, Hbetab_wv, Hbetab_fwhm )

    Hbetan_fwhm = Hbetan_fwhm/3e5*Hbeta/2.35482
    Hbetan_wv = Hbeta + Hbetan_vel/3e5*Hbeta
    Hbeta_nar = gauss(x, Hbetan_peak, Hbetan_wv, Hbetan_fwhm )

    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)
    return contm+ OIII_nar + OIII_out + Hbetab_blr + Hbeta_nar

def log_prior_OIII_outflow_narHb(theta,priors):
    #zguess = np.loadtxt('zguess.txt')

    z, cont, cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbeta_peak, Hbeta_fwhm,Hbeta_vel, Hbetan_peak, Hbetan_fwhm, Hbetan_vel, = theta

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results
# =============================================================================
#  Function to fit [OIII] without outflow with hbeta
# =============================================================================
def OIII(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbeta_peak, Hbeta_fwhm, Hbeta_vel):
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = OIIIr- (48.*(1+z)/1e4)

    Hbeta = 4862.6*(1+z)/1e4

    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)

    Hbeta_fwhm = Hbeta_fwhm/3e5*Hbeta/2.35482

    Hbeta_wv = Hbeta + Hbeta_vel/3e5*Hbeta
    Hbeta_nar = gauss(x, Hbeta_peak, Hbeta_wv, Hbeta_fwhm )

    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)
    return contm+ OIII_nar + Hbeta_nar

def log_prior_OIII(theta,priors):

    z, cont, cont_grad, OIIIn_peak, OIII_fwhm, Hbeta_peak, Hbeta_fwhm, Hbeta_vel = theta

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results

# =============================================================================
#  Function to fit [OIII] without outflow with dual hbeta
# =============================================================================
def OIII_dual_hbeta(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbetab_peak, Hbetab_fwhm, Hbetab_vel, Hbetan_peak, Hbetan_fwhm, Hbetan_vel):
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = OIIIr- (48.*(1+z)/1e4)

    Hbeta = 4862.6*(1+z)/1e4

    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)

    Hbetab_fwhm = Hbetab_fwhm/3e5*Hbeta/2.35482
    Hbetab_wv = Hbeta + Hbetab_vel/3e5*Hbeta
    Hbeta_blr = gauss(x, Hbetab_peak, Hbetab_wv, Hbetab_fwhm )

    Hbetan_fwhm = Hbetan_fwhm/3e5*Hbeta/2.35482
    Hbetan_wv = Hbeta + Hbetan_vel/3e5*Hbeta
    Hbeta_nar = gauss(x, Hbetan_peak, Hbetan_wv, Hbetan_fwhm )

    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)
    return contm+ OIII_nar + Hbeta_blr + Hbeta_nar

def log_prior_OIII_dual_hbeta(theta,priors):

    z, cont, cont_grad, OIIIn_peak, OIII_fwhm, Hbeta_peak, Hbeta_fwhm,Hbeta_vel, Hbetan_peak, Hbetan_fwhm, Hbetan_vel= theta

    results = 0.
    for t,p in zip( theta, priors):
        if p[0] ==0:
            results += -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((t-p[1])/p[2])**2
        elif p[0] ==1:
            results+= np.log((p[1]<t<p[2])/(p[2]-p[1]))
        elif p[0]==2:
            results+= -np.log(p[2]) - 0.5*np.log(2*np.pi) - 0.5 * ((np.log10(t)-p[1])/p[2])**2
        elif p[0]==3:
            results+= np.log((p[1]<np.log10(t)<p[2])/(p[2]-p[1]))

    return results

# =============================================================================
# FeII code
# =============================================================================
from astropy.convolution import Gaussian1DKernel
from astropy.convolution import convolve
from scipy.interpolate import interp1d
#Loading the template

Veron_d = pyfits.getdata(PATH_TO_FeII+ 'Veron-cetty_2004.fits')
Veron_hd = pyfits.getheader(PATH_TO_FeII+'Veron-cetty_2004.fits')
Veron_wv = np.arange(Veron_hd['CRVAL1'], Veron_hd['CRVAL1']+ Veron_hd['NAXIS1'])


Tsuzuki = np.loadtxt(PATH_TO_FeII+'FeII_Tsuzuki_opttemp.txt')
Tsuzuki_d = Tsuzuki[:,1]
Tsuzuki_wv = Tsuzuki[:,0]



BG92 = np.loadtxt(PATH_TO_FeII+'bg92.con')
BG92_d = BG92[:,1]
BG92_wv = BG92[:,0]

with open(PATH_TO_FeII+'Preconvolved_FeII.txt', "rb") as fp:
    Templates= pickle.load(fp)


def FeII_Veron(wave,z, FWHM_feii):

    index = find_nearest(Templates['FWHMs'],FWHM_feii)
    convolved = Templates['Veron_dat'][:,index]

    fce = interp1d(Veron_wv*(1+z)/1e4, convolved , kind='cubic')

    return fce(wave)

def FeII_Tsuzuki(wave,z, FWHM_feii):

    index = find_nearest(Templates['FWHMs'],FWHM_feii)
    convolved = Templates['Tsuzuki_dat'][:,index]

    fce = interp1d(Tsuzuki_wv*(1+z)/1e4, convolved , kind='cubic')

    return fce(wave)

def FeII_BG92(wave,z, FWHM_feii):

    index = find_nearest(Templates['FWHMs'],FWHM_feii)
    convolved = Templates['BG92_dat'][:,index]

    fce = interp1d(BG92_wv*(1+z)/1e4, convolved , kind='cubic')

    return fce(wave)

'''
def FeII_Veron(wave,z, FWHM_feii):
    gk = Gaussian1DKernel(stddev=FWHM_feii/3e5*5008.24/2.35)

    convolved = convolve(Veron_d, gk)
    convolved = convolved/max(convolved[(Veron_wv<5400) &(Veron_wv>4900)])

    fce = interp1d(Veron_wv*(1+z)/1e4, convolved , kind='cubic')

    return fce(wave)

def FeII_Tsuzuki(wave,z, FWHM_feii):
    gk = Gaussian1DKernel(stddev=FWHM_feii/3e5*5008.24/2.35)

    convolved = convolve(Tsuzuki_d, gk)
    convolved = convolved/max(convolved[(Tsuzuki_wv<5400) &(Tsuzuki_wv>4900)])

    fce = interp1d(Tsuzuki_wv*(1+z)/1e4, convolved , kind='cubic')

    return fce(wave)

def FeII_BG92(wave,z, FWHM_feii):
    gk = Gaussian1DKernel(stddev=FWHM_feii/3e5*5008.24/2.35)

    convolved = convolve(BG92_d, gk)
    convolved = convolved/max(convolved[(BG92_wv<5400) &(BG92_wv>4900)])

    fce = interp1d(BG92_wv*(1+z)/1e4, convolved , kind='cubic')
    return fce(wave)

'''

# =============================================================================
#    functions to fit [OIII] only with outflow
# =============================================================================
def OIII_outflow_Fe(x, z, cont,cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbetab_peak, Hbetab_fwhm,Hbetab_vel, FeII_peak, FeII_fwhm, template):
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4
    Hbeta = 4862.6*(1+z)/1e4


    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482
    Out_fwhm = OIII_out/3e5*OIIIr/2.35482

    out_vel_wv = out_vel/3e5*OIIIr

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)
    OIII_out = gauss(x, OIIIw_peak, OIIIr+out_vel_wv, Out_fwhm) + gauss(x, OIIIw_peak/3, OIIIb+out_vel_wv, Out_fwhm)

    Hbetab_fwhm = Hbetab_fwhm/3e5*Hbeta/2.35482
    Hbetab_wv = Hbeta + Hbetab_vel/3e5*Hbeta
    Hbeta_nar = gauss(x, Hbetab_peak, Hbetab_wv, Hbetab_fwhm )


    if template=='BG92':
        FeII_fce = FeII_BG92
    if template=='Tsuzuki':
        FeII_fce = FeII_Tsuzuki
    if template=='Veron':
        FeII_fce = FeII_Veron

    FeII = FeII_peak*FeII_fce(x, z, FeII_fwhm)
    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)
    return contm+ OIII_nar + OIII_out + Hbeta_nar + FeII

def log_prior_OIII_outflow_Fe(theta,priors):
    #zguess = np.loadtxt('zguess.txt')

    z, cont, cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbeta_peak, Hbeta_fwhm,Hbeta_vel, FeII_peak, FeII_fwhm = theta

    if priors['z'][1] < z < priors['z'][2] and priors['cont'][1] < np.log10(cont)<priors['cont'][2]  and priors['cont_grad'][1]< cont_grad<priors['cont_grad'][2]  \
        and priors['OIIIn_peak'][1] < np.log10(OIIIn_peak) < priors['OIIIn_peak'][2] and priors['OIII_fwhm'][1] < OIII_fwhm <priors['OIII_fwhm'][2]\
            and priors['OIIIw_peak'][1] < np.log10(OIIIw_peak) < priors['OIIIw_peak'][2] and priors['OIII_out'][1] < OIII_out <priors['OIII_out'][2]  and priors['out_vel'][1]<out_vel< priors['out_vel'][2] \
                and priors['Hbeta_peak'][1] < np.log10(Hbeta_peak)< priors['Hbeta_peak'][2] and  priors['Hbeta_fwhm'][1]<Hbeta_fwhm<priors['Hbeta_fwhm'][2]and  priors['Hbeta_vel'][1]<Hbeta_vel<priors['Hbeta_vel'][2]\
                    and priors['Fe_fwhm'][1]<FeII_fwhm<priors['Fe_fwhm'][2] and priors['Fe_peak'][1] < np.log10(FeII_peak)<priors['Fe_peak'][2]:
                        return 0.0

    return -np.inf

# =============================================================================
#    functions to fit [OIII] only with outflow with nar Hbeta with Fe
# =============================================================================
def OIII_outflow_Fe_narHb(x, z, cont,cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbetab_peak, Hbetab_fwhm, Hbetab_vel, Hbetan_peak, Hbetan_fwhm,Hbetan_vel, FeII_peak, FeII_fwhm, template):
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4
    Hbeta = 4862.6*(1+z)/1e4


    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482
    Out_fwhm = OIII_out/3e5*OIIIr/2.35482

    out_vel_wv = out_vel/3e5*OIIIr

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)
    OIII_out = gauss(x, OIIIw_peak, OIIIr+out_vel_wv, Out_fwhm) + gauss(x, OIIIw_peak/3, OIIIb+out_vel_wv, Out_fwhm)

    Hbetab_fwhm = Hbetab_fwhm/3e5*Hbeta/2.35482
    Hbetab_wv = Hbeta + Hbetab_vel/3e5*Hbeta
    Hbeta_blr = gauss(x, Hbetab_peak, Hbetab_wv, Hbetab_fwhm )

    Hbetan_fwhm = Hbetan_fwhm/3e5*Hbeta/2.35482
    Hbetan_wv = Hbeta + Hbetan_vel/3e5*Hbeta
    Hbeta_nar = gauss(x, Hbetan_peak, Hbetan_wv, Hbetan_fwhm )

    if template=='BG92':
        FeII_fce = FeII_BG92
    if template=='Tsuzuki':
        FeII_fce = FeII_Tsuzuki
    if template=='Veron':
        FeII_fce = FeII_Veron

    FeII = FeII_peak*FeII_fce(x, z, FeII_fwhm)
    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)

    return contm+ OIII_nar + OIII_out + Hbeta_blr + Hbeta_nar+ FeII

def log_prior_OIII_outflow_Fe_narHb(theta,priors):
    #zguess = np.loadtxt('zguess.txt')

    z, cont, cont_grad, OIIIn_peak, OIIIw_peak, OIII_fwhm, OIII_out, out_vel, Hbeta_peak, Hbeta_fwhm,Hbeta_vel, Hbetan_peak, Hbetan_fwhm, Hbetan_vel, FeII_peak, FeII_fwhm = theta

    if priors['z'][1] < z < priors['z'][2] and priors['cont'][1] < np.log10(cont)<priors['cont'][2]  and priors['cont_grad'][1]< cont_grad<priors['cont_grad'][2]  \
        and priors['OIIIn_peak'][1] < np.log10(OIIIn_peak) < priors['OIIIn_peak'][2] and priors['OIII_fwhm'][1] < OIII_fwhm <priors['OIII_fwhm'][2]\
            and priors['OIIIw_peak'][1] < np.log10(OIIIw_peak) < priors['OIIIw_peak'][2] and priors['OIII_out'][1] < OIII_out <priors['OIII_out'][2]  and priors['out_vel'][1]<out_vel< priors['out_vel'][2] \
                and priors['Hbeta_peak'][1] < np.log10(Hbeta_peak)< priors['Hbeta_peak'][2] and  priors['Hbeta_fwhm'][1]<Hbeta_fwhm<priors['Hbeta_fwhm'][2] and  priors['Hbeta_vel'][1]<Hbeta_vel<priors['Hbeta_vel'][2]\
                    and  priors['Hbetan_peak'][1] < np.log10(Hbetan_peak)<priors['Hbetan_peak'][2] and priors['Hbetan_fwhm'][1]<Hbetan_fwhm<priors['Hbetan_fwhm'][2] and  priors['Hbetan_vel'][1]<Hbetan_vel<priors['Hbetan_vel'][2]\
                        and priors['Fe_fwhm'][1]<FeII_fwhm<priors['Fe_fwhm'][2] and priors['Fe_peak'][1] < np.log10(FeII_peak)<priors['Fe_peak'][2]:
                          return 0.0


    return -np.inf

# =============================================================================
#  Function to fit [OIII] without outflow with Fe
# =============================================================================
def OIII_Fe(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbeta_peak, Hbeta_fwhm,Hbeta_vel, FeII_peak, FeII_fwhm, template):
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4

    Hbeta = 4862.6*(1+z)/1e4

    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)

    Hbeta_fwhm = Hbeta_fwhm/3e5*Hbeta/2.35482

    Hbeta_nar = gauss(x,Hbeta_peak, Hbeta, Hbeta_fwhm)

    if template=='BG92':
        FeII_fce = FeII_BG92
    if template=='Tsuzuki':
        FeII_fce = FeII_Tsuzuki
    if template=='Veron':
        FeII_fce = FeII_Veron

    FeII = FeII_peak*FeII_fce(x, z, FeII_fwhm)

    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)

    return contm+ OIII_nar + Hbeta_nar + FeII

def log_prior_OIII_Fe(theta,priors):

    z, cont, cont_grad, OIIIn_peak, OIII_fwhm, Hbeta_peak, Hbeta_fwhm, Hbeta_vel, FeII_peak, FeII_fwhm = theta

    if priors['z'][1] < z < priors['z'][2] and priors['cont'][1] < np.log10(cont)<priors['cont'][2]  and priors['cont_grad'][1]< cont_grad<priors['cont_grad'][2]  \
        and priors['OIIIn_peak'][1] < np.log10(OIIIn_peak) < priors['OIIIn_peak'][2] \
            and priors['OIII_fwhm'][1] < OIII_fwhm <priors['OIII_fwhm'][2] \
                and priors['Hbeta_peak'][1] < np.log10(Hbeta_peak)< priors['Hbeta_peak'][2] \
                    and priors['Hbeta_fwhm'][1]<Hbeta_fwhm<priors['Hbeta_fwhm'][2] and  priors['Hbeta_vel'][1]<Hbeta_vel<priors['Hbeta_vel'][2]\
                        and priors['Fe_fwhm'][1]<FeII_fwhm<priors['Fe_fwhm'][2] and priors['Fe_peak'][1] < np.log10(FeII_peak)<priors['Fe_peak'][2]:
                          return 0.0

    return -np.inf

# =============================================================================
#  Function to fit [OIII] without outflow with dual hbeta and FeII
# =============================================================================
def OIII_dual_hbeta_Fe(x, z, cont, cont_grad, OIIIn_peak,  OIII_fwhm, Hbetab_peak, Hbetab_fwhm, Hbetab_vel, Hbetan_peak, Hbetan_fwhm,Hbetan_vel,FeII_peak, FeII_fwhm, template):
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4

    Hbeta = 4862.6*(1+z)/1e4

    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482

    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)

    Hbetab_fwhm = Hbetab_fwhm/3e5*Hbeta/2.35482
    Hbetab_wv = Hbeta + Hbetab_vel/3e5*Hbeta
    Hbeta_blr = gauss(x, Hbetab_peak, Hbetab_wv, Hbetab_fwhm )

    Hbetan_fwhm = Hbetan_fwhm/3e5*Hbeta/2.35482
    Hbetan_wv = Hbeta + Hbetan_vel/3e5*Hbeta
    Hbeta_nar = gauss(x, Hbetan_peak, Hbetan_wv, Hbetan_fwhm )

    if template=='BG92':
        FeII_fce = FeII_BG92
    if template=='Tsuzuki':
        FeII_fce = FeII_Tsuzuki
    if template=='Veron':
        FeII_fce = FeII_Veron

    FeII = FeII_peak*FeII_fce(x, z, FeII_fwhm)

    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)
    return contm+ OIII_nar + Hbeta_blr + Hbeta_nar+ FeII

def log_prior_OIII_dual_hbeta_Fe(theta,priors):

    z, cont, cont_grad, OIIIn_peak, OIII_fwhm, Hbeta_peak, Hbeta_fwhm,Hbeta_vel, Hbetan_peak, Hbetan_fwhm, Hbetan_vel, FeII_peak, FeII_fwhm = theta

    if priors['z'][1] < z < priors['z'][2] and priors['cont'][1] < np.log10(cont)<priors['cont'][2]  and priors['cont_grad'][1]< cont_grad<priors['cont_grad'][2]  \
        and priors['OIIIn_peak'][1] < np.log10(OIIIn_peak) < priors['OIIIn_peak'][2] and priors['OIII_fwhm'][1] < OIII_fwhm <priors['OIII_fwhm'][2]\
            and priors['Hbeta_peak'][1] < np.log10(Hbeta_peak)< priors['Hbeta_peak'][2] and  priors['Hbeta_fwhm'][1]<Hbeta_fwhm<priors['Hbeta_fwhm'][2] and  priors['Hbeta_vel'][1]<Hbeta_vel<priors['Hbeta_vel'][2]\
                and priors['Hbetan_peak'][1] < np.log10(Hbetan_peak)< priors['Hbetan_peak'][2] and  priors['Hbetan_fwhm'][1]<Hbetan_fwhm<priors['Hbetan_fwhm'][2]and  priors['Hbetan_vel'][1]<Hbetan_vel<priors['Hbetan_vel'][2]\
                    and priors['Fe_fwhm'][1]<FeII_fwhm<priors['Fe_fwhm'][2] and priors['Fe_peak'][1] < np.log10(FeII_peak)<priors['Fe_peak'][2]:
                        return 0.0

    return -np.inf

```

`Qubespec/QubeSpec/Models/QSO_models.py`:

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Tue Nov 15 12:19:37 2022

@author: jansen
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt; plt.ioff()

from astropy.io import fits as pyfits
from astropy import wcs
from astropy.table import Table, join, vstack
import pickle
from scipy.optimize import curve_fit


from astropy.modeling.powerlaws import PowerLaw1D
from astropy.modeling.powerlaws import BrokenPowerLaw1D


nan= float('nan')

pi= np.pi
e= np.e

c= 3.*10**8
h= 6.62*10**-34
k= 1.38*10**-23

Ken98= (4.5*10**-44)
Conversion2Chabrier=1.7 # Also Madau
Calzetti12= 2.8*10**-44
arrow = u'$\u2193$'

def find_nearest(array, value):
    """ Find the location of an array closest to a value

	"""
    array = np.asarray(array)
    idx = (np.abs(array - value)).argmin()
    return idx


def gauss(x, k, mu,sig):

    expo= -((x-mu)**2)/(2*sig*sig)

    y= k* e**expo

    return y
from scipy.stats import norm, uniform

import numba
# =============================================================================
# FeII code
# =============================================================================
from astropy.convolution import Gaussian1DKernel
from astropy.convolution import convolve
from scipy.interpolate import interp1d
#Loading the template
from . import FeII_templates as pth
PATH_TO_FeII = pth.__path__[0]+ '/'

Veron_d = pyfits.getdata(PATH_TO_FeII+ 'Veron-cetty_2004.fits')
Veron_hd = pyfits.getheader(PATH_TO_FeII+'Veron-cetty_2004.fits')
Veron_wv = np.arange(Veron_hd['CRVAL1'], Veron_hd['CRVAL1']+ Veron_hd['NAXIS1'])


Tsuzuki = np.loadtxt(PATH_TO_FeII+'FeII_Tsuzuki_opttemp.txt')
Tsuzuki_d = Tsuzuki[:,1]
Tsuzuki_wv = Tsuzuki[:,0]

BG92 = np.loadtxt(PATH_TO_FeII+'bg92.con')
BG92_d = BG92[:,1]
BG92_wv = BG92[:,0]

with open(PATH_TO_FeII+'Preconvolved_FeII.txt', "rb") as fp:
    Templates= pickle.load(fp)


def FeII_Veron(wave,z, FWHM_feii):

    index = find_nearest(Templates['FWHMs'],FWHM_feii)
    convolved = Templates['Veron_dat'][:,index]

    fce = interp1d(Veron_wv*(1+z)/1e4, convolved , kind='cubic')

    return fce(wave)

def FeII_Tsuzuki(wave,z, FWHM_feii):

    index = find_nearest(Templates['FWHMs'],FWHM_feii)
    convolved = Templates['Tsuzuki_dat'][:,index]

    fce = interp1d(Tsuzuki_wv*(1+z)/1e4, convolved , kind='cubic')

    return fce(wave)

def FeII_BG92(wave,z, FWHM_feii):

    index = find_nearest(Templates['FWHMs'],FWHM_feii)
    convolved = Templates['BG92_dat'][:,index]

    fce = interp1d(BG92_wv*(1+z)/1e4, convolved , kind='cubic')

    return fce(wave)


# =============================================================================
# High lum QSO model
# =============================================================================
def OIII_QSO(x, z, cont,cont_grad,\
             OIIIn_peak, OIIIw_peak, OIII_fwhm,\
             OIII_out, out_vel,\
             Hb_BLR1_peak, Hb_BLR2_peak, Hb_BLR_fwhm1, Hb_BLR_fwhm2, Hb_BLR_vel,\
             Hb_nar_peak, Hb_out_peak):

    ############################################
    # OIII
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4
    Hbeta = 4862.6*(1+z)/1e4

    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482
    Out_fwhm = OIII_out/3e5*OIIIr/2.35482

    Nar_fwhm_hb = OIII_fwhm/3e5*Hbeta/2.35482
    Out_fwhm_hb = OIII_out/3e5*Hbeta/2.35482

    out_vel_wv = out_vel/3e5*OIIIr


    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)
    OIII_out = gauss(x, OIIIw_peak, OIIIr+out_vel_wv, Out_fwhm) + gauss(x, OIIIw_peak/3, OIIIb+out_vel_wv, Out_fwhm)

    ############################################
    # Hbeta BLR
    Hb_BLR_vel_wv = Hb_BLR_vel/3e5*Hbeta
    Hb_BLR1_fwhm_wv = Hb_BLR_fwhm1/3e5*Hbeta/2.35482
    Hb_BLR2_fwhm_wv = Hb_BLR_fwhm2/3e5*Hbeta/2.35482


    Hbeta_BLR_wv = Hbeta+Hb_BLR_vel_wv
    Hbeta_BLR = gauss(x, Hb_BLR1_peak, Hbeta_BLR_wv, Hb_BLR1_fwhm_wv) +\
                gauss(x, Hb_BLR2_peak, Hbeta_BLR_wv, Hb_BLR2_fwhm_wv)

    ############################################
    # Hbeta NLR
    out_vel_wv_hb = out_vel/3e5*Hbeta

    Hbeta_NLR = gauss(x, Hb_nar_peak, Hbeta, Nar_fwhm_hb)  + \
                gauss(x, Hb_out_peak, Hbeta+out_vel_wv_hb , Out_fwhm_hb)

    ############################################
    # Continuum
    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)

    return contm+ OIII_nar + OIII_out + Hbeta_BLR + Hbeta_NLR



@numba.njit
def log_prior_OIII_QSO(theta,priors):
    z, cont,cont_grad,OIIIn_peak, OIIIw_peak, OIII_fwhm,OIII_out, out_vel,\
        Hb_BLR1_peak, Hb_BLR2_peak, Hb_BLR_fwhm1, Hb_BLR_fwhm2, Hb_BLR_vel,\
            Hb_nar_peak, Hb_out_peak, = theta

    if Hb_out_peak>Hb_nar_peak:
        return -np.inf

    if priors['z'][1] < z < priors['z'][2] and priors['cont'][1] < np.log10(cont)<priors['cont'][2]  and priors['cont_grad'][1]< cont_grad<priors['cont_grad'][2]  \
        and priors['OIIIn_peak'][1] < np.log10(OIIIn_peak) < priors['OIIIn_peak'][2] and priors['OIII_fwhm'][1] < OIII_fwhm <priors['OIII_fwhm'][2]\
            and priors['OIIIw_peak'][1] < np.log10(OIIIw_peak) < priors['OIIIw_peak'][2] and priors['OIII_out'][1] < OIII_out <priors['OIII_out'][2]  and priors['out_vel'][1]<out_vel< priors['out_vel'][2] \
                and priors['Hb_BLR1_peak'][1] < np.log10(Hb_BLR1_peak)< priors['Hb_BLR1_peak'][2] and priors['Hb_BLR2_peak'][1] < np.log10(Hb_BLR2_peak)< priors['Hb_BLR2_peak'][2]  \
                    and priors['Hb_BLR1_fwhm'][1] < Hb_BLR_fwhm1< priors['Hb_BLR1_fwhm'][2] and priors['Hb_BLR2_fwhm'][1] < Hb_BLR_fwhm2< priors['Hb_BLR2_fwhm'][2]\
                        and priors['Hb_BLR_vel'][1]<Hb_BLR_vel<priors['Hb_BLR_vel'][2] \
                            and  priors['Hb_nar_peak'][1] < np.log10(Hb_nar_peak)<priors['Hb_nar_peak'][2] and  priors['Hb_out_peak'][1] < np.log10(Hb_out_peak)<priors['Hb_out_peak'][2]:
                                return 0.0

    return -np.inf


def BKPLG(x, peak,center,sig, a1,a2):
    gk = Gaussian1DKernel(stddev=sig)

    BKP = BrokenPowerLaw1D.evaluate(x,1, center , a1,a2)

    convolved = convolve(BKP, gk)

    return convolved/max(convolved)*peak

# =============================================================================
# High lum QSO model broken power law BLR
# =============================================================================
def OIII_QSO_BKPL(x, z, cont,cont_grad,\
             OIIIn_peak, OIIIw_peak, OIII_fwhm,\
             OIII_out, out_vel,\
             Hb_BLR_peak, zBLR, Hb_BLR_alp1, Hb_BLR_alp2, Hb_BLR_sig,\
             Hb_nar_peak, Hb_out_peak):

    ############################################
    # OIII
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4
    Hbeta = 4862.6*(1+z)/1e4

    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482
    Out_fwhm = OIII_out/3e5*OIIIr/2.35482

    Nar_fwhm_hb = OIII_fwhm/3e5*Hbeta/2.35482
    Out_fwhm_hb = OIII_out/3e5*Hbeta/2.35482

    out_vel_wv = out_vel/3e5*OIIIr


    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)
    OIII_out = gauss(x, OIIIw_peak, OIIIr+out_vel_wv, Out_fwhm) + gauss(x, OIIIw_peak/3, OIIIb+out_vel_wv, Out_fwhm)

    ############################################
    # Hbeta BLR
    Hb_BLR_vel_wv = Hbeta = 4862.6*(1+zBLR)/1e4

    Hbeta_BLR_wv = Hbeta+Hb_BLR_vel_wv
    Hbeta_BLR = BKPLG(x, Hb_BLR_peak, Hbeta_BLR_wv, Hb_BLR_sig, Hb_BLR_alp1, Hb_BLR_alp2)


    ############################################
    # Hbeta NLR
    out_vel_wv_hb = out_vel/3e5*Hbeta

    Hbeta_NLR = gauss(x, Hb_nar_peak, Hbeta, Nar_fwhm_hb)  + \
                gauss(x, Hb_out_peak, Hbeta+out_vel_wv_hb , Out_fwhm_hb)

    ############################################
    # Continuum
    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)

    return contm+ OIII_nar + OIII_out + Hbeta_BLR + Hbeta_NLR


@numba.njit
def log_prior_OIII_QSO_BKPL(theta,priors):
    z, cont,cont_grad,OIIIn_peak, OIIIw_peak, OIII_fwhm,OIII_out, out_vel,\
        Hb_BLR_peak, Hb_BLR_vel, Hb_BLR_alp1, Hb_BLR_alp2, Hb_BLR_sig,\
            Hb_nar_peak, Hb_out_peak, = theta

    if OIIIn_peak<OIIIw_peak:
        return -np.inf
    if Hb_out_peak>Hb_nar_peak:
        return -np.inf

    if priors['z'][1] < z < priors['z'][2] and priors['cont'][1] < np.log10(cont)<priors['cont'][2]  and priors['cont_grad'][1]< cont_grad<priors['cont_grad'][2]  \
        and priors['OIIIn_peak'][1] < np.log10(OIIIn_peak) < priors['OIIIn_peak'][2] and priors['OIII_fwhm'][1] < OIII_fwhm <priors['OIII_fwhm'][2]\
            and priors['OIIIw_peak'][1] < np.log10(OIIIw_peak) < priors['OIIIw_peak'][2] and priors['OIII_out'][1] < OIII_out <priors['OIII_out'][2]  and priors['out_vel'][1]<out_vel< priors['out_vel'][2] \
                and priors['Hb_BLR_peak'][1] < np.log10(Hb_BLR_peak)< priors['Hb_BLR_peak'][2] and priors['Hb_BLR_sig'][1] < Hb_BLR_sig< priors['Hb_BLR_sig'][2] \
                    and priors['Hb_BLR_alp1'][1] < Hb_BLR_alp1< priors['Hb_BLR_alp1'][2] and priors['Hb_BLR_alp2'][1] < Hb_BLR_alp2< priors['Hb_BLR_alp2'][2] \
                        and priors['Hb_BLR_vel'][1]<Hb_BLR_vel<priors['Hb_BLR_vel'][2] \
                            and  priors['Hb_nar_peak'][1] < np.log10(Hb_nar_peak)<priors['Hb_nar_peak'][2] and  priors['Hb_out_peak'][1] < np.log10(Hb_out_peak)<priors['Hb_out_peak'][2]:
                                return 0.0

    return -np.inf


@numba.njit
def log_prior_OIII_QSO_BKPL(theta, priors):
    z, cont,cont_grad,OIIIn_peak, OIIIw_peak, OIII_fwhm,OIII_out, out_vel,\
        Hb_BLR_peak, Hb_BLR_vel, Hb_BLR_alp1, Hb_BLR_alp2, Hb_BLR_sig,\
            Hb_nar_peak, Hb_out_peak, = theta.copy()
    '''
    if OIIIn_peak<OIIIw_peak:
        return -np.inf
    if Hb_out_peak>Hb_nar_peak:
        return -np.inf
    '''
    logprior = sum([ f.logpdf(t) for f,t in zip(priors, theta)])

    return logprior

# =============================================================================
# High lum QSO Fe model
# =============================================================================
def OIII_Fe_QSO(x, z, cont,cont_grad,\
             OIIIn_peak, OIIIw_peak, OIII_fwhm,\
             OIII_out, out_vel,\
             Hb_BLR1_peak, Hb_BLR2_peak, Hb_BLR_fwhm1, Hb_BLR_fwhm2, Hb_BLR_vel,\
             Hb_nar_peak, Hb_out_peak, FeII_peak, FeII_fwhm, template):

    ############################################
    # OIII
    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4
    Hbeta = 4862.6*(1+z)/1e4

    Nar_fwhm = OIII_fwhm/3e5*OIIIr/2.35482
    Out_fwhm = OIII_out/3e5*OIIIr/2.35482

    Nar_fwhm_hb = OIII_fwhm/3e5*Hbeta/2.35482
    Out_fwhm_hb = OIII_out/3e5*Hbeta/2.35482

    out_vel_wv = out_vel/3e5*OIIIr


    OIII_nar = gauss(x, OIIIn_peak, OIIIr, Nar_fwhm) + gauss(x, OIIIn_peak/3, OIIIb, Nar_fwhm)
    OIII_out = gauss(x, OIIIw_peak, OIIIr+out_vel_wv, Out_fwhm) + gauss(x, OIIIw_peak/3, OIIIb+out_vel_wv, Out_fwhm)

    ############################################
    # Hbeta BLR
    Hb_BLR_vel_wv = Hb_BLR_vel/3e5*Hbeta
    Hb_BLR1_fwhm_wv = Hb_BLR_fwhm1/3e5*Hbeta/2.35482
    Hb_BLR2_fwhm_wv = Hb_BLR_fwhm2/3e5*Hbeta/2.35482


    Hbeta_BLR_wv = Hbeta+Hb_BLR_vel_wv
    Hbeta_BLR = gauss(x, Hb_BLR1_peak, Hbeta_BLR_wv, Hb_BLR1_fwhm_wv) +\
                gauss(x, Hb_BLR2_peak, Hbeta_BLR_wv, Hb_BLR2_fwhm_wv)

    ############################################
    # Hbeta NLR
    out_vel_wv_hb = out_vel/3e5*Hbeta

    Hbeta_NLR = gauss(x, Hb_nar_peak, Hbeta, Nar_fwhm_hb)  + \
                gauss(x, Hb_out_peak, Hbeta+out_vel_wv_hb , Out_fwhm_hb)

    ###################################
    # FeII
    if template=='BG92':
        FeII_fce = FeII_BG92
    if template=='Tsuzuki':
        FeII_fce = FeII_Tsuzuki
    if template=='Veron':
        FeII_fce = FeII_Veron
    FeII = FeII_peak*FeII_fce(x, z, FeII_fwhm)
    ############################################
    # Continuum
    contm = PowerLaw1D.evaluate(x, cont, OIIIr, alpha=cont_grad)

    return contm+ OIII_nar + OIII_out + Hbeta_BLR + Hbeta_NLR+ FeII

@numba.njit
def log_prior_OIII_Fe_QSO(theta,priors):
    z, cont,cont_grad,OIIIn_peak, OIIIw_peak, OIII_fwhm,OIII_out, out_vel,\
        Hb_BLR1_peak, Hb_BLR2_peak, Hb_BLR_fwhm1, Hb_BLR_fwhm2, Hb_BLR_vel,\
            Hb_nar_peak, Hb_out_peak,FeII_peak, FeII_fwhm, = theta

    if Hb_out_peak>Hb_nar_peak:
        return -np.inf

    if priors['z'][1] < z < priors['z'][2] and priors['cont'][1] < np.log10(cont)<priors['cont'][2]  and priors['cont_grad'][1]< cont_grad<priors['cont_grad'][2]  \
        and priors['OIIIn_peak'][1] < np.log10(OIIIn_peak) < priors['OIIIn_peak'][2] and priors['OIII_fwhm'][1] < OIII_fwhm <priors['OIII_fwhm'][2]\
            and priors['OIIIw_peak'][1] < np.log10(OIIIw_peak) < priors['OIIIw_peak'][2] and priors['OIII_out'][1] < OIII_out <priors['OIII_out'][2]  and priors['out_vel'][1]<out_vel< priors['out_vel'][2] \
                and priors['Hb_BLR1_peak'][1] < np.log10(Hb_BLR1_peak)< priors['Hb_BLR1_peak'][2] and priors['Hb_BLR2_peak'][1] < np.log10(Hb_BLR2_peak)< priors['Hb_BLR2_peak'][2]  \
                    and priors['Hb_BLR1_fwhm'][1] < Hb_BLR_fwhm1< priors['Hb_BLR1_fwhm'][2] and priors['Hb_BLR2_fwhm'][1] < Hb_BLR_fwhm2< priors['Hb_BLR2_fwhm'][2]\
                        and priors['Hb_BLR_vel'][1]<Hb_BLR_vel<priors['Hb_BLR_vel'][2] \
                            and  priors['Hb_nar_peak'][1] < np.log10(Hb_nar_peak)<priors['Hb_nar_peak'][2] and  priors['Hb_out_peak'][1] < np.log10(Hb_out_peak)<priors['Hb_out_peak'][2]\
                                and priors['Fe_fwhm'][1]<FeII_fwhm<priors['Fe_fwhm'][2] and priors['Fe_peak'][1] < np.log10(FeII_peak)<priors['Fe_peak'][2]:
                                    return 0.0

    return -np.inf


# =============================================================================
# Halpha QSO model
# =============================================================================
def Hal_QSO_BKPL(x, z, cont,cont_grad, Hal_peak, NII_peak, Nar_fwhm, Hal_out_peak, NII_out_peak, outflow_fwhm, outflow_vel,Ha_BLR_peak, zBLR, Ha_BLR_alp1, Ha_BLR_alp2, Ha_BLR_sig):


    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4

    Hal_wv_vel = 6564.52*(1+z)/1e4 + outflow_vel/3e5*Hal_wv
    NII_r_vel = 6585.27*(1+z)/1e4 + outflow_vel/3e5*Hal_wv
    NII_b_vel = 6549.86*(1+z)/1e4 + outflow_vel/3e5*Hal_wv

    Nar_vel_hal = Nar_fwhm/3e5*Hal_wv/2.35482
    Nar_vel_niir = Nar_fwhm/3e5*NII_r/2.35482
    Nar_vel_niib = Nar_fwhm/3e5*NII_b/2.35482

    out_vel_hal = outflow_fwhm/3e5*Hal_wv/2.35482
    out_vel_niir = outflow_fwhm/3e5*NII_r/2.35482
    out_vel_niib = outflow_fwhm/3e5*NII_b/2.35482

    Hal_nar = gauss(x, Hal_peak, Hal_wv, Nar_vel_hal)
    NII_nar_r = gauss(x, NII_peak, NII_r, Nar_vel_niir)
    NII_nar_b = gauss(x, NII_peak/3, NII_b, Nar_vel_niib)

    Hal_out = gauss(x, Hal_out_peak, Hal_wv_vel, out_vel_hal)
    NII_out_r = gauss(x, NII_out_peak, NII_r_vel, out_vel_niir)
    NII_out_b = gauss(x, NII_out_peak/3, NII_b_vel, out_vel_niib)

    outflow = Hal_out+ NII_out_r + NII_out_b


    ############################################
    # Hbeta BLR
    Ha_BLR_vel_wv = 6564.52*(1+zBLR)/1e4

    Ha_BLR_wv = Hal_wv+Ha_BLR_vel_wv
    Ha_BLR = BKPLG(x, Ha_BLR_peak, Ha_BLR_wv, Ha_BLR_sig, Ha_BLR_alp1, Ha_BLR_alp2)

    ############################################
    # Continuum
    contm = PowerLaw1D.evaluate(x, cont, Hal_wv, alpha=cont_grad)

    return contm+Hal_nar+NII_nar_r+NII_nar_b + outflow+ Ha_BLR


@numba.njit
def Halpha_OIII_QSO_BKPL(x, z, cont,cont_grad, Hal_peak, NII_peak, OIII_peak,Hbeta_peak, Nar_fwhm, \
                      Hal_out_peak, NII_out_peak,OIII_out_peak, Hbeta_out_peak,\
                      outflow_fwhm, outflow_vel,\
                      Hal_BLR_peak, Hbeta_BLR_peak,  zBLR, BLR_alp1, BLR_alp2, BLR_sig):

    Hal_part = Hal_QSO_BKPL(x, z, 0, 0, Hal_peak, NII_peak, Nar_fwhm, Hal_out_peak, NII_out_peak, outflow_fwhm, outflow_vel, Hal_BLR_peak, zBLR, BLR_alp1, BLR_alp2, BLR_sig)

    OIII_part = OIII_QSO_BKPL(x, z, cont,cont_grad,\
                 OIII_peak, OIII_out_peak, Nar_fwhm,\
                 outflow_fwhm, outflow_vel,\
                 Hbeta_BLR_peak, zBLR, BLR_alp1, BLR_alp2, BLR_sig,\
                 Hbeta_peak, Hbeta_out_peak)

    return Hal_part + OIII_part

```

`Qubespec/QubeSpec/Plotting/__init__.py`:

```py
from .plots import *
```

`Qubespec/QubeSpec/Plotting/plots.py`:

```py
#!/usr/bin/env python2
# -*- coding: utf-8 -*-
"""
Created on Thu Aug 17 10:11:38 2017

@author: jscholtz
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt

from astropy.io import fits as pyfits
from astropy import wcs
from astropy.table import Table, join, vstack
from matplotlib.backends.backend_pdf import PdfPages
import pickle
from scipy.optimize import curve_fit
import glob

from astropy.coordinates import SkyCoord

from astropy.modeling.powerlaws import PowerLaw1D


nan= float('nan')

pi= np.pi
e= np.e

plt.close('all')
c= 3.*10**8
h= 6.62*10**-34
k= 1.38*10**-23

arrow = u'$\u2193$'

from ..Models import OIII_models as O_models

def gauss(x, k, mu,FWHM):
    sig = FWHM/3e5*mu/2.35482
    expo= -((x-mu)**2)/(2*sig*sig)
    y= k* e**expo
    return y

def plotting_OIII(res, ax, errors=False, template=0, residual='none',axres=None):
    sol = res.props
    popt = sol['popt']
    keys = list(sol.keys())
    z = sol['z'][0]
    wave = res.wave
    fluxs = res.fluxs
    error = res.error
    wv_rest = wave/(1+z)*1e4
    fit_loc = np.where((wv_rest>4700)&(wv_rest<5200))[0]

    try:
        flux = fluxs.data[np.invert(fluxs.mask)]
        wv_rst_sc= wv_rest[np.invert(fluxs.mask)]
        ax.plot(wv_rest[fit_loc], fluxs.data[fit_loc], color='grey', drawstyle='steps-mid', alpha=0.2)
        

        fit_loc_sc = np.where((wv_rst_sc>4700)&(wv_rst_sc<5200))[0]
        ax.plot(wv_rst_sc[fit_loc_sc],flux[fit_loc_sc], drawstyle='steps-mid', label='data')
        if errors==True:
            ax.fill_between(wv_rst_sc[fit_loc_sc],flux[fit_loc_sc]-error[fit_loc_sc],flux[fit_loc_sc]+error[fit_loc_sc], alpha=0.3, color='k', step='mid')
        y_tot_rs = res.yeval[np.invert(fluxs.mask)][fit_loc_sc]

    except:
        ax.plot(res.wave/(1+z)*1e4, res.flux, drawstyle='steps-mid', label='data')

    y_tot = res.yeval[fit_loc]

    ax.plot(wv_rest[fit_loc], y_tot, 'r--')

    flt = np.where((wv_rest[fit_loc]>4900)&(wv_rest[fit_loc]<5100))[0]

    ax.set_ylim(-0.1*np.nanmax(y_tot[flt]), np.nanmax(y_tot[flt])*1.1)
    ax.tick_params(direction='in')
    ax.set_xlim(4700,5050 )

    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4

    fwhm = sol['Nar_fwhm'][0]

    ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['OIII_peak'][0]/3,OIIIb, fwhm)+ gauss(wave[fit_loc], sol['OIII_peak'][0],OIIIr, fwhm) \
                 ,color= 'green', linestyle ='dashed')

    if 'Hbeta_peak' in keys:
        Hbeta= 4862.6*(1+z)/1e4    
        fwhm = sol['Nar_fwhm'][0]
        ax.plot(wv_rest[fit_loc] ,   gauss(wave[fit_loc], sol['Hbeta_peak'][0],Hbeta, fwhm),\
                        color= 'orange', linestyle ='dashed')


    if 'outflow_fwhm' in keys:
        OIIIr = OIIIr+ sol['outflow_vel'][0]/3e5*OIIIr
        OIIIb = OIIIb + sol['outflow_vel'][0]/3e5*OIIIb

        fwhm = sol['outflow_fwhm'][0]

        ax.plot(wv_rest[fit_loc] ,   gauss(wave[fit_loc], sol['OIII_out_peak'][0]/3,OIIIb, fwhm)+ gauss(wave[fit_loc], sol['OIII_out_peak'][0],OIIIr, fwhm),\
                     color= 'blue', linestyle ='dashed')

        if 'Hbeta_out_peak' in keys:
            Hbeta_wv = 4862.6*(1+z)/1e4
            Hbeta_out_wv = Hbeta_wv + sol['outflow_vel'][0]/3e5*Hbeta_wv

            fwhm = sol['outflow_fwhm'][0]

            ax.plot(wv_rest[fit_loc] ,  gauss(wave[fit_loc], sol['Hbeta_out_peak'][0],Hbeta_out_wv, fwhm),\
                        color= 'blue', linestyle ='dashed')

    if 'Fe_peak' in keys:
        ax.plot(wv_rest[fit_loc], PowerLaw1D.evaluate(wave[fit_loc], sol['cont'][0],OIIIr, alpha=sol['cont_grad'][0]), linestyle='dashed', color='limegreen')

        if template=='BG92':
            ax.plot(wv_rest[fit_loc] , sol['Fe_peak'][0]*O_models.Fem.FeII_BG92(wave[fit_loc], z, sol['Fe_fwhm'][0]) , linestyle='dashed', color='magenta' )

        if template=='Tsuzuki':
            ax.plot(wv_rest[fit_loc] , sol['Fe_peak'][0]*O_models.Fem.FeII_Tsuzuki(wave[fit_loc], z, sol['Fe_fwhm'][0]) , linestyle='dashed', color='magenta' )

        if template=='Veron':
            ax.plot(wv_rest[fit_loc] , sol['Fe_peak'][0]*O_models.Fem.FeII_Veron(wave[fit_loc], z, sol['Fe_fwhm'][0]) , linestyle='dashed', color='magenta' )


    if 'Hb_nar_peak' in keys:
        Hbeta= 4862.6*(1+z)/1e4

        Hbeta_NLR = gauss(wave[fit_loc], sol['Hb_nar_peak'][0],Hbeta, sol['Nar_fwhm'][0])
        Hbeta_NLR2= gauss(wave[fit_loc], sol['Hb_out_peak'][0],Hbeta+ sol['outflow_vel'][0]/3e5*Hbeta, sol['outflow_fwhm'][0])


        ax.plot(wv_rest[fit_loc] , Hbeta_NLR , color= 'orange', linestyle ='dotted')
        ax.plot(wv_rest[fit_loc] , Hbeta_NLR2, color= 'orange', linestyle ='dotted')
        #ax.plot(wv_rest[fit_loc] , Hbeta_NLR+Hbeta_NLR2, color= 'orange', linestyle ='dotted')

    if ('zBLR' in keys):
        if 'BLR_alp1' in keys:
            from ..Models.QSO_models import BKPLG
            from astropy.modeling.powerlaws import BrokenPowerLaw1D
            from astropy.convolution import Gaussian1DKernel
            from astropy.convolution import convolve

            Hbeta= 4862.6*(1+z)/1e4

            Hbeta_BLR_wv = 4862.6*(1+sol['zBLR'][0])/1e4
            Hbeta_BLR = BKPLG(wave[fit_loc], sol['BLR_peak'][0], Hbeta_BLR_wv, sol['BLR_sig'][0], sol['BLR_alp1'][0], sol['BLR_alp2'][0])
            ax.plot(wv_rest[fit_loc] , Hbeta_BLR , color= 'orange', linestyle ='dashed')
        else:
            Hbeta= 4862.6*(1+z)/1e4
            Hbeta_BLR_wv = 4862.6*(1+sol['zBLR'][0])/1e4

            Hbeta_BLR = gauss(wave[fit_loc], sol['BLR_Hbeta_peak'][0],Hbeta, sol['BLR_fwhm'][0])

            ax.plot(wv_rest[fit_loc] , Hbeta_BLR , color= 'orange', linestyle ='dashed')
            #ax.plot(wv_rest[fit_loc] , Hbeta_BLR2, color= 'orange', linestyle ='dashed')

    if residual !='none':
        resid_OIII = flux[fit_loc_sc]-y_tot_rs
        sigma_OIII = np.std(resid_OIII)
        RMS_OIII = np.sqrt(np.mean(resid_OIII**2))

        axres.plot(wv_rst_sc[fit_loc_sc],resid_OIII, drawstyle='steps-mid')
        axres.set_ylim(-3*RMS_OIII, 3*RMS_OIII) ## the /3 scales to the ratio
        axres.hlines(0, 4600,5600, color='black', linestyle='dashed')
        if residual=='rms':
            axres.fill_between(wv_rst_sc[fit_loc_sc], RMS_OIII, -RMS_OIII, facecolor='grey', alpha=0.2, step='mid')
        elif residual=='error':
            axres.fill_between(wv_rst_sc[fit_loc_sc],resid_OIII-error[fit_loc_sc],resid_OIII+error[fit_loc_sc], alpha=0.3, color='k', step='mid')



def plotting_Halpha( res, ax, errors=False, residual='none', axres=None):
    sol = res.props
    popt = sol['popt']
    z = popt[0]

    wave = res.wave
    fluxs = res.fluxs
    error = res.error
    keys = list(sol.keys())
    wv_rest = wave/(1+z)*1e4
    fit_loc = np.where((wv_rest>6000.)&(wv_rest<7500.))[0]
    try:
        flux = fluxs.data[np.invert(fluxs.mask)]
        wv_rst_sc= wv_rest[np.invert(fluxs.mask)]
        ax.plot(wv_rest[fit_loc], fluxs.data[fit_loc], color='grey', drawstyle='steps-mid', alpha=0.2)
        

        fit_loc_sc = np.where((wv_rst_sc>6000)&(wv_rst_sc<7000))[0]
        ax.plot(wv_rst_sc[fit_loc_sc],flux[fit_loc_sc], drawstyle='steps-mid', label='data')
        if errors==True:
            ax.fill_between(wv_rst_sc[fit_loc_sc],flux[fit_loc_sc]-error[fit_loc_sc],flux[fit_loc_sc]+error[fit_loc_sc], alpha=0.3, color='k')
        y_tot_rs = res.yeval[np.invert(fluxs.mask)][fit_loc_sc]

    except:
        ax.plot(res.wave/(1+z)*1e4, res.flux, drawstyle='steps-mid', label='data')
        

    y_tot = res.yeval[fit_loc]

    ax.plot(wv_rest[fit_loc], y_tot, 'r--')

    ax.set_ylim(-0.1*max(y_tot), max(y_tot)*1.1)
    ax.set_xlim(6564.52-250,6564.52+250 )
    ax.tick_params(direction='in')

    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4

    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4


    ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['Hal_peak'][0], Hal_wv, sol['Nar_fwhm'][0]), \
            color='orange', linestyle='dashed')
    if 'NII_peak' in list(sol.keys()):
        ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['NII_peak'][0], NII_r, sol['Nar_fwhm'][0]), \
                color='darkgreen', linestyle='dashed')
        ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['NII_peak'][0]/3, NII_b, sol['Nar_fwhm'][0]), \
                color='darkgreen', linestyle='dashed')

    if 'SIIr_peak' in keys:
        ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['SIIr_peak'][0], SII_r, sol['Nar_fwhm'][0]), \
                color='darkblue', linestyle='dashed')
        ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['SIIb_peak'][0], SII_b, sol['Nar_fwhm'][0]), \
                color='darkblue', linestyle='dashed')

    if 'zBLR' in keys:
        BLR_wv = 6564.52*(1+sol['zBLR'][0])/1e4

        ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['BLR_Hal_peak'][0], BLR_wv, sol['BLR_fwhm'][0]), \
                color='darkorange', linestyle='dashed')

    if 'Hal_out_peak' in keys:
        out_vel_hal = sol['outflow_fwhm'][0]
        out_vel_niir = sol['outflow_fwhm'][0]
        out_vel_niib = sol['outflow_fwhm'][0]

        Hal_wv_vel = 6564.52*(1+z)/1e4+ sol['outflow_vel'][0]/3e5*Hal_wv
        NII_r_vel = 6585.27*(1+z)/1e4 + sol['outflow_vel'][0]/3e5*Hal_wv
        NII_b_vel = 6549.86*(1+z)/1e4 + sol['outflow_vel'][0]/3e5*Hal_wv

        Hal_out = gauss(wave[fit_loc],sol['Hal_out_peak'][0], Hal_wv_vel, out_vel_hal)
        NII_out_r = gauss(wave[fit_loc], sol['NII_out_peak'][0], NII_r_vel, out_vel_niir)
        NII_out_b = gauss(wave[fit_loc], sol['NII_out_peak'][0]/3, NII_b_vel, out_vel_niib)

        ax.plot(wv_rest[fit_loc], Hal_out, color='magenta', linestyle='dashed')
        ax.plot(wv_rest[fit_loc], NII_out_r, color='magenta', linestyle='dashed')
        ax.plot(wv_rest[fit_loc], NII_out_b, color='magenta', linestyle='dashed')

    if 'BLR_alp1' in keys:
        from ..Models.QSO_models import BKPLG
        from astropy.modeling.powerlaws import BrokenPowerLaw1D
        from astropy.convolution import Gaussian1DKernel
        from astropy.convolution import convolve

        Ha_BLR_vel_wv = 6563*(1+sol['zBLR'][0])/1e4

        Ha_BLR_wv = Hal_wv+Ha_BLR_vel_wv
        Ha_BLR = BKPLG(wave[fit_loc], sol['BLR_Hal_peak'][0], Ha_BLR_wv, sol['BLR_sig'][0], sol['BLR_alp1'][0], sol['BLR_alp2'][0])
        ax.plot(wv_rest[fit_loc] , Ha_BLR , color= 'magenta', linestyle ='dashed')

    if residual !='none':
        resid_OIII = flux[fit_loc_sc]-y_tot_rs
        sigma_OIII = np.std(resid_OIII)
        RMS_OIII = np.sqrt(np.mean(resid_OIII**2))

        axres.plot(wv_rst_sc[fit_loc_sc],resid_OIII, drawstyle='steps-mid')
        axres.set_ylim(-2*RMS_OIII, 2*RMS_OIII) ## the /3 scales to the ratio
        if residual=='rms':
            axres.fill_between(wv_rst_sc[fit_loc_sc], RMS_OIII, -RMS_OIII, facecolor='grey', alpha=0.2, step='mid')
        elif residual=='error':
            axres.fill_between(wv_rst_sc[fit_loc_sc],resid_OIII-error[fit_loc_sc],resid_OIII+error[fit_loc_sc], alpha=0.3, color='k', step='mid')


def plotting_Halpha_OIII(res, ax,errors=False, residual='none', axres=None, template=0):
    sol = res.props
    popt = sol['popt']
    keys = list(sol.keys())
    z = popt[0]
    error =res.error

    wave = res.wave
    fluxs = res.fluxs

    wv_rest = wave/(1+z)*1e4
    fit_loc = np.where((wv_rest>100.)&(wv_rest<16000.))[0]

    try:
        flux = fluxs.data[np.invert(fluxs.mask)]
        wv_rst_sc= wv_rest[np.invert(fluxs.mask)]
        ax.plot(wv_rest[fit_loc], fluxs.data[fit_loc], color='grey', drawstyle='steps-mid', alpha=0.2)
        

        fit_loc_sc = np.where((wv_rst_sc>4700)&(wv_rst_sc<5200))[0]
        ax.plot(wv_rst_sc[fit_loc_sc],flux[fit_loc_sc], drawstyle='steps-mid', label='data')
        if errors==True:
            ax.fill_between(wv_rst_sc[fit_loc_sc],flux[fit_loc_sc]-error[fit_loc_sc],flux[fit_loc_sc]+error[fit_loc_sc], alpha=0.3, color='k')
        y_tot_rs = res.yeval[np.invert(fluxs.mask)][fit_loc_sc]

    except Exception as e:
        ax.plot(res.wave/(1+z)*1e4, res.flux, drawstyle='steps-mid', label='data')
        print(e)

    #if len(error) !=1:
    #    ax.fill_between(wv_rst_sc[fit_loc_sc],flux[fit_loc_sc]-error[fit_loc_sc],flux[fit_loc_sc]+error[fit_loc_sc], alpha=0.3, color='k')
    #    ax.fill_between(wv_rst_sc[fit_loc_sc],flux[fit_loc_sc]-error[fit_loc_sc],flux[fit_loc_sc]+error[fit_loc_sc], alpha=0.3, color='k')
    y_tot = res.yeval[fit_loc]
    y_tot_rs = res.yeval[np.invert(fluxs.mask)][fit_loc_sc]

    ax.plot(wv_rest[fit_loc], y_tot, 'r--')


    ax.set_ylim(-0.1*max(y_tot), max(y_tot)*1.1)
    ax.tick_params(direction='in')


    Hal_wv = 6564.52*(1+z)/1e4
    NII_r = 6585.27*(1+z)/1e4
    NII_b = 6549.86*(1+z)/1e4
    SII_r = 6732.67*(1+z)/1e4
    SII_b = 6718.29*(1+z)/1e4

    ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['Hal_peak'][0], Hal_wv, sol['Nar_fwhm'][0]), \
            color='orange', linestyle='dashed')

    if 'NII_peak' in list(sol.keys()):
        ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['NII_peak'][0], NII_r, sol['Nar_fwhm'][0]), \
                color='darkgreen', linestyle='dashed')
        ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['NII_peak'][0]/3, NII_b, sol['Nar_fwhm'][0]), \
                color='darkgreen', linestyle='dashed')

    if 'SIIr_peak' in list(sol.keys()):
        ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['SIIr_peak'][0], SII_r, sol['Nar_fwhm'][0]), \
                color='darkblue', linestyle='dashed')
        ax.plot(wv_rest[fit_loc], gauss(wave[fit_loc], sol['SIIb_peak'][0], SII_b, sol['Nar_fwhm'][0]), \
                color='darkblue', linestyle='dashed')

    OIII_r = OIIIr = 5008.24*(1+z)/1e4
    OIII_b = OIIIb = 4960.3*(1+z)/1e4

    fwhm = sol['Nar_fwhm'][0]
    try:
        ax.plot(wv_rest[fit_loc] ,    gauss(wave[fit_loc], sol['OIII_peak'][0]/3,OIIIb, fwhm)+ gauss(wave[fit_loc], sol['OIII_peak'][0],OIIIr, fwhm) \
            ,color= 'green', linestyle ='dashed')
    except:
        ax.plot(wv_rest[fit_loc] ,    gauss(wave[fit_loc], sol['OIII_peak'][0]/3,OIIIb, fwhm)+ gauss(wave[fit_loc], sol['OIII_peak'][0],OIIIr, fwhm) \
                ,color= 'green', linestyle ='dashed')

    Hbeta= 4862.6*(1+z)/1e4
    fwhm = sol['Nar_fwhm'][0]
    ax.plot(wv_rest[fit_loc] ,   gauss(wave[fit_loc], sol['Hbeta_peak'][0],Hbeta, fwhm),\
            color= 'orange', linestyle ='dashed')
    
    if 'Fe_peak' in keys:
        ax.plot(wv_rest[fit_loc], PowerLaw1D.evaluate(wave[fit_loc], sol['cont'][0],OIIIr, alpha=sol['cont_grad'][0]), linestyle='dashed', color='limegreen')

        if template=='BG92':
            ax.plot(wv_rest[fit_loc] , sol['Fe_peak'][0]*O_models.Fem.FeII_BG92(wave[fit_loc], z, sol['Fe_fwhm'][0]) , linestyle='dashed', color='magenta' )

        if template=='Tsuzuki':
            ax.plot(wv_rest[fit_loc] , sol['Fe_peak'][0]*O_models.Fem.FeII_Tsuzuki(wave[fit_loc], z, sol['Fe_fwhm'][0]) , linestyle='dashed', color='magenta' )

        if template=='Veron':
            ax.plot(wv_rest[fit_loc] , sol['Fe_peak'][0]*O_models.Fem.FeII_Veron(wave[fit_loc], z, sol['Fe_fwhm'][0]) , linestyle='dashed', color='magenta' )

    if 'OI_peak' in list(sol.keys()):
        OI = 6302.0*(1+z)/1e4
        fwhm = sol['Nar_fwhm'][0]
        ax.plot(wv_rest[fit_loc] , gauss(wave[fit_loc], sol['OI_peak'][0],OI, fwhm), color='green', linestyle='dashed')

    if 'outflow_vel' in list(sol.keys()):
        OI = 6302.0*(1+z)/1e4

        Out_vel_hal = sol['outflow_fwhm'][0]
        Out_vel_niir = sol['outflow_fwhm'][0]
        Out_vel_niib = sol['outflow_fwhm'][0]
        Out_vel_oiiir = sol['outflow_fwhm'][0]
        Out_vel_oiiib = sol['outflow_fwhm'][0]
        Out_vel_oi = sol['outflow_fwhm'][0]
        Out_vel_hbe = sol['outflow_fwhm'][0]

        Hal_wv = 6564.52*(1+z)/1e4   + sol['outflow_vel'][0]/3e5*Hal_wv
        NII_r = 6585.27*(1+z)/1e4 + sol['outflow_vel'][0]/3e5*NII_r
        NII_b = 6549.86*(1+z)/1e4 + sol['outflow_vel'][0]/3e5*NII_b
        OIII_r = 5008.24*(1+z)/1e4 + sol['outflow_vel'][0]/3e5*OIII_r
        OIII_b = 4960.3*(1+z)/1e4  + sol['outflow_vel'][0]/3e5*OIII_b
        OI = 6302.0*(1+z)/1e4 + sol['outflow_vel'][0]/3e5*OI
        Hbeta = 4862.6*(1+z)/1e4  + sol['outflow_vel'][0]/3e5* Hbeta
        SII_r = 6732.67*(1+z)/1e4  + sol['outflow_vel'][0]/3e5*SII_r
        SII_b = 6718.29*(1+z)/1e4   + sol['outflow_vel'][0]/3e5*SII_b


        Outflow =  gauss(wave[fit_loc], sol['Hal_out_peak'][0], Hal_wv, Out_vel_hal)  + \
            gauss(wave[fit_loc],  sol['NII_out_peak'][0], NII_r, Out_vel_niir)+  gauss(wave[fit_loc],  sol['NII_out_peak'][0]/3, NII_b, Out_vel_niib) + \
            gauss(wave[fit_loc],  sol['OIII_out_peak'][0], OIII_r, Out_vel_oiiir) + gauss(wave[fit_loc],  sol['OIII_out_peak'][0]/3, OIII_b, Out_vel_oiiib)+\
            gauss(wave[fit_loc],  sol['Hbeta_out_peak'][0], Hbeta, Out_vel_hbe )

        if 'OI_peak' in list(sol.keys()):
            Outflow+= gauss(wave[fit_loc], sol['OI_out_peak'][0], OI, Out_vel_oi)

        ax.plot(wv_rest[fit_loc] , Outflow, color='magenta', linestyle='dashed')


    if 'BLR_fwhm' in list(sol.keys()):
        Hal_wv = 6564.52*(1+z)/1e4
        Hbe_wv = 4862.6*(1+z)/1e4

        BLR_sig_hal = sol['BLR_fwhm'][0]
        BLR_sig_hbe = sol['BLR_fwhm'][0]

        BLR_wv_hal = 6564.52*(1+sol['zBLR'][0])/1e4
        BLR_wv_hbe = 4862.6*(1+sol['zBLR'][0])/1e4

        Hal_blr = gauss(wave[fit_loc], sol['BLR_Hal_peak'][0], BLR_wv_hal, BLR_sig_hal)
        Hbe_blr = gauss(wave[fit_loc], sol['BLR_Hbeta_peak'][0], BLR_wv_hbe, BLR_sig_hbe)

        ax.plot(wv_rest[fit_loc], Hal_blr+Hbe_blr, linestyle='dashed',color='lightblue')

def plotting_general(wave, fluxs, ax, sol,fitted_model,error=np.array([1]), residual='none', axres='none'):
    
    popt = sol['popt']
    z = popt[0]
    
    wv_rest = wave/(1+z)*1e4
    fit_loc = np.where((wv_rest>100.)&(wv_rest<16000.))[0]
    
    ax.plot(wv_rest[fit_loc], fluxs.data[fit_loc], color='grey', drawstyle='steps-mid', alpha=0.2)

    flux = fluxs.data[np.invert(fluxs.mask)]
    wv_rst_sc= wv_rest[np.invert(fluxs.mask)]
        
    fit_loc_sc = np.where((wv_rst_sc>100)&(wv_rst_sc<16000))[0]   
    
    ax.plot(wv_rst_sc[fit_loc_sc],flux[fit_loc_sc], drawstyle='steps-mid')
    
    y_tot = fitted_model(wave[fit_loc], *popt)
    y_tot_rs = fitted_model(wv_rst_sc[fit_loc_sc]*(1+z)/1e4, *popt)

    ax.plot(wv_rest[fit_loc], y_tot, 'r--')
    

    ax.set_ylim(-0.1*max(y_tot), max(y_tot)*1.1)
    ax.tick_params(direction='in')
    
        
    if axres !='none':
        resid_OIII = flux[fit_loc_sc]-y_tot_rs
        sigma_OIII = np.std(resid_OIII)
        RMS_OIII = np.sqrt(np.mean(resid_OIII**2))
        
        axres.plot(wv_rst_sc[fit_loc_sc],resid_OIII, drawstyle='steps-mid')
        axres.set_ylim(-2*RMS_OIII, 2*RMS_OIII) ## the /3 scales to the ratio
        if residual=='rms':
            axres.fill_between(wv_rst_sc[fit_loc_sc], RMS_OIII, -RMS_OIII, facecolor='grey', alpha=0.2)
        elif residual=='error':
            axres.fill_between(wv_rst_sc[fit_loc_sc],resid_OIII-error[fit_loc_sc],resid_OIII+error[fit_loc_sc], alpha=0.3, color='k')


def plotting_optical(res, ax, error=np.array([1]), template=0, residual='none',axres=None):
    sol = res.props
    popt = sol['popt']
    keys = list(sol.keys())
    z = popt[0]
    wave = res.wave
    fluxs = res.fluxs
    error = res.error
    wv_rest = wave/(1+z)*1e4

    ax.plot(wv_rest, fluxs.data, color='grey', drawstyle='steps-mid', alpha=0.2)

    flux = fluxs.data[np.invert(fluxs.mask)]
    wv_rst_sc= wv_rest[np.invert(fluxs.mask)]


    ax.plot(wv_rst_sc,flux, drawstyle='steps-mid', label='data')
    if len(error) !=1:
        ax.fill_between(wv_rst_sc,flux-error,flux+error, alpha=0.3, color='k')

    y_tot = res.yeval
    y_tot_rs = res.yeval[np.invert(fluxs.mask)]

    ax.plot(wv_rest, y_tot, 'r--')

    ax.set_ylim(-0.1*np.nanmax(y_tot), np.nanmax(y_tot)*1.1)
    ax.tick_params(direction='in')
    ax.set_xlim(4700,5050 )

    OIIIr = 5008.24*(1+z)/1e4
    OIIIb = 4960.3*(1+z)/1e4

    fwhm = sol['Nar_fwhm'][0]

    ax.plot(wv_rest, gauss(wave, sol['OIII_peak'][0]/3,OIIIb, fwhm)+ gauss(wave, sol['OIII_peak'][0],OIIIr, fwhm) \
                 ,color= 'green', linestyle ='dashed')

    if 'Hbeta_peak' in keys:
        Hbeta= 4862.6*(1+z)/1e4    
        fwhm = sol['Nar_fwhm'][0]
        ax.plot(wv_rest ,   gauss(wave, sol['Hbeta_peak'][0],Hbeta, fwhm),\
                        color= 'orange', linestyle ='dashed')


    if 'outflow_fwhm' in keys:
        OIIIr = OIIIr+ sol['outflow_vel'][0]/3e5*OIIIr
        OIIIb = OIIIb + sol['outflow_vel'][0]/3e5*OIIIb

        fwhm = sol['outflow_fwhm'][0]

        ax.plot(wv_rest,   gauss(wave, sol['OIII_out_peak'][0]/3,OIIIb, fwhm)+ gauss(wave, sol['OIII_out_peak'][0],OIIIr, fwhm),\
                     color= 'blue', linestyle ='dashed')

        if 'Hbeta_out_peak' in keys:
            Hbeta_wv = 4862.6*(1+z)/1e4
            Hbeta_out_wv = Hbeta_wv + sol['outflow_vel'][0]/3e5*Hbeta_wv

            fwhm = sol['outflow_fwhm'][0]

            ax.plot(wv_rest,  gauss(wave, sol['Hbeta_out_peak'][0],Hbeta_out_wv, fwhm),\
                        color= 'blue', linestyle ='dashed')

    if residual !='none':
        resid_OIII = flux-y_tot_rs
        sigma_OIII = np.std(resid_OIII)
        RMS_OIII = np.sqrt(np.mean(resid_OIII**2))

        axres.plot(wv_rst_sc,resid_OIII, drawstyle='steps-mid')
        axres.set_ylim(-3*RMS_OIII, 3*RMS_OIII) ## the /3 scales to the ratio
        axres.hlines(0, 4600,5600, color='black', linestyle='dashed')
        if residual=='rms':
            axres.fill_between(wv_rst_sc, RMS_OIII, -RMS_OIII, facecolor='grey', alpha=0.2)
        elif residual=='error':
            axres.fill_between(wv_rst_sc,resid_OIII-error,resid_OIII+error, alpha=0.3, color='k')



def overide_axes_labels(fig,ax,lims,showx=1,showy=1,labelx=1,labely=1,color='k',fewer_x=0,pruney=0,prunex=0,tick_color='k', tickin=0, labelsize=12, white=0):
    #over rides axis labels generated by wcsaxes in order to put relative coordinates in

    #fig is the figure being plotted
    #ax = axis to plot on
    #lims is what you want on the axis (xmin,xmax,ymin,ymax) OR (img_wcs,im_hdr)
    #labelx / label y = bool, true if want tick and axis labels on the x / y axis

    #plt.ion()

    if len(lims)==2:
        img_wcs=lims[0]
        hdr=lims[1]
        o=np.array(img_wcs.all_pix2world(1,1,1))
        o=SkyCoord(o[0],o[1], unit="deg")
        p1=np.array(img_wcs.all_pix2world(hdr['NAXIS1'],1,1))
        p1=SkyCoord(p1[0],p1[1], unit="deg")
        p2=np.array(img_wcs.all_pix2world(1,hdr['NAXIS2'],1))
        p2=SkyCoord(p2[0],p2[1], unit="deg")

        arcsec_size= np.array([o.separation(p2).arcsec,o.separation(p1).arcsec,])/2.

        lims=[-arcsec_size[1],arcsec_size[1],-arcsec_size[0],arcsec_size[0]]

    lon = ax.coords[0]
    lat = ax.coords[1]

    lon.set_ticks_visible(False)
    lon.set_ticklabel_visible(False)
    lat.set_ticks_visible(False)
    lat.set_ticklabel_visible(False)

    if showx or showy:
        #plt.draw()
        #plt.pause(0.000000001)
        newax = fig.add_axes(ax.get_position(), frameon=False)

        plt.xlim(lims[0],lims[1])
        plt.ylim(lims[2],lims[3])

        newax.xaxis.label.set_color(color)
        newax.tick_params(axis='x', colors=color)
        newax.tick_params(axis='x', color=tick_color)


        newax.yaxis.label.set_color(color)
        newax.tick_params(axis='y', colors=color)
        newax.tick_params(axis='y', color=tick_color)

        if not showx: gca().axes.xaxis.set_ticklabels([])
        if not showy: gca().axes.axes.yaxis.set_ticklabels([])

        if labely:    plt.ylabel('arcsec', fontsize=labelsize)
        if labelx:    plt.xlabel('arcsec', fontsize=labelsize)


        if fewer_x: newax.set_xticks(newax.get_xticks()[::2])

        #newax.yaxis.set_major_locator(MaxNLocator(prune='both'))
        #newax.xaxis.set_major_locator(MaxNLocator(prune='both'))
        if pruney: newax.set_yticks(newax.get_yticks()[1:-1])
        if prunex: newax.set_xticks(newax.get_xticks()[1:-1])

    if tickin==1:
        newax.tick_params(axis='y', direction='in', color='white')
        newax.tick_params(axis='x', direction='in', color='white')

    if tickin==2:
        newax.tick_params(axis='y', direction='in', color='black')
        newax.tick_params(axis='x', direction='in', color='black')

    if white==1:
        from matplotlib.ticker import (MultipleLocator, FormatStrFormatter,
                               AutoMinorLocator)
        newax.xaxis.label.set_color('white')
        newax.yaxis.label.set_color('white')

        #plt.ylabel('arcsec', fontsize=labelsize, color='w')
        #plt.xlabel('arcsec', fontsize=labelsize, color='w')

        plt.setp(newax.get_yticklabels(), color="white")
        plt.setp(newax.get_xticklabels(), color="white")

        #newax.xaxis.set_major_locator(MultipleLocator(4))
        #newax.yaxis.set_major_locator(MultipleLocator(4))

        #newax.xaxis.set_minor_locator(MultipleLocator(3))
        #newax.yaxis.set_minor_locator(MultipleLocator(3))

def OIII_map_plotting(ID, path, fwhmrange = [300,500], velrange=[-400,100], flux_max=0):
    from mpl_toolkits.axes_grid1 import make_axes_locatable


    with pyfits.open(path, memmap=False) as hdulist:
        
        #map_hb = hdulist['Hbeta'].data
        map_oiii = hdulist['OIII'].data
        map_oiii_ki= hdulist['OIII_kin'].data
        

        IFU_header = hdulist['PRIMARY'].header

    
    x = int(IFU_header['X_cent']); y= int(IFU_header['Y_cent'])
    f = plt.figure( figsize=(10,10))

    if flux_max==0:
        flx_max = map_oiii[1,y,x]
    else:
        flx_max = flux_max

    deg_per_pix = IFU_header['CDELT2']
    arc_per_pix = deg_per_pix*3600


    Offsets_low = -np.array([x,y])
    Offsets_hig = np.shape(map_oiii[1])[1:3] -np.array([x,y])

    lim = np.array([ Offsets_low[0], Offsets_hig[0],
                     Offsets_low[1], Offsets_hig[1] ])

    lim_sc = lim*arc_per_pix

    ax1 = f.add_axes([0.1, 0.55, 0.38,0.38])
    ax2 = f.add_axes([0.1, 0.1, 0.38,0.38])
    ax3 = f.add_axes([0.55, 0.1, 0.38,0.38])
    ax4 = f.add_axes([0.55, 0.55, 0.38,0.38])

    flx = ax1.imshow(map_oiii[1],vmax=flux_max, origin='lower', extent= lim_sc)
    ax1.set_title('Flux map')
    divider = make_axes_locatable(ax1)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(flx, cax=cax, orientation='vertical')

    #lims =
    #emplot.overide_axes_labels(f, axes[0,0], lims)


    vel = ax2.imshow( map_oiii_ki[0,:,:], cmap='coolwarm', origin='lower', vmin=velrange[0], vmax=velrange[1], extent= lim_sc)
    ax2.set_title('Velocity offset map')
    divider = make_axes_locatable(ax2)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(vel, cax=cax, orientation='vertical')


    fw = ax3.imshow( map_oiii_ki[1,:,:],vmin=fwhmrange[0], vmax=fwhmrange[1], origin='lower', extent= lim_sc)
    ax3.set_title('FWHM map')
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    snr = ax4.imshow(map_oiii[0],vmin=3, vmax=20, origin='lower', extent= lim_sc)
    ax4.set_title('SNR map')
    divider = make_axes_locatable(ax4)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(snr, cax=cax, orientation='vertical')



def Plot_results_Halpha_OIII(file, center=[27,27], fwhmrange = [100,500], velrange=[-100,100], flux_max=0, o3offset=0, extent=np.array([0])):
    with pyfits.open(file, memmap=False) as hdulist:
        map_hal = hdulist['Halpha'].data
        map_nii = hdulist['NII'].data
        map_hb = hdulist['Hbeta'].data
        map_oiii = hdulist['OIII'].data
        map_oi = hdulist['OI'].data
        map_siir = hdulist['SIIr'].data
        map_siib = hdulist['SIIb'].data
        map_hal_ki = hdulist['Hal_kin'].data
        #map_oiii_ki= hdulist['OIII_kin'].data
        Av = hdulist['Av'].data

        IFU_header = hdulist['PRIMARY'].header

    from mpl_toolkits.axes_grid1 import make_axes_locatable
    x = int(center[0]); y= int(center[0])

    deg_per_pix = IFU_header['CDELT2']
    arc_per_pix = deg_per_pix*3600

    Offsets_low =- np.array(center)
    Offsets_hig = np.shape(map_hal)[1:] - np.array(center)

    lim = np.array([ Offsets_low[0], Offsets_hig[0],
                    Offsets_low[1], Offsets_hig[1] ])

    lim_sc = lim*arc_per_pix
    print(lim_sc)

    if flux_max==0:
        flx_max = map_hal[1,y,x]
    else:
        flx_max = flux_max

# =============================================================================
#         Plotting Stuff
# =============================================================================
    f,axes = plt.subplots(6,3, figsize=(10,20), sharex=True, sharey=True)
    ax1 = axes[0,0]
    # =============================================================================
    # Halpha SNR
    snr = ax1.imshow(map_hal[0,:,:],vmin=3, vmax=20, origin='lower', extent= lim_sc)
    ax1.set_title('Hal SNR map')
    divider = make_axes_locatable(ax1)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(snr, cax=cax, orientation='vertical')
    ax1.set_xlabel('RA offset (arcsecond)')
    ax1.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Halpha flux
    ax1 = axes[0,1]
    flx = ax1.imshow(map_hal[1,:,:],vmax=flx_max, origin='lower', extent= lim_sc)
    ax1.set_title('Halpha Flux map')
    divider = make_axes_locatable(ax1)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(flx, cax=cax, orientation='vertical')
    cax.set_ylabel('Flux (arbitrary units)')
    ax1.set_xlabel('RA offset (arcsecond)')
    ax1.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Halpha  velocity
    ax2 = axes[0,2]
    vel = ax2.imshow(map_hal_ki[0,:,:], cmap='coolwarm', origin='lower', vmin=velrange[0],vmax=velrange[1], extent= lim_sc)
    ax2.set_title('Hal Velocity offset map')
    divider = make_axes_locatable(ax2)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(vel, cax=cax, orientation='vertical')

    cax.set_ylabel('Velocity (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Halpha fwhm
    ax3 = axes[1,2]
    fw = ax3.imshow(map_hal_ki[1,:,:],vmin=fwhmrange[0],vmax=fwhmrange[1], origin='lower', extent= lim_sc)
    ax3.set_title('Hal FWHM map')
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    cax.set_ylabel('FWHM (km/s)')
    ax2.set_xlabel('RA offset (arcsecond)')
    ax2.set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [NII] SNR
    axes[1,0].set_title('[NII] SNR')
    fw= axes[1,0].imshow(map_nii[0,:,:],vmin=3, vmax=10,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[1,0])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[1,0].set_xlabel('RA offset (arcsecond)')
    axes[1,0].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [NII] flux
    axes[1,1].set_title('[NII] map')
    fw= axes[1,1].imshow(map_nii[1,:,:] ,vmax=flx_max,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[1,1])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[1,1].set_xlabel('RA offset (arcsecond)')
    axes[1,1].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Hbeta] SNR
    axes[2,0].set_title('Hbeta SNR')
    fw= axes[2,0].imshow(map_hb[0,:,:],vmin=3, vmax=10,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[2,0])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[2,0].set_xlabel('RA offset (arcsecond)')
    axes[2,0].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # Hbeta flux
    axes[2,1].set_title('Hbeta map')
    fw= axes[2,1].imshow(map_hb[1,:,:] ,vmax=flx_max,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[2,1])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[2,1].set_xlabel('RA offset (arcsecond)')
    axes[2,1].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [OIII] SNR
    axes[3,0].set_title('[OIII] SNR')
    fw= axes[3,0].imshow(map_oiii[0,:,:],vmin=3, vmax=20,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[3,0])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[3,0].set_xlabel('RA offset (arcsecond)')
    axes[3,0].set_ylabel('Dec offset (arcsecond)')

    # =============================================================================
    # [OIII] flux
    axes[3,1].set_title('[OIII] map')
    fw= axes[3,1].imshow(map_oiii[1,:,:] ,vmax=flx_max,origin='lower', extent= lim_sc)
    divider = make_axes_locatable(axes[3,1])
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    axes[3,1].set_xlabel('RA offset (arcsecond)')
    axes[3,1].set_ylabel('Dec offset (arcsecond)')
    '''
    # =============================================================================
    # [OIII] vel
    ax3= axes[2,2]
    ax3.set_title('[OIII] vel')
    fw = ax3.imshow(map_oiii_ki[0,:,:],vmin=velrange[0]+o3offset,vmax=velrange[1]+o3offset,cmap='coolwarm', origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    # =============================================================================
    # [OIII] fwhm
    ax3 = axes[3,2]
    ax3.set_title('[OIII] fwhm')
    fw = ax3.imshow(map_oiii_ki[1,:,:],vmin=fwhmrange[0],vmax=fwhmrange[1], origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    # =============================================================================
    # [OIII] fwhm
    ax3 = axes[4,2]
    ax3.set_title('[OIII] vel offset')
    fw = ax3.imshow(map_oiii_ki[2,:,:],vmin=0,vmax=150, origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')
    '''
    # =============================================================================
    # OI SNR
    ax3 = axes[4,0]
    ax3.set_title('OI SNR')
    fw = ax3.imshow(map_oi[0,:,:],vmin=3, vmax=10, origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    # =============================================================================
    # OI flux
    ax3 = axes[4,1]
    ax3.set_title('OI Flux')
    fw = ax3.imshow(map_oi[1,:,:], origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    # =============================================================================
    # SII SNR
    ax3 = axes[5,0]
    ax3.set_title('[SII] SNR')
    fw = ax3.imshow(map_siir[0,:,:],vmin=3, vmax=10, origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    # =============================================================================
    # SII Ratio
    ax3 = axes[5,1]
    ax3.set_title('[SII]r/[SII]b')
    fw = ax3.imshow(map_siir[1,:,:]/map_siib[1,:,:] ,vmin=0.3, vmax=1.5, origin='lower', extent= lim_sc)
    divider = make_axes_locatable(ax3)
    cax = divider.append_axes('right', size='5%', pad=0.05)
    f.colorbar(fw, cax=cax, orientation='vertical')

    if len(extent) >1:
        axes[0,0].set_xlim(extent[0], extent[1])
        axes[0,0].set_ylim(extent[2], extent[3])


    plt.tight_layout()



from mpl_toolkits.axes_grid1 import make_axes_locatable

def colorbar(f, ax, im, label, fontsize=12):
    divider = make_axes_locatable(ax)
    cax = divider.append_axes('right', size='5%', pad=0.0)
    f.colorbar(im, cax=cax, orientation='vertical') 
    cax.set_ylabel(label, fontsize=fontsize)
```

`Qubespec/QubeSpec/QubeSpec.py`:

```py
#!/usr/bin/env python2
# -*- coding: utf-8 -*-
"""
Created on Thu Aug  3 16:36:26 2017

@author: jansen
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt
import tqdm
import warnings

from astropy.io import fits
from astropy.wcs import wcs
from astropy.nddata import Cutout2D

from matplotlib.backends.backend_pdf import PdfPages
import pickle
import corner
import tqdm
import os
from astropy import stats
from brokenaxes import brokenaxes

from astropy.utils.exceptions import AstropyWarning
import astropy.constants, astropy.cosmology, astropy.units, astropy.wcs
from astropy.table import Table
import os

nan= float('nan')

pi= np.pi
e= np.e

c= 3.*10**8

OIIIr = 5008.24
OIIIb = 4960.3
Hal = 6564.52
NII_r = 6585.27
NII_b = 6549.86
Hbe = 4862.6

SII_r = 6731
SII_b = 6718.29
import time

from .Models import FeII_templates as pth
try:
    PATH_TO_FeII = pth.__path__[0]+ '/'
    with open(PATH_TO_FeII+'/Preconvolved_FeII.txt', "rb") as fp:
        Templates= pickle.load(fp)
    has_FeII = True
    print(has_FeII)

except FileNotFoundError:
    from .Models.FeII_comp import *
    its = preconvolve()
    print(its)



from . import Utils as sp
from . import Plotting as emplot
from . import Fitting as emfit
from . import Dust as dst

from .Models import Halpha_OIII_models as HaO_models
from . import Background as bkg
from . import Maps as Maps
from . import Spaxel_fitting as Spaxel


def Shortcut(QubeSpec_setup):
    """Quick function which does most of the prep of a of the data for fitting. 

    :param QubeSpec_setup: dict - setup file for QubeSpec

    :return: QubeSpec Cube object
    """

    print('Loading the data')
    obj = Cube( Full_path = QubeSpec_setup['file'],\
                z =  QubeSpec_setup['z'], \
                ID =  QubeSpec_setup['ID'] ,\
                flag =  QubeSpec_setup['instrument'] ,\
                savepath = QubeSpec_setup['save_path'] ,\
                Band = 'NIRSPEC',\
                norm = QubeSpec_setup['norm'])
    
    print('Masking JWST')
    obj.mask_JWST(0, threshold= QubeSpec_setup['mask_threshold'], spe_ma=QubeSpec_setup['mask_channels'])

    if QubeSpec_setup.get('BackgroundSubtraction', True):
        print('Performing background subtraction')
        if source_mask:=QubeSpec_setup.get('Source_mask', False): # If key is present, assume it's a file name
            assert type(source_mask)==str, f'QubeSpec_setup["Source_mask"] must be a string (if present). You gave {source_mask=}'
            assert os.path.isfile(source_mask), f'File QubeSpec_setup["Source_mask"]={source_mask=} not found'
            print('Loading source mask from file')
            source_bkg = sp.QFitsview_mask(source_mask) # Loading background mask
    
        obj.background_subtraction( source_mask=source_bkg, wave_range=QubeSpec_setup['line_map_wavelength'], plot=1) # Doing 

    print('PSF matching')
    obj.PSF_matching(PSF_match = QubeSpec_setup['PSF_match'],\
                    wv_ref= QubeSpec_setup['PSF_match_wv'])
    
    print('Creating Continuum map')
    obj.collapse_white(1)

    print('Extracting 1D collapsed spectrum')
    obj.find_center(1, manual=QubeSpec_setup['Object_center'])
    obj.D1_spectra_collapse(1, addsave='',rad=QubeSpec_setup['Aperture_extraction'], err_range=QubeSpec_setup['err_range'], boundary=QubeSpec_setup['err_boundary'], plot_err=1)
    

    return obj

# ============================================================================
#  Main class
# =============================================================================
class Cube:
    """Main Class for QubeSpec
    """
    def __init__(self, Full_path='', z='', ID='', flag='', savepath='', Band='',data='SCI', norm=1e-13,):
        """The main class for QubeSpex

        Args:
            Full_path (str, optional): _description_. Defaults to ''.
            z (str, optional): _description_. Defaults to ''.
            ID (str, optional): _description_. Defaults to ''.
            flag (str, optional): _description_. Defaults to ''.
            savepath (str, optional): _description_. Defaults to ''.
            Band (str, optional): _description_. Defaults to ''.
            norm (_type_, optional): _description_. Defaults to 1e-13.

        Raises:
            Exception: _description_
        """
        import importlib
        importlib.reload(emfit )

        self.z = z
        self.ID = ID
        self.instrument = flag
        self.savepath = savepath
        self.band = Band
        self.Cube_path = Full_path
        self.flux_norm= norm

        if not os.path.isdir(self.savepath+'Diagnostics'):
            os.mkdir(self.savepath+'Diagnostics')

        if self.Cube_path !='':
            #print (Full_path)
            if self.instrument=='KMOS':
                filemarker = fits.open(Full_path)
                self.header = filemarker[1].header # FITS header in HDU 1
                flux_temp  = filemarker[1].data/norm

                self.error_cube = filemarker[2].data/norm

                filemarker.close()  # FITS HDU file marker closed

            elif self.instrument=='Sinfoni':
                filemarker = fits.open(Full_path)
                self.header = filemarker[0].header # FITS header in HDU 1
                flux_temp  = filemarker[0].data/norm

                filemarker.close()  # FITS HDU file marker closed

            elif self.instrument=='NIRSPEC_IFU':
                with fits.open(self.Cube_path, memmap=False) as hdulist:
                    try:
                        flux_temp = hdulist[data].data/norm * astropy.units.Unit(hdulist['SCI'].header['BUNIT'])
                        error = hdulist['ERR'].data/norm * astropy.units.Unit(hdulist['SCI'].header['BUNIT'])
                    except Exception as _exc_:
                        print(_exc_)
                        flux_temp = hdulist[data].data/norm * astropy.units.Unit('Jy')*1e-6
                        error = hdulist['ERR'].data/norm * astropy.units.Unit('Jy')*1e-6

                    w = wcs.WCS(hdulist[1].header)
                    self.header = hdulist[1].header
                    cube_wcs = astropy.wcs.WCS(hdulist[data].header)
                    wave = cube_wcs.all_pix2world(0., 0., np.arange(cube_wcs._naxis[2]), 0)[2]
                    wave *= astropy.units.Unit(hdulist[data].header['CUNIT3'])
                    if wave.unit==astropy.units.m:
                        wave = wave.to('um')
                    else:
                        wave *= 1.e6 # Somehow, units are autoconverted to m

                    error *= (astropy.constants.c.to('AA/s') / wave.to('AA')**2)[:, None, None]
                    flux_temp *= (astropy.constants.c.to('AA/s') / wave.to('AA')**2)[:, None, None]
                    flux_temp = flux_temp.to('1 erg/(s cm2 AA arcsec2)')/0.01
                    error = error.to('1 erg/(s cm2 AA arcsec2)')/0.01
                    flux_temp = flux_temp.value
                    self.error_cube = error.value

            elif self.instrument=='NIRSPEC_IFU_fl':
                with fits.open(self.Cube_path, memmap=False) as hdulist:
                    flux_temp = hdulist[data].data/norm*1e4
                    self.error_cube = hdulist['ERR'].data/norm*1e4
                    self.wcs = wcs.WCS(hdulist[1].header)
                    self.header = hdulist[1].header

            elif self.instrument=='MIRI':
                with fits.open(self.Cube_path, memmap=False) as hdulist:
                    flux_temp = hdulist['SCI'].data/norm * astropy.units.Unit(hdulist['SCI'].header['BUNIT'])
                    error = hdulist['ERR'].data/norm * astropy.units.Unit(hdulist['SCI'].header['BUNIT'])
                    self.w = wcs.WCS(hdulist[1].header)
                    self.header = hdulist[1].header
                    cube_wcs = astropy.wcs.WCS(hdulist['SCI'].header)
                    wave = cube_wcs.all_pix2world(0., 0., np.arange(cube_wcs._naxis[2]), 0)[2]
                    wave *= astropy.units.Unit(hdulist['SCI'].header['CUNIT3'])
                    if wave.unit==astropy.units.m:
                        wave = wave.to('um')
                    else:
                        wave *= 1.e6 # Somehow, units are autoconverted to m

                    error *= (astropy.constants.c.to('AA/s') / wave.to('AA')**2)[:, None, None]
                    flux_temp *= (astropy.constants.c.to('AA/s') / wave.to('AA')**2)[:, None, None]
                    flux_temp = flux_temp.to('1 erg/(s cm2 AA arcsec2)')/0.01
                    error = error.to('1 erg/(s cm2 AA arcsec2)')/0.01
                    flux_temp = flux_temp.value
                    self.error_cube = error.value

            else:
                raise Exception('Instrument flag not understood')

            self.flux = np.ma.masked_invalid(flux_temp)   #  deal with NaN

            # Number of spatial pixels
            n_xpixels = self.header['NAXIS1']
            n_ypixels = self.header['NAXIS2']
            #  Number of spectral pixels
            n_spixels = self.header['NAXIS3']
            self.dim = [n_ypixels, n_xpixels, n_spixels]


            try:
                x = self.header['CDELT1']
            except:
                self.header['CDELT1'] = self.header['CD1_1']
            try:
                x = self.header['CDELT2']
            except:
                self.header['CDELT2'] = self.header['CD2_2']
            try:
                x = self.header['CDELT3']
            except:
                self.header['CDELT3'] = self.header['CD3_3']

            self.obs_wave = self.header['CRVAL3'] + (np.arange(n_spixels) - (self.header['CRPIX3'] - 1.0))*self.header['CDELT3']

            deg_per_pix_x = abs(self.header['CDELT1'])
            arc_per_pix_x = 1.*deg_per_pix_x*3600
            Xpix = self.header['NAXIS1']
            Xph = Xpix*arc_per_pix_x

            deg_per_pix_y = abs(self.header['CDELT2'])

            arc_per_pix_y = deg_per_pix_y*3600
            Ypix = self.header['NAXIS2']
            Yph = Ypix*arc_per_pix_y
                        
            if self.instrument=='NIRSPEC_IFU_fl':
                self.instrument= 'NIRSPEC_IFU'
            self.phys_size = np.array([Xph, Yph])
            

        else:
            self.save_dummy = 0

    def divider(self):
        return np.nan

    background_subtraction = bkg.background_subtraction
    background_subtraction_depricated = bkg.background_sub_spec_depricated
    
    def add_res(self, line_cat):
        '''
        Add catalogue line from a astorpy table - used in KASHz
        Parameters
        ----------
        line_cat : TYPE
            DESCRIPTION.

        Returns
        -------
        None.

        '''

        self.cat = line_cat


    def mask_emission(self):
        '''
        Legacy: This function masks out all the OIII and HBeta emission.
        It is a ;egacy KASHz function.

        Returns
        -------
        None.

        '''
        OIIIa=  OIIIr/1e4*(1+self.z)
        OIIIb=  OIIIb/1e4*(1+self.z)
        Hbeta=  Hbeta/1e4*(1+self.z)
        width = 300/3e5*OIIIa

        mask =  self.flux.mask.copy()

        OIIIa_loc = np.where((self.obs_wave<OIIIa+width)&(self.obs_wave>OIIIa-width))[0]
        OIIIb_loc = np.where((self.obs_wave<OIIIb+width)&(self.obs_wave>OIIIb-width))[0]
        Hbeta_loc = np.where((self.obs_wave<Hbeta+width)&(self.obs_wave>Hbeta-width))[0]

        mask[OIIIa_loc,:,:] = True
        mask[OIIIb_loc,:,:] = True
        mask[Hbeta_loc,:,:] = True
        self.em_line_mask= mask


    def mask_sky(self,sig, mode=0):
        '''
        Old function to mask_sky - very rudmumentary only used as initial masking
        for KASHz.

        Parameters
        ----------
        sig : TYPE
            DESCRIPTION.
        mode : TYPE, optional
            DESCRIPTION. The default is 0.

        Returns
        -------
        None.

        '''

        bins = np.linspace(0,2048,5)
        bins= np.array(bins, dtype=int)
        flux = np.ma.array(data=self.flux.data.copy(), mask= self.em_line_mask.copy())
        mask =  self.em_line_mask.copy()
        dim = self.dim


        if mode=='Hsin':
            use = np.where((self.obs_wave>1.81)&(self.obs_wave<1.46))[0]
            mask[use,:,:] = True

        for i in range(dim[0]):
            for j in range(dim[1]):
                stds = np.ma.std(flux[:,i,j])
                y = np.ma.mean(flux[:,i,j])


                sky = np.where((flux[:,i,j]< (y-stds*sig)) | (flux[:,i,j]> (y+stds*sig)))[0]

                mask[sky,i,j] = True

                if i==20 and j==20:
                    print(sky)


        self.sky_line_mask_em = mask


    def collapse_white(self, plot):
        '''
        This function creates a white light image of the cube.

        Parameters
        ----------
        plot : TYPE
            DESCRIPTION.

        Returns
        -------
        None.

        '''

        self.Median_stack_white =  np.ma.median(self.flux, axis=(0))

        if plot==1:
            plt.figure()
            plt.imshow(self.Median_stack_white,  origin='lower')
            plt.colorbar()
            plt.savefig(self.savepath+'Diagnostics/Median_cont_image.pdf')



    def find_center(self, plot=0, extra_mask=0, manual=np.array([0])):
        '''
        Input:
            Storage,
            image name to be loaded
            Plot it?
            extra mask of the weird bright features
            manual - If manual is on then It will just return the manual inputs. Use if there is no continuum detected
        '''

        shapes = self.dim
        data = self.Median_stack_white

        # Create the x inputs for the curve_fit
        x = np.linspace(0, shapes[1]-1, shapes[1])
        y = np.linspace(0, shapes[0]-1, shapes[0])
        x, y = np.meshgrid(x, y)

        import scipy.optimize as opt

        if len(manual)==1:

            # If there is no extra mask -create a dummy extra mask
            if len(np.shape(extra_mask))<1.:
                extra_mask = self.flux.mask.copy()
                extra_mask = extra_mask[0,:,:]
                extra_mask[:,:] = False

            #############
            # Masking the edges based on the pixel scale.
            edges = self.flux.mask.copy() # Mask to collapse
            edges = edges[0,:,:]
            edges[:,:] = False
            try:
                pixel_scale = 1./(self.header['CD2_2']*3600)

            except:
                pixel_scale = 1./(self.header['CDELT2']*3600)


            if pixel_scale < 7:
                edges[:,0] = True
                edges[:,1] = True
                edges[:, -1] = True
                edges[:, -2] = True
                edges[1,:] = True
                edges[0,:] = True
                edges[-1,:] = True
                edges[-2,:] = True

                print ('Masking edges based on 0.2 scale')

            else:
                edges[:,:5] = True
                edges[:, -6:] = True
                edges[:5,:] = True
                edges[-6:,:] = True

                print ('Masking edges based on 0.1 scale')

            # Combining the edge and extra mask
            comb = np.logical_or(extra_mask, edges)

            # Setting all other nan values to 0 to avoid any troubles
            data.data[np.isnan(data.data)] = 0
            data= data.data

            # combining the data and masks
            masked_im = np.ma.array(data= data, mask=comb)

            # Finding the center of the contiunuum
            loc = np.ma.where(masked_im == masked_im.max())
            print ('location of the peak on the continuum',loc)

            #plt.figure()
            #plt.title('Find center - plot')
            #plt.imshow(masked_im, origin='low')

            # Setting the
            initial_guess = (data[loc[1][0], loc[0][0]],loc[1][0],loc[0][0],1,1,0,0)

            print ('Initial guesses', initial_guess)

            try:
                dm = (x,y)
                popt, pcov = opt.curve_fit(sp.twoD_Gaussian, dm, data.ravel(), p0=initial_guess)

                er = np.sqrt(np.diag(pcov))

                print ('Cont loc ', popt[1:3])
                print ('Cont loc er', er[1:3])

            except:
                print('Failed fit to the continuum - switching to the center of the cube')
                popt = np.zeros(7)
                popt[1] = int(self.dim[0]/2); popt[2] = int(self.dim[1]/2)

            if (popt[1]<3) | (popt[2]<3):
                print('Failed fit to the continuum - switching to the center of the cube')
                popt = np.zeros(7)
                popt[1] = int(self.dim[0]/2); popt[2] = int(self.dim[1]/2)

            self.center_data = popt



        else:
            manual = np.append(data[int(manual[0]), int(manual[1])], manual)
            manual = np.append(manual, np.array([2.,2.,0.5,0. ]))
            self.center_data = manual



    def choose_pixels(self, plot, rad= 0.6, flg=1, mask_manual=[0]):
        '''

        Choosing the pixels that will collapse into the 1D spectrum. Also this mask is used later
        Parameters
        ----------
        plot : TYPE
            DESCRIPTION.
        rad : TYPE, optional
            DESCRIPTION. The default is 0.6.
        flg : TYPE, optional
            DESCRIPTION. The default is 1.
        mask_manual : TYPE, optional
            DESCRIPTION. The default is [0].

        Returns
        -------
        None.

        '''

        center =  self.center_data[1:3].copy()
        shapes = self.dim

        print ('Center of cont', center)
        print ('Extracting spectrum from diameter', rad*2, 'arcseconds')

        # Creating a mask for all spaxels.
        mask_catch = self.flux.mask.copy()
        mask_catch[:,:,:] = True
        header  = self.header
        #arc = np.round(1./(header['CD2_2']*3600))
        arc = np.round(1./(header['CDELT2']*3600))
        print('Pixel scale:', arc)
        print ('radius ', arc*rad)

        # This choose spaxel within certain radius. Then sets it to False since we dont mask those pixels
        for ix in range(shapes[0]):
            for iy in range(shapes[1]):
                dist = np.sqrt((ix- center[1])**2+ (iy- center[0])**2)
                if dist< arc*rad:
                    mask_catch[:,ix,iy] = False

        if len(mask_manual) !=1:
            for i in range(shapes[2]):
                mask_catch[i,:,:] = mask_manual.copy()

        self.Signal_mask = mask_catch

        if plot==1:
            plt.figure()
            plt.title('Selected Spaxels for 1D spectrum + Contours from 2D Gaus')
            plt.imshow(np.ma.array(data=self.Median_stack_white, mask=self.Signal_mask[0,:,:]), origin='lower')
            plt.colorbar()

            shapes = self.dim
            x = np.linspace(0, shapes[1]-1, shapes[1])
            y = np.linspace(0, shapes[0]-1, shapes[0])
            x, y = np.meshgrid(x, y)

            data_fit = sp.twoD_Gaussian((x,y), *self.center_data)

            plt.contour(x, y, data_fit.reshape(shapes[0], shapes[1]), 20, colors='w')
            plt.savefig(self.savepath+'Diagnostics/1D_spectrum_Selected_pixel.pdf')


    def background_sub_spec_gnz11(self, center, rad=0.6, manual_mask=[],smooth=25, plot=0):
        '''
        Background subtraction used when the NIRSPEC cube has still flux in the blank field.

        Parameters
        ----------
        center : TYPE
            DESCRIPTION.
        rad : TYPE, optional
            DESCRIPTION. The default is 0.6.
        plot : TYPE, optional
            DESCRIPTION. The default is 0.

        Returns
        -------
        None.

        '''
        self.collapsed_bkg, self.flux = bkg.background_sub_spec_gnz11(self, center, rad=rad, manual_mask=manual_mask, smooth=smooth, plot=plot)


    def D1_spectra_collapse(self, plot,rad= 0.6, addsave='', err_range=[0], boundary=2.4, plot_err= 0, flg=1):
        '''
        This function collapses the Cube to form a 1D spectrum of the galaxy

        Parameters
        ----------
        plot : TYPE
            DESCRIPTION.
        addsave : TYPE, optional
            DESCRIPTION. The default is ''.
        err_range : TYPE, optional
            DESCRIPTION. The default is [0].
        boundary : TYPE, optional
            DESCRIPTION. The default is 2.4.

        Returns
        -------
        None.

        '''
        
        self.choose_pixels( plot=plot, rad= rad, flg=flg, mask_manual=[0])
        # Loading the Signal mask - selects spaxel to collapse to 1D spectrum
        mask_spax = self.Signal_mask.copy()
        # Loading mask of the sky lines an bad features in the spectrum
        mask_sky_1D = self.sky_clipped_1D.copy()

        if self.instrument=='NIRSPEC_IFU':
            total_mask = np.logical_or( mask_spax, self.sky_clipped)
        else:
            total_mask = np.logical_or( mask_spax, self.flux.mask)
        # M
        flux = np.ma.array(data=self.flux.data, mask= total_mask)

        D1_spectra = np.ma.sum(flux, axis=(1,2))
        self.D1_spectrum = np.ma.array(data = D1_spectra.data, mask=mask_sky_1D)

        if plot==1:
            plt.figure()
            plt.title('Collapsed 1D spectrum from D1_spectra_collapse fce')

            plt.plot(self.obs_wave, D1_spectra.data, drawstyle='steps-mid', color='grey')
            plt.plot(self.obs_wave, np.ma.array(data= D1_spectra, mask=self.sky_clipped_1D), drawstyle='steps-mid')

            plt.ylabel('Flux')
            plt.xlabel('Observed wavelength')
            plt.savefig(self.savepath+'Diagnostics/1D_spectrum.pdf')
               
        self.D1_spectrum_var = np.ma.sum(np.ma.array(data=self.error_cube.data, mask= total_mask)**2, axis=(1,2))

        if self.instrument =='NIRSPEC_IFU':
            print('NIRSPEC mode of error calc')
            nspaxel= np.sum(np.logical_not(total_mask[150,:,:]))

            D1_spectrum_var_er = np.sqrt(self.D1_spectrum_var)#/nspaxel)
            
            self.D1_spectrum_er = sp.error_scaling(self.obs_wave, D1_spectra, D1_spectrum_var_er, err_range, boundary,\
                                                   exp=plot_err)

            if plot_err==1:
                f,ax = plt.subplots(1)
                ax.plot(self.obs_wave, D1_spectrum_var_er, label='Extension')
                ax.plot(self.obs_wave, self.D1_spectrum_er, label='rescaled')

                ax.legend(loc='best')
                ax.set_xlabel(r'$\lambda_{\rm obs}$ $\mu$m')
                ax.set_ylabel('Flux density')
                plt.savefig(self.savepath+'Diagnostics/1D_spectrum_error_scaling.pdf')

        else:
            print('Other mode of error calc')
            if len(err_range)==2:
                error = stats.sigma_clipped_stats(D1_spectra[(err_range[0]<self.obs_wave) \
                                                            &(self.obs_wave<err_range[1])],sigma=3)[2] \
                                                        *np.ones(len(D1_spectra))
                self.D1_spectrum_er = error

            elif len(err_range)==4:
                error1 = stats.sigma_clipped_stats(D1_spectra[(err_range[0]<self.obs_wave) \
                                                            &(self.obs_wave<err_range[1])],sigma=3)[2]
                error2 = stats.sigma_clipped_stats(D1_spectra[(err_range[2]<self.obs_wave) \
                                                            &(self.obs_wave<err_range[3])],sigma=3)[2]
                
                error = np.zeros(len(D1_spectra))
                error[self.obs_wave<boundary] = error1
                error[self.obs_wave>boundary] = error2
                self.D1_spectrum_er = error
            else:
                self.D1_spectrum_er = stats.sigma_clipped_stats(self.D1_spectrum,sigma=3)[2]*np.ones(len(self.D1_spectrum)) #STD_calc(wave/(1+self.z)*1e4,self.D1_spectrum, self.band)* np.ones(len(self.D1_spectrum))

        if self.ID =='cdfs_220':
            self.D1_spectrum_er = 0.05*np.ones(len(self.D1_spectrum))
        if self.ID =='cid_346':
            self.D1_spectrum_er = 0.005*np.ones(len(self.D1_spectrum))

        if self.ID =='cdfs_584':
            self.D1_spectrum_er = 0.02*np.ones(len(self.D1_spectrum))

        Save_spec = np.zeros((4,len(D1_spectra)))
        Save_spec[0,:] = self.obs_wave
        Save_spec[1,:] = self.D1_spectrum
        Save_spec[2,:] = self.D1_spectrum_er.copy()
        Save_spec[3,:] = mask_sky_1D

        np.savetxt(self.savepath+self.ID+'_'+self.band+addsave+'_1Dspectrum.txt', Save_spec)



    def mask_JWST(self, plot=0, threshold=100, spe_ma=[]):
        '''
        Masking bad pixels in JWST NIRSPEC and MIRI observations.

        Parameters
        ----------
        plot : TYPE
            DESCRIPTION.
        threshold : TYPE, optional
            DESCRIPTION. The default is 1e11.
        spe_ma : TYPE, optional
            DESCRIPTION. The default is [].
        dtype : TYPE, optional
            DESCRIPTION. The default is bool.

        Returns
        -------
        None.

        '''
        self.masking_threshold = threshold
        self.channel_mask = spe_ma
        sky_clipped =  self.flux.mask.copy()
        median_error = np.nanmedian(self.error_cube)
        std_error = np.nanmedian(self.error_cube)
        limit = threshold*std_error+median_error
        sky_clipped[self.error_cube>limit] = True

        sky_clipped_1D = self.flux.mask.copy()[:,10,10].copy()
        sky_clipped_1D[:] = False
        sky_clipped_1D[spe_ma] = True
        self.sky_clipped_1D = sky_clipped_1D
        self.sky_clipped = sky_clipped
        self.Sky_stack_mask = self.flux.mask.copy()



    def stack_sky(self,plot, spe_ma=np.array([], dtype=bool), expand=0):
        '''
        Masking sky for KMOS and SINFONI based observations

        Parameters
        ----------
        plot : TYPE
            DESCRIPTION.
        spe_ma : TYPE, optional
            DESCRIPTION. The default is np.array([], dtype=bool).
        expand : TYPE, optional
            DESCRIPTION. The default is 0.

        Returns
        -------
        None.

        '''
        header = self.header
        ######
        # Finding the center of the Object
        center =  self.center_data[1:3].copy()

        ######
        # Defining other variable to be used
        wave = self.obs_wave.copy()#*1e4/(1+z) # Wavelength
        flux = self.flux.copy()   # Flux

        shapes = self.dim # The shapes of the image

        mask_nan = self.flux.mask.copy()

        mask_collapse = self.flux.mask.copy() # Mask to collapse
        mask_collapse[:,:,:] = False



        header  = self.header

        try:
            Radius = np.round(1.2/(header['CD2_2']*3600))

        except:
            Radius = np.round(1.2/(header['CDELT2']*3600))


        for ix in range(shapes[0]):
            for iy in range(shapes[1]):
                dist = np.sqrt((ix- center[1])**2+ (iy- center[0])**2)
                if dist< Radius:
                    mask_collapse[:,ix,iy] = True

        try:
            arc = (header['CD2_2']*3600)
        except:
            arc = (header['CDELT2']*3600)


        if arc< 0.17:
            print ('Masking special corners')
            mask_collapse[:,:,0] = True
            mask_collapse[:,:,1] = True
            mask_collapse[:,:,2] = True
            mask_collapse[:,:,3] = True

            mask_collapse[:,:,-1] = True
            mask_collapse[:,:,-2] = True
            mask_collapse[:,:,-3] = True
            mask_collapse[:,:,-4] = True

            mask_collapse[:,0,:] = True
            mask_collapse[:,1,:] = True
            mask_collapse[:,2,:] = True
            mask_collapse[:,3,:] = True

            mask_collapse[:,-1,:] = True
            mask_collapse[:,-2,:] = True
            mask_collapse[:,-3,:] = True
            mask_collapse[:,-4,:] = True

        elif arc> 0.17:
            print ('Masking special corners')
            mask_collapse[:,:,0] = True
            mask_collapse[:,:,-1] = True
            mask_collapse[:,0,:] = True
            mask_collapse[:,-1,:] = True

        # For Hband sinfoni data I subtracted the frames from each other to imitate the sky frame. Therefore there are two negative objects in the cube. I am masking those as well.
        if (self.band =='Hsin'):

            mask_collapse[:,76-10:76+8 ,83-10:83+10 ] = True #mask_collapse[:,2:10 ,0:12 ] = True #
            mask_collapse[:,21-10:21+8 ,27-10:27+10 ] = True
            print ('HB89 Hsin masking of negative objects')


        mask_collapse = np.logical_or(mask_collapse, mask_nan)

        self.Sky_stack_mask = mask_collapse
        ######

        # Collapsing the spaxels into sky spectrum
        stacked_sky = np.ma.sum(np.ma.array(data=flux.data, mask=mask_collapse), axis=(1,2))

        # Creating a brand new mask to mask weird features in the sky_spectrum
        std_mask = mask_collapse[:,7,7].copy()
        std_mask[:] = False

        weird = np.array([], dtype=int)

        if self.band=='YJ':
            print ('Masking based on YJ band')
            # Actually masking the weird features: Edges + that 1.27 annoying bit
            weird = np.where((wave>1.269) &(wave<1.285))[0]
            #weird = np.where((wave>1.28499) &(wave<1.285))[0]
            weird = np.append(weird, np.where((wave<1.010))[0])
            weird = np.append(weird, np.where((wave>1.35))[0])
            weird = np.append(weird, np.where((wave>1.31168)&(wave< 1.3140375))[0])

            # Masking the stacked sky not to intefere with calculating std
            std_mask[weird] = True

        elif  self.band=='H':
            print ('Masking based on H band')
            weird = np.where((wave<1.45))[0]
            weird = np.append(weird, np.where((wave>1.85))[0])
            weird = np.append(weird, np.where((wave>1.78351) &(wave<1.7885))[0])

        elif self.band=='K':
            print ('Masking based on K band')
            weird = np.where((wave<1.945))[0]
            weird = np.append(weird, np.where((wave>2.4))[0])

        elif self.band=='Hsin':
            print ('Masking based on H band with Sinfoni')
            weird = np.where((wave>1.82))[0]
            weird = np.append(weird, np.where((wave<1.45))[0])
            print (len(wave), len(weird))

        elif self.band=='Ysin':
            print ('Masking based on Y band with Sinfoni')
            weird = np.where((wave>1.35))[0]
            weird = np.append(weird, np.where((wave<1.11))[0])
            print (len(wave), len(weird))

        elif self.band=='Ksin':
            print ('Masking based on K band with Sinfoni')
            weird = np.where((wave>2.4))[0]
            weird = np.append(weird, np.where((wave<1.945))[0])
            print (len(wave), len(weird))

        elif self.band=='HKsin':
            print ('Masking based on HK band with Sinfoni')
            weird = np.where((wave>2.4))[0]
            weird = np.append(weird, np.where((wave<1.5))[0])
            print (len(wave), len(weird))

        weird = np.append(weird, spe_ma)

        std_mask[weird] = True

        stacked_sky_mask = np.ma.array(data = stacked_sky, mask=std_mask)


        # Masking sky lines
        y = np.zeros_like(stacked_sky)

        clip_w = 1.5

        ssma = stacked_sky_mask.data[np.invert(stacked_sky_mask.mask)]
        low, hgh = sp.conf(ssma)


        sky = np.where((stacked_sky<y+ low*clip_w) | (stacked_sky> y + hgh*clip_w))[0]

        sky_clipped =  self.flux.mask.copy()
        sky_clipped = sky_clipped[:,7,7]
        sky_clipped[sky] = True          # Masking the sky features
        sky_clipped[weird] = True        # Masking the weird features


        # Storing the 1D sky line mask into cube to be used later
        mask_sky = self.flux.mask.copy()



        if (self.ID=='xuds_316') & (self.band=='YJ'):
            sky_clipped[np.where((wave< 1.202 ) & (wave > 1.199))[0]] = False

        if (self.ID=='cdfs_328') & (self.band=='YJ'):
            sky_clipped[np.where((wave< 1.2658 ) & (wave > 1.2571))[0]] = False

        if (self.ID=='cdfs_220') & (self.band=='YJ'):
            sky_clipped[np.where((wave< 1.286 ) & (wave > 1.2571))[0]] = False

        if (self.ID=='cdfs_751') & (self.band=='K'):
            sky_clipped[np.where((wave< 1.99 ) )[0]] = False

        if (self.ID=='cdfs_485') & (self.band=='H'):
            sky_clipped[np.where((wave< 1.71577 ) & (wave > 1.71300))[0]] = False

        if (self.ID=='xuds_398') & (self.band=='YJ'):
            sky_clipped[np.where((wave< 1.2976 ) & (wave > 1.26))[0]] = False
        if (self.ID=='xuds_479') & (self.band=='YJ'):
            sky_clipped[np.where((wave< 1.04806 ) & (wave > 1.03849))[0]] = False

        for ix in range(shapes[0]):
            for iy in range(shapes[1]):
                mask_sky[:,ix,iy] = sky_clipped

        # Storing the 1D and 3D sky masks
        self.sky_clipped = mask_sky
        self.sky_clipped_1D = sky_clipped

        self.Stacked_sky = stacked_sky


        np.savetxt(self.savepath+'clp.txt', sky_clipped)



        if plot==1:
            mask_spax = self.Signal_mask.copy()
            mask_sky = self.sky_clipped.copy()

            total_mask = np.logical_or(mask_spax, mask_sky)


            flux_new = np.ma.array(data=self.flux.data, mask= total_mask)
            D1_spectra_new = np.ma.sum(flux_new, axis=(1,2))

            flux_old = np.ma.array(data=self.flux.data, mask=mask_spax)
            D1_spectra_old = np.ma.sum(flux_old, axis=(1,2))
            #######
            # Plotting the spaxels used to assemble the sky

            plt.figure()
            plt.imshow(np.ma.array(data=self.Median_stack_white, mask=mask_collapse[0,:,:]), origin='lower')
            plt.colorbar()
            plt.title('Removing the Galaxy')


            #######
            # 3 panel plot
            # 1 panel - The stacked spectrum
            # 2 panel - clipped sky lines
            # 3 panel - The collpsed 1D spectrum of the galaxy - No masking
            # 4 panel - The collpsed 1D spectrum of the galaxy - Final masking

            f, (ax1,ax2, ax3, ax4) = plt.subplots(4, sharex=True,sharey=True, figsize=(10,15))

            ax1.set_title('Stacked spectrum outside the galaxy')

            ax1.plot(wave, y+np.ones_like(stacked_sky)*hgh, 'g--')
            ax1.plot(wave, y+np.ones_like(stacked_sky)*low, 'g--')

            ax1.plot(wave, y+np.ones_like(stacked_sky)*hgh*clip_w, 'r--')
            ax1.plot(wave, y+np.ones_like(stacked_sky)*low*clip_w, 'r--')

            ax1.plot(wave, (stacked_sky), drawstyle='steps-mid', color='grey')
            ax1.plot(wave, np.ma.array(data=stacked_sky,mask=std_mask), drawstyle='steps-mid')
            ax1.set_ylabel('Sky spec')

            ax1.set_ylim(np.ma.min(np.ma.array(data=stacked_sky,mask=std_mask)), np.ma.max(np.ma.array(data=stacked_sky,mask=std_mask)))

            ax2.plot(wave, np.ma.array(data=stacked_sky, mask=sky_clipped), drawstyle='steps-mid')
            ax2.set_ylabel('Clipped sky')

            ax2.set_ylim(np.ma.min(np.ma.array(data=stacked_sky,mask=std_mask)), np.ma.max(np.ma.array(data=stacked_sky,mask=std_mask)))


            ax3.set_ylabel('Old spec')
            ax3.plot(wave, D1_spectra_old, drawstyle='steps-mid')

            ax4.plot(wave, D1_spectra_new, drawstyle='steps-mid')
            ax4.set_ylabel('New spec')

            ax1.set_ylim(-0.05,0.4)

            plt.savefig(self.savepath+'Diagnostics/Sky_spectrum.pdf')

            plt.tight_layout()

    def fitting_collapse_Halpha(self, plot=1, models = 'BLR', progress=True, sampler ='emcee',er_scale=1, N=6000, priors= {'z': [0,'normal_hat',0, 0, 0,0]}):
        priors_update = priors.copy()
        priors= {'z':[0, 'normal_hat', 0,0,0,0],\
                'cont':[0,'loguniform',-3,1],\
                'cont_grad':[0,'normal',0,0.3], \
                'Hal_peak':[0,'loguniform',-3,1],\
                'BLR_Hal_peak':[0,'loguniform',-3,1],\
                'zBLR':[0, 'normal', 0,0.003],\
                'NII_peak':[0,'loguniform',-3,1],\
                'Nar_fwhm':[300,'uniform',100,900],\
                'BLR_fwhm':[4000,'uniform', 2000,9000],\
                'BLR_offset':[-100,'normal',0,200],\
                'SIIr_peak':[0,'loguniform',-3,1],\
                'SIIb_peak':[0,'loguniform',-3,1],\
                'Hal_out_peak':[0,'loguniform',-3,1],\
                'NII_out_peak':[0,'loguniform',-3,1],\
                'outflow_fwhm':[600,'uniform', 300,1500],\
                'outflow_vel':[-50,'normal', 0,300]}

        
        for name in list(priors_update.keys()):
            priors[name] = priors_update[name]

        wave = self.obs_wave.copy()
        flux = self.D1_spectrum.copy()
        error = self.D1_spectrum_er.copy()/er_scale
        z = self.z
        
        fl = flux.data
        msk = flux.mask
        
        flux = np.ma.array(data=fl, mask = msk)
        
        
        if models=='BLR':
            
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_Halpha(model='gal')
            
            
            Fits_blr = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_blr.fitting_Halpha(model='BLR')
            
            
            
            if Fits_blr.BIC-Fits_sig.BIC <-2:
                print('Delta BIC' , Fits_blr.BIC-Fits_sig.BIC, ' ')
                print('BICM', Fits_blr.BIC)
                self.D1_fit_results = Fits_blr.props
                self.D1_fit_chain = Fits_blr.chains
                self.D1_fit_model = Fits_blr.fitted_model
                self.D1_fit_full = Fits_blr
                
                self.z = self.D1_fit_results['popt'][0]
                
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hblr')
                self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
                self.dBIC = Fits_blr.BIC-Fits_sig.BIC
                
                
            else:
                print('Delta BIC' , Fits_blr.BIC-Fits_sig.BIC, ' ')
                
                self.D1_fit_results = Fits_sig.props
                self.D1_fit_chain = Fits_sig.chains
                self.D1_fit_model = Fits_sig.fitted_model
                self.D1_fit_full = Fits_sig
                
                self.z = self.D1_fit_results['popt'][0]
                
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hn')
                self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
                self.dBIC = Fits_blr.BIC-Fits_sig.BIC
                
            '''This is for KASHz only!
            
            if (self.ID=='cid_111') | (self.ID=='xuds_254') | (self.ID=='xuds_379') | (self.ID=='xuds_235') | (self.ID=='sxds_620')\
                | (self.ID=='cdfs_751') | (self.ID=='cdfs_704') | (self.ID=='cdfs_757') | (self.ID=='sxds_787') | (self.ID=='sxds_1093')\
                    | (self.ID=='xuds_186') | (self.ID=='cid_1445') | (self.ID=='cdfs_38')| (self.ID=='cdfs_485')\
                        | (self.ID=='cdfs_588')  | (self.ID=='cid_932')  | (self.ID=='xuds_317'):
                    
                print('Delta BIC' , BICM-BICS, ' ')
                self.D1_fit_results = prop_sig
                self.D1_fit_chain = flat_samples_sig
                self.D1_fit_model = fitted_model_sig
                self.z = prop_sig['popt'][0]
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hn')
                self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
                self.dBIC = BICM-BICS
                
                
            if (self.ID=='xuds_168') :
                 print('Delta BIC' , BICM-BICS, ' ')
                 print('BICM', BICM)
                 self.D1_fit_results = prop_blr
                 self.D1_fit_chain = flat_samples_blr
                 self.D1_fit_model = fitted_model_blr
                 self.z = prop_blr['popt'][0]
                 
                 self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hblr')
                 self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
                 self.dBIC = BICM-BICS
            '''       
        elif models=='Outflow':
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_Halpha(model='gal')
            
            
            Fits_out = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_out.fitting_Halpha(model='outflow')
            
            
            if Fits_out.BIC-Fits_sig.BIC <-2:
                print('Delta BIC' , Fits_out.BIC-Fits_sig.BIC, ' ')
                print('BICM', Fits_out.BIC)
                self.D1_fit_results = Fits_out.props
                self.D1_fit_chain = Fits_out.chains
                self.D1_fit_model = Fits_out.fitted_model
                self.D1_fit_full = Fits_out
                
                self.z = self.D1_fit_results['popt'][0]
                
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hn')
                self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
                self.dBIC = Fits_out.BIC-Fits_sig.BIC
                
                
            else:
                print('Delta BIC' , Fits_out.BIC-Fits_sig.BIC, ' ')
                
                self.D1_fit_results = Fits_sig.props
                self.D1_fit_chain = Fits_sig.chains
                self.D1_fit_model = Fits_sig.fitted_model
                self.D1_fit_full = Fits_sig
                
                self.z = self.D1_fit_results['popt'][0]
                
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hn')
                self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
                self.dBIC = Fits_out.BIC-Fits_sig.BIC
                
        elif models=='Single_only':
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_Halpha(model='gal')
        
            self.D1_fit_results = Fits_sig.props
            self.D1_fit_chain = Fits_sig.chains
            self.D1_fit_model = Fits_sig.fitted_model
            self.D1_fit_full = Fits_sig
            
            self.z = self.D1_fit_results['popt'][0]
            
            self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hn')
            self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
            self.dBIC = 3
        
        elif models=='Outflow_only':
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_Halpha(model='outflow')
        
            self.D1_fit_results = Fits_sig.props
            self.D1_fit_chain = Fits_sig.chains
            self.D1_fit_model = Fits_sig.fitted_model
            self.D1_fit_full = Fits_sig
            
            self.z = self.D1_fit_results['popt'][0]
            
            self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hn')
            self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
            self.dBIC = 3
            
        elif models=='BLR_only':
            
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_Halpha(model='BLR_simple')
        
            self.D1_fit_results = Fits_sig.props
            self.D1_fit_chain = Fits_sig.chains
            self.D1_fit_model = Fits_sig.fitted_model
            self.D1_fit_full = Fits_sig
            
            self.z = self.D1_fit_results['popt'][0]
            
            self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hblr')
            self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
            self.dBIC = 3
            
        elif models=='QSO_BKPL':
            
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_Halpha(model='QSO_BKPL')
        
            self.D1_fit_results = Fits_sig.props
            self.D1_fit_chain = Fits_sig.chains
            self.D1_fit_model = Fits_sig.fitted_model
            self.D1_fit_full = Fits_sig
            
            self.z = self.D1_fit_results['popt'][0]
            
            self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hblr')
            self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
            self.dBIC = 3
        
        else:
            Exception('Sorry, models keyword not understood - AGN keywords allowed: BLR, Outflow, Single_only, BLR_only, Outflow_only, QSO_BKPL')
        
        labels= list(self.D1_fit_chain.keys())[1:]
            
        fig = corner.corner(
            sp.unwrap_chain(self.D1_fit_chain), 
            labels=labels,
            quantiles=[0.16, 0.5, 0.84],
            show_titles=True,
            title_kwargs={"fontsize": 12})
        
        print('SNR hal ', self.SNR)
        print('SNR SII ', self.SNR_sii)
        
        
        f, (ax1, ax2) = plt.subplots(2, 1,  gridspec_kw={'height_ratios': [3, 1]}, sharex='col')
        plt.subplots_adjust(hspace=0)
        ax1.yaxis.tick_left()
        ax2.yaxis.tick_left()
        
        emplot.plotting_Halpha(self.D1_fit_full, ax1, errors=True, residual='error', axres=ax2)
        
        self.fit_plot = [f,ax1,ax2]
        
        if (models=='BLR') | (models=='Outflow'):
            g, (ax1a,ax2a) = plt.subplots(2)
            emplot.plotting_Halpha(Fits_sig, ax1a)
            try:
                emplot.plotting_Halpha(Fits_blr, ax2a)
            except:
                emplot.plotting_Halpha(Fits_out, ax2a)
        
        plt.savefig(self.savepath+'Diagnostics/1D_spectrum_Halpha_fit.pdf')

            
            
    def fitting_collapse_Halpha_OIII(self, plot=1, progress=True,N=6000,sampler='emcee', models='Single_only', priors= {'z': [0,'normal_hat',0, 0, 0,0]}):
        priors_update = priors.copy()
        priors={'z':[0,'normal_hat', 0, 0.,0,0],\
            'cont':[0,'loguniform', -3,1],\
            'cont_grad':[0,'normal', 0,0.2],\
            'Hal_peak':[0,'loguniform', -3,1],\
            'NII_peak':[0,'loguniform', -3,1],\
            'Nar_fwhm':[300,'uniform', 200,900],\
            'SIIr_peak':[0,'loguniform', -3,1],\
            'SIIb_peak':[0,'loguniform', -3,1],\
            'OIII_peak':[0,'loguniform', -3,1],\
            'Hbeta_peak':[0,'loguniform', -3,1],\
            'outflow_fwhm':[450,'uniform', 300,1500],\
            'outflow_vel':[-50,'normal', -50,100],\
            'Hal_out_peak':[0,'loguniform', -3,1],\
            'NII_out_peak':[0,'loguniform', -3,1],\
            'OIII_out_peak':[0,'loguniform', -3,1],\
            'Hbeta_out_peak':[0,'loguniform', -3,1],\
            'zBLR':[0,'normal', 0,0.003],\
            'BLR_fwhm':[4000,'normal', 5000,500],\
            'BLR_Hal_peak':[0,'loguniform', -3,1],\
            'BLR_Hbeta_peak':[0,'loguniform', -3,1] }

        for name in list(priors_update.keys()):
            priors[name] = priors_update[name]
            
        
        wave = self.obs_wave.copy()
        flux = self.D1_spectrum.copy()
        error = self.D1_spectrum_er.copy()
        z = self.z
        
        fl = flux.data
        msk = flux.mask
        
        flux = np.ma.array(data=fl, mask = msk)
        
        if models=='Single_only':   
            
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_Halpha_OIII(model='gal' )
            
            self.D1_fit_results = Fits_sig.props
            self.D1_fit_chain = Fits_sig.chains
            self.D1_fit_model = Fits_sig.fitted_model
            self.D1_fit_full = Fits_sig

            self.z = Fits_sig.props['popt'][0]
            
            self.SNR_hal =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hn')
            self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
            self.SNR_OIII =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
            self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
            self.SNR_nii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'NII')
    
            self.dBIC = 3
            
            
        elif models=='Outflow_only':   
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_Halpha_OIII(model='outflow' )
            
            self.D1_fit_results = Fits_sig.props
            self.D1_fit_chain = Fits_sig.chains
            self.D1_fit_model = Fits_sig.fitted_model
            self.z = Fits_sig.props['popt'][0]
            self.D1_fit_full = Fits_sig

            self.SNR_hal =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hn')
            self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
            self.SNR_OIII =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
            self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
            self.SNR_nii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'NII')
    
            
            self.dBIC = 3
            
        elif (models=='BLR') | (models=='BLR_only'):   
             Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
             Fits_sig.fitting_Halpha_OIII(model='BLR' )
             
             self.D1_fit_results = Fits_sig.props
             self.D1_fit_chain = Fits_sig.chains
             self.D1_fit_model = Fits_sig.fitted_model
             self.z = Fits_sig.props['popt'][0]
             self.D1_fit_full = Fits_sig

             self.SNR_hal =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hn')
             self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
             self.SNR_OIII =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
             self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
             self.SNR_nii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'NII')
             
             self.dBIC = 3

        elif models=='BLR_simple':   
             Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
             Fits_sig.fitting_Halpha_OIII(model='BLR_simple' )
             
             self.D1_fit_results = Fits_sig.props
             self.D1_fit_chain = Fits_sig.chains
             self.D1_fit_model = Fits_sig.fitted_model
             self.z = Fits_sig.props['popt'][0]
             self.D1_fit_full = Fits_sig

             self.SNR_hal =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hn')
             self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
             self.SNR_OIII =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
             self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
             self.SNR_nii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'NII')
     
             self.dBIC = 3

        elif models=='QSO_BKPL':   
             Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
             Fits_sig.fitting_Halpha_OIII(model='QSO_BKPL' )
             
             self.D1_fit_full = Fits_sig
             self.D1_fit_results = Fits_sig.props
             self.D1_fit_chain = Fits_sig.chains
             self.D1_fit_model = Fits_sig.fitted_model
             self.z = Fits_sig.props['popt'][0]
             '''
             self.SNR_hal =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hn')
             self.SNR_sii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'SII')
             self.SNR_OIII =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
             self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
             self.SNR_nii =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'NII')
             '''
             
        else:
            raise Exception('models variable in fitting_collapse_Halpha_OIII not understood. Outflow variables: Single_only, Outflow_only, BLR, QSO_BKPL, BLR_simple')
        labels= list(self.D1_fit_chain.keys())[1:]
            
        fig = corner.corner(
            sp.unwrap_chain(self.D1_fit_chain), 
            labels=labels,
            quantiles=[0.16, 0.5, 0.84],
            show_titles=True,
            title_kwargs={"fontsize": 12})
        
        
        f = plt.figure(figsize=(10,4))
        if models=='QSO_BKPL':
            baxes = brokenaxes(xlims=((4700,5050),(6200,6800)),  hspace=.01)
        else:
            baxes = brokenaxes(xlims=((4800,5050),(6400,6800)),  hspace=.01)
                
        emplot.plotting_Halpha_OIII(self.D1_fit_full, baxes, errors=True, residual='error')                             
        baxes.set_xlabel('Restframe wavelength (ang)')

        plt.savefig(self.savepath+'Diagnostics/1D_spectrum_Halpha_OIII_fit.pdf')

        
        g = plt.figure(figsize=(10,4))
        if models=='QSO_BKPL':
            baxes_er = brokenaxes(xlims=((4700,5050),(6200,6800)),  hspace=.01)  
        else:
            baxes_er = brokenaxes(xlims=((4800,5050),(6400,6800)),  hspace=.01)
            
        
        y_tot = self.D1_fit_model(self.obs_wave, *self.D1_fit_results['popt'])
        
        baxes_er.plot(self.obs_wave/(1+self.D1_fit_results['popt'][0])*1e4, self.D1_spectrum-y_tot)
        baxes_er.set_ylim(-5*self.D1_spectrum_er[0], 5*self.D1_spectrum_er[0])
         
        self.fit_plot = [f,baxes]
        
    def fitting_collapse_OIII(self, plot=1, models='Outflow',simple=1, Fe_template=0,progress=True,sampler='emcee', N=6000,priors= {'z': [0,'normal_hat',0, 0, 0,0]}):
        priors_update = priors.copy()
        priors= {'z': [0,'normal_hat',0, 0, 0,0],\
                'cont':[0,'loguniform',-3,1],\
                'cont_grad':[0,'normal',0,0.2], \
                'OIII_peak':[0,'loguniform',-3,1],\
                'OIII_out_peak':[0,'loguniform',-3,1],\
                'Nar_fwhm':[300,'uniform', 100,900],\
                'BLR_fwhm':[5000,'uniform', 2000,9000],\
                'outflow_fwhm':[700,'uniform',600,2500],\
                'outflow_vel':[-50,'normal',0,200],\
                'Hbeta_peak':[0,'loguniform',-3,1],\
                'BLR_Hbeta_peak':[0,'loguniform',-3,1],\
                'Hbeta_out_peak':[0,'loguniform',-3,1],\
                'zBLR': [0,'normal_hat',0, 0, 0,0],\
                'Fe_peak':[0,'loguniform',-3,1],\
                'Fe_fwhm':[3000,'uniform',2000,6000]}
        
        for name in list(priors_update.keys()):
            priors[name] = priors_update[name]

        wave = self.obs_wave.copy()
        flux = self.D1_spectrum.copy()
        error = self.D1_spectrum_er.copy()
    
        if models=='Outflow':
            
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_OIII(model='gal')
                
            Fits_out = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_out.fitting_OIII(model='outflow')
            
            if Fits_out.BIC-Fits_sig.BIC <-2:
                print('Delta BIC' , Fits_out.BIC-Fits_sig.BIC, ' ')
                print('BICM', Fits_out.BIC)
                self.D1_fit_results = Fits_out.props
                self.D1_fit_chain = Fits_out.chains
                self.D1_fit_model = Fits_out.fitted_model
                self.D1_fit_full = Fits_out
                
                self.z = self.D1_fit_results['popt'][0]
                
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
                self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
                self.dBIC = Fits_out.BIC-Fits_sig.BIC
                
            else:
                print('Delta BIC' , Fits_out.BIC-Fits_sig.BIC, ' ')
                
                self.D1_fit_results = Fits_sig.props
                self.D1_fit_chain = Fits_sig.chains
                self.D1_fit_model = Fits_sig.fitted_model
                self.D1_fit_full = Fits_sig
                
                self.z = self.D1_fit_results['popt'][0]
                
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
                self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
                self.dBIC = Fits_out.BIC-Fits_sig.BIC
            '''
            if (ID=='cdfs_751') | (ID=='cid_40') | (ID=='xuds_068') | (ID=='cdfs_51') | (ID=='cdfs_614')\
                | (ID=='xuds_190') | (ID=='cdfs_979') | (ID=='cdfs_301')| (ID=='cid_453') | (ID=='cid_61') | (ID=='cdfs_254')  | (ID=='cdfs_427'):
                    
                print('Delta BIC' , BICM-BICS, ' ')
                self.D1_fit_results = prop_sig
                self.D1_fit_chain = flat_samples_sig
                self.D1_fit_model = fitted_model_sig
                self.z = prop_sig['popt'][0]
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
                self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
                self.dBIC = BICM-BICS
                
                
                
            if ID=='cid_346':
                print('Delta BIC' , BICM-BICS, ' ')
                self.D1_fit_results = prop_out
                self.D1_fit_chain = flat_samples_out
                self.D1_fit_model = fitted_model_out
                self.z = prop_out['popt'][0]
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
                self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
                self.dBIC = BICM-BICS
            '''
            g, (ax1a,ax2a) = plt.subplots(2)
            emplot.plotting_OIII(Fits_sig, ax1a)
            emplot.plotting_OIII(Fits_out, ax2a)
            
            
        elif models=='Single_only':
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_OIII(model='gal' )
               
            self.D1_fit_results = Fits_sig.props
            self.D1_fit_chain = Fits_sig.chains
            self.D1_fit_model = Fits_sig.fitted_model
            self.D1_fit_full = Fits_sig
            
            self.z = self.D1_fit_results['popt'][0]
            
            self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
            self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
            self.dBIC = 3
            
        elif models=='Outflow_only':
            Fits_out = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_out.fitting_OIII(model='outflow', Fe_template=Fe_template )
                
            print('BICM', Fits_out.BIC)
            self.D1_fit_results = Fits_out.props
            self.D1_fit_chain = Fits_out.chains
            self.D1_fit_model = Fits_out.fitted_model
            self.D1_fit_full = Fits_out
            
            self.z = self.D1_fit_results['popt'][0]
            
            self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
            self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
            self.dBIC = 3
            
        elif models=='QSO':
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_OIII(model='BLR_simple', Fe_template=Fe_template )
                
            Fits_out = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_out.fitting_OIII(model='BLR_outflow', Fe_template=Fe_template )
            
            if Fits_out.BIC-Fits_sig.BIC <-2:
                print('Delta BIC' , Fits_out.BIC-Fits_sig.BIC, ' ')
                print('BICM', Fits_out.BIC)
                self.D1_fit_results = Fits_out.props
                self.D1_fit_chain = Fits_out.chains
                self.D1_fit_model = Fits_out.fitted_model
                self.D1_fit_full = Fits_out
                
                self.z = self.D1_fit_results['popt'][0]
                
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
                self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')

                self.dBIC = Fits_out.BIC-Fits_sig.BIC
            
            else:
                print('Delta BIC' , Fits_out.BIC-Fits_sig.BIC, ' ')
                
                self.D1_fit_results = Fits_sig.props
                self.D1_fit_chain = Fits_sig.chains
                self.D1_fit_model = Fits_sig.fitted_model
                self.D1_fit_full = Fits_sig
                
                self.z = self.D1_fit_results['popt'][0]
                
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
                self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
                self.dBIC = Fits_out.BIC-Fits_sig.BIC

        elif models=='QSO_simple':
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_OIII(model='gal', Fe_template=Fe_template )
                
            Fits_out = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_out.fitting_OIII(model='BLR_simple', Fe_template=Fe_template )
            
            if Fits_out.BIC-Fits_sig.BIC <-2:
                print('Delta BIC' , Fits_out.BIC-Fits_sig.BIC, ' ')
                print('BICM', Fits_out.BIC)
                self.D1_fit_results = Fits_out.props
                self.D1_fit_chain = Fits_out.chains
                self.D1_fit_model = Fits_out.fitted_model
                self.D1_fit_full = Fits_out
                
                self.z = self.D1_fit_results['popt'][0]
                
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
                self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')

                self.dBIC = Fits_out.BIC-Fits_sig.BIC
            
            else:
                print('Delta BIC' , Fits_out.BIC-Fits_sig.BIC, ' ')
                
                self.D1_fit_results = Fits_sig.props
                self.D1_fit_chain = Fits_sig.chains
                self.D1_fit_model = Fits_sig.fitted_model
                self.D1_fit_full = Fits_sig
                
                self.z = self.D1_fit_results['popt'][0]
                
                self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
                self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
                self.dBIC = Fits_out.BIC-Fits_sig.BIC


        elif models=='BLR_simple':
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_OIII(model='BLR_simple', Fe_template=Fe_template )
                
            
            
            
            self.D1_fit_results = Fits_sig.props
            self.D1_fit_chain = Fits_sig.chains
            self.D1_fit_model = Fits_sig.fitted_model
            self.D1_fit_full = Fits_sig
                
            self.z = self.D1_fit_results['popt'][0]
                
            self.SNR =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'OIII')
            self.SNR_hb =  sp.SNR_calc(wave, flux, error, self.D1_fit_results, 'Hb')
                
            
           
        elif models=='QSO_bkp':
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors, sampler=sampler)
            Fits_sig.fitting_OIII(model='QSO_BKPL',Fe_template=Fe_template)
                
            self.D1_fit_results = Fits_sig.props
            self.D1_fit_chain = Fits_sig.chains
            self.D1_fit_model = Fits_sig.fitted_model
            self.D1_fit_full = Fits_sig
            
            self.z = self.D1_fit_results['popt'][0]
            
            self.SNR =  3
            self.SNR_hb =  3
            self.dBIC = 3
            
        else:
            Exception('Sorry, models keyword not understood: QSO, QSO_BKPL, Outflow_only, Single_only, Outflow')
        
        
        self.D1_fit_full.corner()
        
        print(self.SNR)
        print(self.SNR_hb)
        
        f, (ax1, ax2) = plt.subplots(2, 1,  gridspec_kw={'height_ratios': [3, 1]}, sharex='col')
        plt.subplots_adjust(hspace=0)
        ax1.yaxis.tick_left()
        ax2.yaxis.tick_left()
        
        emplot.plotting_OIII(self.D1_fit_full, ax1, errors=True, residual='error', axres=ax2, template=Fe_template)
        plt.savefig(self.savepath+'Diagnostics/1D_spectrum_OIII_fit.pdf')

        self.fit_plot = [f,ax1,ax2]  
    
    def fitting_collapse_optical(self, plot=1, models='Outflow', progress=True, N=6000,priors= {'z': [0,'normal_hat',0, 0, 0,0]}):
        
        priors= {'z': [0,'normal_hat',0, 0, 0,0],\
                'cont':[0,'loguniform',-3,1],\
                'cont_grad':[0,'normal',0,0.2], \
                'OIII_peak':[0,'loguniform',-3,1],\
                'OIII_out_peak':[0,'loguniform',-3,1],\
                'Nar_fwhm':[300,'uniform', 100,900],\
                'BLR_fwhm':[5000,'uniform', 2000,9000],\
                'outflow_fwhm':[700,'uniform',600,2500],\
                'outflow_vel':[-50,'normal',0,200],\
                'Hbeta_peak':[0,'loguniform',-3,1],\
                'BLR_Hbeta_peak':[0,'loguniform',-3,1],\
                'Hbeta_out_peak':[0,'loguniform',-3,1],\
                'zBLR': [0,'normal_hat',0, 0, 0,0],\
                'Fe_peak':[0,'loguniform',-3,1],\
                'Fe_fwhm':[3000,'uniform',2000,6000]}
        
        for name in list(priors.keys()):
            priors[name] = priors[name]

        wave = self.obs_wave.copy()
        flux = self.D1_spectrum.copy()
        error = self.D1_spectrum_er.copy()
    
        if models=='Outflow':
            
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors)
            Fits_sig.fitting_optical(model='gal')
                
            Fits_out = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors)
            Fits_out.fitting_optical(model='outflow')
            
            if Fits_out.BIC-Fits_sig.BIC <-2:
                print('Delta BIC' , Fits_out.BIC-Fits_sig.BIC, ' ')
                print('BICM', Fits_out.BIC)
                self.D1_fit_results = Fits_out.props
                self.D1_fit_chain = Fits_out.chains
                self.D1_fit_model = Fits_out.fitted_model
                self.D1_fit_full = Fits_out
                
                self.z = self.D1_fit_results['popt'][0]
                
                
                self.dBIC = Fits_out.BIC-Fits_sig.BIC
                
            else:
                print('Delta BIC' , Fits_out.BIC-Fits_sig.BIC, ' ')
                
                self.D1_fit_results = Fits_sig.props
                self.D1_fit_chain = Fits_sig.chains
                self.D1_fit_model = Fits_sig.fitted_model
                self.D1_fit_full = Fits_sig
                
                self.z = self.D1_fit_results['popt'][0]
                
                
                self.dBIC = Fits_out.BIC-Fits_sig.BIC
            
            g, (ax1a,ax2a) = plt.subplots(2)
            emplot.plotting_optical(Fits_sig, ax1a)
            emplot.plotting_optical(Fits_out, ax2a)
            
            
        elif models=='Single_only':
            Fits_sig = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors)
            Fits_sig.fitting_optical(model='gal' )
               
            self.D1_fit_results = Fits_sig.props
            self.D1_fit_chain = Fits_sig.chains
            self.D1_fit_model = Fits_sig.fitted_model
            self.D1_fit_full = Fits_sig
            
            self.z = self.D1_fit_results['popt'][0]
            
            self.dBIC = 3
            
        elif models=='Outflow_only':
            Fits_out = emfit.Fitting(wave, flux, error, self.z,N=N,progress=progress, priors=priors)
            Fits_out.fitting_optical(model='outflow' )
                
            print('BICM', Fits_out.BIC)
            self.D1_fit_results = Fits_out.props
            self.D1_fit_chain = Fits_out.chains
            self.D1_fit_model = Fits_out.fitted_model
            self.D1_fit_full = Fits_out
            
            self.z = self.D1_fit_results['popt'][0]
            self.dBIC = 3
             
        else:
            Exception('Sorry, models keyword not understood: Outflow_only, Single_only, Outflow')
        
        
        self.D1_fit_full.corner()
      
        f, (ax1, ax2) = plt.subplots(2, 1,  gridspec_kw={'height_ratios': [3, 1]}, sharex='col')
        plt.subplots_adjust(hspace=0)
        ax1.yaxis.tick_left()
        ax2.yaxis.tick_left()
        
        emplot.plotting_optical(self.D1_fit_full, ax1, errors=True, residual='error', axres=ax2)
        plt.savefig(self.savepath+'Diagnostics/1D_spectrum_optical_fit.pdf')

        self.fit_plot = [f,ax1,ax2]  
            
    
    def fitting_collapse_general(self,fitted_model, labels, priors, logprior, nwalkers=64,use=np.array([]), N=6000 ):
        wave = self.obs_wave.copy()
        flux = self.D1_spectrum.copy()
        error = self.D1_spectrum_er.copy()
        z = self.z
        ID = self.ID
        if len(use)==0:
            use = np.linspace(0, len(wave)-1, len(wave), dtype=int)
            
        Fits_gen = emfit.Fitting(wave[use], flux[use], error[use], z, priors=priors, N=10000)
        Fits_gen.fitting_general(fitted_model, labels, logprior, nwalkers=nwalkers)
        
        self.D1_fit_results = Fits_gen.props
        self.D1_fit_chain = Fits_gen.chains
        self.D1_fit_model = Fits_gen.fitted_model
        self.z = Fits_gen.props['popt'][0]

        f,ax = plt.subplots(1)

        ax.plot(self.wave, self.flux, drawstyle='steps-mid')
        ax.plot(self.wave, Fits_gen.yeval, 'r--')
        plt.savefig(self.savepath+'Diagnostics/1D_spectrum_general_fit.pdf')

            
            
        fig = corner.corner(
            sp.unwrap_chain(self.D1_fit_chain), 
            labels=labels,
            quantiles=[0.16, 0.5, 0.84],
            show_titles=True,
            title_kwargs={"fontsize": 12})

    def fitting_collapse_ppxf(self):
        import os
        try:
            os.mkdir(self.savepath+'PRISM_1D')
        except:
            print('Folder structure already exists')
        try:
            os.mkdir(self.savepath+'PRISM_1D/prism_clear')
        except:
            print('Folder structure already exists')

        flux = self.D1_spectrum.data/(1e-7*1e4)*self.flux_norm
        obs_wave = self.obs_wave
        errors = self.D1_spectrum_er/(1e-7*1e4)*self.flux_norm
        import spectres as spres
        from . import jadify_temp as pth
        PATH_TO_jadify = pth.__path__[0]+ '/'
    
        sp.jadify(self.savepath+'PRISM_1D/prism_clear/100000', 'prism_clear', obs_wave, flux, err=errors, mask=np.zeros_like(obs_wave),
                        overwrite=True, descr=None, author='jscholtz', verbose=False)
        import yaml
        from yaml.loader import SafeLoader

        # Open the file and load the file
        with open('/Users/jansen/My Drive/MyPython/Qubespec/QubeSpec/jadify_temp/r100_jades_deep_hst_v3.1.1_template.yaml') as f:
            data = yaml.load(f, Loader=SafeLoader)

        data['dirs']['data_dir'] = self.savepath+'PRISM_1D/'
        data['dirs']['output_dir'] = self.savepath+'PRISM_1D/'
        data['ppxf']['redshift_table'] = self.savepath+'PRISM_1D/redshift_1D.csv'

        with open(self.savepath+'/PRISM_1D/R100_1D_setup_test.yaml', 'w') as f:
            data = yaml.dump(data, f, sort_keys=False, default_flow_style=True)

        #filename = PATH_TO_jadify+ 'red_table_template.csv'
        #redshift_cat = Table.read(filename)

        #redshift_cat['ID'][0] = 100000
        #redshift_cat['z_visinsp'][0] = self.z
        #redshift_cat['z_phot'][0] = self.z
        #redshift_cat['z_bagp'][0] = self.z
        #redshift_cat.write(self.savepath+'/PRISM_1D/redshift_1D.csv',overwrite=True)

        import nirspecxf
        id = 100000
        config100 = nirspecxf.NIRSpecConfig(self.savepath+'/R100_1D_setup_manual.yaml')
        ns, _ = nirspecxf.process_object_id(id, config100)

        self.D1_ppxf = ns


    def astrometry_correction(self, Coord):
        '''
        Correcting the Astrometry of the Cube. Enter new Ra and Dec coordinates.
        '''

        cube_center = self.center_data[1:3]

        # Old Header for plotting purposes
        Header_cube_old = self.header.copy()

        # New Header
        Header_cube_new = self.header.copy()
        Header_cube_new['CRPIX1'] = cube_center[0]+1
        Header_cube_new['CRPIX2'] = cube_center[1]+1
        Header_cube_new['CRVAL1'] = Coord[0]
        Header_cube_new['CRVAL2'] = Coord[1]

        self.header = Header_cube_new


    def report(self):
        '''
        Reporting the full results of D1_fit results

        Returns
        -------
        None.

        '''

        results = self.D1_fit_results
        print('')
        print('Model: ', results['name'])
        print('SNR of the line: ', self.SNR)
        print('dBIC of ', self.dBIC)

        for key in results.keys():

            if key == 'name' or key =='popt':
                print('')
            else:
                print(key, results[key])

    def unwrap_cube_prism(self, rad=0.4, add='',instrument='NIRSPEC', mask_manual=0, binning_pix=1, err_range=[0], boundary=2.4):
        '''
        Unwrapping the cube.

        Parameters
        ----------
        rad : TYPE, optional
            DESCRIPTION. The default is 0.4.
        sp_binning : TYPE, optional
            DESCRIPTION. The default is 'Nearest'.
        instrument : TYPE, optional
            DESCRIPTION. The default is 'KMOS'.
        add : TYPE, optional
            DESCRIPTION. The default is ''.
        mask_manual : TYPE, optional
            DESCRIPTION. The default is 0.
        binning_pix : TYPE, optional
            DESCRIPTION. The default is 1.
        err_range : TYPE, optional
            DESCRIPTION. The default is [0].
        boundary : TYPE, optional
            DESCRIPTION. The default is 2.4.

        Returns
        -------
        None.

        '''
        flux = self.flux.copy()
        shapes = self.dim

        ThD_mask = self.sky_clipped.copy()
        Spax_mask = self.Sky_stack_mask[0,:,:]

# =============================================================================
#   Unwrapping the cube
# =============================================================================
        try:
            arc = (self.header['CD2_2']*3600)

        except:
            arc = (self.header['CDELT2']*3600)

        if instrument=='NIRSPEC':
            upper_lim = 0
            step = 1
            step = binning_pix
        if instrument=='NIRSPEC05':
            upper_lim = 0
            step = 2
            step = binning_pix
        x = range(shapes[0]-upper_lim)
        y = range(shapes[1]-upper_lim)

        print(rad/arc)
        h, w = self.dim[:2]
        center= self.center_data[1:3]

        mask = sp.create_circular_mask(h, w, center= center, radius= rad/arc)
        mask = np.invert(mask)
        try:
            if mask_manual.all !=1:
                mask=mask_manual
        except:
            print('Circular mask')

        Spax_mask = np.logical_or(np.invert(Spax_mask),mask)
        if self.instrument=='NIRSPEC_IFU':
            Spax_mask = mask.copy()
        import os
        try:
            os.mkdir(self.savepath+'PRISM_spaxel/prism_clear')
        except:
            print('Making directory failed. Maybe it exists already')
        for i in tqdm.tqdm(x):
            #i= i+step

            for j in y:
                #j=j+step
                if Spax_mask[i,j]==False:
                    #print i,j

                    Spax_mask_pick = ThD_mask.copy()
                    Spax_mask_pick[:,:,:] = True
                    Spax_mask_pick[:, i-step:i+upper_lim, j-step:j+upper_lim] = False

                    if self.instrument=='NIRSPEC_IFU':
                        total_mask = np.logical_or(Spax_mask_pick, self.sky_clipped)
                        flx_spax_t = np.ma.array(data=flux.data,mask=total_mask)

                        flx_spax = np.ma.median(flx_spax_t, axis=(1,2))
                        flx_spax_m = np.ma.array(data = flx_spax.data, mask=self.sky_clipped_1D)
                        nspaxel= np.sum(np.logical_not(total_mask[22,:,:]))
                        if nspaxel==0:
                            nspaxel=1 
                        Var_er = np.sqrt(np.ma.sum(np.ma.array(data=self.error_cube.data, mask= total_mask)**2, axis=(1,2))/nspaxel)

                        error = sp.error_scaling(self.obs_wave, flx_spax_m, Var_er, err_range, boundary,\
                                                   exp=0)

                    sp.jadify(self.savepath+'PRISM_spaxel/prism_clear/00'+str(i)+str(j), 'prism_clear', self.obs_wave, flx_spax_m.data/(1e-7*1e4)*self.flux_norm, err=error/(1e-7*1e4)*self.flux_norm, mask=np.zeros_like(self.obs_wave),
                        overwrite=True, descr=None, author='jscholtz', verbose=False)
                    
        

    def unwrap_cube(self, rad=0.4,mask_manual=0, sp_binning='Nearest', add='', binning_pix=1, err_range=[0], boundary=2.4,instrument='NIRSPEC05'):
        """ Unwrapping the cube to prep it for spaxel-by-spaxel fitting. Saves the output as a pickle .txt object. 


        Parameters
        ----------
    
        rad : float
            radius of the circular aperture to select spaxel to fit (only used if mask_manual is not supplied)

        mask_manual: 2d - array
            2D array - with True value for spaxel you want ot fit. Ideal to select with QFitsView and load with QubeSpec.sp.Qfitsview_mask function

        sp_binning : str
            spatial binning - 'Single' - no binning, 'Nearest' - bins within 0.1 arcsec radius

        binning_pix: int -
            If sp_biiing = 'Nearest', how many pixels to bin over 1,2,3

        add: str - optional 
            add additional string to the saved file name for version/variations/names of companions. 

        err_range : list - optional
            same as for extracting 1D spectra and for the errors.

        boundary: float - optinal
            same as for extracting 1D spectra and for the errors.

        instrument: str
            not used anymore. Doesnt do anything. Will be remove soon.
            
           
        """
           
        flux = self.flux.copy()
        Mask= self.sky_clipped_1D
        shapes = self.dim


        ThD_mask = self.sky_clipped.copy()
        z = self.z
        wv_obs = self.obs_wave.copy()

        msk = Mask.copy()
        Spax_mask = self.Sky_stack_mask[0,:,:]

# =============================================================================
#   Unwrapping the cube
# =============================================================================
        try:
            arc = (self.header['CD2_2']*3600)

        except:
            arc = (self.header['CDELT2']*3600)

        upper_lim = 0
        step = binning_pix
    
        x = range(shapes[0]-upper_lim)
        y = range(shapes[1]-upper_lim)

        h, w = self.dim[:2]
        center= self.center_data[1:3]

        mask = sp.create_circular_mask(h, w, center= center, radius= rad/arc)
        mask = np.invert(mask)
        try:
            if mask_manual.all !=1:
                mask=mask_manual
        except:
            print('Circular mask')

        Spax_mask = np.logical_or(np.invert(Spax_mask),mask)
        if self.instrument=='NIRSPEC_IFU':
            Spax_mask = mask.copy()

        plt.figure()
        plt.imshow(np.ma.array(data=self.Median_stack_white, mask=Spax_mask), origin='lower')

        Unwrapped_cube = []
        for i in tqdm.tqdm(x):
            for j in y:
                if Spax_mask[i,j]==False:
                    
                    Spax_mask_pick = ThD_mask.copy()
                    Spax_mask_pick[:,:,:] = True
                    if sp_binning=='Nearest':
                        Spax_mask_pick[:, i-step:i+step, j-step:j+step] = False
                    if sp_binning=='Single':
                        Spax_mask_pick[:, i, j] = False

                    if self.instrument=='NIRSPEC_IFU':
                        total_mask = np.logical_or(Spax_mask_pick, self.sky_clipped)
                        flx_spax_t = np.ma.array(data=flux.data.copy(),mask=total_mask)

                        flx_spax = np.ma.median(flx_spax_t, axis=(1,2))
                        flx_spax_m = np.ma.array(data = flx_spax.data, mask=self.sky_clipped_1D)
                        nspaxel= np.sum(np.logical_not(total_mask[22,:,:]))
                        
                        Var_er = np.sqrt(np.ma.sum(np.ma.array(data=self.error_cube, mask= total_mask)**2, axis=(1,2))/nspaxel)
                        error = sp.error_scaling(self.obs_wave, flx_spax_m, Var_er, err_range, boundary,\
                                                   exp=0)
                        try:
                            error[error.mask==True] = np.ma.median(error)
                        except:
                            pass
                    else:
                        flx_spax_t = np.ma.array(data=flux.data,mask=Spax_mask_pick)
                        flx_spax = np.ma.median(flx_spax_t, axis=(1,2))
                        flx_spax_m = np.ma.array(data = flx_spax.data, mask=msk)

                        error = stats.sigma_clipped_stats(flx_spax_m,sigma=3)[2] * np.ones(len(flx_spax))

                    Unwrapped_cube.append([i,j,flx_spax_m, error,wv_obs, z])


        print(len(Unwrapped_cube))
        with open(self.savepath+self.ID+'_'+self.band+'_Unwrapped_cube'+add+'.txt', "wb") as fp:
            pickle.dump(Unwrapped_cube, fp)
     

    def Regional_Spec(self, center=[30,30], rad=0.4, err_range=None, manual_mask=np.array([]), boundary=None):
        '''
        Extracting regional spectra to be fitted.

        Parameters
        ----------
        center : TYPE
            DESCRIPTION.
        rad : TYPE
            DESCRIPTION.
        err_range : TYPE, optional
            DESCRIPTION. The default is None.
        manual_mask : TYPE, optional
            DESCRIPTION. The default is None.
        boundary : TYPE, optional
            DESCRIPTION. The default is None.

        Returns
        -------
        D1_spectrum : TYPE
            DESCRIPTION.
        D1_spectrum_er : TYPE
            DESCRIPTION.
        mask_catch : TYPE
            DESCRIPTION.

        '''

        # Creating a mask for all spaxels.
        mask_catch = self.flux.mask.copy()
        mask_catch[:,:,:] = True
        header  = self.header
        #arc = np.round(1./(header['CD2_2']*3600))
        arc = np.round(1./(header['CDELT2']*3600))
        
        
        if len(manual_mask)==0:
            print ('Center of cont', center)
            print ('Extracting spectrum from diameter', rad*2, 'arcseconds')
            print('Pixel scale:', arc)
            print ('radius ', arc*rad)
            # This choose spaxel within certain radius. Then sets it to False since we dont mask those pixels
            for ix in range(self.dim[0]):
                for iy in range(self.dim[1]):
                    dist = np.sqrt((ix- center[1])**2+ (iy- center[0])**2)
                    if dist< arc*rad:
                        mask_catch[:,ix,iy] = False
        else:
            print('Selecting spaxel based on the supplied mask.')
            mask_3d = np.dstack([manual_mask]*self.flux.shape[0])
            # Rearranging the mask so the order of the axis is the same as the cube - moving wavelength axis first 
            mask_catch = np.moveaxis(mask_3d, -1, 0)
            # Creating the mask array across the whole cube - spectra of masked spaxels will be ignored in other actions 
            

        # Loading mask of the sky lines an bad features in the spectrum
        mask_sky_1D = self.sky_clipped_1D.copy()

        if self.instrument=='NIRSPEC_IFU':
            total_mask = np.logical_or( mask_catch, self.sky_clipped)
        else:
            total_mask = np.logical_or( mask_catch, self.flux.mask)
        # M
        flux = np.ma.array(data=self.flux.data, mask= total_mask)

        D1_spectrum = np.ma.sum(flux, axis=(1,2))
        D1_spectrum = np.ma.array(data = D1_spectrum.data, mask=mask_sky_1D)

        if self.instrument =='NIRSPEC_IFU':
            print('NIRSPEC mode of error calc')
            D1_spectrum_var_er = np.sqrt(np.ma.sum(np.ma.array(data=self.error_cube.data, mask= total_mask)**2, axis=(1,2)))

            D1_spectrum_er = sp.error_scaling(self.obs_wave, D1_spectrum, D1_spectrum_var_er, err_range, boundary,\
                                                   exp=0)
        else:
            print('Other mode of error calc')
            if len(err_range)==2:
                error = stats.sigma_clipped_stats(D1_spectrum[(err_range[0]<self.obs_wave) \
                                                            &(self.obs_wave<err_range[1])],sigma=3)[2] \
                                                        *np.ones(len(D1_spectrum))
                D1_spectrum_er = error

            elif len(err_range)==4:
                error1 = stats.sigma_clipped_stats(D1_spectrum[(err_range[0]<self.obs_wave) \
                                                            &(self.obs_wave<err_range[1])],sigma=3)[2]
                error2 = stats.sigma_clipped_stats(D1_spectrum[(err_range[2]<self.obs_wave) \
                                                            &(self.obs_wave<err_range[3])],sigma=3)[2]
                
                error = np.zeros(len(D1_spectrum))
                error[self.obs_wave<boundary] = error1
                error[self.obs_wave>boundary] = error2
                D1_spectrum_er = error
            else:
                D1_spectrum_er = stats.sigma_clipped_stats(self.D1_spectrum,sigma=3)[2]*np.ones(len(self.D1_spectrum)) #STD_calc(wave/(1+self.z)*1e4,self.D1_spectrum, self.band)* np.ones(len(self.D1_spectrum))

        return D1_spectrum, D1_spectrum_er, mask_catch

    def PSF_matching(self, PSF_match=True, psf_fce=sp.NIRSpec_IFU_PSF, wv_ref=0, theta=None):
        from astropy.convolution import convolve_fft  
        from astropy.convolution import Gaussian2DKernel
        if PSF_match==True:
            print('Now PSF matching')
            if wv_ref == 0:
                wv_ref, = self.obs_wave[-1]
        
            theta = self.header['PA_V3']-138
            psf_matched = self.flux.copy()
            error_matched = self.error_cube.copy()
            for its in tqdm.tqdm(enumerate(self.obs_wave[ self.obs_wave<wv_ref])):
                i, wave = its
                
                sigma = np.sqrt(psf_fce(wv_ref)**2 - psf_fce(wave)**2)/0.05
                if wave<wv_ref:
                    kernel = Gaussian2DKernel( sigma[0],sigma[1], theta=theta)

                    psf_matched[i,:,:] = convolve_fft(psf_matched[i,:,:], kernel)
                    error_matched[i,:,:] = convolve_fft(error_matched[i,:,:], kernel)

            primary_hdu = fits.PrimaryHDU(np.zeros(1), header=self.header)

            hdus = [primary_hdu,fits.ImageHDU(psf_matched.data, name='SCI', header=self.header), fits.ImageHDU(error_matched, name='ERR', header=self.header)]
            hdulist = fits.HDUList(hdus)
            hdulist.writeto( self.Cube_path[:-4] +'psf_matched.fits', overwrite=True)

            psf_matched[np.isnan(self.flux.data)] = np.nan


            self.flux = np.ma.masked_invalid(psf_matched.data.copy())
            self.error = error_matched.copy()
            
            self.mask_JWST(plot=0, threshold=self.masking_threshold, spe_ma= self.channel_mask)
        else:
            print('You asked to do PSF matching, but PSF_match keyword is False. I am skipping PSF matching.')
        

    def ppxf_fitting(self):
        x=1

    
    def save(self, file_path):
        import pickle
        """save class as self.name.txt"""
        with open(file_path, "wb") as file:
            file.write(pickle.dumps(self.__dict__))
        

    def load(self, file_path):
        """try load self.name.txt"""
        import pickle
        with open(file_path, "rb") as file:
            dataPickle = file.read()
            self.__dict__ = pickle.loads(dataPickle)
        
        
        

```

`Qubespec/QubeSpec/README.md`:

```md
Data analysis pipeline to analyze data from VLT/KMOS, VLT/SINFONI and soon JWST/NIRSPEC to map emission lines in AGN and incactive host galaxies, create flux and kinematic maps as well as modelling outflows in Halpha and [OIII].

Code in IFU_tools_class is the main body of the code and example to run it is in cubes_prep.py

Graph_setup sets up matplotlib to make plots that Dave and Chris like.

WHEN UPDATING THE FITTING_TOOLS_MCMC.PY PLEASE EDIT 35 TO POINT THE CODE TO THE CORRECT LOCATION OF THE FeII TEMPLATES.

CHANGELOG:


1/6/23 - Implementation of a custom function for fitting in both combined spectrum and spaxel-by-spaxel. + new implamentation of error calculations for NIRSpec. 

10/10/22 -  i) Implementation of Hbeta velocity offset compared to [OIII] emission line.
            ii) Implementation of changing boundaries and initial conditions using a dictionary called priors.
            iii) Making a backup of KASHz fitting_tools used to fit KASHz sources.
            iv) Improvement to the speed of FeII template fitting. However, please pre-convolve the templates with FeII_comp.py

21/9/22 - More advanced support of the NIRSPEC IFU - both in Flambda and Fnu. Incorporating a JWST masking of bad pixels based on the error cube.

8/7/22 - Addition of Halpha outflow model. Addition of FeII template fitting in the [OIII] lines. Addition of Hbeta nar and BLR at the same time.

29/3/22 - Redshift is now fitted +-0.05 - done for safety reasons. Improved plotting of Hbeta and emission line/velocity maps

21/3/22 - Fixed bug in SNR_calc for non outflow [OIII] fit.

20/3/22 - Added fitting of narrow Hbeta, [SII] including SNR calc and Flux calculation. Fixed some type-2 Halpha plotting problems.

11/3/22 - Added support for mapping the emission - spaxel by spaxel fitting for the [OIII] emission. Currently fitting a single Gaussian profile - outflow detection and mapping will be done differently.

10/3/22 - Added function for calculating the fluxes. Some new support for fitting the maps using least dqaure fitting. However, it is now broken do not use.

```

`Qubespec/QubeSpec/Spaxel_fitting/Spaxel.py`:

```py
import tqdm
import os
import multiprocess as mp
from multiprocess import Pool
import numpy as np
from astropy.table import Table
import time
import warnings
import matplotlib.pyplot as plt 

from ..Fitting import Fitting

import pickle

import numba
from .. import Utils as sp


import time


class Halpha_OIII:
    def Spaxel_fitting(self, Cube,add='',Ncores=(mp.cpu_count() - 2),sampler='emcee',models='Single',priors= {'z':[0, 'normal', 0,0.003],\
                                                                                        'cont':[0,'loguniform',-4,1],\
                                                                                        'cont_grad':[0,'normal',0,0.3], \
                                                                                        'Hal_peak':[0,'loguniform',-4,1],\
                                                                                        'BLR_Hal_peak':[0,'loguniform',-4,1],\
                                                                                        'NII_peak':[0,'loguniform',-4,1],\
                                                                                        'Nar_fwhm':[300,'uniform',100,900],\
                                                                                        'BLR_fwhm':[4000,'uniform', 2000,9000],\
                                                                                        'zBLR':[0, 'normal', 0,0.003],\
                                                                                            'SIIr_peak':[0,'loguniform',-4,1],\
                                                                                            'SIIb_peak':[0,'loguniform',-4,1],\
                                                                                            'Hal_out_peak':[0,'loguniform',-4,1],\
                                                                                            'NII_out_peak':[0,'loguniform',-4,1],\
                                                                                            'outflow_fwhm':[600,'uniform', 300,1500],\
                                                                                            'outflow_vel':[-50,'normal', 0,300],\
                                                                                            'OIII_peak':[0,'loguniform',-4,1],\
                                                                                            'OIII_out_peak':[0,'loguniform',-4,1],\
                                                                                            'Hbeta_peak':[0,'loguniform',-4,1],\
                                                                                            'Hbeta_out_peak':[0,'loguniform',-4,1],\
                                                                                            'SIIr_peak':[0,'loguniform', -3,1],\
                                                                                            'SIIb_peak':[0,'loguniform', -3,1],\
                                                                                            'BLR_Hbeta_peak':[0,'loguniform', -3,1]}, **kwargs):
                                        
                                        
        """ Function to use to fit Spaxels. 

        Parameters
        ----------
    
        Cube : QubeSpec.Cube class instance
            Cube class from the main part of the QubeSpec. 

        models : str
            option - Single, BLR, BLR_simple, outflow_both, BLR_both

        add : str - optional
            add string to the name of the file to load and 

        Ncores : int - optional
            number of cpus to use to fit - default number of available cpu -1

        priors: dict - optional
            dictionary with all of the priors to update
            
        """                              
                                    
        import pickle
        start_time = time.time()
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_Unwrapped_cube'+add+'.txt', "rb") as fp:
            Unwrapped_cube= pickle.load(fp)

        print('import of the unwrap cube - done')

        self.priors = priors
        self.models = models
        self.sampler = sampler

        if Ncores<1:
            Ncores=1
        
        progress = kwargs.get('progress', True)
        progress = tqdm.tqdm if progress else lambda x, total=0: x

        with Pool(Ncores) as pool:
            cube_res = list(progress(
                pool.imap(
                    self.fit_spaxel, Unwrapped_cube),
                total=len(Unwrapped_cube)))

    

        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_Halpha_OIII'+add+'.txt', "wb") as fp:
            pickle.dump( cube_res,fp)

        print("--- Cube fitted in %s seconds ---" % (time.time() - start_time))
    
    def fit_spaxel(self, lst, progress=False):

        i,j,flx_spax_m, error, wave, z = lst

        if self.models=='Single':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_Halpha_OIII(model='gal' )
                Fits_sig.fitted_model = 0
                
                cube_res  = [i,j, Fits_sig]
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}]
                
        elif self.models=='BLR':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_Halpha_OIII(model='BLR' )
                Fits_sig.fitted_model = 0
                
                cube_res  = [i,j, Fits_sig]
                
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}]
                
        elif self.models=='BLR_simple':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_Halpha_OIII(model='BLR_simple' )
                Fits_sig.fitted_model = 0
                
                cube_res  = [i,j, Fits_sig]
                
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}]

        elif self.models=='outflow_both':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_Halpha_OIII(model='gal' )
                Fits_sig.fitted_model = 0
                
                Fits_out = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_out.fitting_Halpha_OIII(model='outflow' )
                Fits_out.fitted_model = 0
                
                cube_res  = [i,j,Fits_sig, Fits_out ]
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}, {'Failed fit':0}]
                print('Failed fit')
        
        elif self.models=='BLR_both':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_Halpha_OIII(model='BLR_simple' )
                Fits_sig.fitted_model = 0
                
                Fits_out = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_out.fitting_Halpha_OIII(model='BLR' )
                Fits_out.fitted_model = 0
                
                cube_res  = [i,j,Fits_sig, Fits_out ]
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}, {'Failed fit':0}]
                print('Failed fit')
                
        return cube_res

    
    def Spaxel_toptup(self, Cube, to_fit ,add='',models='Single',sampler='emcee', Ncores=(mp.cpu_count() - 2),priors= {'z':[0, 'normal', 0,0.003],\
                                                                                       'cont':[0,'loguniform',-4,1],\
                                                                                       'cont_grad':[0,'normal',0,0.3], \
                                                                                       'Hal_peak':[0,'loguniform',-4,1],\
                                                                                       'BLR_Hal_peak':[0,'loguniform',-4,1],\
                                                                                       'NII_peak':[0,'loguniform',-4,1],\
                                                                                       'Nar_fwhm':[300,'uniform',100,900],\
                                                                                       'BLR_fwhm':[4000,'uniform', 2000,9000],\
                                                                                       'zBLR':[0, 'normal', 0,0.003],\
                                                                                        'SIIr_peak':[0,'loguniform',-4,1],\
                                                                                        'SIIb_peak':[0,'loguniform',-4,1],\
                                                                                        'Hal_out_peak':[0,'loguniform',-4,1],\
                                                                                        'NII_out_peak':[0,'loguniform',-4,1],\
                                                                                        'outflow_fwhm':[600,'uniform', 300,1500],\
                                                                                        'outflow_vel':[-50,'normal', 0,300],\
                                                                                        'OIII_peak':[0,'loguniform',-4,1],\
                                                                                        'OIII_out_peak':[0,'loguniform',-4,1],\
                                                                                        'Hbeta_peak':[0,'loguniform',-4,1],\
                                                                                        'Hbeta_out_peak':[0,'loguniform',-4,1],\
                                                                                        'SIIr_peak':[0,'loguniform', -3,1],\
                                                                                        'SIIb_peak':[0,'loguniform', -3,1],\
                                                                                        'BLR_Hbeta_peak':[0,'loguniform', -3,1]}, **kwargs):
        import pickle
        self.models = models
        self.priors = priors
        start_time = time.time()
        self.sampler=sampler
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_Halpha_OIII'+add+'.txt', "rb") as fp:
            Cube_res= pickle.load(fp)
            
        print('import of the unwrap cube - done')
        yss = [res[0] for res in Cube_res]
        xss = [res[1] for res in Cube_res]   
        for j, to_fit_sig in enumerate(to_fit):
            print(to_fit_sig)
            use = np.where((np.array(xss)==to_fit_sig[0])& (np.array(yss)==to_fit_sig[1]))[0]
            if len(use)>0:
                use=use[0]
                if len(Cube_res[use])==3:
                    y,x, res = Cube_res[use]
                if len(Cube_res[use])==4:
                    y,x, res,res2 = Cube_res[use]
                
                lst = [y,x, res.fluxs, res.error, res.wave, Cube.z]
                
                Cube_res[use] = self.fit_spaxel(lst, progress=True)
                Fits_sig = Cube_res[use][2]
                f,ax = plt.subplots(1, figsize=(10,5))
                ax.plot(Fits_sig.wave, Fits_sig.flux, drawstyle='steps-mid')
                ax.plot(Fits_sig.wave, Fits_sig.yeval, 'r--')

                ax.text(Fits_sig.wave[10], 0.9*max(Fits_sig.yeval), 'x='+str(x)+', y='+str(y) )
       
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_Halpha_OIII'+add+'.txt', "wb") as fp:
            pickle.dump( Cube_res,fp)  
        
        print("--- Cube fitted in %s seconds ---" % (time.time() - start_time))


class OIII:
    def __init__(self):
        self.status = 'ok'

    def Spaxel_fitting(self, Cube,models='Single',add='',template=0,sampler='emcee', Ncores=(mp.cpu_count() - 1), priors= {'z':[0, 'normal', 0,0.003],\
                                                                                        'cont':[0,'loguniform',-4,1],\
                                                                                        'cont_grad':[0,'normal',0,0.3], \
                                                                                        'Nar_fwhm':[300,'uniform',100,900],\
                                                                                        'BLR_fwhm':[4000,'uniform', 2000,9000],\
                                                                                        'zBLR':[0, 'normal', 0,0.003],\
                                                                                            'outflow_fwhm':[600,'uniform', 300,1500],\
                                                                                            'outflow_vel':[-50,'normal', 0,300],\
                                                                                            'OIII_peak':[0,'loguniform',-4,1],\
                                                                                            'OIII_out_peak':[0,'loguniform',-4,1],\
                                                                                            'Hbeta_peak':[0,'loguniform',-4,1],\
                                                                                            'Hbeta_out_peak':[0,'loguniform',-4,1],\
                                                                                            'BLR_Hbeta_peak':[0,'loguniform', -4,1]}, **kwargs):

        """ Function to use to fit Spaxels. 

        Parameters
        ----------
    
        Cube : QubeSpec.Cube class instance
            Cube class from the main part of the QubeSpec. 

        models : str
            option - Single, BLR, BLR_simple, outflow_both, BLR_both

        add : str - optional
            add string to the name of the file to load and 

        Ncores : int - optional
            number of cpus to use to fit - default number of available cpu -1

        priors: dict - optional
            dictionary with all of the priors to update
            
        """
        import pickle
        start_time = time.time()
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_Unwrapped_cube'+add+'.txt', "rb") as fp:
            Unwrapped_cube= pickle.load(fp)

        print('import of the unwrap cube - done')

        self.priors = priors
        self.template = template
        self.models = models
        self.sampler = sampler

        if Ncores<1:
            Ncores=1
        
        progress = kwargs.get('progress', True)
        progress = tqdm.tqdm if progress else lambda x, total=0: x

        with Pool(Ncores) as pool:
            cube_res = list(progress(
                pool.imap(
                    self.fit_spaxel, Unwrapped_cube),
                total=len(Unwrapped_cube)))
                

        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_OIII'+add+'.txt', "wb") as fp:
            pickle.dump( cube_res,fp)

        print("--- Cube fitted in %s seconds ---" % (time.time() - start_time))

    def fit_spaxel(self, lst, progress=False):

        i,j,flx_spax_m, error, wave, z = lst

        if self.models=='Single':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_OIII(model='gal' )
                Fits_sig.fitted_model = 0
                
                cube_res  = [i,j, Fits_sig]
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}]
                
        elif self.models=='BLR':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_OIII(model='BLR' )
                Fits_sig.fitted_model = 0
                
                cube_res  = [i,j, Fits_sig]
                
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}]
                
        elif self.models=='BLR_simple':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_OIII(model='BLR_simple' )
                Fits_sig.fitted_model = 0
                
                cube_res  = [i,j, Fits_sig]
                
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}]

        elif self.models=='outflow_both':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_OIII(model='gal' )
                Fits_sig.fitted_model = 0
                
                Fits_out = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_out.fitting_OIII(model='outflow' )
                Fits_out.fitted_model = 0
                
                cube_res  = [i,j,Fits_sig, Fits_out ]
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}, {'Failed fit':0}]
                print('Failed fit')
        
        elif self.models=='BLR_both':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_OIII(model='BLR_simple' )
                Fits_sig.fitted_model = 0
                
                Fits_out = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_out.fitting_OIII(model='BLR' )
                Fits_out.fitted_model = 0
                
                cube_res  = [i,j,Fits_sig, Fits_out ]
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}, {'Failed fit':0}]
                print('Failed fit')
                
        return cube_res

    def Spaxel_toptup(self, Cube, to_fit ,add='', sampler='emcee', Ncores=(mp.cpu_count() - 2),models='Single',priors= {'z':[0, 'normal', 0,0.003],\
                                                                                       'cont':[0,'loguniform',-4,1],\
                                                                                       'cont_grad':[0,'normal',0,0.3], \
                                                                                       'Hal_peak':[0,'loguniform',-4,1],\
                                                                                       'BLR_Hal_peak':[0,'loguniform',-4,1],\
                                                                                       'NII_peak':[0,'loguniform',-4,1],\
                                                                                       'Nar_fwhm':[300,'uniform',100,900],\
                                                                                       'BLR_fwhm':[4000,'uniform', 2000,9000],\
                                                                                       'zBLR':[0, 'normal', 0,0.003],\
                                                                                        'SIIr_peak':[0,'loguniform',-4,1],\
                                                                                        'SIIb_peak':[0,'loguniform',-4,1],\
                                                                                        'Hal_out_peak':[0,'loguniform',-4,1],\
                                                                                        'NII_out_peak':[0,'loguniform',-4,1],\
                                                                                        'outflow_fwhm':[600,'uniform', 300,1500],\
                                                                                        'outflow_vel':[-50,'normal', 0,300],\
                                                                                        'OIII_peak':[0,'loguniform',-4,1],\
                                                                                        'OIII_out_peak':[0,'loguniform',-4,1],\
                                                                                        'Hbeta_peak':[0,'loguniform',-4,1],\
                                                                                        'Hbeta_out_peak':[0,'loguniform',-4,1],\
                                                                                        'SIIr_peak':[0,'loguniform', -3,1],\
                                                                                        'SIIb_peak':[0,'loguniform', -3,1],\
                                                                                        'BLR_Hbeta_peak':[0,'loguniform', -3,1]}, **kwargs):
        import pickle
        start_time = time.time()
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw'+add+'.txt', "rb") as fp:
            Cube_res= pickle.load(fp)
            
        print('import of the unwrap cube - done')
        
        for j, to_fit_sig in enumerate(to_fit):
            print(to_fit_sig)
            for i, row in enumerate(Cube_res):
                if len(row)==3:
                    y,x, res = row
                if len(row)==4:
                    y,x, res,res2 = row
                if to_fit_sig[0]==x and to_fit_sig[1]==y:
                    lst = [x,y, res.fluxs, res.error, res.wave, Cube.z]

                    Cube_res[i] = self.fit_spaxel(lst, progress=True)

                    Fits_sig = Cube_res[i][2]
                    f,ax = plt.subplots(1, figsize=(10,5))
                    ax.plot(Fits_sig.wave, Fits_sig.flux, drawstyle='steps-mid')
                    ax.plot(Fits_sig.wave, Fits_sig.yeval, 'r--')

                    ax.text(Fits_sig.wave[10], 0.9*max(Fits_sig.yeval), 'x='+str(x)+', y='+str(y) )

                    break
        
                
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_general'+add+'.txt', "wb") as fp:
            pickle.dump( Cube_res,fp)  
        
        print("--- Cube fitted in %s seconds ---" % (time.time() - start_time))
  
class Halpha:
    def __init__(self):
        self.status = 'ok'

    def Spaxel_fitting(self, Cube,models='Single',sampler='emcee', add='',Ncores=(mp.cpu_count() - 1),priors={'cont':[0,-4,1],\
                                                        'cont_grad':[0,-0.01,0.01], \
                                                        'Hal_peak':[0,-4,1],\
                                                        'BLR_peak':[0,-4,1],\
                                                        'NII_peak':[0,-4,1],\
                                                        'Nar_fwhm':[300,100,900],\
                                                        'BLR_fwhm':[4000,2000,9000],\
                                                        'zBLR':[-200,-900,600],\
                                                        'SIIr_peak':[0,-4,1],\
                                                        'SIIb_peak':[0,-4,1],\
                                                        'Hal_out_peak':[0,-4,1],\
                                                        'NII_out_peak':[0,-4,1],\
                                                        'outflow_fwhm':[600,300,1500],\
                                                        'outflow_vel':[-50, -300,300]}, **kwargs):
        
        """ Function to use to fit Spaxels. 

        Parameters
        ----------
    
        Cube : QubeSpec.Cube class instance
            Cube class from the main part of the QubeSpec. 

        models : str
            option - Single, BLR, BLR_simple, outflow_both, BLR_both

        add : str - optional
            add string to the name of the file to load and 

        Ncores : int - optional
            number of cpus to use to fit - default number of available cpu -1

        priors: dict - optional
            dictionary with all of the priors to update
            
        """
        import pickle
        start_time = time.time()
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_Unwrapped_cube'+add+'.txt', "rb") as fp:
            Unwrapped_cube= pickle.load(fp)

        print('import of the unwrap cube - done')

        self.priors = priors
        self.models = models
        self.sampler = sampler

        if Ncores<1:
            Ncores=1
        
        progress = kwargs.get('progress', True)
        progress = tqdm.tqdm if progress else lambda x, total=0: x

        with Pool(Ncores) as pool:
            cube_res = list(progress(
                pool.imap(
                    self.fit_spaxel, Unwrapped_cube),
                total=len(Unwrapped_cube)))

        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_Halpha'+add+'.txt', "wb") as fp:
            pickle.dump( cube_res,fp)

        print("--- Cube fitted in %s seconds ---" % (time.time() - start_time))

    def Spaxel_fitting_big(self, Cube,models='Single', sampler='emcee', add='',Ncores=(mp.cpu_count() - 1),priors={'cont':[0,-4,1],\
                                                        'cont_grad':[0,-0.01,0.01], \
                                                        'Hal_peak':[0,-4,1],\
                                                        'BLR_peak':[0,-4,1],\
                                                        'NII_peak':[0,-4,1],\
                                                        'Nar_fwhm':[300,100,900],\
                                                        'BLR_fwhm':[4000,2000,9000],\
                                                        'zBLR':[-200,-900,600],\
                                                        'SIIr_peak':[0,-4,1],\
                                                        'SIIb_peak':[0,-4,1],\
                                                        'Hal_out_peak':[0,-4,1],\
                                                        'NII_out_peak':[0,-4,1],\
                                                        'outflow_fwhm':[600,300,1500],\
                                                        'outflow_vel':[-50, -300,300]}, **kwargs):
        
        """ Function to use to fit Spaxels. 

        Parameters
        ----------
    
        Cube : QubeSpec.Cube class instance
            Cube class from the main part of the QubeSpec. 

        models : str
            option - Single, BLR, BLR_simple, outflow_both, BLR_both

        add : str - optional
            add string to the name of the file to load and 

        Ncores : int - optional
            number of cpus to use to fit - default number of available cpu -1

        priors: dict - optional
            dictionary with all of the priors to update
            
        """
        import pickle
        start_time = time.time()
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_Unwrapped_cube'+add+'.txt', "rb") as fp:
            Unwrapped_cube= pickle.load(fp)

        print('import of the unwrap cube - done')

        self.priors = priors
        self.models = models
        self.sampler = sampler

        if Ncores<1:
            Ncores=1
        
        progress = kwargs.get('progress', True)
        progress = tqdm.tqdm if progress else lambda x, total=0: x

        with Pool(Ncores) as pool:
            cube_res = list(progress(
                pool.imap(
                    self.fit_spaxel, Unwrapped_cube[:800]),
                total=len(Unwrapped_cube[:800])))

        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_Halpha'+add+'chunk1.txt', "wb") as fp:
            pickle.dump( cube_res,fp)
        
        with Pool(Ncores) as pool:
            cube_res = list(progress(
                pool.imap(
                    self.fit_spaxel, Unwrapped_cube[800:]),
                total=len(Unwrapped_cube[800:])))
        
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_Halpha'+add+'chunk2.txt', "wb") as fp:
            pickle.dump( cube_res,fp)

        print("--- Cube fitted in %s seconds ---" % (time.time() - start_time))
    def fit_spaxel(self, lst, progress=False):

        i,j,flx_spax_m, error, wave, z = lst

        if self.models=='Single':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_Halpha(model='gal' )
                Fits_sig.fitted_model = 0
                
                cube_res  = [i,j, Fits_sig]
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}]
                
        elif self.models=='BLR':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_Halpha(model='BLR' )
                Fits_sig.fitted_model = 0
                
                cube_res  = [i,j, Fits_sig]
                
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}]
                
        elif self.models=='BLR_simple':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_Halpha(model='BLR_simple' )
                Fits_sig.fitted_model = 0
                
                cube_res  = [i,j, Fits_sig]
                
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}]

        elif self.models=='outflow_both':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_Halpha(model='gal' )
                Fits_sig.fitted_model = 0
                
                Fits_out = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_out.fitting_Halpha(model='outflow' )
                Fits_out.fitted_model = 0
                
                cube_res  = [i,j,Fits_sig, Fits_out ]
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}, {'Failed fit':0}]
                print('Failed fit')
        
        elif self.models=='BLR_both':
            try:
                Fits_sig = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_sig.fitting_Halpha(model='BLR_simple' )
                Fits_sig.fitted_model = 0
                
                Fits_out = Fitting(wave, flx_spax_m, error, z,N=10000,progress=progress, priors=self.priors, sampler=self.sampler)
                Fits_out.fitting_Halpha(model='BLR' )
                Fits_out.fitted_model = 0
                
                cube_res  = [i,j,Fits_sig, Fits_out ]
            except Exception as _exc_:
                print(_exc_)
                cube_res = [i,j, {'Failed fit':0}, {'Failed fit':0}]
                print('Failed fit')
                
        return cube_res
    
    def Spaxel_toptup(self, Cube, to_fit ,add='', Ncores=(mp.cpu_count() - 2),sampler='emcee',models='Single',priors= {'z':[0, 'normal', 0,0.003],\
                                                                                       'cont':[0,'loguniform',-4,1],\
                                                                                       'cont_grad':[0,'normal',0,0.3], \
                                                                                       'Hal_peak':[0,'loguniform',-4,1],\
                                                                                       'BLR_Hal_peak':[0,'loguniform',-4,1],\
                                                                                       'NII_peak':[0,'loguniform',-4,1],\
                                                                                       'Nar_fwhm':[300,'uniform',100,900],\
                                                                                       'BLR_fwhm':[4000,'uniform', 2000,9000],\
                                                                                       'zBLR':[0, 'normal', 0,0.003],\
                                                                                        'SIIr_peak':[0,'loguniform',-4,1],\
                                                                                        'SIIb_peak':[0,'loguniform',-4,1],\
                                                                                        'Hal_out_peak':[0,'loguniform',-4,1],\
                                                                                        'NII_out_peak':[0,'loguniform',-4,1],\
                                                                                        'outflow_fwhm':[600,'uniform', 300,1500],\
                                                                                        'outflow_vel':[-50,'normal', 0,300],\
                                                                                        'OIII_peak':[0,'loguniform',-4,1],\
                                                                                        'OIII_out_peak':[0,'loguniform',-4,1],\
                                                                                        'Hbeta_peak':[0,'loguniform',-4,1],\
                                                                                        'Hbeta_out_peak':[0,'loguniform',-4,1],\
                                                                                        'SIIr_peak':[0,'loguniform', -3,1],\
                                                                                        'SIIb_peak':[0,'loguniform', -3,1],\
                                                                                        'BLR_Hbeta_peak':[0,'loguniform', -3,1]}, **kwargs):
        import pickle
        start_time = time.time()
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw'+add+'.txt', "rb") as fp:
            Cube_res= pickle.load(fp)
        self.sampler= sampler
            
        print('import of the unwrap cube - done')
        
        for j, to_fit_sig in enumerate(to_fit):
            print(to_fit_sig)
            for i, row in enumerate(Cube_res):
                if len(row)==3:
                    y,x, res = row
                if len(row)==4:
                    y,x, res,res2 = row
                if to_fit_sig[0]==x and to_fit_sig[1]==y:
                    lst = [y,x, res.fluxs, res.error, res.wave, Cube.z]

                    Cube_res[i] = self.fit_spaxel(lst, progress=True)

                    Fits_sig = Cube_res[i][2]
                    f,ax = plt.subplots(1, figsize=(10,5))
                    ax.plot(Fits_sig.wave, Fits_sig.flux, drawstyle='steps-mid')
                    ax.plot(Fits_sig.wave, Fits_sig.yeval, 'r--')

                    ax.text(Fits_sig.wave[10], 0.9*max(Fits_sig.yeval), 'x='+str(x)+', y='+str(y) )

                    break
        
                
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_general'+add+'.txt', "wb") as fp:
            pickle.dump( Cube_res,fp)  
        
        print("--- Cube fitted in %s seconds ---" % (time.time() - start_time))
       

class general:
    def __init__(self):
        self.status = 'ok'

    def Spaxel_fitting(self, Cube,fitted_model, labels, priors, logprior,sampler='emcee', nwalkers=64,use=np.array([]), N=10000, add='',add_save='',Ncores=(mp.cpu_count() - 2), **kwargs):
        """ Function to use to fit Spaxels. 

        Parameters
        ----------
    
        Cube : QubeSpec.Cube class instance
            Cube class from the main part of the QubeSpec. 

        fitted_model : callable
            Function to fit

        labels : list
            list of the name of the paramters in the same order as in the fitted_function

        priors: dict - optional
            dictionary with all of the priors to update
        
        logprior: callable function
            logprior evaluation function - use emfit.logprior_general or emfit.logprior_general_scipy
        
        nwalkers : int - optional
            default 64 walkers for the MCMC

        add : str - optional
            add string to the name of the file to load and 

        Ncores : int - optional
            number of cpus to use to fit - default number of available cpu -1
            
        """
        import pickle
        start_time = time.time()
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_Unwrapped_cube'+add+'.txt', "rb") as fp:
            Unwrapped_cube= pickle.load(fp)
            
        print('import of the unwrap cube - done')
        
        self.priors= priors
        self.fitted_model = fitted_model
        self.labels = labels
        self.logprior = logprior
        self.nwalkers = nwalkers
        self.use = use
        self.N = N  
        self.sampler = sampler    
        
        if Ncores<1:
            Ncores=1
        
        progress = kwargs.get('progress', True)
        progress = tqdm.tqdm if progress else lambda x, total=0: x
        debug = kwargs.get('debug', False)
        if debug:
            warnings.warn(
                '\u001b[5;33mDebug mode - no multiprocessing!\033[0;0m',
                UserWarning)
            cube_res = list(progress(
                self.fit_spaxel, Unwrapped_cube),
                    total=len(Unwrapped_cube))
        else:
            with Pool(Ncores) as pool:
                cube_res = list(progress(
                    pool.imap(
                        self.fit_spaxel, Unwrapped_cube),
                    total=len(Unwrapped_cube)))
                
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_general'+add+add_save+'.txt', "wb") as fp:
            pickle.dump( cube_res,fp)  
        
        print("--- Cube fitted in %s seconds ---" % (time.time() - start_time))


    def Spaxel_topup(self, Cube, to_fit ,fitted_model, labels, priors, logprior, nwalkers=64,use=np.array([]), N=10000, add='',add_save='',Ncores=(mp.cpu_count() - 2), **kwargs):
        import pickle
        start_time = time.time()
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_general'+add+'.txt', "rb") as fp:
            Cube_res= pickle.load(fp)
            
        print('import of the unwrap cube - done')
        
        self.priors= priors
        self.fitted_model = fitted_model
        self.labels = labels
        self.logprior = logprior
        self.nwalkers = nwalkers
        self.use = use
        self.N = N     

        yss = [res[0] for res in Cube_res]
        xss = [res[1] for res in Cube_res]   
        for j, to_fit_sig in enumerate(to_fit):
            print(to_fit_sig)
            use = np.where((np.array(xss)==to_fit_sig[0])& (np.array(yss)==to_fit_sig[1]))[0]
            if len(use)>0:
                use=use[0]
                if len(Cube_res[use])==3:
                    y,x, res = Cube_res[use]
                lst = [y,x, res.fluxs, res.error, res.wave, Cube.z]
                
                Cube_res[use] = self.fit_spaxel(lst, progress=True)
                Fits_sig = Cube_res[use][2]
                f,ax = plt.subplots(1, figsize=(10,5))
                ax.plot(Fits_sig.wave, Fits_sig.flux, drawstyle='steps-mid')
                ax.plot(Fits_sig.wave, Fits_sig.yeval, 'r--')

                ax.text(Fits_sig.wave[10], 0.9*max(Fits_sig.yeval), 'x='+str(x)+', y='+str(y) )
                
        with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_general'+add+add_save+'.txt', "wb") as fp:
            pickle.dump( Cube_res,fp)  
        
        print("--- Cube fitted in %s seconds ---" % (time.time() - start_time))
    
    def fit_spaxel(self, lst, progress=False):

        i,j,flx_spax_m, error, wave, z = lst
        

        if len(self.use)==0:
            self.use = np.linspace(0, len(wave)-1, len(wave), dtype=int)

        try:
            Fits_sig = Fitting(wave[self.use], flx_spax_m[self.use], error[self.use], z,N=self.N,progress=progress, priors=self.priors, sampler=self.sampler)
            Fits_sig.fitting_general(self.fitted_model, self.labels, self.logprior, nwalkers=self.nwalkers)
            Fits_sig.fitted_model = 0
        
                
            cube_res  = [i,j,Fits_sig ]
        except Exception as _exc_:
            print(_exc_)
            cube_res = [i,j, {'Failed fit':0}, {'Failed fit':0}]
            print('Failed fit')
        
        return cube_res

def Spaxel_ppxf(Cube, ncpu=2):
    import glob
    import yaml
    from yaml.loader import SafeLoader

    # Open the file and load the file
    with open('/Users/jansen/My Drive/MyPython/Qubespec/QubeSpec/jadify_temp/r100_jades_deep_hst_v3.1.1_template.yaml') as f:
        data = yaml.load(f, Loader=SafeLoader)

    data['dirs']['data_dir'] = Cube.savepath+'PRISM_spaxel/'
    data['dirs']['output_dir'] = Cube.savepath+'PRISM_spaxel/'
    data['ppxf']['redshift_table'] = Cube.savepath+'PRISM_1D/redshift_1D.csv'

    with open(Cube.savepath+'/PRISM_spaxel/R100_1D_setup_test.yaml', 'w') as f:
        data = yaml.dump(data, f, sort_keys=False, default_flow_style=True)
    from . import jadify_temp as pth
    PATH_TO_jadify = pth.__path__[0]+ '/'
    filename = PATH_TO_jadify+ 'red_table_template.csv'
    redshift_cat = Table.read(filename)
    
    files = glob.glob(Cube.savepath+'PRISM_spaxel/prism_clear/*.fits')
    
    IDs= np.array([], dtype=int)
    for i, file in enumerate(files):
        comp = file.split('/')
        IDs = np.append( IDs, int(comp[-1][:6]))
    redshift_cat_mod = Table()
    redshift_cat_mod['ID'] = IDs
    redshift_cat_mod['z_visinsp'] = np.ones_like(len(IDs))*Cube.z
    redshift_cat_mod['z_phot'] = np.ones_like(len(IDs))*Cube.z
    redshift_cat_mod['z_bagp'] = np.ones_like(len(IDs))*Cube.z
    redshift_cat_mod['flag'] = np.zeros_like(IDs, dtype='<U6')
    redshift_cat_mod['flag'][:] = redshift_cat['flag'][0]
    redshift_cat_mod.write(Cube.savepath+'PRISM_spaxel/redshift_spaxel.csv',overwrite=True)
    
    import nirspecxf
    config100 = nirspecxf.NIRSpecConfig(Cube.savepath+'PRISM_spaxel/R100_1D_setup_manual.yaml')
    #xid = IDs[3]
    #ns, _ = nirspecxf.process_object_id(id, config100)
    nirspecxf.process_multi(ncpu, IDs, config100)
    #for i, id in enumerate(IDs):
    #    print(i)
    #    ns, _ = nirspecxf.process_object_id(id, config100)
    print('Fitting done, merging results')
    nirspecxf.data_prods.merge_em_lines_tables(
        Cube.savepath+'PRISM_spaxel/res/*R100_em_lines.fits',
        Cube.savepath+'PRISM_spaxel/spaxel_R100_ppxf_emlines.fits')
```

`Qubespec/QubeSpec/Spaxel_fitting/__init__.py`:

```py
from .Spaxel import *
```

`Qubespec/QubeSpec/Utils/Support.py`:

```py
"""
@author: jansen
"""

#importing modules
import numpy as np
import matplotlib.pyplot as plt; plt.ioff()

from astropy.io import fits as pyfits
from astropy import wcs
from astropy.table import Table, join, vstack
from matplotlib.backends.backend_pdf import PdfPages
import pickle
from scipy.optimize import curve_fit
import astropy.units as u 

nan= float('nan')

pi= np.pi
e= np.e

plt.close('all')
c= 3.*10**8
h= 6.62*10**-34
k= 1.38*10**-23

Ken98= (4.5*10**-44)
Conversion2Chabrier=1.7 # Also Madau
Calzetti12= 2.8*10**-44
arrow = u'$\u2193$' 


OIIIr = 5008.24
OIIIb = 4960.3
Hal = 6564.52
NII_r = 6585.27
NII_b = 6549.86
Hbe = 4862.6

SII_r = 6731
SII_b = 6718.29

from astropy.modeling.powerlaws import PowerLaw1D

def gauss(x, k, mu,FWHM):
    sig = FWHM/3e5*mu/2.35482
    expo= -((x-mu)**2)/(2*sig*sig)

    y= k* e**expo

    return y

def find_nearest(array, value):
    """
    Find the index of the element in an array that is closest to a given value.

    Parameters:
        array (array-like): The input array.
        value (float or int): The value to find the closest element to.

    Returns:
        int: The index of the element in the array that is closest to the given value.

    Example:
        >>> array = [1, 2, 3, 4, 5]
        >>> value = 3.7
        >>> find_nearest(array, value)
        3
    """
    array = np.asarray(array)
    idx = (np.abs(array - value)).argmin()
    return idx

def create_circular_mask(h, w, center=None, radius=None):
    """ Creates a circular mask input - size of the array (height, width), optional center of the circular
    aperture and the radius in pixels
	
	"""

    if center is None: # use the middle of the image
        center = [int(w/2), int(h/2)]
    if radius is None: # use the smallest distance between the center and image walls
        radius = min(center[0], center[1], w-center[0], h-center[1])

    Y, X = np.ogrid[:h, :w]
    dist_from_center = np.sqrt((X - center[0])**2 + (Y-center[1])**2)

    mask = dist_from_center <= radius

    return mask

def error_calc(array):
    """ calculates, 50th, 16th and 84 percintile of an array
	
	"""
    p50,p16,p84 = np.percentile(array, (50,16,84))
    p16 = p50-p16
    p84 = p84-p50
    
    return p50, p16,p84

def conf(aray):
    """ Legacy - old version of finding 16th and 84th percintile
	
	"""
    
    sorted_array= np.array(sorted(aray))
    leng= (float(len(aray))/100)*16
    leng= int(leng)
    
    
    hgh = sorted_array[-leng]
    low = sorted_array[leng]
    
    return low, hgh

def twoD_Gaussian(dm, amplitude, xo, yo, sigma_x, sigma_y, theta, offset): 
    """ 2D Gaussian array used to find center of emission 
	
	"""
    x, y = dm
    xo = float(xo)
    yo = float(yo)    
    a = (np.cos(theta)**2)/(2*sigma_x**2) + (np.sin(theta)**2)/(2*sigma_y**2)
    b = -(np.sin(2*theta))/(4*sigma_x**2) + (np.sin(2*theta))/(4*sigma_y**2)
    c = (np.sin(theta)**2)/(2*sigma_x**2) + (np.cos(theta)**2)/(2*sigma_y**2)
    g = offset + amplitude*np.exp( - (a*((x-xo)**2) + 2*b*(x-xo)*(y-yo) 
                            + c*((y-yo)**2)))
    return g.ravel()

def smooth(image,sm):
    """ Gaussian 2D smoothning for maps
	
	"""
    from astropy.convolution import Gaussian2DKernel
    from scipy.signal import convolve as scipy_convolve
    from astropy.convolution import convolve
    
    gauss_kernel = Gaussian2DKernel(sm)

    con_im = convolve(image, gauss_kernel)
    
    #con_im = con_im#*image/image
    
    return con_im  

def prop_calc(results): 
    """ Legacy - Now part of Fitting class.  Take the dictionary with the results chains and calculates the values 
    and 1 sigma confidence interval
	
	"""
    labels = list(results.keys())[1:]
    res_plt = []
    res_dict = {'name': results['name']}
    for lbl in labels:
        
        array = results[lbl]
        
        p50,p16,p84 = np.percentile(array, (50,16,84))
        p16 = p50-p16
        p84 = p84-p50
        
        res_plt.append(p50)
        res_dict[lbl] = np.array([p50,p16,p84])
        
    res_dict['popt'] = res_plt
    return res_dict
        

def SNR_calc(wave,flux, error, dictsol, mode, wv_cent=5008, peak_name='', fwhm_name='', lsf=0):
    """ Calculates the SNR of a line
    wave - observed wavelength
    flux - flux of the spectrum
    error - error on the spectrum
    dictsol - spectral fitting results in dictionary form 
    mode - which emission line do you want to caluclate the SNR for: OIII, Hn, Hblr, NII,
           Hb, SII
	
	"""
    sol = dictsol['popt']
    wave = wave[np.invert(flux.mask)]
    flux = flux.data[np.invert(flux.mask)]
    keys = list(dictsol.keys())
    
    if mode=='general':
        center = wv_cent*(1+dictsol['z'][0])/1e4
        fwhm = (dictsol[fwhm_name][0]**2 + lsf**2)**0.5
        contfce = PowerLaw1D.evaluate(wave, sol[1],center, alpha=sol[2])
        model = gauss(wave, dictsol[peak_name][0],center, fwhm)
    elif mode =='OIII':
        center = OIIIr*(1+sol[0])/1e4
        if 'outflow_fwhm' in keys:
            fwhms = sol[5]/3e5*center
            fwhm = dictsol['outflow_fwhm'][0]
            
            center = OIIIr*(1+sol[0])/1e4
            centerw = OIIIr*(1+sol[0])/1e4 + sol[7]/3e5*center
            
            contfce = PowerLaw1D.evaluate(wave, sol[1],center, alpha=sol[2])
            model = flux-contfce 
        elif 'Nar_fwhm' in keys:
            fwhm = dictsol['Nar_fwhm'][0]
            
            center = OIIIr*(1+sol[0])/1e4
            
            contfce = PowerLaw1D.evaluate(wave, sol[1],center, alpha=sol[2])
            model = flux-contfce 
        else:   
            fwhm = sol[4]/3e5*center
            model = flux- PowerLaw1D.evaluate(wave,sol[1],center, alpha=sol[2])        
            
    elif mode =='Hn':
        center = Hal*(1+sol[0])/1e4

        fwhm = dictsol['Nar_fwhm'][0]
        model = gauss(wave, dictsol['Hal_peak'][0], center, fwhm)
    
    elif mode =='Hblr':
        center = Hal*(1+sol[0])/1e4
        
        fwhm = sol[7]/3e5*center
        model = gauss(wave, sol[4], center, fwhm/2.35)
            
    elif mode =='NII':
        center = NII_r*(1+sol[0])/1e4
        fwhm = dictsol['Nar_fwhm'][0]
        model = gauss(wave, dictsol['NII_peak'][0], center, fwhm)
    
    elif mode =='Hb':
        center = Hbe*(1+sol[0])/1e4
        if 'Hbetan_fwhm' in keys:
            fwhm = dictsol['Hbetan_fwhm'][0]
            model = gauss(wave, dictsol['Hbetan_peak'][0], center, fwhm)
        elif 'Nar_fwhm' in keys:
            fwhm = dictsol['Nar_fwhm'][0]
            model = gauss(wave, dictsol['Hbeta_peak'][0], center, fwhm)
        else:
            fwhm = dictsol['Hbeta_fwhm'][0]
            model = gauss(wave, dictsol['Hbeta_peak'][0], center, fwhm)
    
    elif mode =='SII':
        center = SII_r*(1+sol[0])/1e4
        
        fwhm = dictsol['Nar_fwhm'][0]
        try:
            model_r = gauss(wave, dictsol['SIIr_peak'][0], center, fwhm) 
            model_b = gauss(wave, dictsol['SIIb_peak'][0], center, fwhm) 
        except:
            model_r = gauss(wave, dictsol['SIIr_peak'][0], center, fwhm) 
            model_b = gauss(wave, dictsol['SIIb_peak'][0], center, fwhm) 
        
        model = model_r + model_b
        
        center = 6724*(1+sol[0])/1e4
        fwhm = fwhm/3e5*center
        use = np.where((wave< center+fwhm*1)&(wave> center-fwhm*1))[0]   
        flux_l = model[use]
        std = error[use]
        
        n = len(use)
        SNR = np.nansum(flux_l)/np.sqrt(np.nansum(std**2))
        
        if SNR < 0:
            SNR=0
        
        return SNR
    
    else:
        raise Exception('Sorry mode in SNR_calc not understood')
    fwhm = fwhm/3e5*center
    use = np.where((wave< center+fwhm*1)&(wave> center-fwhm*1))[0] 
    flux_l = model[use]
    std = error[use]
    
    n = len(use)
    SNR =np.nansum(flux_l)/np.sqrt(np.nansum(std**2))
    if SNR < 0:
        SNR=0
    
    return SNR  

def SNR_calc_obj(obj_fit, mode, wv_cent=5008, peak_name='', fwhm_name='', lsf=0):
    """ Calculates the SNR of a line
    wave - observed wavelength
    flux - flux of the spectrum
    error - error on the spectrum
    dictsol - spectral fitting results in dictionary form 
    mode - which emission line do you want to caluclate the SNR for: OIII, Hn, Hblr, NII,
           Hb, SII
	
	"""
    dictsol = obj_fit.props
    wave = obj_fit.wave_fitloc
    flux = obj_fit.flux_fitloc
    error = obj_fit.error_fitloc

    keys = list(dictsol.keys())

    sol = dictsol['popt']
    
    
    if mode=='general':
        center = wv_cent*(1+dictsol['z'][0])/1e4
        fwhm = (dictsol[fwhm_name][0]**2 + lsf**2)**0.5
        contfce = PowerLaw1D.evaluate(wave, sol[1],center, alpha=sol[2])
        model = gauss(wave, dictsol[peak_name][0],center, fwhm)
    elif mode =='OIII':
        center = OIIIr*(1+sol[0])/1e4
        if 'outflow_fwhm' in keys:
            fwhms = sol[5]/3e5*center
            fwhm = dictsol['outflow_fwhm'][0]
            
            center = OIIIr*(1+sol[0])/1e4
            centerw = OIIIr*(1+sol[0])/1e4 + sol[7]/3e5*center
            
            contfce = PowerLaw1D.evaluate(wave, sol[1],center, alpha=sol[2])
            model = flux-contfce 
        elif 'Nar_fwhm' in keys:
            fwhm = dictsol['Nar_fwhm'][0]
            
            center = OIIIr*(1+sol[0])/1e4
            
            contfce = PowerLaw1D.evaluate(wave, sol[1],center, alpha=sol[2])
            model = flux-contfce 
        else:   
            fwhm = sol[4]/3e5*center
            model = flux- PowerLaw1D.evaluate(wave,sol[1],center, alpha=sol[2])        
            
    elif mode =='Hn':
        center = Hal*(1+sol[0])/1e4

        fwhm = dictsol['Nar_fwhm'][0]
        model = gauss(wave, dictsol['Hal_peak'][0], center, fwhm)
    
    elif mode =='Hblr':
        center = Hal*(1+sol[0])/1e4
        
        fwhm = sol[7]/3e5*center
        model = gauss(wave, sol[4], center, fwhm/2.35)
            
    elif mode =='NII':
        center = NII_r*(1+sol[0])/1e4
        fwhm = dictsol['Nar_fwhm'][0]
        model = gauss(wave, dictsol['NII_peak'][0], center, fwhm)
    
    elif mode =='Hb':
        center = Hbe*(1+sol[0])/1e4
        if 'Hbetan_fwhm' in keys:
            fwhm = dictsol['Hbetan_fwhm'][0]
            model = gauss(wave, dictsol['Hbetan_peak'][0], center, fwhm)
        elif 'Nar_fwhm' in keys:
            fwhm = dictsol['Nar_fwhm'][0]
            model = gauss(wave, dictsol['Hbeta_peak'][0], center, fwhm)
        else:
            fwhm = dictsol['Hbeta_fwhm'][0]
            model = gauss(wave, dictsol['Hbeta_peak'][0], center, fwhm)
    
    elif mode =='SII':
        center = SII_r*(1+sol[0])/1e4
        
        fwhm = dictsol['Nar_fwhm'][0]
        try:
            model_r = gauss(wave, dictsol['SIIr_peak'][0], center, fwhm) 
            model_b = gauss(wave, dictsol['SIIb_peak'][0], center, fwhm) 
        except:
            model_r = gauss(wave, dictsol['SIIr_peak'][0], center, fwhm) 
            model_b = gauss(wave, dictsol['SIIb_peak'][0], center, fwhm) 
        
        model = model_r + model_b
        
        center = 6724*(1+sol[0])/1e4
        fwhm = fwhm/3e5*center
        use = np.where((wave< center+fwhm*1)&(wave> center-fwhm*1))[0]   
        flux_l = model[use]
        std = error[use]
        
        n = len(use)
        SNR = np.nansum(flux_l)/np.sqrt(np.nansum(std**2))
        
        if SNR < 0:
            SNR=0
        
        return SNR
    
    else:
        raise Exception('Sorry mode in SNR_calc not understood')
    fwhm = fwhm/3e5*center
    use = np.where((wave< center+fwhm*1)&(wave> center-fwhm*1))[0] 
    flux_l = model[use]
    std = error[use]
    
    n = len(use)
    SNR =np.nansum(flux_l)/np.sqrt(np.nansum(std**2))
    if SNR < 0:
        SNR=0
    
    return SNR  

def BIC_calc(wave,fluxm,error, model, results, mode, template=0):
    """ calculates BIC
	
	"""
    popt = results['popt']
    z= popt[0]
    
    if mode=='OIII':
        
        flux = fluxm.data[np.invert(fluxm.mask)]
        wave = wave[np.invert(fluxm.mask)]
        error = error[np.invert(fluxm.mask)]
        
        fit_loc = np.where((wave>4800*(1+z)/1e4)&(wave<5100*(1+z)/1e4))[0]
        
        flux = flux[fit_loc]
        wave = wave[fit_loc]
        error = error[fit_loc]
        
        if template==0:
            y_model = model(wave, *popt)
        else:
            y_model = model(wave, *popt, template)
        chi2 = np.nansum(((flux-y_model)/error)**2)
        BIC = chi2+ len(popt)*np.log(len(flux))
    
    if mode=='Halpha':
        
        flux = fluxm.data[np.invert(fluxm.mask)]
        wave = wave[np.invert(fluxm.mask)]
        error = error[np.invert(fluxm.mask)]
        
        fit_loc = np.where((wave>(6564.52-200)*(1+z)/1e4)&(wave<(6564.52+300)*(1+z)/1e4))[0]
        
        flux = flux[fit_loc]
        wave = wave[fit_loc]
        error = error[fit_loc]
        
        y_model = model(wave, *popt)
        chi2 = np.nansum(((flux-y_model)/error)**2)
        BIC = chi2+ len(popt)*np.log(len(flux))
    
    if mode=='Halpha_OIII':
        fit_loc = np.where((wave>4700*(1+z)/1e4)&(wave<5100*(1+z)/1e4))[0]
        fit_loc = np.append(fit_loc, np.where((wave>(6300-50)*(1+z)/1e4)&(wave<(6300+50)*(1+z)/1e4))[0])
        fit_loc = np.append(fit_loc, np.where((wave>(6564.52-170)*(1+z)/1e4)&(wave<(6564.52+170)*(1+z)/1e4))[0])
        
        flux = fluxm.data[np.invert(fluxm.mask)]
        wave = wave[np.invert(fluxm.mask)]
        error = error[np.invert(fluxm.mask)]
        
        fit_loc = np.where((wave>(6564.52-200)*(1+z)/1e4)&(wave<(6564.52+300)*(1+z)/1e4))[0]
        
        flux = flux[fit_loc]
        wave = wave[fit_loc]
        error = error[fit_loc]
        
        y_model = model(wave, *popt)
        chi2 = np.nansum(((flux-y_model)/error)**2)
        BIC = chi2+ len(popt)*np.log(len(flux))
       
    return chi2, BIC

def unwrap_chain(res):
    """
    Unwraps a dictionary of chains into a 2D numpy array.

    Parameters:
    - res (dict): A dictionary containing chains as values, where each chain is a 1D numpy array.

    Returns:
    - chains (ndarray): A 2D numpy array where each column represents a chain from the input dictionary.

    Example:
    >>> res = {'chain1': np.array([1, 2, 3]), 'chain2': np.array([4, 5, 6])}
    >>> unwrap_chain(res)
    array([[1., 4.],
        [2., 5.],
        [3., 6.]])
    """
    keys = list(res.keys())[1:]  
    chains = np.zeros(( len(res[keys[0]]), len(keys) ))  
    for i in range(len(keys)):  
        chains[:,i] = res[keys[i]]    
    return chains

def QFitsview_mask(filepath):
    mask_load = pyfits.getdata(filepath)
    mask = ~mask_load
    mask[mask==-1] = 1
    mask[mask==-2] = 0
    return mask

def flux_calc_general(wv_cent, res, fwhm_name, peak_name, lsf=0):
    """
    Calculate the flux using the general formula.

    Parameters:
        wv_cent (float): The central wavelength.
        res (dict): A dictionary containing the necessary parameters.
        fwhm_name (str): The name of the key in the 'res' dictionary that corresponds to the full width at half maximum (FWHM).
        peak_name (str): The name of the key in the 'res' dictionary that corresponds to the peak value.

    Returns:
        float: The calculated flux.

    """
    mu = wv_cent*(1+res['z'][0])/1e4
    if type(fwhm_name)==str:
        FWHM = (res[fwhm_name][0]**2+ lsf**2)**0.5
    else: 
        FWHM = (fwhm_name**2+ lsf**2)**0.5
    a = 1./(2*(FWHM/3e5*mu/2.35482)**2)
    return res[peak_name][0]*np.sqrt(np.pi/a)


def flux_calc(res, mode, norm=1e-13, wv_cent=5008, peak_name='', fwhm_name='', ratio_name='', lsf=0):
    """
    Calculate the flux for different emission lines based on the given parameters.

    Parameters:
        res (dict): A dictionary containing the necessary parameters.
        mode (str): The mode of calculation. Possible values are:
            - 'general': Calculate the flux using the general formula.
            - 'OIIIt': Calculate the flux for OIII emission line with outflow component.
            - 'OIIIn': Calculate the flux for OIII emission line without outflow component.
            - 'OIIIw': Calculate the flux for the outflow component of OIII emission line.
            - 'Hat': Calculate the flux for Halpha emission line with outflow component.
            - 'Han': Calculate the flux for Halpha emission line without outflow component.
            - 'Hal_BLR': Calculate the flux for the broad line region (BLR) component of Halpha emission line.
            - 'NIIt': Calculate the flux for NII emission line with outflow component.
            - 'NII': Calculate the flux for NII emission line without outflow component.
            - 'NIIo': Calculate the flux for the outflow component of NII emission line.
            - 'Hbeta': Calculate the flux for Hbeta emission line.
            - 'Hbe_BLR': Calculate the flux for the broad line region (BLR) component of Hbeta emission line.
            - 'Hbetaw': Calculate the flux for the wing component of Hbeta emission line.
            - 'Hbetan': Calculate the flux for the narrow component of Hbeta emission line.
            - 'SIIr': Calculate the flux for SII red emission line.
            - 'SIIb': Calculate the flux for SII blue emission line.
        norm (float, optional): The normalization factor for the calculated flux. Default is 1e-13.
        wv_cent (float, optional): The central wavelength for the calculation. Default is 5008.
        peak_name (str, optional): The name of the key in the 'res' dictionary that corresponds to the peak value. Required for 'general', 'OIIIt', 'OIIIn', 'OIIIw', 'Hat', 'Han', 'Hal_BLR', 'NIIt', 'NII', 'NIIo', 'Hbeta', 'Hbe_BLR', 'Hbetaw', 'Hbetan' modes.
        fwhm_name (str, optional): The name of the key in the 'res' dictionary that corresponds to the full width at half maximum (FWHM). Required for 'general', 'OIIIt', 'OIIIn', 'OIIIw', 'Hat', 'Han', 'Hal_BLR', 'NIIt', 'NII', 'NIIo', 'Hbeta', 'Hbe_BLR', 'Hbetaw', 'Hbetan' modes.
        ratio_name (str, optional): The name of the key in the 'res' dictionary that corresponds to the ratio value. Required for 'general' mode.

    Returns:
        float: The calculated flux.

    Raises:
        Exception: If the mode is not understood.

    """
    keys = list(res.keys())
    
    if mode=='general':
        if ratio_name=='':
            ratio=1
        else:
            ratio=res[ratio_name][0]
        flx =  ratio*flux_calc_general(wv_cent, res, fwhm_name, peak_name, lsf=lsf)
        return flx*norm
    
    elif mode=='OIIIt':
        flx =  flux_calc_general(OIIIr, res, 'Nar_fwhm', 'OIII_peak', lsf=lsf)
        if 'OIII_out_peak' in keys:  
            flx +=  flux_calc_general(OIIIr, res, 'outflow_fwhm', 'OIII_out_peak', lsf=lsf)      
        return flx*norm
            
            
    elif mode=='OIIIn':
        flx =  flux_calc_general(OIIIr, res, 'Nar_fwhm', 'OIII_peak', lsf=lsf)
        return flx*norm
        
    elif mode=='OIIIw':
        if 'OIII_out_peak' in keys:
            flx =  flux_calc_general(OIIIr, res, 'outflow_fwhm', 'OIII_out_peak', lsf=lsf)  
            return flx*norm
        else:
            return 0
    
    elif mode=='Hat':
        flx =  flux_calc_general(Hal, res, 'Nar_fwhm', 'Hal_peak', lsf=lsf)
        if 'outflow_fwhm' in list(res.keys()):
            flx +=  flux_calc_general(Hal, res, 'outflow_fwhm', 'Hal_out_peak', lsf=lsf)
        return flx*norm
    
    elif mode=='Han':
        flx = flux_calc_general(Hal, res, 'Nar_fwhm', 'Hal_peak', lsf=lsf)
        return flx*norm

    elif mode=='Haw':
        flx = flux_calc_general(Hal, res, 'Nar_fwhm', 'Hal_out_peak', lsf=lsf)
        return flx*norm
        
    elif mode=='Hal_BLR':
        if 'BLR_fwhm' in keys:
            flx = flux_calc_general(Hal, res, 'BLR_fwhm', 'BLR_Hal_peak', lsf=lsf)
            return flx*norm
            
        elif 'BLR_alp1' in keys:
            from ..Models.QSO_models import BKPLG
            wave = np.linspace(6300,6700,700)*(1+res['z'][0])/1e4
            model = BKPLG(wave, res['BLR_peak'][0], Hal*(1+res['z'][0])/1e4, res['BLR_sig'][0], res['BLR_alp1'][0], res['BLR_alp2'][0])
            
        else:
            return 0
    
    elif mode=='NIIt':
        flx = flux_calc_general(NII_r, res, 'Nar_fwhm', 'NII_peak', lsf=lsf)
        
        if 'outflow_fwhm' in list(res.keys()):
            flx +=  flux_calc_general(NII_r, res, 'outflow_fwhm', 'NII_out_peak', lsf=lsf)
        return flx*norm
    
    elif mode=='NII':
        flx = flux_calc_general(NII_r, res, 'Nar_fwhm', 'NII_peak', lsf=lsf)
        return flx*norm
              
    elif mode=='NIIo':
        flx = flux_calc_general(NII_r, res, 'outflow_fwhm', 'NII_out_peak', lsf=lsf)
        return flx*norm
        
    elif mode=='Hbeta':     
        try:
            flx = flux_calc_general(Hbe, res, 'Nar_fwhm', 'Hbeta_peak', lsf=lsf)
        except:
            flx = flux_calc_general(Hbe, res, 'Hbeta_fwhm', 'Hbeta_peak', lsf=lsf)
        return flx*norm
    
    elif mode=='Hbe_BLR':
        if 'BLR_fwhm' in keys:
            flx = flux_calc_general(Hbe, res, 'BLR_fwhm', 'BLR_Hbeta_peak', lsf=lsf)
            return flx*norm
        
        elif 'BLR_alp1' in keys:
            wave = np.linspace(4800,4900,700)*(1+res['z'][0])/1e4
            from ..Models.QSO_models import BKPLG
            model = BKPLG(wave, res['BLR_peak'][0], Hbe, res['BLR_sig'][0], res['BLR_alp1'][0], res['BLR_alp2'][0], lsf=lsf)
        else:
            return 0 
        
    elif mode=='Hbetaw':
        flx = flux_calc_general(Hbe, res, 'Hbeta_fwhm', 'Hbeta_peak', lsf=lsf)
        return flx*norm
    elif mode=='Hbetan':
        flx = flux_calc_general(Hbe, res, 'Hbetan_fwhm', 'Hbetan_peak', lsf=lsf)
        return flx*norm  
    
    elif mode=='SIIr':
        flx = flux_calc_general(6732, res, 'Nar_fwhm', 'SIIr_peak', lsf=lsf)
        return flx*norm
        
    elif mode=='SIIb':
        flx = flux_calc_general(6718, res, 'Nar_fwhm', 'SIIb_peak', lsf=lsf) 
        return flx*norm
    
    else:
        raise Exception('Sorry mode in Flux calc not understood')
        
    import scipy.integrate as scpi
    
    Flux = scpi.simps(model, wave)*norm
        
    return Flux

import random
def flux_calc_mcmc(fit_obj, mode, norm=1, N=2000, wv_cent=5008, peak_name='', fwhm_name='', ratio_name='', lsf=0,std=0, chains=0):
    """
    Calculates flux and 68% confidence iterval. 

    Parameters
    ----------

        fit_obj - object
            Fitting class object
        
        mode - string
            modes: general, OIIIn, OIIIw, OIIIt, Han, NII, Hbeta, SIIr, SIIb
        
        norm - value
            normalization used in the QubeSpec cube class 

        N - int
            number of sampling of the chains
        
        wv_cent - float
            rest-frame wavelength in ang of the line if mode='general'
        
        peak_name - string
          if mode='general' name of the peak name to use

        fwhm_name - string
            if mode='general' name of the fwhm name to use

        ratio_name - string
            if mode='general' name of the ratio to use (e.g. in [OII])

    Returns
    -------

    array of median value and +- 1sigma
    """
    chains = fit_obj.chains
    res = fit_obj.props
    labels = list(chains.keys())

    popt = np.zeros_like(res['popt'])
    Fluxes = []
    res_new = {'name': res['name']}
    
    Nchain = len(chains['z'])
    itere = np.arange(Nchain/2,Nchain,1, dtype=int)
        
    for j in itere:
        #sel = random.randint(Nchain/2,N-1)
        for i in range(len(popt)): 
            
            popt[i] = chains[labels[i+1]][j]
            res_new[labels[i+1]] = [popt[i], 0,0 ]
        
        res_new['popt'] = popt
        Fluxes.append(flux_calc(res_new, mode,norm, wv_cent=wv_cent, peak_name=peak_name, fwhm_name=fwhm_name, ratio_name=ratio_name, lsf=lsf))
    
    p50,p16,p84 = np.percentile(Fluxes, (50,16,84))
    p16 = p50-p16
    p84 = p84-p50
    if std ==0 and chains==0:
        return p50, p16, p84
    elif std ==1 and chains==0:
        return p50, p16, p84, np.std(Fluxes)
    elif std ==0 and chains==1:
        return p50, p16, p84, np.array(Fluxes)
    else:
        return p50, p16, p84, np.std(Fluxes), np.array(Fluxes)



def EW_calc_mcmc(fit_obj, mode, norm=1, N=2000, wv_cent=5008, peak_name='', fwhm_name='', ratio_name='', lsf=0, wv_cont=5008):
    """
    Calculates EW and 68% confidence iterval. 

    Parameters
    ----------

        fit_obj - object
            Fitting class object
        
        mode - string
            modes: general, OIIIn, OIIIw, OIIIt, Han, NII, Hbeta, SIIr, SIIb
        
        norm - value
            normalization used in the QubeSpec cube class 

        N - int
            number of sampling of the chains
        
        wv_cent - float
            rest-frame wavelength in ang of the line if mode='general'
        
        peak_name - string
          if mode='general' name of the peak name to use

        fwhm_name - string
            if mode='general' name of the fwhm name to use

        ratio_name - string
            if mode='general' name of the ratio to use (e.g. in [OII])

    Returns
    -------

    array of median value and +- 1sigma
    """
    chains = fit_obj.chains
    res = fit_obj.props
    labels = list(chains.keys())

    popt = np.zeros_like(res['popt'])
    Fluxes = []
    res_new = {'name': res['name']}
    
    Nchain = len(chains['z'])
    itere = np.arange(Nchain/2,Nchain,1, dtype=int)
        
    for j in itere:
        #sel = random.randint(Nchain/2,N-1)
        for i in range(len(popt)): 
            
            popt[i] = chains[labels[i+1]][j]
            res_new[labels[i+1]] = [popt[i], 0,0 ]
        
        res_new['popt'] = popt
        Fluxes.append(flux_calc(res_new, mode,norm, wv_cent=wv_cent, peak_name=peak_name, fwhm_name=fwhm_name, ratio_name=ratio_name, lsf=lsf))
    Conts = PowerLaw1D.evaluate(wv_cent/1e4*(1+fit_obj.chains['z'][itere]),fit_obj.chains['cont'][itere], wv_cont/1e4*(1+fit_obj.chains['z'][itere]), fit_obj.chains['cont_grad'][itere] )*norm

    EWs = np.array(Fluxes)/Conts*1e4/(1+fit_obj.chains['z'][itere])

    p50,p16,p84 = np.percentile(EWs, (50,16,84))
    p16 = p50-p16
    p84 = p84-p50
    return p50, p16, p84




def vel_kin_percentiles(self, peak_names, fwhm_names, vel_names,rest_wave,vel_percentiles=[], z=0, error_range=[50,16,84], N=100):
    """_summary_

    :param peak_names: _description_
    :param fwhm_names: _description_
    :param vel_names: _description_
    :param rest_wave: _description_
    :param vel_percentiles: _description_, defaults to []
    :param z: _description_, defaults to 0
    :param error_range: _description_, defaults to [50,16,84]
    :param N: _description_, defaults to 100
    
    :return: _description_
    """
    if z==0:
        z = self.props['popt'][0]
    
    import scipy.integrate as scpi
    import scipy.interpolate as intp
    
    cent =  rest_wave*(1+z)/1e4
    bound1 =  cent + 3000/3e5*cent
    bound2 =  cent - 3000/3e5*cent
    Ni = 6000
    wvs = np.linspace(bound2, bound1, Ni)
    vels = np.linspace(-3000,3000, Ni)

    velnames = ['z']
    for j in vel_names:
        velnames.append(j)

    Nchain = len(self.chains['z'])
    itere = np.arange(Nchain/2,Nchain,1, dtype=int)
    itere = np.random.choice(itere, size=N, replace=False)

    vel_percentiles = np.append( np.array([10,90,50]), vel_percentiles)

    vel_res = np.zeros((len(vel_percentiles), N))
    peak_vel = np.zeros(N)
    if N==1:
        y = np.zeros_like(wvs)
        for i, name in enumerate(vel_names):
            
            if name =='z':
                wv_cent = rest_wave*(1+self.props['z'][0])/1e4
            else:
                wv_cent = rest_wave*(1+self.props['z'][0])/1e4
                wv_cent = wv_cent + self.props[vel_names[i]][0]/3e5*wv_cent

            y += gauss(wvs, self.props[peak_names[i]][0], wv_cent, self.props[fwhm_names[i]][0])
    
        vel_peak = vels[np.argmax(y)]
        flux_cum = np.cumsum(y)
        flux_cum = flux_cum/np.max(flux_cum)
        for k, value in enumerate(vel_percentiles):
            vel_res[k] = vels[find_nearest(flux_cum, value/100)]

        res = {}
        res['vel_peak'] = vel_peak
        res['w80'] = vel_res[1]-vel_res[0]

        for i in range(len(vel_percentiles)):
            res['v'+str(int(vel_percentiles[i]))] = vel_res[i]

        return res
        
    else:
        for ind, itr in enumerate(itere):
            y = np.zeros_like(wvs)
            for i, name in enumerate(velnames):
                if name =='z':
                    wv_cent = rest_wave*(1+self.chains['z'][itr])/1e4
                else:
                    wv_cent = rest_wave*(1+self.chains['z'][itr])/1e4
                    wv_cent = wv_cent + self.chains[velnames[i]][itr]/3e5*wv_cent

                y += gauss(wvs, self.chains[peak_names[i]][itr], wv_cent, self.chains[fwhm_names[i]][itr])
            peak_vel[ind] = vels[np.argmax(y)]

            #if ind==0:

            #    plt.figure()
            #    plt.plot(wvs, y)
            
            flux_cum = np.cumsum(y)
            flux_cum = flux_cum/np.max(flux_cum)
            for k, value in enumerate(vel_percentiles):
                vel_res[k,ind] = vels[find_nearest(flux_cum, value/100)]
        
        W80 = vel_res[1,:] - vel_res[0,:]

        res = {}
        res['vel_peak'] = np.percentile(peak_vel, error_range)
        res['w80'] = np.percentile(W80, error_range)

        for i in range(len(vel_percentiles)):
            res['v'+str(int(vel_percentiles[i]))] = np.percentile(vel_res[i,:], error_range)


        return res
        

        
def W80_OIII_calc(Fits, N=100,z=0):
    """_summary_

    :param Fits: _description_
    :param N: _description_, defaults to 100
    :return: _description_
    """
    sol = Fits.props
    
    if 'outflow_fwhm' in sol:

        if 'OIII_out_peak' in sol:

            kin_res = vel_kin_percentiles(Fits, ['OIII_peak', 'OIII_out_peak'],\
                                ['Nar_fwhm', 'outflow_fwhm'], ['outflow_vel'], \
                                    rest_wave=5008,  N=N,error_range=[50,16,84],z=z)
        
        if 'OIIIw_peak' in sol:

            kin_res = vel_kin_percentiles(Fits, ['OIII_peak', 'OIIIw_peak'],\
                                ['Nar_fwhm', 'outflow_fwhm'], ['outflow_vel'], \
                                    rest_wave=5008,  N=N,error_range=[50,16,84],z=z)
            
    else:
        kin_res = vel_kin_percentiles(Fits, ['OIII_peak'],\
                                ['Nar_fwhm'], [], \
                                    rest_wave=5008,  N=N,error_range=[50,16,84],z=z)

    vel_peak = kin_res['vel_peak']
    v10 = kin_res['v10']
    v90 = kin_res['v90']
    w80 = kin_res['w80']
    v50 = kin_res['v50']
    if N==1:        
        return {'vel_peak':vel_peak,'v10':v10,'v90':v90,'w80':w80,'v50':v50}
    
    else:
        v10[1] = v10[1] - v10[0]
        v10[2] = v10[2]- v10[0]

        v50[1] = v50[1] - v50[0]
        v50[2] = v50[2]- v50[0]

        v90[1] = v90[1] - v90[0]
        v90[2] = v90[2]- v90[0]
            
        w80[1] = w80[1] - w80[0]
        w80[2] = w80[2] - w80[0]

        vel_peak[1] = vel_peak[1] - vel_peak[2]
        vel_peak[2] = vel_peak[2] - vel_peak[1]

        return {'vel_peak':vel_peak,'v10':v10,'v90':v90,'w80':w80,'v50':v50}



def W80_Halpha_calc(Fits, N=100,z=0):
    """_summary_

    :param Fits: _description_
    :param N: _description_, defaults to 100
    :return: _description_
    """
    sol = Fits.props
    
    if 'outflow_fwhm' in sol:
        kin_res = vel_kin_percentiles(Fits, ['Hal_peak', 'Hal_out_peak'],\
                            ['Nar_fwhm', 'outflow_fwhm'], ['outflow_vel'], \
                                rest_wave=6564,  N=N,error_range=[50,16,84],z=z)
        
        
            
    else:
        kin_res = vel_kin_percentiles(Fits, ['Hal_peak'],\
                                ['Nar_fwhm'], [], \
                                    rest_wave=6564,  N=N,error_range=[50,16,84],z=z)

    vel_peak = kin_res['vel_peak']
    v10 = kin_res['v10']
    v90 = kin_res['v90']
    w80 = kin_res['w80']
    v50 = kin_res['v50']

    if N==1:        
        return {'vel_peak':vel_peak,'v10':v10,'v90':v90,'w80':w80,'v50':v50}
    
    else:
        v10[1] = v10[1] - v10[0]
        v10[2] = v10[2]- v10[0]

        v50[1] = v50[1] - v50[0]
        v50[2] = v50[2]- v50[0]

        v90[1] = v90[1] - v90[0]
        v90[2] = v90[2]- v90[0]
            
        w80[1] = w80[1] - w80[0]
        w80[2] = w80[2] - w80[0]

        vel_peak[1] = vel_peak[1] - vel_peak[2]
        vel_peak[2] = vel_peak[2] - vel_peak[1]

        return {'vel_peak':vel_peak,'v10':v10,'v90':v90,'w80':w80,'v50':v50}




def W80_NII_calc(Fits, N=100,z=0):
    """_summary_

    :param Fits: _description_
    :param N: _description_, defaults to 100
    :return: _description_
    """
    sol = Fits.props
    
    if 'outflow_fwhm' in sol:

        kin_res = vel_kin_percentiles(Fits, ['NII_peak', 'NII_out_peak'],\
                            ['Nar_fwhm', 'outflow_fwhm'], ['outflow_vel'], \
                                rest_wave=6564,  N=N,error_range=[50,16,84],z=z)
              
    else:
        kin_res = vel_kin_percentiles(Fits, ['NII_peak'],\
                                ['Nar_fwhm'], [], \
                                    rest_wave=6564,  N=N,error_range=[50,16,84],z=z)
    vel_peak = kin_res['vel_peak']
    v10 = kin_res['v10']
    v90 = kin_res['v90']
    w80 = kin_res['w80']
    v50 = kin_res['v50']

    if N==1:        
        return {'vel_peak':vel_peak,'v10':v10,'v90':v90,'w80':w80,'v50':v50}
    
    else:
        v10[1] = v10[1] - v10[0]
        v10[2] = v10[2]- v10[0]

        v50[1] = v50[1] - v50[0]
        v50[2] = v50[2]- v50[0]

        v90[1] = v90[1] - v90[0]
        v90[2] = v90[2]- v90[0]
            
        w80[1] = w80[1] - w80[0]
        w80[2] = w80[2] - w80[0]

        vel_peak[1] = vel_peak[1] - vel_peak[2]
        vel_peak[2] = vel_peak[2] - vel_peak[1]

        return {'vel_peak':vel_peak,'v10':v10,'v90':v90,'w80':w80,'v50':v50}


def flux_to_lum(flux,redshift):
    from astropy.cosmology import WMAP9 as cosmo
    import astropy.units as u 
    lum = (flux*u.erg/u.s/u.cm**2) * 4*np.pi*(cosmo.luminosity_distance(redshift))**2  
    return lum.to(u.erg/u.s)

def jadify(object_name, disp_filt, wave, flux, err=None, mask=None, verbose=True,
    overwrite=True, descr=None, author=None):
    """
    object_name : int or str **do not use "_" characters
        unique identifier. Preferrably up to eight digits. String is acceptable but
        frowned upon.
    disp_filt : string
        one of 'prism_clear', 'g140m_f070lp', 'g235m_f170lp', 'g395m_f290lp'
    wave : array or any other iterable
        in [um]
    flux : array or any other iterable. Same shape as `wave`
        in [W/m^3]
    err  : array or any other iterable. Same shape as `wave`; [optional]
        in [W/m^3]
    mask : array or any other iterable. Same sahpe as `wave`; [optional]
        0 means good pixel; 1 bad pixel
    verbose : bool
        Suppress messages
    overwrite : bool
        Force overwrite existing fits file. Ask for confirmation otherwise.
    descr : str [optional]
        Any text to add to the comments. Added to the primary HDU under 'comments'
    author : str [optional]
        Only if you want to. Added to the primary HDU under 'author'
    """
    import os
    from astropy.io import fits
    if verbose:
        print('Reminder (suppress with verbose=False):\n'
            '`wave`: [um]; in observed frame\n'
            '`flux`: [W/m^3]; 1 erg/(s cm^2 AA) = 1e7 W/m^3\n'
            '`err` : [W/m^3]; optional. If not given all 0\n'
            '`mask`: [0=good, 1=bad]; optional. If not given all 0\n'
            )
    if any(wave<0.5) or any(wave>6):
        print(f'{wave} wavelength vector seems strange. Are you sure it is in um?')
    weird_wave_disp = (
        (disp_filt=='g140m_f070lp' and (any(wave<0.5) or any(wave>2))) # Not in G140M
        or (disp_filt=='g235m_f170lp' and (any(wave<1.5) or any(wave>3.5))) # Not in G235M
        or (disp_filt=='g395m_f290lp' and (any(wave<2.5) or any(wave>6)))   # Not in G395M
        )
    if weird_wave_disp:
        print(f'{wave} wavelength vector seems strange for {disp_filt}. Are you sure it the right disperser/filter combination?')
        
    # Open dummy file.
    output_filename = f'{object_name}_{disp_filt}_v3.0_1D.fits'
    from .. import jadify_temp as pth

    PATH_TO_jadify = pth.__path__[0]+ '/'
    filename = PATH_TO_jadify+ 'temp_prism_clear_v3.0_extr3_1D.fits'

    with fits.open(filename) as hdu:
        hdu['DATA'].data = flux
        hdu['ERR'].data  = (err if err is not None else np.zeros_like(flux))
        hdu['DIRTY_Data'].data = flux
        hdu['DIRTY_QUALITY'].data = (mask if mask is not None else np.zeros(flux.size, dtype=int))
        hdu['WAVELENGTH'].data = wave/1e6
        hdu['GTO_FLAG'].data = np.zeros_like(flux)
        hdu['GTO_OVERLAPPING'].data = np.zeros_like(flux)

        if descr is not None:
            hdu[0].header['COMMENT'] = str(descr)

        if os.path.isfile(output_filename) and (overwrite is False):
            proceed = input(f'{output_filename} exists and {overwrite=}. Enter y to overwrite\n')
            if proceed is not 'y': 
                print('Aborted by user')
                return
         
        # Never reach this if overwrite=False and file exists
        hdu.writeto(output_filename, overwrite=True)


def NIRSpec_IFU_PSF(wave):
    """
    Calculate the Point Spread Function (PSF) for the NIRSpec IFU.

    Parameters:
        wave (float): The wavelength of the light.

    Returns:
        numpy.ndarray: An array containing the two components of the PSF, sigma1 and sigma2.

    Notes:
    This function calculates the PSF based on the formula from D'Eugenio et al 2023 - stellar kinematics.
    The PSF is calculated using two components, sigma1 and sigma2, which depend on the wavelength of the light.
    The formula for sigma1 is 0.12 + 1.9 * wave * e^(-24.4/wave).
    The formula for sigma2 is 0.09 + 0.2 * wave * e^(-12.5/wave).
    The function returns an array containing the values of sigma1 and sigma2.
    """
    # From D'Eugenio et al 2023 - stellar kinematics
    sigma1= 0.12 + 1.9*wave * e**(-24.4/wave)
    sigma2= 0.09 + 0.2*wave * e**(-12.5/wave)                     
    return np.array([sigma1,sigma2])

def pickle_load(file_path):
    import pickle
    with open(file_path, "rb") as fp:
        return pickle.load(fp)

def pickle_save(file_path, stuff):
    import pickle
    with open(file_path, "wb") as fp:
        pickle.dump(stuff, fp)

def error_scaling(obs_wave,flux, error_var, err_range, boundary, exp=0):
    error= np.zeros_like(flux)
    from astropy import stats

    #if (np.any(np.array(err_range)<obs_wave[0])==True) | (np.any(np.array(err_range)>obs_wave[-1])==True):
    #    raise Exception('err range values are out of range of the wavelength range of the data')
    
    #if (boundary<obs_wave[0]) | (boundary>obs_wave[-1]):
    #    raise Exception('Err boundary value are out of range of the wavelength range of the data')


    if len(err_range)==2:
        error1 = stats.sigma_clipped_stats(flux[(err_range[0]<obs_wave) \
                                                    &(obs_wave<err_range[1])],sigma=3, mask = flux[(err_range[0]<obs_wave) \
                                                    &(obs_wave<err_range[1])].mask)[2]
        
        average_var1 = stats.sigma_clipped_stats(error_var[(err_range[0]<obs_wave) \
                                                    &(obs_wave<err_range[1])],sigma=3, mask = error[(err_range[0]<obs_wave) \
                                                    &(obs_wave<err_range[1])].mask)[1]
    
        error = error_var*(error1/average_var1)

    elif len(err_range)==4:
        error1 = stats.sigma_clipped_stats(flux[(err_range[0]<obs_wave) \
                                                    &(obs_wave<err_range[1])],sigma=3, mask = flux[(err_range[0]<obs_wave) \
                                                    &(obs_wave<err_range[1])].mask)[2]
        error2 = stats.sigma_clipped_stats(flux[(err_range[2]<obs_wave) \
                                                    &(obs_wave<err_range[3])],sigma=3, mask = flux[(err_range[2]<obs_wave) \
                                                    &(obs_wave<err_range[3])].mask)[2]
        
        average_var1 = stats.sigma_clipped_stats(error_var[(err_range[0]<obs_wave) \
                                                    &(obs_wave<err_range[1])],sigma=3, mask = error[(err_range[0]<obs_wave) \
                                                    &(obs_wave<err_range[1])].mask)[1]
        average_var2 = stats.sigma_clipped_stats(error_var[(err_range[2]<obs_wave) \
                                                    &(obs_wave<err_range[3])],sigma=3, mask = error[(err_range[2]<obs_wave) \
                                                    &(obs_wave<err_range[3])].mask)[1]
        error[obs_wave<boundary] = error_var[obs_wave<boundary]*(error1/average_var1)
        error[obs_wave>boundary] = error_var[obs_wave>boundary]*(error2/average_var2)
    else:
        error1 = stats.sigma_clipped_stats(flux,sigma=3)[2]
                
        average_var1 = stats.sigma_clipped_stats(flux,sigma=3)[1]
        error = error_var/(error1/average_var1)
            
    error[error==0] = np.mean(error)*10
    try:
        error[error.mask==True] = np.ma.mean(error)*10
        error = error.data
    except:
        lsk=0

    if exp==1:
        try:
            print('Error rescales are: ', error1/average_var1, error2/average_var2 )
        except:
            print('Error rescale is: ', error1/average_var1 )
    return error

def where(array, lmin, lmax):
    use = np.where( (array>lmin) & (array<lmax))
    return use

def header_to_2D(header):
    from astropy.io import fits
    hdu = fits.PrimaryHDU()
    new_header = hdu.header  # show the all of the header cards

    new_header['NAXIS'] = 2
    new_header['WCSAXES'] = 2
    list_cp = ['BITPIX', 'NAXIS1', 'NAXIS2', 'CRPIX1', 'CRVAL1', 'CTYPE1', 'CUNIT1', 'CDELT1', 'CRPIX2', 'CRVAL2', 'CTYPE2', 'CUNIT2', 'CDELT2',\
               'PC1_1', 'PC1_2', 'PC2_1', 'PC2_2',  ]
    
    for item in list_cp:
        try:
            new_header[item] = header[item]
        except:
            ils=0
    return new_header

def DS9_region_mask(filepath, header):
    from regions import Regions
    region_sky  = Regions.read(filepath, format='ds9')
    if header['NAXIS']>2:
        new_header = header_to_2D(header)
    else:
        new_header= header
    try:
        region_pix = region_sky[0].to_pixel(wcs.WCS(new_header))
    except:
        region_pix = region_sky.to_pixel(wcs.WCS(new_header))
    mask = region_pix.to_mask(mode='center',).to_image([new_header['NAXIS2'],new_header['NAXIS1']])
    return ~np.array(mask, dtype=bool)

def MSA_load(Full_path):
    with pyfits.open(Full_path, memmap=False) as hdulist:
        flux_orig = hdulist['DATA'].data*1e-7*1e4*1e15
        obs_wave = hdulist['wavelength'].data*1e6
        error =  hdulist['ERR'].data*1e-7*1e4*1e15

        flux = np.ma.masked_invalid(flux_orig.copy())
    
    return obs_wave, flux, error

def NIRCam_image(Cube, possible_filters=( 'F356W_FPHO', 'F444W_FPHO')):
    import sedpy
    import astropy.units as u

    c = 3.*10**8*u.m/u.s

    Flux = Cube.flux_old.copy() # I am using non background subtracted cube
    Flux *= Cube.flux_norm/ 1e4 # setting the units to ergs/s/cm2/AA
    

    #Flux = Flux.to('1 erg/(s cm2 AA)')
    obs_wave = Cube.obs_wave*u.um # setting th 
    
    maggies_to_nJy = 3631 # conversion from maggies to nJy or Jy not sure

    # Setting the filters in SEDpy
    filts=[i.replace("_FPHO", "") for i in possible_filters]
    filts1=[i.lower() for i in filts]
    filternames = ['jwst_'+n if len(n)==5 else 'jwst_mod'+n[5]+'_'+n[:5] for n in filts1]
        
    filters = sedpy.observate.load_filters(filternames)
    filter_wav_um=(np.array([f.wave_effective for f in filters])*u.AA).to('um')
    shapes = Flux.shape
    NIRCam_image = np.zeros((shapes[1], shapes[2], len(filternames)))

    for i in range(shapes[1]):
        for j in range(shapes[2]):
            NIRCam_image[i,j,:] = (sedpy.observate.getSED(obs_wave.to('AA').value, Flux[:,i,j],\
									   linear_flux=True, filterlist=filters))*maggies_to_nJy

    
    NIRCam_image[NIRCam_image==3631] = np.nan
    return NIRCam_image, filter_wav_um


def twoD_Gaussian(dm, amplitude, xo, yo, sigma_x, sigma_y, theta, offset): 
    """ 2D Gaussian array used to find center of emission 
	
	"""
    x, y = dm
    xo = float(xo)
    yo = float(yo)    
    a = (np.cos(theta)**2)/(2*sigma_x**2) + (np.sin(theta)**2)/(2*sigma_y**2)
    b = -(np.sin(2*theta))/(4*sigma_x**2) + (np.sin(2*theta))/(4*sigma_y**2)
    c = (np.sin(theta)**2)/(2*sigma_x**2) + (np.cos(theta)**2)/(2*sigma_y**2)
    g = offset + amplitude*np.exp( - (a*((x-xo)**2) + 2*b*(x-xo)*(y-yo) 
                            + c*((y-yo)**2)))
    return g.ravel()

def Image_center_fit(image, init_loc, plot_it = 0, mask=None):
    import astropy.stats as stats
    rms = stats.sigma_clipped_stats(image, sigma=3)[2]
    shapes = image.shape

    # Create the x inputs for the curve_fit
    x = np.linspace(0, shapes[1]-1, shapes[1])
    y = np.linspace(0, shapes[0]-1, shapes[0])
    x, y = np.meshgrid(x, y)
    if mask is not None:
        image = np.ma.masked_array(image, mask=mask)

    plt.figure()
    plt.imshow(image, vmin=-rms, vmax=5*rms, cmap='gray')
    import scipy.optimize as opt

    print(image[50,50])

    print(image[init_loc[0],init_loc[1]])
    # Setting the
    initial_guess = (image[init_loc[0],init_loc[1]],  init_loc[1],init_loc[0],1,1,0,0)

    print ('Initial guesses', initial_guess)

    
    dm = (x,y)
    popt, pcov = opt.curve_fit(twoD_Gaussian, dm, image.ravel(),  p0=initial_guess, bounds=([-np.inf, -np.inf, -np.inf, 0.1,0.1, -np.inf, -np.inf],[np.inf, np.inf, np.inf, 5,5, np.inf, np.inf]))
    popt_l = popt.copy()
    popt_l[0] = 1
    er = np.sqrt(np.diag(pcov))
    print(popt)

    print ('Cont loc ', popt[1:3])
    print ('Cont loc er', er[1:3])

    if plot_it==1:
        
        plt.figure()
        plt.imshow(image, vmin=-rms, vmax=5*rms, cmap='gray')

        data_fit = twoD_Gaussian((x,y), *popt_l)

        plt.contour(x, y, data_fit.reshape(shapes[0], shapes[1]), 8, colors='r')

        plt.xlim(popt[1]-10,popt[1]+10)
        plt.ylim(popt[2]-10,popt[2]+10)
        
        plt.plot(popt[1],popt[2], 'ro')

def plot_filters(ax,norm=1):
    # 090W, 115W,150W, 200W, 277W, 356W, 410M, 444W

    lowl = ax.get_ylim()[0]

    Filt = Table.read( '/Users/jansen/JADES/NIRCam_trans/F090W_mean_system_throughput.txt' , format='ascii')
    ax.fill_between(Filt['Microns'],y2=lowl, y1= Filt['Throughput']/max(Filt['Throughput'])*norm+lowl, color='lightskyblue', alpha=0.2)

    Filt = Table.read( '/Users/jansen/JADES/NIRCam_trans/F115W_mean_system_throughput.txt' , format='ascii')
    ax.fill_between(Filt['Microns'],y2=lowl, y1= Filt['Throughput']/max(Filt['Throughput'])*norm+lowl, color='blue', alpha=0.2)

    Filt = Table.read( '/Users/jansen/JADES/NIRCam_trans/F150W_mean_system_throughput.txt' , format='ascii')
    ax.fill_between(Filt['Microns'],y2=lowl, y1= Filt['Throughput']/max(Filt['Throughput'])*norm+lowl, color='darkblue', alpha=0.2)

    Filt = Table.read( '/Users/jansen/JADES/NIRCam_trans/F200W_mean_system_throughput.txt' , format='ascii')
    ax.fill_between(Filt['Microns'],y2=lowl, y1= Filt['Throughput']/max(Filt['Throughput'])*norm+lowl, color='lightgreen', alpha=0.2)

    Filt = Table.read( '/Users/jansen/JADES/NIRCam_trans/F277W_mean_system_throughput.txt' , format='ascii')
    ax.fill_between(Filt['Microns'],y2=lowl, y1= Filt['Throughput']/max(Filt['Throughput'])*norm+lowl, color='orange', alpha=0.2)

    Filt = Table.read( '/Users/jansen/JADES/NIRCam_trans/F335M_mean_system_throughput.txt' , format='ascii')
    ax.fill_between(Filt['Microns'],y2=lowl, y1= Filt['Throughput']/max(Filt['Throughput'])*norm+lowl, color='peru', alpha=0.2)

    Filt = Table.read( '/Users/jansen/JADES/NIRCam_trans/F356W_mean_system_throughput.txt' , format='ascii')
    ax.fill_between(Filt['Microns'],y2=lowl, y1= Filt['Throughput']/max(Filt['Throughput'])*norm+lowl, color='darkorange', alpha=0.2)

    Filt = Table.read( '/Users/jansen/JADES/NIRCam_trans/F410M_mean_system_throughput.txt' , format='ascii')
    ax.fill_between(Filt['Microns'],y2=lowl, y1= Filt['Throughput']/max(Filt['Throughput'])*norm+lowl, color='red', alpha=0.2)

    Filt = Table.read( '/Users/jansen/JADES/NIRCam_trans/F444W_mean_system_throughput.txt' , format='ascii')
    ax.fill_between(Filt['Microns'],y2=lowl, y1= Filt['Throughput']/max(Filt['Throughput'])*norm+lowl, color='firebrick', alpha=0.2)


def cal_sfr_kennicutt(ha_flux, err_ha_flux, redshift):
    """
    Use the Kennicutt+94 SFR relation, that relies on a standard Salpeter IMF
    return sfr and err_sfr
    """
    from astropy.cosmology import Planck18 as cosmo 

    conversion_factor = 1.26e41 # solar mass/yr.erg/s
    ha_lum = ha_flux * (4*np.pi*(cosmo.luminosity_distance(redshift).to(u.cm))**2).value

    sfr = ha_lum/conversion_factor
    err_sfr = sfr * (err_ha_flux/ha_flux)

    return(sfr, err_sfr)   
```

`Qubespec/QubeSpec/Utils/__init__.py`:

```py
from .Support import *
```

`Qubespec/QubeSpec/Visualizations/__init__.py`:

```py
from .viz import *
```

`Qubespec/QubeSpec/Visualizations/viz.py`:

```py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Sun Dec 25 21:23:34 2022

@author: jansen
"""

#importing modules
from astropy.io import fits as pyfits
from .. import Graph_setup as gst
import numpy as np
nan= float('nan')

pi= np.pi
e= np.e
c= 3.*10**8

fsz = gst.graph_format()

import matplotlib.pyplot as plt
import matplotlib.patches
import matplotlib.cm
from brokenaxes import brokenaxes
from matplotlib.widgets import Slider, Button, RadioButtons, RangeSlider

class Viz_outreach:
    '''Class to visualize '''
    def __init__(self, path_res, map_hdu, indc = [1,0],vlim2= [-100,100], z=None ):
        """
        Load the fit and the data
        Returns
        -------
        """
        self.indc = indc
        self.z = z
        self.map_hdu_name = map_hdu
        self.vlim2 = vlim2

        with pyfits.open(path_res, memmap=False) as hdulist:
            self.map = []
            for its in map_hdu:
                self.map.append(hdulist[its].data[:,:,:])
            
            self.yeval = hdulist['yeval'].data
            self.flux = hdulist['flux'].data
            self.error = hdulist['error'].data

            names = [entry.name for entry in hdulist]
            print('HDUs:', names)
            if 'YEVAL_NAR' in names:
                print('yes')
                self.yeval_nar = hdulist['yeval_nar'].data
            if 'YEVAL_BRO' in names:
                self.yeval_bro = hdulist['yeval_bro'].data
      
            self.header = hdulist['PRIMARY'].header
            nwave = np.shape(self.yeval)[0]
            self.obs_wave = self.header['CRVAL3'] + (np.arange(nwave) - (self.header['CRPIX3'] - 1.0))*self.header['CDELT3']
        self.slice_val_ind = 2
        self.slice_val = self.obs_wave[2]

    def plot_general(self, i,j):
        ''' 
        General function to plot the updated spaxel spectrum in the plot
        '''
        self.axspec.cla()
        fluxm= self.flux[:,j,i]
        errorm= self.error[:,j,i]
        yevalm = self.yeval[:,j,i]
        self.axspec.plot(self.obs_wave, fluxm, drawstyle='steps-mid')
        self.axspec.plot(self.obs_wave, yevalm, 'r--')
        self.axspec.plot(self.obs_wave, errorm, 'k:')

        if hasattr(self, 'yeval_nar'):
            self.axspec.plot(self.obs_wave, self.yeval_nar[:,j,i], 'g--')
        if hasattr(self, 'yeval_bro'):
            self.axspec.plot(self.obs_wave, self.yeval_bro[:,j,i], 'b--')


        self.axspec.set_ylim(-0.1*max(yevalm), 1.1*max(yevalm))
        
        if self.xlims is not None:
            self.axspec.set_xlim(self.xlims[0], self.xlims[1])
            
            use = np.where( (self.obs_wave<self.xlims[1]) & (self.obs_wave>self.xlims[0]) )[0]
            self.axspec.text(self.obs_wave[use][10], 0.9*max(yevalm[use]), 'x='+str(i)+', y='+str(j) )

            if self.ylims:
                self.axspec.set_ylim(self.ylims[0], self.ylims[1]) 
            else:
                self.axspec.set_ylim(-0.1*max(yevalm[use]), 1.1*max(yevalm[use])) 
        
        
        limst = self.axspec.get_ylim()
        self.line_slice = self.axspec.vlines(self.slice_val,limst[0], limst[1], color='k', linestyle='dashed')


    def showme(self, xlims= None, vmax=1e-15, ylims=None):
        '''
        Function to initialize the whole setup and layout
        '''
        self.xlims = xlims
        self.ylims = ylims
        fig = plt.figure(figsize=(15.6, 8))
        fig.canvas.manager.set_window_title('vicube')
        gs = fig.add_gridspec(
            2, 3, height_ratios=(1,1), width_ratios=(1,1,1))

        self.ax0 = fig.add_subplot(gs[0, 0])
        self.ax1 = fig.add_subplot(gs[0, 1], sharex=self.ax0, sharey=self.ax0)
        self.ax2 = fig.add_subplot(gs[0, 2], sharex=self.ax0, sharey=self.ax0)
        self.axes = [self.ax0,self.ax1,self.ax2]

        self.ax0.set_title(self.map_hdu_name[0])
        self.ax1.set_title(self.map_hdu_name[1])
        self.ax2.set_title('Slice')
        self.axspec = fig.add_subplot(gs[1, :]) #brokenaxes(xlims=xlims,  hspace=.01, subplot_spec=gs[1, :])

        self.axes= self.axes[:len(self.map)]

        self.ax2.imshow(np.sum(self.flux[self.slice_val_ind-1:self.slice_val_ind+1,:,:],axis=0), origin='lower')
        k=0
        for ax, map,its in zip(self.axes,self.map, range(len(self.axes))):
            if its==1:
                cmap='coolwarm'
                map_ind= self.indc[k]
                _img_ = ax.imshow(map[map_ind,:,:], origin='lower',vmin=self.vlim2[0], vmax=self.vlim2[1], cmap=cmap)
            else:
                cmap='viridis'
                map_ind=self.indc[k]
                _img_ = ax.imshow(map[map_ind,:,:], origin='lower', cmap=cmap)
            
            
            k+=1
        
        self.xlimax = plt.axes([0.12, 0.95, 0.8, 0.03])
        self.xlim_slider = RangeSlider(self.xlimax, 'xlim', self.obs_wave[0], self.obs_wave[-1], valinit=(self.xlims[0], self.xlims[1]))
        self.xlim_slider.on_changed(self.slide_update)

        self.sliceax = plt.axes([0.12, 0.05, 0.8, 0.03])
        self.slice_slider = Slider(self.sliceax, 'wavelength', valmin=self.obs_wave[0],
                                   valmax=self.obs_wave[-1],
                                    valinit=self.obs_wave[0])
        
        self.slice_slider.on_changed(self.slide_update_slice)

        selector0  = matplotlib.patches.Rectangle(
            (14.5, 14.5), 1, 1, edgecolor='r', facecolor='none', lw=1.0)
        selector1  = matplotlib.patches.Rectangle(
            (14.5, 14.5), 1, 1, edgecolor='r', facecolor='none', lw=1.0)
        selector2  = matplotlib.patches.Rectangle(
            (14.5, 14.5), 1, 1, edgecolor='r', facecolor='none', lw=1.0)
        self.ax0.add_artist(selector0)
        self.ax1.add_artist(selector1)
        self.ax2.add_artist(selector2)
        selector0.set_visible(True)
        selector1.set_visible(True)
        selector2.set_visible(True)

        self.plot_general(50,50)
        #plt.tight_layout()

        def update_plot(event):
            '''
            Function to update the plot after a click 
            '''
            selector0.set_visible(True)
            self.i, self.j = int(event.xdata), int(event.ydata)

            #axspec = brokenaxes(xlims=xlims,  hspace=.01, subplot_spec=gs[1, :])
            #axspec = fig.add_subplot(gs[1, :])
            self.plot_general(self.i,self.j )
            selector0.set_xy((self.i-.5, self.j-.5))
            selector1.set_xy((self.i-.5, self.j-.5))
            selector2.set_xy((self.i-.5, self.j-.5))

        def hover(event):
            if (event.inaxes != self.ax0):
                selector0.set_visible(False),selector1.set_visible(False),selector2.set_visible(False)
                fig.canvas.draw_idle()
                return
            update_plot(event)
            fig.canvas.draw_idle()
        #fig.canvas.mpl_connect("motion_notify_event", hover)
        fig.canvas.mpl_connect("button_press_event", hover)    
        plt.show()   

    def slide_update(self, val):
        self.xlims = self.xlim_slider.val
        self.axspec.set_xlim(self.xlims[0], self.xlims[1])

    def slide_update_slice(self, val):
        self.slice_val = self.slice_slider.val
        self.slice_val_ind = np.argmin(np.abs(self.obs_wave-self.slice_val))
        self.ax2.cla()
        self.ax2.imshow(np.sum(self.flux[self.slice_val_ind-1:self.slice_val_ind+1,:,:],axis=0), origin='lower')
        self.line_slice.set_visible(False)
        limst = self.axspec.get_ylim()
        self.line_slice = self.axspec.vlines(self.slice_val,limst[0], limst[1], color='k', linestyle='dashed')

class Visualize:
    def __init__(self, path_res, map_hdu, indc = [1,1,0], z=None ):
        """
        Load the fit and the data
        Returns
        -------
        """
        self.indc = indc
        self.z = z
        self.map_hdu_name = map_hdu
        with pyfits.open(path_res, memmap=False) as hdulist:
            self.map = []
            for its in map_hdu:
                self.map.append(hdulist[its].data[:,:,:])
            
            self.yeval = hdulist['yeval'].data
            self.flux = hdulist['flux'].data
            self.error = hdulist['error'].data

            names = [entry.name for entry in hdulist]
            print('HDUs:', names)
            if 'YEVAL_NAR' in names:
                print('yes')
                self.yeval_nar = hdulist['yeval_nar'].data
            if 'YEVAL_BRO' in names:
                self.yeval_bro = hdulist['yeval_bro'].data
      
            self.header = hdulist['PRIMARY'].header
            nwave = np.shape(self.yeval)[0]
            self.obs_wave = self.header['CRVAL3'] + (np.arange(nwave) - (self.header['CRPIX3'] - 1.0))*self.header['CDELT3']

    def plot_general(self, i,j):
        self.axspec.cla()
        fluxm= self.flux[:,j,i]
        errorm= self.error[:,j,i]
        yevalm = self.yeval[:,j,i]
        self.axspec.plot(self.obs_wave, fluxm, drawstyle='steps-mid')
        self.axspec.plot(self.obs_wave, yevalm, 'r--')
        self.axspec.plot(self.obs_wave, errorm, 'k:')

        if hasattr(self, 'yeval_nar'):
            self.axspec.plot(self.obs_wave, self.yeval_nar[:,j,i], 'g--')
        if hasattr(self, 'yeval_bro'):
            self.axspec.plot(self.obs_wave, self.yeval_bro[:,j,i], 'b--')


        self.axspec.set_ylim(-0.1*max(yevalm), 1.1*max(yevalm))
        if self.z is not None:
            self.axspec.vlines(0.5008*(1+self.z),-0.1*max(yevalm), 1.1*max(yevalm), color='k', linestyle='dashed')
            self.axspec.vlines(0.6563*(1+self.z),-0.1*max(yevalm), 1.1*max(yevalm), color='k', linestyle='dashed')

        if self.xlims is not None:
            self.axspec.set_xlim(self.xlims[0], self.xlims[1])
            
            use = np.where( (self.obs_wave<self.xlims[1]) & (self.obs_wave>self.xlims[0]) )[0]
            self.axspec.text(self.obs_wave[use][10], 0.9*max(yevalm[use]), 'x='+str(i)+', y='+str(j) )

            if self.ylims:
                self.axspec.set_ylim(self.ylims[0], self.ylims[1]) 
            else:
                self.axspec.set_ylim(-0.1*max(yevalm[use]), 1.1*max(yevalm[use])) 
        
        if self.z is not None:
            limst = self.axspec.get_ylim()
            self.axspec.vlines(0.5008*(1+self.z),limst[0], limst[1], color='k', linestyle='dashed')


    def showme(self, xlims= None, vmax=1e-15, ylims=None):
        self.xlims = xlims
        self.ylims = ylims
        fig = plt.figure(figsize=(15.6, 8))
        fig.canvas.manager.set_window_title('vicube')
        gs = fig.add_gridspec(
            2, 3, height_ratios=(1,1), width_ratios=(1,1,1))

        self.ax0 = fig.add_subplot(gs[0, 0])
        self.ax1 = fig.add_subplot(gs[0, 1], sharex=self.ax0, sharey=self.ax0)
        self.ax2 = fig.add_subplot(gs[0, 2], sharex=self.ax0, sharey=self.ax0)
        self.axes = [self.ax0,self.ax1,self.ax2]

        self.ax0.set_title(self.map_hdu_name[0])
        self.ax1.set_title(self.map_hdu_name[1])
        self.ax2.set_title(self.map_hdu_name[2])
        self.axspec = fig.add_subplot(gs[1, :]) #brokenaxes(xlims=xlims,  hspace=.01, subplot_spec=gs[1, :])

        self.axes= self.axes[:len(self.map)]
        k=0
        for ax, map,its in zip(self.axes,self.map, range(len(self.axes))):
            if its==2:
                cmap='coolwarm'
                map_ind= self.indc[k]
            else:
                cmap='viridis'
                map_ind=self.indc[k]
            _img_ = ax.imshow(map[map_ind,:,:], origin='lower', cmap=cmap)
            k+=1
        
        self.xlimax = plt.axes([0.12, 0.03, 0.8, 0.03])
        self.xlim_slider = RangeSlider(self.xlimax, 'xlim', self.obs_wave[0], self.obs_wave[-1], valinit=(self.xlims[0], self.xlims[1]))
        self.xlim_slider.on_changed(self.slide_update)

        selector0  = matplotlib.patches.Rectangle(
            (14.5, 14.5), 1, 1, edgecolor='r', facecolor='none', lw=1.0)
        selector1  = matplotlib.patches.Rectangle(
            (14.5, 14.5), 1, 1, edgecolor='r', facecolor='none', lw=1.0)
        selector2  = matplotlib.patches.Rectangle(
            (14.5, 14.5), 1, 1, edgecolor='r', facecolor='none', lw=1.0)
        self.ax0.add_artist(selector0)
        self.ax1.add_artist(selector1)
        self.ax2.add_artist(selector2)
        selector0.set_visible(True)
        selector1.set_visible(True)
        selector2.set_visible(True)

        self.plot_general(50,50)
        plt.tight_layout()

        def update_plot(event):
            selector0.set_visible(True)
            i, j = int(event.xdata), int(event.ydata)

            #axspec = brokenaxes(xlims=xlims,  hspace=.01, subplot_spec=gs[1, :])
            #axspec = fig.add_subplot(gs[1, :])
            self.plot_general(i,j)
            selector0.set_xy((i-.5, j-.5))
            selector1.set_xy((i-.5, j-.5))
            selector2.set_xy((i-.5, j-.5))

        def hover(event):
            if (event.inaxes != self.ax0):
                selector0.set_visible(False),selector1.set_visible(False),selector2.set_visible(False)
                fig.canvas.draw_idle()
                return
            update_plot(event)
            fig.canvas.draw_idle()
        #fig.canvas.mpl_connect("motion_notify_event", hover)
        fig.canvas.mpl_connect("button_press_event", hover)    
        plt.show()   

    def slide_update(self, val):
        self.xlims = self.xlim_slider.val
        self.axspec.set_xlim(self.xlims[0], self.xlims[1])

    
```

`Qubespec/QubeSpec/Voronoi/__init__.py`:

```py
from .vor_bin import *
```

`Qubespec/QubeSpec/Voronoi/vor_bin.py`:

```py
from os import path
import numpy as np
import matplotlib.pyplot as plt
import tqdm
from vorbin.voronoi_2d_binning import voronoi_2d_binning
from astropy import stats
from astropy.io import fits

from matplotlib.backends.backend_pdf import PdfPages
from brokenaxes import brokenaxes

from .. import Utils as sp
from .. import Plotting as emplot
from .. import Fitting as emfit

from ..Models import Halpha_OIII_models as HaO_models
import pickle

def Voronoi_binning(Map_SNR, Map_noise, target_SNR, plot=1,quiet=0):
    """
    Perform Voronoi binning on a 2D map.

    Parameters:
    - Map_SNR (ndarray): 2D array representing the signal-to-noise ratio map.
    - Map_noise (ndarray): 2D array representing the noise map.
    - target_SNR (float): Target signal-to-noise ratio.
    - plot (int, optional): Flag to enable/disable plotting. Default is 1 (enabled).
    - quiet (int, optional): Flag to enable/disable progress bar. Default is 0 (disabled).

    Returns:
    - Map_seg (ndarray): 2D array representing the segmented map.

    Note:
    - The input maps (Map_SNR and Map_noise) should have the same shape.
    - The output segmented map (Map_seg) will have the same shape as the input maps.

    """
    shapes = Map_SNR.shape
    x = []
    y = []
    SNR = []
    noise = []
    for i in range(shapes[1]):
        for j in range(shapes[0]):
            if np.isfinite(Map_SNR[j,i]):
                x.append(i)
                y.append(j)
                SNR.append(Map_SNR[j,i])
                noise.append(Map_noise[j,i])

    x = np.array(x)
    y = np.array(y)
    SNR = np.array(SNR)
    noise = np.array(noise)
    signal = noise*SNR
    # Perform the actual computation. The vectors
    # (binNum, xNode, yNode, xBar, yBar, sn, nPixels, scale)
    # are all generated in *output*
    #
    binNum, x_gen, y_gen, x_bar, y_bar, sn, nPixels, scale = voronoi_2d_binning(
        x, y, signal, noise, target_SNR, plot=plot, quiet=quiet, pixelsize=1)
    
    Map_seg = np.full_like(Map_SNR, np.nan)
    for k,(seg,i,j) in enumerate(zip(binNum,x,y)):
        Map_seg[j,i] = seg

    return Map_seg

def unwrap_voronoi(Cube, Map_seg, add='', err_range=[0], boundary=2.4 ):
    """
    Unwraps the Voronoi segments in a given Cube object and saves the results.

    Parameters:
    -----------
    Cube : object
        The Cube object containing the data.
    Map_seg : array-like
        The segmentation map.
    add : str, optional
        Additional string to append to the saved file name. Default is an empty string.
    err_range : list, optional
        The range of error values to consider. Default is [0].
    boundary : float, optional
        The boundary value for error scaling. Default is 2.4.

    Returns:
    --------
    None

    Notes:
    ------
    The Cube object should have the following attributes:
    - Sky_stack_mask: A 2D mask array indicating the sky stack.
    - instrument: A string indicating the instrument used.
    - lux: A 3D data array containing the flux values.
    - sky_clipped: A 2D mask array indicating the clipped sky.
    - sky_clipped_1D: A 1D mask array indicating the clipped sky.
    - error_cube: A 3D data array containing the error values.
    - obs_wave: A 1D array containing the observed wavelengths.
    - z: A float indicating the redshift value.
    - savepath: A string indicating the path to save the results.
    - ID: A string indicating the ID of the Cube object.
    - band: A string indicating the band of the Cube object.

    Examples:
    ---------
    >>> unwrap_voronoi(Cube, Map_seg)
    """

    itere = np.unique(Map_seg)
    segs= itere[np.isfinite(itere)]
    Spax_mask = Cube.Sky_stack_mask[0,:,:]

    Unwrapped_cube = []
    for seg in tqdm.tqdm(segs):
        Spax_mask[:,:] = True
        Spax_mask[Map_seg==seg] = False


        if Cube.instrument=='NIRSPEC_IFU':
            total_mask = np.logical_or(Spax_mask, Cube.sky_clipped)
            flx_spax_t = np.ma.array(data=Cube.flux.data,mask=total_mask)

            flx_spax = np.ma.median(flx_spax_t, axis=(1,2))
            flx_spax_m = np.ma.array(data = flx_spax.data, mask=Cube.sky_clipped_1D)
            nspaxel= np.sum(np.logical_not(total_mask[22,:,:]))
            Var_er = np.sqrt(np.ma.sum(np.ma.array(data=Cube.error_cube.data, mask= total_mask)**2, axis=(1,2))/nspaxel)

            error = sp.error_scaling(Cube.obs_wave, flx_spax_m, Var_er, err_range, boundary,\
                                        exp=0)

        else:
            flx_spax_t = np.ma.array(data=Cube.flux.data,mask=Spax_mask)
            flx_spax = np.ma.median(flx_spax_t, axis=(1,2))
            flx_spax_m = np.ma.array(data = flx_spax.data, mask=Cube.sky_clipped_1D)

            error = stats.sigma_clipped_stats(flx_spax_m,sigma=3)[2] * np.ones(len(flx_spax))

        Unwrapped_cube.append([seg,seg,flx_spax_m, error,Cube.obs_wave, Cube.z])


    print(len(Unwrapped_cube))
    with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_Unwrapped_cube_voronoi'+add+'.txt', "wb") as fp:
        pickle.dump(Unwrapped_cube, fp)



def fill_cube(array, fill, mask):
    """
    Fill the specified elements of a 3D array with a given value based on a mask.

    Parameters:
        array (ndarray): The 3D array to be filled.
        fill (scalar): The value to fill the specified elements with.
        mask (ndarray): The mask indicating which elements to fill.

    Returns:
        ndarray: The filled 3D array.

    """
    array_copy = np.copy(array)
    shapes = mask.shape
    for j in range(shapes[1]):
        for i in range(shapes[0]):
           if mask[i,j]==True:
               array_copy[:,i,j] = fill
    return array_copy

def Map_creation_general(Cube,info, Map_seg, SNR_cut = 3 ,  width_upper=300,add='',\
                            brokenaxes_xlims= ((2.820,3.45),(3.75,4.05),(5,5.3)) ):
    """
    Function to post process voronoi spaxel fits. The function will load the fits results and determine which model is more likely,
    based on BIC. It will then calculate the W80 of the emission lines, V50 etc and create flux maps, velocity maps eyc.,
    Afterwards it saves all of it as .fits file. 

    Parameters
    ----------
        
    Cube : QubeSpec.Cube class instance
        Cube class from the main part of the QubeSpec. 
            
    info : dict
        dictionary containing information on what to extract. 

    SNR_cut : float
        SNR cutoff to detect emission lines 
            
    add : str
        additional string to use to load the results and save maps/pdf
            
    brokenaxes_xlims: list
        list of wavelength ranges to use for broken axes when plotting

    Returns
    -------
    f : matplotlib.figure.Figure
        The figure object containing the plot.

    """
    z0 = Cube.z
    failed_fits=0
    
    # =============================================================================
    #         Importing all the data necessary to post process
    # =============================================================================
    with open(Cube.savepath+Cube.ID+'_'+Cube.band+'_spaxel_fit_raw_general_voronoi'+add+'.txt', "rb") as fp:
        results= pickle.load(fp)

    # =============================================================================
    #         Setting up the maps
    # =============================================================================
    Result_cube = np.zeros_like(Cube.flux.data)
    Result_cube_data = Cube.flux.data
    Result_cube_error = Cube.error_cube.data
    
    info_keys = list(info.keys())
    
    for key in info_keys:
        if key=='params':
            info[key] = {'extract':info[key]}
            for param in info[key]['extract']:
                info[key][param] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)

        else:
            map_flx = np.zeros((4,Cube.dim[0], Cube.dim[1]))
            map_flx[:,:,:] = np.nan
                
            info[key]['flux_map'] = map_flx
            
            if 'kin' in list(info[key]):
                info[key]['W80'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)
                info[key]['peak_vel'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)

                info[key]['v10'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)
                info[key]['v90'] = np.full((3, Cube.dim[0], Cube.dim[1]),np.nan)


    BIC_map = np.zeros((Cube.dim[0], Cube.dim[1]))
    BIC_map[:,:] = np.nan

    chi2_map = np.zeros((Cube.dim[0], Cube.dim[1]))
    chi2_map[:,:] = np.nan
    # =============================================================================
    #        Filling these maps
    # =============================================================================

    Spax = PdfPages(Cube.savepath+Cube.ID+'_Spaxel_general_fit_voronoi_detection_only'+add+'.pdf')

    for row in tqdm.tqdm(range(len(results))):

        try:
            i,j, Fits = results[row]
        except:
            ls=0
        if str(type(Fits)) == "<class 'dict'>":
            failed_fits+=1
            continue

        mask = Map_seg==i        
        #Result_cube_data[:,mask] = Fits.fluxs.data
        Result_cube_data = fill_cube(Result_cube_data, Fits.fluxs.data, mask)
        try:
            Result_cube_error= fill_cube(Result_cube_error, Fits.error.data, mask)
        except:
            lds=0
        
        Result_cube= fill_cube(Result_cube, Fits.yeval, mask)
        try:
            chi2_map[mask], BIC_map[mask] = Fits.chi2, Fits.BIC
        except:
            chi2_map[mask], BIC_map[mask] = 0,0

        for key in info_keys:
            if key=='params':
                for param in info[key]['extract']:
                    info[key][param] =  fill_cube(info[key][param], np.percentile(Fits.chains[param], (16,50,84)), mask) 
            else:
                if 'kin' not in key:
                    SNR= sp.SNR_calc(Cube.obs_wave, Fits.fluxs, Fits.error, Fits.props, 'general',\
                                        wv_cent = info[key]['wv'],\
                                        peak_name = key+'_peak', \
                                            fwhm_name = info[key]['fwhm'])
                    
                    info[key]['flux_map'][0,mask] = SNR
                    
                    if SNR>SNR_cut:
                        flux, p16,p84 = sp.flux_calc_mcmc(Fits, 'general', Cube.flux_norm,\
                                                            wv_cent = info[key]['wv'],\
                                                            peak_name = key+'_peak', \
                                                                fwhm_name = info[key]['fwhm'])
                        
                        info[key]['flux_map'][1,mask] = flux
                        info[key]['flux_map'][2,mask] = p16
                        info[key]['flux_map'][3,mask] = p84

                        if 'kin' in list(info[key]):
                            kins_par = sp.vel_kin_percentiles(Fits, peak_names=info[key]['kin']['peaks'], \
                                                                                fwhm_names=info[key]['kin']['fwhms'],\
                                                                                vel_names=info[key]['kin']['vels'],\
                                                                                rest_wave=info[key]['wv'],\
                                                                                N=100,z=Cube.z)
                    
                            info[key]['W80'] = fill_cube(info[key]['peak_vel'], kins_par['w80'], mask)
                            info[key]['peak_vel'] = fill_cube(info[key]['peak_vel'], kins_par['vel_peak'], mask)

                            info[key]['v10'] = fill_cube(info[key]['peak_vel'],  kins_par['v10'], mask)
                            info[key]['v90'] = fill_cube(info[key]['peak_vel'], kins_par['v90'], mask)
                            
                    else:
                        flux, p16,p84 = sp.flux_calc_mcmc(Fits, 'general', Cube.flux_norm,\
                                                            wv_cent = info[key]['wv'],\
                                                            peak_name = key+'_peak', \
                                                                fwhm_name = info[key]['fwhm'])
                        info[key]['flux_map'][2,mask] = p16


# =============================================================================
#             Plotting
# =============================================================================
        f = plt.figure( figsize=(20,6))

        ax = brokenaxes(xlims=brokenaxes_xlims,  hspace=.01)
        
        ax.plot(Fits.wave, Fits.fluxs.data, drawstyle='steps-mid')
        y= Fits.yeval
        ax.plot(Cube.obs_wave,  y, 'r--')
        
        ax.set_xlabel('wavelength (um)')
        ax.set_ylabel('Flux density')
        
        ax.set_ylim(-2*Fits.error[0], 1.2*max(y))
        ax.set_title('xy='+str(j)+' '+ str(i) )

        Spax.savefig()
        plt.close(f)

    print('Failed fits', failed_fits)
    Spax.close()

# =============================================================================
#         Plotting maps
# =============================================================================
    primary_hdu = fits.PrimaryHDU(np.zeros((3,3,3)), header=Cube.header)
    hdus = [primary_hdu]
    hdus.append(fits.ImageHDU(Result_cube_data, name='flux'))
    hdus.append(fits.ImageHDU(Result_cube_error, name='error'))
    hdus.append(fits.ImageHDU(Result_cube, name='yeval'))

    for key in info_keys:
        if key=='params':
            for param in info[key]['extract']:
                hdus.append(fits.ImageHDU(info[key][param], name=param))
            
        else: 
            hdus.append(fits.ImageHDU(info[key]['flux_map'], name=key))
            
            if 'kin' in list(info[key]):
                hdus.append(fits.ImageHDU(info[key]['peak_vel'], name=key+'_peakvel'))
                hdus.append(fits.ImageHDU(info[key]['W80'], name=key+'_W80'))
                hdus.append(fits.ImageHDU(info[key]['v10'], name=key+'_v10'))
                hdus.append(fits.ImageHDU(info[key]['v90'], name=key+'_v90'))


    hdus.append(fits.ImageHDU(chi2_map, name='chi2'))
    hdus.append(fits.ImageHDU(BIC_map, name='BIC'))
    hdulist = fits.HDUList(hdus)
    hdulist.writeto(Cube.savepath+Cube.ID+'_general_fits_voronoi_maps'+add+'.fits', overwrite=True)

    return f
```

`Qubespec/QubeSpec/__init__.py`:

```py
from .QubeSpec import *

```

`Qubespec/QubeSpec/detection/Detection.py`:

```py
# coding: utf-8
import os

import numpy as np
import matplotlib.pyplot as plt

from astropy import units
from astropy.stats import biweight_scale

import sep

__all__ = ('source_detection',)



def __source_detection__(image, noise, mask=None, detection_threshold=3,
    deblend_cont=0.005, segmentation_map=True):
    """
    image  : 2-d array
    noise  : 2-d array
    """

    obj, seg = sep.extract(image, detection_threshold,
        err=noise, mask=mask, deblend_cont=deblend_cont,
        segmentation_map=segmentation_map)

    return obj, seg


def source_detection(flux, error, obs_wave, wave_range=(-np.inf, np.inf),
    noise_type='nominal', plot=True, **kwargs):

    """Use `sep` to detect sources in the datacube.

    flux:
    error:
    obs_wave
    wave_range : 2-elements [wavelength]
        use only the specified wavelength range for creating the detection image.
        The default uses all wavelength elements (`white-light image`).
    noise_type : str, optional
        If `uniform`, use the robust standard deviation of the background-subtracted
        image. If `nominal`, use the formal uncertainty on the detection image; the
        latter may be underestimated!
    kwargs : optional
        any valid keyword for `__source_detection__`.

    Return
    ------

    obj : structured array
        Each row contains data for an individual detection.
    seg : 2-d int array
        A segmentation map: 1 for spaxels belonging to the first source in `obj`,
        2 for the second source, etc.

    Note: the 1-d, 2-d and 3-d masks of the datacube are always applied. The
    principle is that these masks contain invalid entries.
    """

    mask1d = (obs_wave<wave_range[0]) | (obs_wave>wave_range[1])

    mask3d = flux.mask | mask1d[:, None, None] # Also apply 3-d DQ mask.
    spec_norm_factor = np.nanmedian(flux.data[~mask3d])
    spec_norm = flux / spec_norm_factor

    image = np.nanmedian(np.where(mask3d, np.nan, spec_norm), axis=0)

    # This is onyl a rough background for object detection, not the final background.
    mask2d = flux==np.nan
    mask2d = mask2d[100,:,:]
    rough_background = sep.Background(image, mask=mask2d)
    rough_background = rough_background.back()
    image -= rough_background

    if noise_type=='uniform':
        print('Uniform noise estimate for source detection')
        noise = biweight_scale(image[np.isfinite(image)])
        noise = np.full_like(image, noise)
    elif noise_type=='nominal':
        vars_norm = (error/spec_norm_factor)**2
        noise = np.nansum(np.where(mask3d, np.nan, vars_norm), axis=0) # Variance of sum.
        noise /= np.nansum(np.where(mask3d, 0, 1), axis=0) # Variance of mean
        noise = np.sqrt(noise * np.pi / 2.) # From variance of mean to of median.
    else:
        raise ValueError(f'{noise_type=} not supported')

    obj, seg = __source_detection__(image, noise, mask=mask2d, **kwargs)

    if plot:
        
        fig, (ax0, ax1, ax2,ax3) = plt.subplots(1, 4, sharex=True, sharey=True, figsize=(15, 5))
        vmin, vmax = np.nanpercentile(image + rough_background, (1, 98))

        ax0.imshow(image, origin='lower', vmin=vmin, vmax=vmax, cmap='Greys')
        ax1.imshow(rough_background, origin='lower', vmin=vmin, vmax=vmax, cmap='Greys')
        ax2.imshow(seg, origin='lower', cmap='nipy_spectral')

        ax3.imshow(image, origin='lower', cmap='nipy_spectral')
        ax3.imshow(seg, origin='lower', cmap='nipy_spectral', alpha=0.5)
        for _ax_ in (ax0, ax1, ax2,ax3):
            _ax_.plot(obj['xcpeak'], obj['ycpeak'], color='firebrick',
                marker='.', mec='none', alpha=0.7, ms=12, ls='none')
        
        

    return obj, seg

```

`Qubespec/QubeSpec/jadify_temp/r100_jades_deep_hst_v3.1.1_template.yaml`:

```yaml
general:
    R: 100 # Can be 1000, 100, 100Irr
    create_dirs: True # If False, do not create non-existing directories, but raise exceptions
    matplotlib_backend: null # If a valid string, use that backend for plotting, e.g. "pdf"
    resume: False # If True, do not fit objects that already have a good fit in
                 # [dirs][output_dir].
cosmology:   # Used to find the age of the Universe for each object.
    H0:  67.4 # Hubble parameter at redshift z = 0 [km / (s Mpc)]
    Om0: 0.315 # Matter density at redshift z = 0. All from Planck18
dirs:
    data_dir:        "/Users/jansen/My Drive/Astro/COS30_IFS/Saves/PRISM_spaxel"
    output_dir:      "/Users/jansen/My Drive/Astro/COS30_IFS/Saves/PRISM_spaxel"
    g140m:           "g140m_f070lp"
    g235m:           "g235m_f170lp"
    g395m:           "g395m_f290lp"
    g395h:           "g395h_f290lp"
    prism:           "prism_clear"
    dr_version:      "v3.0"
    extraction:      "" # Default (5-spaxel box). Use "extr3" for 3-spaxel extraction
    subtraction:     "" # Default (three nods). Use "nod2" for 2-nod subtraction.
spec_res:
    prism:           "[default]/tables/01_disp/jwst_nirspec_prism_disp.fits"
    prism_irregular: "[default]/tables/01_disp/jwst_nirspec_prism_disp.fits"
    g140m:           "[default]/tables/01_disp/jwst_nirspec_g140m_disp.fits"
    g235m:           "[default]/tables/01_disp/jwst_nirspec_g235m_disp.fits"
    g395m:           "[default]/tables/01_disp/jwst_nirspec_g395m_disp.fits"
    g395h:           "[default]/tables/01_disp/jwst_nirspec_g395h_disp.fits"
remotedata:
    ftp:             "ftp.cosmos.esa.int"
    spec1d_dir:      "JADES-INTERNAL/NIRSpec_DP/Surveys/DataChallenge2/Final_products_v4"
    spec2d_dir:      "JADES-INTERNAL/NIRSpec_DP/Surveys/DataChallenge2/Final_products"
visual_inspection:
    vi_usernames:    ["mcurti", "rm"]
lick:
    specind_def: "[default]/tables/00_lick/index_definitions.dat"
ppxf: # ppxf related keywords (includes non-ppxf keywords relevant to the fit).
    re_fit_free: False  # If True, run a second ppxf fit where all detected lines have free
                       # velocity and dispersion.
    v_tol: 1000.       # [km/s] If `re_fit_free` is True, re-fit detected lines within +/-v_tol from previous solution.
    sigma_tol: 0.30   # [fraction] If `re_fit_free` is True, re-fit detected lines within +/-fraction from the previous solution.
    refit_detection_threshold: 5. # Lines with S/N>`detection_threshold` are fit free.
    balmer_lines: ['Balmer', 'Hepsilon', 'Hdelta', 'Hgamma', 'Hbeta', 'Halpha']
    #redshift_table: "00_redshifts/visual_redshifts_deep_r1000_MC_v1.fits"
    #redshift_table: "00_redshifts/visual_redshifts_deep_r100_MC_v1_z_bagp.fits"
    #redshift_table: "00_redshifts/visual_redshifts_gs_deep_hst_fde_v3.0_v1.0_TL_v2.0.csv"
    redshift_table: "/Users/jansen/My Drive/Astro/COS30_IFS/red_table.csv"
    tie_balmer: False # See ppxf documentation
    limit_doublets: False # See ppxf documentation # Deprecated
    gas_reddening: null
    degree:  -1 # See ppxf documentation
    mdegree: 15 # See ppxf documentation
    k_sigma:  3 # Used for `ppxfpp.augmented_ppxf.sigma_clip_tl`
    clean: False # See ppxf documentation
    #tied: null
    tied: [['', ''], ['',''], ['p[0]','p[1]'], ['',''], ['',''], ['',''], ['','']]
    bounds: [[[-2000., 2000.], [1., 1000.]],
             [[-2000., 2000.], [1., 1000.]],
             [[-2000., 2000.], [1., 1000.]],
             [[-2000., 2000.], [1., 1000.]],
             [[-2000., 2000.], [1., 1000.]],
             [[-2000., 2000.], [1., 1000.]],
             [[-2000., 2000.], [1., 2000.]]]
    run_mc: null # Number of mc runs (use `null` to do no runs).
    debug_mc: False # If True, debug MC run
    noise_treatment: 1. # allowed keywords are: 'rescale_noise', 'use_empir_noise' or a float number by which the noise should be rescalled, e.g. 2.
                    #rescale_noise: Up/down-scale noise spectrum based on residuals of
                    # *continuum* ppxf best-fit. If a positive number is
                    # provided, noise spectrum becomes `noise*rescale_noise`.is
                    #use_empir_noise: Whether to use empirical noise estimate for sigma clipping.
                    #float number: e.g. 2., float by which the noise should be rescaled
    fit_offsets: False # If True, when an offset is detected, the fit is run again
                      # including a template that attempts to model the offset (a top-hat
                      # or a step function). If False, detected offsets are reported but
                      # not fit.
upper_limits:
    n_sigma_wave: 1.5 # Number of line sigmas σ over which to integrate; the integration happens
                      # within ±`n_sigma_wave`⋅σ pixels. However, if
                      # `n_sigma_wave`⋅σ<`n_pixels`⋅Δλ (where Δλ is the pixel size), the
                      # algorithm will use ±`n_pixels`⋅Δλ from the centroid (see below).
    n_pixels: 1.5     # ±number of pixels over which to integrate the noise, if
                      # `n_sigma_wave`⋅σ<`n_pixels`⋅Δλ (where Δλ is the pixel size and σ is the
                      # line velocity dispersion); see `n_sigma_wave` above.
    detection_threshold: 3. # Factor to upscale the noise estimate. E.g. 3 means the upper limits are
                            # 3⋅σ upper limits.
stellar_templates:
    class: 'c3k_mist'
    regex: '/Users/jansen/SED_fitting/ppxf/c3k_mist_ssp_R700/SSP_C3K_MIST_Salpeter*fits'
    fwhm: '/Users/jansen/SED_fitting/ppxf/c3k_mist_ssp_R700/LSF-Config_c3k_mist'
    norm_range: null
      #[4000., 5200.]
emission_lines:
    # define names and vacuum restframe wavelength [Å] of lines we use in ppxf
    # For each entry (w, f, c, l)
    # Name: line name. IMPORTANT. Names ending with 'a', 'b', 'd' and 'm' have special
    #       meaning in post-processing. 'a' & 'b' are the maximum/minimum line ratio of
    #       variable doublets; 'd' are fixed-ratio doublets; 'm' are fixed ratio multiplets.
    #       The latter are useful e.g. for the Balmer series, when dust attenuation is used.
    # w: central wavelength;
    # f: flux ratio (not relevant for singlets)
    # c: kinematic component (*must be equal for each line in multiplet*)
    # l: label to be used in plotting (if '', line is marked with no name)
    # Note lines with the same `c` will have the same velocity and dispersion.
    # Name:       [[       w,  f,   c,         l            ]]
    'HLyA_1216'       : [[ 1215.670, 1.00, 5,[-1.000,99.000],  '$\mathrm{HLyA\_1216      }$ ']]
    'LyA_drop'        : [[ 1215.670, -1.0, 6,[-1.000,99.000],  '$\mathrm{LyA\_drop      }$ ']]
    #'N4_1483'    :  [[   1483.321, 1.00, 3,[-1.000,99.000],  '$\mathrm{N4\_1483        }$ ']]
    'N4_1486'    :  [[   1484.5, 1.00, 3,[-1.000,99.000],  '$\mathrm{N4\_1486        }$ ']]
    #'Si2_1531'   :  [[   1528.970, 1, 3,[-1.000,99.000],  '$\mathrm{Si2\_1531       }$ ']]
    #'C4_1548'    :  [[   1548.190, 1, 3,[-1.000,99.000],  '$\mathrm{C4\_1548        }$ ']]
    #'C4_1551'    :  [[   1550.770, 1, 3,[-1.000,99.000],  '$\mathrm{C4\_1551        }$ ']]
    'C4_1549'         : [[ 1549.480, 1, 3,[-1.000,99.000],  '$\mathrm{C4\_1549        }$ ']]
    #'He2_1640'        : [[ 1640.420, 1, 3,[-1.000,99.000],  '$\mathrm{He2\_1640       }$ ']]
    #'O3_1661'    :  [[   1660.810, 1, 3,[-1.000,99.000],  '$\mathrm{O3\_1661        }$ ']]
    #'O3_1666'    :  [[   1666.150, 1, 3,[-1.000,99.000],  '$\mathrm{O3\_1666        }$ ']]
    'Blnd_He2_O3_1650': [[ 1650.000, 1, 3,[-1.000,99.000],  '$\mathrm{He2\_1640 + O3\_1661d}$']]
    #'O3_1661d'   :  [[   1660.810, 0.341, 3,[-1.000,99.000],  '$\mathrm{O3\_1661    }$ '], # PyNeb
    #                 [   1666.150, 1., 3,[-1.000,99.000],  '$\mathrm{O3\_1666       }$ ']]
    #'Al2_1671'   :  [[   1670.790, 1, 3,[-1.000,99.000],  '$\mathrm{Al2\_1671       }$ ']]
    'N3_1752'    :  [[   1751., 1.00, 3,[-1.000,99.000],  '$\mathrm{N3\_1752        }$ ']]
    #'Si3_1883'   :  [[   1882.710, 1, 3,[-1.000,99.000],  '$\mathrm{Si3\_1883       }$ ']]
    #'Si3_1892'   :  [[   1892.030, 1, 3,[-1.000,99.000],  '$\mathrm{Si3\_1892       }$ ']]
    #'Si3_1883'   :  [[   1887.370, 0., 3,[-1.000,99.000],  '$\mathrm{Si3\_1883      }$ ']] # 2019ApJ...880...16K
    #'C3_1907'    :  [[   1906.680, 1, 3,[-1.000,99.000],  '$\mathrm{C3\_1907        }$ ']]
    #'C3_1910'    :  [[   1908.730, 1, 3,[-1.000,99.000],  '$\mathrm{C3\_1910        }$ ']]
    'C3_1907'         : [[ 1907.705, 1, 3,[-1.000,99.000],  '$\mathrm{C3\_1907       }$ ']] # 2019ApJ...880...16K
    #'N2_2141'    :  [[   2142.300, 1, 3,[-1.000,99.000],  '$\mathrm{N2\_2141        }$ ']]
    'Ne4_2424'   :  [[   2425.158, 1, 3,[-1.000,99.000],  '$\mathrm{Ne4\_2424        }$ ']]
    #'Mg2_2796'   :  [[   2796.352, 1, 3,[-1.000,99.000],  '$\mathrm{Mg2\_2796       }$ ']]
    #'Mg2_2803'   :  [[   2803.531, 1, 3,[-1.000,99.000],  '$\mathrm{Mg2\_2803       }$ ']]
    'Mg2_2796'        : [[ 2799.942, 1, 3,[-1.000,99.000],  '$\mathrm{Mg2\_2796      }$ ']] # 2020MNRAS.498.2554C
    #'Ne5_3426':     [[   3426.850, 1.00, 3,[-1.000,99.000],  '$\mathrm{Ne5\_3426    }$ ']] # Singlet, NIST
    #'O2_3726'    :  [[   3727.100, 1, 1,[-1.000,99.000],  '$\mathrm{O2\_3726        }']]
    #'O2_3729'    :  [[   3729.875, 1, 1,[-1.000,99.000],  '$\mathrm{O2\_3729        }']]
    'O2_3727'         : [[ 3728.488, 1.000, 1,[-1.000,99.000],  '$\mathrm{O2\_3726}$']] # 2019ApJ...880...16K
    #'H1_3797'    :  [[   3798.987, 1, 2,[-1.000,99.000],  '$\mathrm{H1\_3797        }$ ']]
    #'H1_3835'    :  [[   3836.485, 1, 2,[-1.000,99.000],  '$\mathrm{H1\_3835        }$ ']]
    #'Ne3_3869'   :  [[   3869.860, 1, 1,[-1.000,99.000],  '$\mathrm{Ne3\_3869       }']]
    'Ne3_3869d'       : [[ 3869.860, 1.000, 1,[-1.000,99.000],  '$\mathrm{Ne3\_3869}$'], # PyNeb
                         [ 3968.590, 0.301, 1,[-1.000,99.000],  '$\mathrm{Ne3\_3968}$']]
    #'He1_3889'   :  [[   3889.730, 1, 1,[-1.000,99.000],  '$\mathrm{He1\_3889       }$ ']]
    #'H1_3890'    :  [[   3890.166, 1, 2,[-1.000,99.000],  '$\mathrm{H1\_3890        }$ ']]
    #'Ne3_3968'   :  [[   3968.590, 1, 1,[-1.000,99.000],  '$\mathrm{Ne3\_3968       }']]
    #'H1_3970'    :  [[   3971.198, 1, 2,[-1.000,99.000],  '$\mathrm{H1\_3970        }$ ']]
    #'He1_4027'   :  [[   4027.329, 1, 1,[-1.000,99.000],  '$\mathrm{He1\_4027       }$ ']]
    #'S2_4070'    :  [[   4069.749, 1, 1,[-1.000,99.000],  '$\mathrm{S2\_4070        }$ ']]
    #'S2_4078'    :  [[   4077.500, 1, 1,[-1.000,99.000],  '$\mathrm{S2\_4078        }$ ']]
    'HBaD_4102'        : [[ 4102.860, 1.000, 2,[-1.000,99.000],  '$\mathrm{HBaD\_4102      }$ ']]
    'HBaG_4340'        : [[ 4341.647, 1.000, 2,[ 5.300,99.000],  '$\mathrm{HBaG\_4340      }$ ']]
    'O3_4363'          : [[ 4364.436, 1.000, 1,[ 5.300,99.000],  '$\mathrm{O3\_4363        }$ ']]
    'Blnd_HBaG_O3_4340': [[ 4341.647, 1.000, 2,[-1.000, 5.300],  '$\mathrm{HBaG\_4340+O3\_4363}$ ']]
    #'Ne4_4725'   :  [[   4725.47,  1, 1,[-1.000,99.000],  '$\mathrm{Ne4\_4725       }$' ]]
    'HBaB_4861'        : [[ 4862.637, 1.000, 2,[-1.000,99.000],  '$\mathrm{HBaB\_4861      }$ ']]
    #'O3_4959'    :  [[   4960.295, 1, 1,[-1.000,99.000],  '$\mathrm{O3\_4959        }']]
    #'O3_5007'    :  [[   5008.240, 1, 1,[-1.000,99.000],  '$\mathrm{O3\_5007        }']]
    'O3_5007d'         : [[ 4960.295, 0.335, 1,[-1.000,99.000],  '$\mathrm{[OIII]}$'], # PyNeb
                          [ 5008.240, 1.000, 1,[-1.000,99.000], '$\mathrm{[OIII]}$']]
    #'O1_5577'    :  [[   5578.887, 1, 1,[-1.000,99.000],  '$\mathrm{O1\_5577        }$ ']]
    #'N2_5755'    :  [[   5756.190, 1, 1,[-1.000,99.000],  '$\mathrm{N2\_5755        }$ ']]
    'He1_5875'         : [[ 5877.249, 1.000, 1,[-1.000,99.000],  '$\mathrm{He1\_5875       }$ ']]
    'O1_6300'          : [[ 6302.046, 1.000, 1,[-1.000,99.000],  '$\mathrm{O1\_6300        }$ ']]
    #'[OI]':       [[ 6363.67, 0.33, 1,[-1.000,99.000],  '$\mathrm{[OI]}$'    ],
    #               [ 6302.046, 1.00, 1,[-1.000,99.000],  '$\mathrm{[OI]}$'    ]]
    #'S3_6312'    :  [[   6313.810, 1, 1,[-1.000,99.000],  '$\mathrm{S3\_6312        }$ ']]
    #'N2_6548'    :  [[   6549.860, 1, 1,[-1.000,99.000],  '$\mathrm{N2\_6548        }']]
    #'N2_6584d':     [[ 6549.860, 0.340, 2,[-1.000,99.000],  '$\mathrm{[NII]}$' ], # PyNeb
    #                 [ 6585.273, 1.00, 2,[-1.000,99.000],  '$\mathrm{[NII]}$' ]]
    'Blnd_HBaA_N2'     : [[ 6564.523, 1.000, 2,[-1.000,99.000],  '$\mathrm{HBaA\_6563+[NII]}$ ']]
    #'N2_6584'    :  [[   6585.273, 1, 1,[-1.000,99.000],  '$\mathrm{N2\_6584        }']]
    'S2_6725'          : [[ 6725.000, 0.440, 1,[-1.000,99.000], '$\mathrm{S2\_6725}$']]
    'He1_7065'         : [[ 7067.138, 1.000, 1,[-1.000,99.000],  '$\mathrm{He1\_7065       }$ ']]
    #'O2_7323'    :  [[   7321.940, 1, 1,[-1.000,99.000],  '$\mathrm{O2\_7323        }$ ']]
    #'O2_7332'    :  [[   7332.210, 1, 1,[-1.000,99.000],  '$\mathrm{O2\_7332        }$ ']]
    'O2_7323d'  :  [[   7321.940, 1, 1,[-1.000,99.000],  '$\mathrm{O2\_7323         }$ '],   # PyNeb
                    [   7332.210, 0.52, 1,[-1.000,99.000],  '$\mathrm{O2\_7332      }$ ']]
    #'S3_9069'    :  [[   9071.100, 1, 4,[-1.000,99.000],  '$\mathrm{S3\_9069        }$ ']]
    #'S3_9532'    :  [[   9533.200, 1, 4,[-1.000,99.000],  '$\mathrm{S3\_9532        }$ ']]
    'S3_9069d'         : [[ 9071.100, 0.405, 4,[-1.000,99.000],  '$\mathrm{S3\_9069   }$ '], # PyNeb
                          [ 9533.200, 1.000, 4,[-1.000,99.000],  '$\mathrm{S3\_9532        }$ ']]
    'HPaD_10049'       : [[10052.123, 1.000, 4,[-1.000,99.000],  '$\mathrm{HPaD\_10049     }$ ']]
    'He1_10829'        : [[10832.057, 1.000, 4,[-1.000,99.000],  '$\mathrm{He1\_10829      }$ ']]
    'HPaG_10938'       : [[10940.978, 1.000, 4,[-1.000,99.000],  '$\mathrm{HPaG\_10938     }$ ']]
    'HPaB_12818'       : [[12821.432, 1.000, 4,[-1.000,99.000],  '$\mathrm{HPaB\_12818     }$ ']]
    #'Fe2_16440'          [[  16440.017, 1.000, 4,[-1.000,99.000],  '$\mathrm{Fe2\_16440      }$ ']]
    'HPaA_18751'       : [[18755.804, 1.000, 4,[-1.000,99.000],  '$\mathrm{HPaA\_18751     }$ ']]
    'HBrD_19446'       : [[19450.890, 1.000, 4,[-1.000,99.000],  '$\mathrm{HBrD\_19446     }$ ']]
    #'Si6_19631'          [[  19646.000, 1.000, 4,[-1.000,99.000],  '$\mathrm{Si6\_19631      }$ ']]
    #'Al9_20430'          [[  20430.000, 1.000, 4,[-1.000,99.000],  '$\mathrm{Al9\_20430      }$ ']]
    #'H_2_1_0_S1'         [[  21218.000, 1.000, 4,[-1.000,99.000],  '$\mathrm{H\_2\_1\_0\_S1  }$ ']]
    'HBrG_21655'       : [[21661.180, 1.000, 4,[-1.000,99.000],  '$\mathrm{HBrG\_21655     }$ ']]
    'HBrB_26252'       : [[26258.680, 1.000, 4,[-1.000,99.000],  '$\mathrm{HBrB\_26252     }$ ']]
    'HBrA_40512'       : [[40522.690, 1.000, 4,[-1.000,99.000],  '$\mathrm{HBrA\_40512     }$ ']]
    #'Fe2_53400'  :  [[  53400.000, 1, 4,[-1.000,99.000],  '$\mathrm{Fe2\_53400      }$ ']]

```

`Qubespec/README.md`:

```md
QubeSpec is a simple but powerful python package to fit optical astronomical spectra and more importantly analysing IFS cube from JWST/NIRSpec, JWST/MIRI, VLT/KMOS and VLT/SINFONI. The code has built models for fitting Halpha, [OIII], Hbeta, [SII] and [NII] of galaxies, galaxies with outflows, Type-1 AGN and Quasars.

Authors: Jan Scholtz, Francesco D'Eugenio and Ignas Ignas Juodžbalis

# Obtain the source code.

Obtain the *stable* version of the source code by following <a href="https://github.com/honzascholtz/qubespec/archive/refs/heads/main.zip" target=_blank>this link</a>. Unpack it somewhere, say in folder `tests`.  


# Installation instructions

From inside your working directory, run (works on `bash`, untested on `tcsh`)
```
conda create -n qubespec python=3.9
conda activate qubespec
git clone https://github.com/honzascholtz/Qubespec.git
pip3 install QubeSpec/.
```

You should then be able to import QubeSpec in python as:
```
import QubeSpec
```

More information can be found at https://qubespec.readthedocs.io/en/latest/

11/3/22 - Added support for mapping the emission - spaxel by spaxel fitting for the [OIII] emission. Currently fitting a single Gaussian profile - outflow detection and mapping will be done differently.

10/3/22 - Added function for calculating the fluxes. Some new support for fitting the maps using least dqaure fitting. However, it is now broken do not use.

```

`Qubespec/Tutorial/cdfs_38_H_inner_1Dspectrum.txt`:

```txt
1.424999952316279961e+00 1.425215772644146783e+00 1.425431592972013606e+00 1.425647413299880428e+00 1.425863233627747251e+00 1.426079053955614073e+00 1.426294874283480896e+00 1.426510694611347718e+00 1.426726514939214541e+00 1.426942335267081363e+00 1.427158155594948186e+00 1.427373975922815008e+00 1.427589796250681831e+00 1.427805616578548653e+00 1.428021436906415476e+00 1.428237257234282298e+00 1.428453077562149121e+00 1.428668897890015943e+00 1.428884718217882766e+00 1.429100538545749588e+00 1.429316358873616410e+00 1.429532179201483233e+00 1.429747999529350055e+00 1.429963819857216878e+00 1.430179640185083700e+00 1.430395460512950523e+00 1.430611280840817345e+00 1.430827101168684168e+00 1.431042921496550990e+00 1.431258741824417813e+00 1.431474562152284635e+00 1.431690382480151458e+00 1.431906202808018280e+00 1.432122023135885103e+00 1.432337843463751925e+00 1.432553663791618748e+00 1.432769484119485570e+00 1.432985304447352393e+00 1.433201124775219215e+00 1.433416945103086038e+00 1.433632765430952860e+00 1.433848585758819683e+00 1.434064406086686505e+00 1.434280226414553328e+00 1.434496046742420150e+00 1.434711867070286972e+00 1.434927687398153795e+00 1.435143507726020617e+00 1.435359328053887440e+00 1.435575148381754262e+00 1.435790968709621085e+00 1.436006789037487907e+00 1.436222609365354730e+00 1.436438429693221552e+00 1.436654250021088375e+00 1.436870070348955197e+00 1.437085890676822020e+00 1.437301711004688842e+00 1.437517531332555665e+00 1.437733351660422487e+00 1.437949171988289310e+00 1.438164992316156132e+00 1.438380812644022955e+00 1.438596632971889777e+00 1.438812453299756600e+00 1.439028273627623422e+00 1.439244093955490245e+00 1.439459914283357067e+00 1.439675734611223890e+00 1.439891554939090712e+00 1.440107375266957535e+00 1.440323195594824357e+00 1.440539015922691179e+00 1.440754836250558002e+00 1.440970656578424824e+00 1.441186476906291647e+00 1.441402297234158469e+00 1.441618117562025292e+00 1.441833937889892114e+00 1.442049758217758937e+00 1.442265578545625759e+00 1.442481398873492582e+00 1.442697219201359404e+00 1.442913039529226227e+00 1.443128859857093049e+00 1.443344680184959872e+00 1.443560500512826694e+00 1.443776320840693517e+00 1.443992141168560339e+00 1.444207961496427162e+00 1.444423781824293984e+00 1.444639602152160807e+00 1.444855422480027629e+00 1.445071242807894452e+00 1.445287063135761274e+00 1.445502883463628097e+00 1.445718703791494919e+00 1.445934524119361742e+00 1.446150344447228564e+00 1.446366164775095386e+00 1.446581985102962209e+00 1.446797805430829031e+00 1.447013625758695854e+00 1.447229446086562676e+00 1.447445266414429499e+00 1.447661086742296321e+00 1.447876907070163144e+00 1.448092727398029966e+00 1.448308547725896789e+00 1.448524368053763611e+00 1.448740188381630434e+00 1.448956008709497256e+00 1.449171829037364079e+00 1.449387649365230901e+00 1.449603469693097724e+00 1.449819290020964546e+00 1.450035110348831369e+00 1.450250930676698191e+00 1.450466751004565014e+00 1.450682571332431836e+00 1.450898391660298659e+00 1.451114211988165481e+00 1.451330032316032304e+00 1.451545852643899126e+00 1.451761672971765949e+00 1.451977493299632771e+00 1.452193313627499593e+00 1.452409133955366416e+00 1.452624954283233238e+00 1.452840774611100061e+00 1.453056594938966883e+00 1.453272415266833706e+00 1.453488235594700528e+00 1.453704055922567351e+00 1.453919876250434173e+00 1.454135696578300996e+00 1.454351516906167818e+00 1.454567337234034641e+00 1.454783157561901463e+00 1.454998977889768286e+00 1.455214798217635108e+00 1.455430618545501931e+00 1.455646438873368753e+00 1.455862259201235576e+00 1.456078079529102398e+00 1.456293899856969221e+00 1.456509720184836043e+00 1.456725540512702866e+00 1.456941360840569688e+00 1.457157181168436511e+00 1.457373001496303333e+00 1.457588821824170155e+00 1.457804642152036978e+00 1.458020462479903800e+00 1.458236282807770623e+00 1.458452103135637445e+00 1.458667923463504268e+00 1.458883743791371090e+00 1.459099564119237913e+00 1.459315384447104735e+00 1.459531204774971558e+00 1.459747025102838380e+00 1.459962845430705203e+00 1.460178665758572025e+00 1.460394486086438848e+00 1.460610306414305670e+00 1.460826126742172493e+00 1.461041947070039315e+00 1.461257767397906138e+00 1.461473587725772960e+00 1.461689408053639783e+00 1.461905228381506605e+00 1.462121048709373428e+00 1.462336869037240250e+00 1.462552689365107073e+00 1.462768509692973895e+00 1.462984330020840718e+00 1.463200150348707540e+00 1.463415970676574362e+00 1.463631791004441185e+00 1.463847611332308007e+00 1.464063431660174830e+00 1.464279251988041652e+00 1.464495072315908475e+00 1.464710892643775297e+00 1.464926712971642120e+00 1.465142533299508942e+00 1.465358353627375765e+00 1.465574173955242587e+00 1.465789994283109410e+00 1.466005814610976232e+00 1.466221634938843055e+00 1.466437455266709877e+00 1.466653275594576700e+00 1.466869095922443522e+00 1.467084916250310345e+00 1.467300736578177167e+00 1.467516556906043990e+00 1.467732377233910812e+00 1.467948197561777635e+00 1.468164017889644457e+00 1.468379838217511280e+00 1.468595658545378102e+00 1.468811478873244925e+00 1.469027299201111747e+00 1.469243119528978569e+00 1.469458939856845392e+00 1.469674760184712214e+00 1.469890580512579037e+00 1.470106400840445859e+00 1.470322221168312682e+00 1.470538041496179504e+00 1.470753861824046327e+00 1.470969682151913149e+00 1.471185502479779972e+00 1.471401322807646794e+00 1.471617143135513617e+00 1.471832963463380439e+00 1.472048783791247262e+00 1.472264604119114084e+00 1.472480424446980907e+00 1.472696244774847507e+00 1.472912065102714330e+00 1.473127885430581152e+00 1.473343705758447975e+00 1.473559526086314797e+00 1.473775346414181620e+00 1.473991166742048442e+00 1.474206987069915264e+00 1.474422807397782087e+00 1.474638627725648909e+00 1.474854448053515732e+00 1.475070268381382554e+00 1.475286088709249377e+00 1.475501909037116199e+00 1.475717729364983022e+00 1.475933549692849844e+00 1.476149370020716667e+00 1.476365190348583489e+00 1.476581010676450312e+00 1.476796831004317134e+00 1.477012651332183957e+00 1.477228471660050779e+00 1.477444291987917602e+00 1.477660112315784424e+00 1.477875932643651247e+00 1.478091752971518069e+00 1.478307573299384892e+00 1.478523393627251714e+00 1.478739213955118537e+00 1.478955034282985359e+00 1.479170854610852182e+00 1.479386674938719004e+00 1.479602495266585827e+00 1.479818315594452649e+00 1.480034135922319471e+00 1.480249956250186294e+00 1.480465776578053116e+00 1.480681596905919939e+00 1.480897417233786761e+00 1.481113237561653584e+00 1.481329057889520406e+00 1.481544878217387229e+00 1.481760698545254051e+00 1.481976518873120874e+00 1.482192339200987696e+00 1.482408159528854519e+00 1.482623979856721341e+00 1.482839800184588164e+00 1.483055620512454986e+00 1.483271440840321809e+00 1.483487261168188631e+00 1.483703081496055454e+00 1.483918901823922276e+00 1.484134722151789099e+00 1.484350542479655921e+00 1.484566362807522744e+00 1.484782183135389566e+00 1.484998003463256389e+00 1.485213823791123211e+00 1.485429644118990034e+00 1.485645464446856856e+00 1.485861284774723678e+00 1.486077105102590501e+00 1.486292925430457323e+00 1.486508745758324146e+00 1.486724566086190968e+00 1.486940386414057791e+00 1.487156206741924613e+00 1.487372027069791436e+00 1.487587847397658258e+00 1.487803667725525081e+00 1.488019488053391903e+00 1.488235308381258726e+00 1.488451128709125548e+00 1.488666949036992371e+00 1.488882769364859193e+00 1.489098589692726016e+00 1.489314410020592838e+00 1.489530230348459661e+00 1.489746050676326483e+00 1.489961871004193306e+00 1.490177691332060128e+00 1.490393511659926951e+00 1.490609331987793773e+00 1.490825152315660596e+00 1.491040972643527418e+00 1.491256792971394241e+00 1.491472613299261063e+00 1.491688433627127885e+00 1.491904253954994708e+00 1.492120074282861530e+00 1.492335894610728353e+00 1.492551714938595175e+00 1.492767535266461998e+00 1.492983355594328820e+00 1.493199175922195643e+00 1.493414996250062465e+00 1.493630816577929288e+00 1.493846636905796110e+00 1.494062457233662933e+00 1.494278277561529755e+00 1.494494097889396578e+00 1.494709918217263400e+00 1.494925738545130223e+00 1.495141558872997045e+00 1.495357379200863868e+00 1.495573199528730690e+00 1.495789019856597513e+00 1.496004840184464335e+00 1.496220660512331158e+00 1.496436480840197980e+00 1.496652301168064803e+00 1.496868121495931625e+00 1.497083941823798448e+00 1.497299762151665270e+00 1.497515582479532092e+00 1.497731402807398915e+00 1.497947223135265737e+00 1.498163043463132560e+00 1.498378863790999382e+00 1.498594684118866205e+00 1.498810504446733027e+00 1.499026324774599850e+00 1.499242145102466672e+00 1.499457965430333495e+00 1.499673785758200317e+00 1.499889606086067140e+00 1.500105426413933962e+00 1.500321246741800785e+00 1.500537067069667607e+00 1.500752887397534430e+00 1.500968707725401252e+00 1.501184528053268075e+00 1.501400348381134897e+00 1.501616168709001720e+00 1.501831989036868542e+00 1.502047809364735365e+00 1.502263629692602187e+00 1.502479450020469010e+00 1.502695270348335832e+00 1.502911090676202654e+00 1.503126911004069477e+00 1.503342731331936299e+00 1.503558551659803122e+00 1.503774371987669944e+00 1.503990192315536767e+00 1.504206012643403589e+00 1.504421832971270412e+00 1.504637653299137234e+00 1.504853473627004057e+00 1.505069293954870879e+00 1.505285114282737702e+00 1.505500934610604524e+00 1.505716754938471347e+00 1.505932575266338169e+00 1.506148395594204992e+00 1.506364215922071814e+00 1.506580036249938637e+00 1.506795856577805459e+00 1.507011676905672282e+00 1.507227497233539104e+00 1.507443317561405927e+00 1.507659137889272749e+00 1.507874958217139572e+00 1.508090778545006394e+00 1.508306598872873217e+00 1.508522419200740039e+00 1.508738239528606861e+00 1.508954059856473684e+00 1.509169880184340506e+00 1.509385700512207329e+00 1.509601520840074151e+00 1.509817341167940974e+00 1.510033161495807796e+00 1.510248981823674619e+00 1.510464802151541441e+00 1.510680622479408264e+00 1.510896442807275086e+00 1.511112263135141909e+00 1.511328083463008731e+00 1.511543903790875554e+00 1.511759724118742376e+00 1.511975544446609199e+00 1.512191364774476021e+00 1.512407185102342844e+00 1.512623005430209666e+00 1.512838825758076489e+00 1.513054646085943311e+00 1.513270466413810134e+00 1.513486286741676956e+00 1.513702107069543779e+00 1.513917927397410601e+00 1.514133747725277424e+00 1.514349568053144246e+00 1.514565388381011068e+00 1.514781208708877891e+00 1.514997029036744713e+00 1.515212849364611536e+00 1.515428669692478358e+00 1.515644490020345181e+00 1.515860310348212003e+00 1.516076130676078826e+00 1.516291951003945648e+00 1.516507771331812471e+00 1.516723591659679293e+00 1.516939411987546116e+00 1.517155232315412938e+00 1.517371052643279761e+00 1.517586872971146583e+00 1.517802693299013406e+00 1.518018513626880228e+00 1.518234333954747051e+00 1.518450154282613873e+00 1.518665974610480696e+00 1.518881794938347518e+00 1.519097615266214341e+00 1.519313435594081163e+00 1.519529255921947986e+00 1.519745076249814808e+00 1.519960896577681631e+00 1.520176716905548453e+00 1.520392537233415275e+00 1.520608357561282098e+00 1.520824177889148920e+00 1.521039998217015743e+00 1.521255818544882565e+00 1.521471638872749388e+00 1.521687459200616210e+00 1.521903279528483033e+00 1.522119099856349855e+00 1.522334920184216678e+00 1.522550740512083500e+00 1.522766560839950323e+00 1.522982381167817145e+00 1.523198201495683968e+00 1.523414021823550790e+00 1.523629842151417613e+00 1.523845662479284435e+00 1.524061482807151258e+00 1.524277303135018080e+00 1.524493123462884903e+00 1.524708943790751725e+00 1.524924764118618548e+00 1.525140584446485370e+00 1.525356404774352193e+00 1.525572225102219015e+00 1.525788045430085837e+00 1.526003865757952660e+00 1.526219686085819482e+00 1.526435506413686305e+00 1.526651326741553127e+00 1.526867147069419950e+00 1.527082967397286772e+00 1.527298787725153595e+00 1.527514608053020417e+00 1.527730428380887240e+00 1.527946248708754062e+00 1.528162069036620885e+00 1.528377889364487707e+00 1.528593709692354530e+00 1.528809530020221352e+00 1.529025350348088175e+00 1.529241170675954997e+00 1.529456991003821820e+00 1.529672811331688642e+00 1.529888631659555465e+00 1.530104451987422287e+00 1.530320272315289110e+00 1.530536092643155932e+00 1.530751912971022755e+00 1.530967733298889577e+00 1.531183553626756400e+00 1.531399373954623222e+00 1.531615194282490044e+00 1.531831014610356867e+00 1.532046834938223689e+00 1.532262655266090512e+00 1.532478475593957334e+00 1.532694295921824157e+00 1.532910116249690979e+00 1.533125936577557802e+00 1.533341756905424624e+00 1.533557577233291447e+00 1.533773397561158269e+00 1.533989217889025092e+00 1.534205038216891914e+00 1.534420858544758737e+00 1.534636678872625559e+00 1.534852499200492382e+00 1.535068319528359204e+00 1.535284139856226027e+00 1.535499960184092849e+00 1.535715780511959672e+00 1.535931600839826494e+00 1.536147421167693317e+00 1.536363241495560139e+00 1.536579061823426962e+00 1.536794882151293784e+00 1.537010702479160607e+00 1.537226522807027429e+00 1.537442343134894251e+00 1.537658163462761074e+00 1.537873983790627896e+00 1.538089804118494719e+00 1.538305624446361541e+00 1.538521444774228364e+00 1.538737265102095186e+00 1.538953085429962009e+00 1.539168905757828831e+00 1.539384726085695654e+00 1.539600546413562476e+00 1.539816366741429299e+00 1.540032187069296121e+00 1.540248007397162944e+00 1.540463827725029766e+00 1.540679648052896589e+00 1.540895468380763411e+00 1.541111288708630234e+00 1.541327109036497056e+00 1.541542929364363879e+00 1.541758749692230701e+00 1.541974570020097524e+00 1.542190390347964346e+00 1.542406210675831169e+00 1.542622031003697991e+00 1.542837851331564814e+00 1.543053671659431636e+00 1.543269491987298458e+00 1.543485312315165281e+00 1.543701132643032103e+00 1.543916952970898926e+00 1.544132773298765748e+00 1.544348593626632571e+00 1.544564413954499393e+00 1.544780234282366216e+00 1.544996054610233038e+00 1.545211874938099861e+00 1.545427695265966683e+00 1.545643515593833506e+00 1.545859335921700328e+00 1.546075156249567151e+00 1.546290976577433973e+00 1.546506796905300796e+00 1.546722617233167618e+00 1.546938437561034441e+00 1.547154257888901263e+00 1.547370078216768086e+00 1.547585898544634908e+00 1.547801718872501731e+00 1.548017539200368553e+00 1.548233359528235376e+00 1.548449179856102198e+00 1.548665000183969020e+00 1.548880820511835843e+00 1.549096640839702665e+00 1.549312461167569488e+00 1.549528281495436310e+00 1.549744101823303133e+00 1.549959922151169955e+00 1.550175742479036778e+00 1.550391562806903600e+00 1.550607383134770423e+00 1.550823203462637245e+00 1.551039023790504068e+00 1.551254844118370890e+00 1.551470664446237713e+00 1.551686484774104535e+00 1.551902305101971358e+00 1.552118125429838180e+00 1.552333945757705003e+00 1.552549766085571825e+00 1.552765586413438648e+00 1.552981406741305470e+00 1.553197227069172293e+00 1.553413047397039115e+00 1.553628867724905938e+00 1.553844688052772760e+00 1.554060508380639583e+00 1.554276328708506405e+00 1.554492149036373227e+00 1.554707969364240050e+00 1.554923789692106872e+00 1.555139610019973695e+00 1.555355430347840517e+00 1.555571250675707340e+00 1.555787071003574162e+00 1.556002891331440985e+00 1.556218711659307807e+00 1.556434531987174630e+00 1.556650352315041452e+00 1.556866172642908275e+00 1.557081992970775097e+00 1.557297813298641920e+00 1.557513633626508742e+00 1.557729453954375565e+00 1.557945274282242387e+00 1.558161094610109210e+00 1.558376914937976032e+00 1.558592735265842855e+00 1.558808555593709677e+00 1.559024375921576500e+00 1.559240196249443322e+00 1.559456016577310145e+00 1.559671836905176967e+00 1.559887657233043790e+00 1.560103477560910612e+00 1.560319297888777434e+00 1.560535118216644257e+00 1.560750938544511079e+00 1.560966758872377902e+00 1.561182579200244724e+00 1.561398399528111547e+00 1.561614219855978369e+00 1.561830040183845192e+00 1.562045860511712014e+00 1.562261680839578837e+00 1.562477501167445659e+00 1.562693321495312482e+00 1.562909141823179304e+00 1.563124962151046127e+00 1.563340782478912949e+00 1.563556602806779772e+00 1.563772423134646594e+00 1.563988243462513417e+00 1.564204063790380239e+00 1.564419884118247062e+00 1.564635704446113884e+00 1.564851524773980707e+00 1.565067345101847529e+00 1.565283165429714352e+00 1.565498985757581174e+00 1.565714806085447997e+00 1.565930626413314819e+00 1.566146446741181641e+00 1.566362267069048464e+00 1.566578087396915286e+00 1.566793907724782109e+00 1.567009728052648931e+00 1.567225548380515754e+00 1.567441368708382576e+00 1.567657189036249399e+00 1.567873009364116221e+00 1.568088829691983044e+00 1.568304650019849866e+00 1.568520470347716689e+00 1.568736290675583511e+00 1.568952111003450334e+00 1.569167931331317156e+00 1.569383751659183979e+00 1.569599571987050801e+00 1.569815392314917624e+00 1.570031212642784446e+00 1.570247032970651269e+00 1.570462853298518091e+00 1.570678673626384914e+00 1.570894493954251736e+00 1.571110314282118559e+00 1.571326134609985381e+00 1.571541954937852203e+00 1.571757775265719026e+00 1.571973595593585848e+00 1.572189415921452671e+00 1.572405236249319493e+00 1.572621056577186316e+00 1.572836876905053138e+00 1.573052697232919961e+00 1.573268517560786783e+00 1.573484337888653606e+00 1.573700158216520428e+00 1.573915978544387251e+00 1.574131798872254073e+00 1.574347619200120896e+00 1.574563439527987718e+00 1.574779259855854541e+00 1.574995080183721363e+00 1.575210900511588186e+00 1.575426720839455008e+00 1.575642541167321831e+00 1.575858361495188653e+00 1.576074181823055476e+00 1.576290002150922298e+00 1.576505822478789121e+00 1.576721642806655943e+00 1.576937463134522766e+00 1.577153283462389588e+00 1.577369103790256410e+00 1.577584924118123233e+00 1.577800744445990055e+00 1.578016564773856878e+00 1.578232385101723700e+00 1.578448205429590523e+00 1.578664025757457123e+00 1.578879846085323946e+00 1.579095666413190768e+00 1.579311486741057591e+00 1.579527307068924413e+00 1.579743127396791236e+00 1.579958947724658058e+00 1.580174768052524881e+00 1.580390588380391703e+00 1.580606408708258526e+00 1.580822229036125348e+00 1.581038049363992171e+00 1.581253869691858993e+00 1.581469690019725816e+00 1.581685510347592638e+00 1.581901330675459461e+00 1.582117151003326283e+00 1.582332971331193106e+00 1.582548791659059928e+00 1.582764611986926750e+00 1.582980432314793573e+00 1.583196252642660395e+00 1.583412072970527218e+00 1.583627893298394040e+00 1.583843713626260863e+00 1.584059533954127685e+00 1.584275354281994508e+00 1.584491174609861330e+00 1.584706994937728153e+00 1.584922815265594975e+00 1.585138635593461798e+00 1.585354455921328620e+00 1.585570276249195443e+00 1.585786096577062265e+00 1.586001916904929088e+00 1.586217737232795910e+00 1.586433557560662733e+00 1.586649377888529555e+00 1.586865198216396378e+00 1.587081018544263200e+00 1.587296838872130023e+00 1.587512659199996845e+00 1.587728479527863668e+00 1.587944299855730490e+00 1.588160120183597313e+00 1.588375940511464135e+00 1.588591760839330957e+00 1.588807581167197780e+00 1.589023401495064602e+00 1.589239221822931425e+00 1.589455042150798247e+00 1.589670862478665070e+00 1.589886682806531892e+00 1.590102503134398715e+00 1.590318323462265537e+00 1.590534143790132360e+00 1.590749964117999182e+00 1.590965784445866005e+00 1.591181604773732827e+00 1.591397425101599650e+00 1.591613245429466472e+00 1.591829065757333295e+00 1.592044886085200117e+00 1.592260706413066940e+00 1.592476526740933762e+00 1.592692347068800585e+00 1.592908167396667407e+00 1.593123987724534230e+00 1.593339808052401052e+00 1.593555628380267875e+00 1.593771448708134697e+00 1.593987269036001519e+00 1.594203089363868342e+00 1.594418909691735164e+00 1.594634730019601987e+00 1.594850550347468809e+00 1.595066370675335632e+00 1.595282191003202454e+00 1.595498011331069277e+00 1.595713831658936099e+00 1.595929651986802922e+00 1.596145472314669744e+00 1.596361292642536567e+00 1.596577112970403389e+00 1.596792933298270212e+00 1.597008753626137034e+00 1.597224573954003857e+00 1.597440394281870679e+00 1.597656214609737502e+00 1.597872034937604324e+00 1.598087855265471147e+00 1.598303675593337969e+00 1.598519495921204792e+00 1.598735316249071614e+00 1.598951136576938437e+00 1.599166956904805259e+00 1.599382777232672082e+00 1.599598597560538904e+00 1.599814417888405726e+00 1.600030238216272549e+00 1.600246058544139371e+00 1.600461878872006194e+00 1.600677699199873016e+00 1.600893519527739839e+00 1.601109339855606661e+00 1.601325160183473484e+00 1.601540980511340306e+00 1.601756800839207129e+00 1.601972621167073951e+00 1.602188441494940774e+00 1.602404261822807596e+00 1.602620082150674419e+00 1.602835902478541241e+00 1.603051722806408064e+00 1.603267543134274886e+00 1.603483363462141709e+00 1.603699183790008531e+00 1.603915004117875354e+00 1.604130824445742176e+00 1.604346644773608999e+00 1.604562465101475821e+00 1.604778285429342644e+00 1.604994105757209466e+00 1.605209926085076289e+00 1.605425746412943111e+00 1.605641566740809933e+00 1.605857387068676756e+00 1.606073207396543578e+00 1.606289027724410401e+00 1.606504848052277223e+00 1.606720668380144046e+00 1.606936488708010868e+00 1.607152309035877691e+00 1.607368129363744513e+00 1.607583949691611336e+00 1.607799770019478158e+00 1.608015590347344981e+00 1.608231410675211803e+00 1.608447231003078626e+00 1.608663051330945448e+00 1.608878871658812271e+00 1.609094691986679093e+00 1.609310512314545916e+00 1.609526332642412738e+00 1.609742152970279561e+00 1.609957973298146383e+00 1.610173793626013206e+00 1.610389613953880028e+00 1.610605434281746851e+00 1.610821254609613673e+00 1.611037074937480496e+00 1.611252895265347318e+00 1.611468715593214140e+00 1.611684535921080963e+00 1.611900356248947785e+00 1.612116176576814608e+00 1.612331996904681430e+00 1.612547817232548253e+00 1.612763637560415075e+00 1.612979457888281898e+00 1.613195278216148720e+00 1.613411098544015543e+00 1.613626918871882365e+00 1.613842739199749188e+00 1.614058559527616010e+00 1.614274379855482833e+00 1.614490200183349655e+00 1.614706020511216478e+00 1.614921840839083300e+00 1.615137661166950123e+00 1.615353481494816945e+00 1.615569301822683768e+00 1.615785122150550590e+00 1.616000942478417413e+00 1.616216762806284235e+00 1.616432583134151058e+00 1.616648403462017880e+00 1.616864223789884702e+00 1.617080044117751525e+00 1.617295864445618347e+00 1.617511684773485170e+00 1.617727505101351992e+00 1.617943325429218815e+00 1.618159145757085637e+00 1.618374966084952460e+00 1.618590786412819282e+00 1.618806606740686105e+00 1.619022427068552927e+00 1.619238247396419750e+00 1.619454067724286572e+00 1.619669888052153395e+00 1.619885708380020217e+00 1.620101528707887040e+00 1.620317349035753862e+00 1.620533169363620685e+00 1.620748989691487507e+00 1.620964810019354330e+00 1.621180630347221152e+00 1.621396450675087975e+00 1.621612271002954797e+00 1.621828091330821620e+00 1.622043911658688442e+00 1.622259731986555265e+00 1.622475552314422087e+00 1.622691372642288909e+00 1.622907192970155732e+00 1.623123013298022554e+00 1.623338833625889377e+00 1.623554653953756199e+00 1.623770474281623022e+00 1.623986294609489844e+00 1.624202114937356667e+00 1.624417935265223489e+00 1.624633755593090312e+00 1.624849575920957134e+00 1.625065396248823957e+00 1.625281216576690779e+00 1.625497036904557602e+00 1.625712857232424424e+00 1.625928677560291247e+00 1.626144497888158069e+00 1.626360318216024892e+00 1.626576138543891714e+00 1.626791958871758537e+00 1.627007779199625359e+00 1.627223599527492182e+00 1.627439419855359004e+00 1.627655240183225827e+00 1.627871060511092649e+00 1.628086880838959472e+00 1.628302701166826294e+00 1.628518521494693116e+00 1.628734341822559939e+00 1.628950162150426761e+00 1.629165982478293584e+00 1.629381802806160406e+00 1.629597623134027229e+00 1.629813443461894051e+00 1.630029263789760874e+00 1.630245084117627696e+00 1.630460904445494519e+00 1.630676724773361341e+00 1.630892545101228164e+00 1.631108365429094986e+00 1.631324185756961809e+00 1.631540006084828631e+00 1.631755826412695454e+00 1.631971646740562276e+00 1.632187467068429099e+00 1.632403287396295921e+00 1.632619107724162744e+00 1.632834928052029566e+00 1.633050748379896389e+00 1.633266568707763211e+00 1.633482389035630034e+00 1.633698209363496856e+00 1.633914029691363679e+00 1.634129850019230501e+00 1.634345670347097323e+00 1.634561490674964146e+00 1.634777311002830968e+00 1.634993131330697791e+00 1.635208951658564613e+00 1.635424771986431436e+00 1.635640592314298258e+00 1.635856412642165081e+00 1.636072232970031903e+00 1.636288053297898726e+00 1.636503873625765548e+00 1.636719693953632371e+00 1.636935514281499193e+00 1.637151334609366016e+00 1.637367154937232838e+00 1.637582975265099661e+00 1.637798795592966483e+00 1.638014615920833306e+00 1.638230436248700128e+00 1.638446256576566951e+00 1.638662076904433773e+00 1.638877897232300596e+00 1.639093717560167418e+00 1.639309537888034241e+00 1.639525358215901063e+00 1.639741178543767886e+00 1.639956998871634708e+00 1.640172819199501530e+00 1.640388639527368353e+00 1.640604459855235175e+00 1.640820280183101998e+00 1.641036100510968820e+00 1.641251920838835643e+00 1.641467741166702465e+00 1.641683561494569288e+00 1.641899381822436110e+00 1.642115202150302933e+00 1.642331022478169755e+00 1.642546842806036578e+00 1.642762663133903400e+00 1.642978483461770223e+00 1.643194303789637045e+00 1.643410124117503868e+00 1.643625944445370690e+00 1.643841764773237513e+00 1.644057585101104335e+00 1.644273405428971158e+00 1.644489225756837980e+00 1.644705046084704803e+00 1.644920866412571625e+00 1.645136686740438448e+00 1.645352507068305270e+00 1.645568327396172092e+00 1.645784147724038915e+00 1.645999968051905737e+00 1.646215788379772560e+00 1.646431608707639382e+00 1.646647429035506205e+00 1.646863249363373027e+00 1.647079069691239850e+00 1.647294890019106672e+00 1.647510710346973495e+00 1.647726530674840317e+00 1.647942351002707140e+00 1.648158171330573962e+00 1.648373991658440785e+00 1.648589811986307607e+00 1.648805632314174430e+00 1.649021452642041252e+00 1.649237272969908075e+00 1.649453093297774897e+00 1.649668913625641720e+00 1.649884733953508542e+00 1.650100554281375365e+00 1.650316374609242187e+00 1.650532194937109010e+00 1.650748015264975832e+00 1.650963835592842655e+00 1.651179655920709477e+00 1.651395476248576299e+00 1.651611296576443122e+00 1.651827116904309944e+00 1.652042937232176767e+00 1.652258757560043589e+00 1.652474577887910412e+00 1.652690398215777234e+00 1.652906218543644057e+00 1.653122038871510879e+00 1.653337859199377702e+00 1.653553679527244524e+00 1.653769499855111347e+00 1.653985320182978169e+00 1.654201140510844992e+00 1.654416960838711814e+00 1.654632781166578637e+00 1.654848601494445459e+00 1.655064421822312282e+00 1.655280242150179104e+00 1.655496062478045927e+00 1.655711882805912749e+00 1.655927703133779572e+00 1.656143523461646394e+00 1.656359343789513217e+00 1.656575164117380039e+00 1.656790984445246862e+00 1.657006804773113684e+00 1.657222625100980506e+00 1.657438445428847329e+00 1.657654265756714151e+00 1.657870086084580974e+00 1.658085906412447796e+00 1.658301726740314619e+00 1.658517547068181441e+00 1.658733367396048264e+00 1.658949187723915086e+00 1.659165008051781909e+00 1.659380828379648731e+00 1.659596648707515554e+00 1.659812469035382376e+00 1.660028289363249199e+00 1.660244109691116021e+00 1.660459930018982844e+00 1.660675750346849666e+00 1.660891570674716489e+00 1.661107391002583311e+00 1.661323211330450134e+00 1.661539031658316956e+00 1.661754851986183779e+00 1.661970672314050601e+00 1.662186492641917424e+00 1.662402312969784246e+00 1.662618133297651069e+00 1.662833953625517891e+00 1.663049773953384713e+00 1.663265594281251536e+00 1.663481414609118358e+00 1.663697234936985181e+00 1.663913055264852003e+00 1.664128875592718826e+00 1.664344695920585648e+00 1.664560516248452249e+00 1.664776336576319071e+00 1.664992156904185894e+00 1.665207977232052716e+00 1.665423797559919539e+00 1.665639617887786361e+00 1.665855438215653184e+00 1.666071258543520006e+00 1.666287078871386829e+00 1.666502899199253651e+00 1.666718719527120474e+00 1.666934539854987296e+00 1.667150360182854119e+00 1.667366180510720941e+00 1.667582000838587764e+00 1.667797821166454586e+00 1.668013641494321408e+00 1.668229461822188231e+00 1.668445282150055053e+00 1.668661102477921876e+00 1.668876922805788698e+00 1.669092743133655521e+00 1.669308563461522343e+00 1.669524383789389166e+00 1.669740204117255988e+00 1.669956024445122811e+00 1.670171844772989633e+00 1.670387665100856456e+00 1.670603485428723278e+00 1.670819305756590101e+00 1.671035126084456923e+00 1.671250946412323746e+00 1.671466766740190568e+00 1.671682587068057391e+00 1.671898407395924213e+00 1.672114227723791036e+00 1.672330048051657858e+00 1.672545868379524681e+00 1.672761688707391503e+00 1.672977509035258326e+00 1.673193329363125148e+00 1.673409149690991971e+00 1.673624970018858793e+00 1.673840790346725615e+00 1.674056610674592438e+00 1.674272431002459260e+00 1.674488251330326083e+00 1.674704071658192905e+00 1.674919891986059728e+00 1.675135712313926550e+00 1.675351532641793373e+00 1.675567352969660195e+00 1.675783173297527018e+00 1.675998993625393840e+00 1.676214813953260663e+00 1.676430634281127485e+00 1.676646454608994308e+00 1.676862274936861130e+00 1.677078095264727953e+00 1.677293915592594775e+00 1.677509735920461598e+00 1.677725556248328420e+00 1.677941376576195243e+00 1.678157196904062065e+00 1.678373017231928888e+00 1.678588837559795710e+00 1.678804657887662533e+00 1.679020478215529355e+00 1.679236298543396178e+00 1.679452118871263000e+00 1.679667939199129822e+00 1.679883759526996645e+00 1.680099579854863467e+00 1.680315400182730290e+00 1.680531220510597112e+00 1.680747040838463935e+00 1.680962861166330757e+00 1.681178681494197580e+00 1.681394501822064402e+00 1.681610322149931225e+00 1.681826142477798047e+00 1.682041962805664870e+00 1.682257783133531692e+00 1.682473603461398515e+00 1.682689423789265337e+00 1.682905244117132160e+00 1.683121064444998982e+00 1.683336884772865805e+00 1.683552705100732627e+00 1.683768525428599450e+00 1.683984345756466272e+00 1.684200166084333095e+00 1.684415986412199917e+00 1.684631806740066740e+00 1.684847627067933562e+00 1.685063447395800384e+00 1.685279267723667207e+00 1.685495088051534029e+00 1.685710908379400852e+00 1.685926728707267674e+00 1.686142549035134497e+00 1.686358369363001319e+00 1.686574189690868142e+00 1.686790010018734964e+00 1.687005830346601787e+00 1.687221650674468609e+00 1.687437471002335432e+00 1.687653291330202254e+00 1.687869111658069077e+00 1.688084931985935899e+00 1.688300752313802722e+00 1.688516572641669544e+00 1.688732392969536367e+00 1.688948213297403189e+00 1.689164033625270012e+00 1.689379853953136834e+00 1.689595674281003657e+00 1.689811494608870479e+00 1.690027314936737302e+00 1.690243135264604124e+00 1.690458955592470947e+00 1.690674775920337769e+00 1.690890596248204591e+00 1.691106416576071414e+00 1.691322236903938236e+00 1.691538057231805059e+00 1.691753877559671881e+00 1.691969697887538704e+00 1.692185518215405526e+00 1.692401338543272349e+00 1.692617158871139171e+00 1.692832979199005994e+00 1.693048799526872816e+00 1.693264619854739639e+00 1.693480440182606461e+00 1.693696260510473284e+00 1.693912080838340106e+00 1.694127901166206929e+00 1.694343721494073751e+00 1.694559541821940574e+00 1.694775362149807396e+00 1.694991182477674219e+00 1.695207002805541041e+00 1.695422823133407864e+00 1.695638643461274686e+00 1.695854463789141509e+00 1.696070284117008331e+00 1.696286104444875154e+00 1.696501924772741976e+00 1.696717745100608798e+00 1.696933565428475621e+00 1.697149385756342443e+00 1.697365206084209266e+00 1.697581026412076088e+00 1.697796846739942911e+00 1.698012667067809733e+00 1.698228487395676556e+00 1.698444307723543378e+00 1.698660128051410201e+00 1.698875948379277023e+00 1.699091768707143846e+00 1.699307589035010668e+00 1.699523409362877491e+00 1.699739229690744313e+00 1.699955050018611136e+00 1.700170870346477958e+00 1.700386690674344781e+00 1.700602511002211603e+00 1.700818331330078426e+00 1.701034151657945248e+00 1.701249971985812071e+00 1.701465792313678893e+00 1.701681612641545716e+00 1.701897432969412538e+00 1.702113253297279361e+00 1.702329073625146183e+00 1.702544893953013005e+00 1.702760714280879828e+00 1.702976534608746650e+00 1.703192354936613473e+00 1.703408175264480295e+00 1.703623995592347118e+00 1.703839815920213940e+00 1.704055636248080763e+00 1.704271456575947585e+00 1.704487276903814408e+00 1.704703097231681230e+00 1.704918917559548053e+00 1.705134737887414875e+00 1.705350558215281698e+00 1.705566378543148520e+00 1.705782198871015343e+00 1.705998019198882165e+00 1.706213839526748988e+00 1.706429659854615810e+00 1.706645480182482633e+00 1.706861300510349455e+00 1.707077120838216278e+00 1.707292941166083100e+00 1.707508761493949923e+00 1.707724581821816745e+00 1.707940402149683568e+00 1.708156222477550390e+00 1.708372042805417212e+00 1.708587863133284035e+00 1.708803683461150857e+00 1.709019503789017680e+00 1.709235324116884502e+00 1.709451144444751325e+00 1.709666964772618147e+00 1.709882785100484970e+00 1.710098605428351792e+00 1.710314425756218615e+00 1.710530246084085437e+00 1.710746066411952260e+00 1.710961886739819082e+00 1.711177707067685905e+00 1.711393527395552727e+00 1.711609347723419550e+00 1.711825168051286372e+00 1.712040988379153195e+00 1.712256808707020017e+00 1.712472629034886840e+00 1.712688449362753662e+00 1.712904269690620485e+00 1.713120090018487307e+00 1.713335910346354130e+00 1.713551730674220952e+00 1.713767551002087774e+00 1.713983371329954597e+00 1.714199191657821419e+00 1.714415011985688242e+00 1.714630832313555064e+00 1.714846652641421887e+00 1.715062472969288709e+00 1.715278293297155532e+00 1.715494113625022354e+00 1.715709933952889177e+00 1.715925754280755999e+00 1.716141574608622822e+00 1.716357394936489644e+00 1.716573215264356467e+00 1.716789035592223289e+00 1.717004855920090112e+00 1.717220676247956934e+00 1.717436496575823757e+00 1.717652316903690579e+00 1.717868137231557402e+00 1.718083957559424224e+00 1.718299777887291047e+00 1.718515598215157869e+00 1.718731418543024692e+00 1.718947238870891514e+00 1.719163059198758337e+00 1.719378879526625159e+00 1.719594699854491981e+00 1.719810520182358804e+00 1.720026340510225626e+00 1.720242160838092449e+00 1.720457981165959271e+00 1.720673801493826094e+00 1.720889621821692916e+00 1.721105442149559739e+00 1.721321262477426561e+00 1.721537082805293384e+00 1.721752903133160206e+00 1.721968723461027029e+00 1.722184543788893851e+00 1.722400364116760674e+00 1.722616184444627496e+00 1.722832004772494319e+00 1.723047825100361141e+00 1.723263645428227964e+00 1.723479465756094786e+00 1.723695286083961609e+00 1.723911106411828431e+00 1.724126926739695254e+00 1.724342747067562076e+00 1.724558567395428899e+00 1.724774387723295721e+00 1.724990208051162544e+00 1.725206028379029366e+00 1.725421848706896188e+00 1.725637669034763011e+00 1.725853489362629833e+00 1.726069309690496656e+00 1.726285130018363478e+00 1.726500950346230301e+00 1.726716770674097123e+00 1.726932591001963946e+00 1.727148411329830768e+00 1.727364231657697591e+00 1.727580051985564413e+00 1.727795872313431236e+00 1.728011692641298058e+00 1.728227512969164881e+00 1.728443333297031703e+00 1.728659153624898526e+00 1.728874973952765348e+00 1.729090794280632171e+00 1.729306614608498993e+00 1.729522434936365816e+00 1.729738255264232638e+00 1.729954075592099461e+00 1.730169895919966283e+00 1.730385716247833106e+00 1.730601536575699928e+00 1.730817356903566751e+00 1.731033177231433573e+00 1.731248997559300395e+00 1.731464817887167218e+00 1.731680638215034040e+00 1.731896458542900863e+00 1.732112278870767685e+00 1.732328099198634508e+00 1.732543919526501330e+00 1.732759739854368153e+00 1.732975560182234975e+00 1.733191380510101798e+00 1.733407200837968620e+00 1.733623021165835443e+00 1.733838841493702265e+00 1.734054661821569088e+00 1.734270482149435910e+00 1.734486302477302733e+00 1.734702122805169555e+00 1.734917943133036378e+00 1.735133763460903200e+00 1.735349583788770023e+00 1.735565404116636845e+00 1.735781224444503668e+00 1.735997044772370490e+00 1.736212865100237313e+00 1.736428685428104135e+00 1.736644505755970957e+00 1.736860326083837780e+00 1.737076146411704602e+00 1.737291966739571425e+00 1.737507787067438247e+00 1.737723607395305070e+00 1.737939427723171892e+00 1.738155248051038715e+00 1.738371068378905537e+00 1.738586888706772360e+00 1.738802709034639182e+00 1.739018529362506005e+00 1.739234349690372827e+00 1.739450170018239650e+00 1.739665990346106472e+00 1.739881810673973295e+00 1.740097631001840117e+00 1.740313451329706940e+00 1.740529271657573762e+00 1.740745091985440585e+00 1.740960912313307407e+00 1.741176732641174230e+00 1.741392552969041052e+00 1.741608373296907875e+00 1.741824193624774697e+00 1.742040013952641520e+00 1.742255834280508342e+00 1.742471654608375164e+00 1.742687474936241987e+00 1.742903295264108809e+00 1.743119115591975632e+00 1.743334935919842454e+00 1.743550756247709277e+00 1.743766576575576099e+00 1.743982396903442922e+00 1.744198217231309744e+00 1.744414037559176567e+00 1.744629857887043389e+00 1.744845678214910212e+00 1.745061498542777034e+00 1.745277318870643857e+00 1.745493139198510679e+00 1.745708959526377502e+00 1.745924779854244324e+00 1.746140600182111147e+00 1.746356420509977969e+00 1.746572240837844792e+00 1.746788061165711614e+00 1.747003881493578437e+00 1.747219701821445259e+00 1.747435522149312082e+00 1.747651342477178904e+00 1.747867162805045727e+00 1.748082983132912549e+00 1.748298803460779371e+00 1.748514623788646194e+00 1.748730444116513016e+00 1.748946264444379839e+00 1.749162084772246661e+00 1.749377905100113484e+00 1.749593725427980306e+00 1.749809545755847129e+00 1.750025366083713951e+00 1.750241186411580774e+00 1.750457006739447596e+00 1.750672827067314419e+00 1.750888647395181241e+00 1.751104467723048064e+00 1.751320288050914886e+00 1.751536108378781709e+00 1.751751928706648531e+00 1.751967749034515354e+00 1.752183569362382176e+00 1.752399389690248999e+00 1.752615210018115821e+00 1.752831030345982644e+00 1.753046850673849466e+00 1.753262671001716289e+00 1.753478491329583111e+00 1.753694311657449934e+00 1.753910131985316756e+00 1.754125952313183578e+00 1.754341772641050401e+00 1.754557592968917223e+00 1.754773413296784046e+00 1.754989233624650868e+00 1.755205053952517691e+00 1.755420874280384513e+00 1.755636694608251336e+00 1.755852514936118158e+00 1.756068335263984981e+00 1.756284155591851803e+00 1.756499975919718626e+00 1.756715796247585448e+00 1.756931616575452271e+00 1.757147436903319093e+00 1.757363257231185916e+00 1.757579077559052738e+00 1.757794897886919561e+00 1.758010718214786383e+00 1.758226538542653206e+00 1.758442358870520028e+00 1.758658179198386851e+00 1.758873999526253673e+00 1.759089819854120496e+00 1.759305640181987318e+00 1.759521460509854140e+00 1.759737280837720963e+00 1.759953101165587785e+00 1.760168921493454608e+00 1.760384741821321430e+00 1.760600562149188253e+00 1.760816382477055075e+00 1.761032202804921898e+00 1.761248023132788720e+00 1.761463843460655543e+00 1.761679663788522365e+00 1.761895484116389188e+00 1.762111304444256010e+00 1.762327124772122833e+00 1.762542945099989655e+00 1.762758765427856478e+00 1.762974585755723300e+00 1.763190406083590123e+00 1.763406226411456945e+00 1.763622046739323768e+00 1.763837867067190590e+00 1.764053687395057413e+00 1.764269507722924235e+00 1.764485328050791058e+00 1.764701148378657880e+00 1.764916968706524703e+00 1.765132789034391525e+00 1.765348609362258347e+00 1.765564429690125170e+00 1.765780250017991992e+00 1.765996070345858815e+00 1.766211890673725637e+00 1.766427711001592460e+00 1.766643531329459282e+00 1.766859351657326105e+00 1.767075171985192927e+00 1.767290992313059750e+00 1.767506812640926572e+00 1.767722632968793395e+00 1.767938453296660217e+00 1.768154273624527040e+00 1.768370093952393862e+00 1.768585914280260685e+00 1.768801734608127507e+00 1.769017554935994330e+00 1.769233375263861152e+00 1.769449195591727975e+00 1.769665015919594797e+00 1.769880836247461620e+00 1.770096656575328442e+00 1.770312476903195265e+00 1.770528297231062087e+00 1.770744117558928910e+00 1.770959937886795732e+00 1.771175758214662554e+00 1.771391578542529377e+00 1.771607398870396199e+00 1.771823219198263022e+00 1.772039039526129844e+00 1.772254859853996667e+00 1.772470680181863489e+00 1.772686500509730312e+00 1.772902320837597134e+00 1.773118141165463957e+00 1.773333961493330779e+00 1.773549781821197602e+00 1.773765602149064424e+00 1.773981422476931247e+00 1.774197242804798069e+00 1.774413063132664892e+00 1.774628883460531714e+00 1.774844703788398537e+00 1.775060524116265359e+00 1.775276344444132182e+00 1.775492164771999004e+00 1.775707985099865827e+00 1.775923805427732649e+00 1.776139625755599472e+00 1.776355446083466294e+00 1.776571266411333117e+00 1.776787086739199939e+00 1.777002907067066761e+00 1.777218727394933584e+00 1.777434547722800406e+00 1.777650368050667229e+00 1.777866188378534051e+00 1.778082008706400874e+00 1.778297829034267696e+00 1.778513649362134519e+00 1.778729469690001341e+00 1.778945290017868164e+00 1.779161110345734986e+00 1.779376930673601809e+00 1.779592751001468631e+00 1.779808571329335454e+00 1.780024391657202276e+00 1.780240211985069099e+00 1.780456032312935921e+00 1.780671852640802744e+00 1.780887672968669566e+00 1.781103493296536167e+00 1.781319313624402989e+00 1.781535133952269812e+00 1.781750954280136634e+00 1.781966774608003456e+00 1.782182594935870279e+00 1.782398415263737101e+00 1.782614235591603924e+00 1.782830055919470746e+00 1.783045876247337569e+00 1.783261696575204391e+00 1.783477516903071214e+00 1.783693337230938036e+00 1.783909157558804859e+00 1.784124977886671681e+00 1.784340798214538504e+00 1.784556618542405326e+00 1.784772438870272149e+00 1.784988259198138971e+00 1.785204079526005794e+00 1.785419899853872616e+00 1.785635720181739439e+00 1.785851540509606261e+00 1.786067360837473084e+00 1.786283181165339906e+00 1.786499001493206729e+00 1.786714821821073551e+00 1.786930642148940374e+00 1.787146462476807196e+00 1.787362282804674019e+00 1.787578103132540841e+00 1.787793923460407663e+00 1.788009743788274486e+00 1.788225564116141308e+00 1.788441384444008131e+00 1.788657204771874953e+00 1.788873025099741776e+00 1.789088845427608598e+00 1.789304665755475421e+00 1.789520486083342243e+00 1.789736306411209066e+00 1.789952126739075888e+00 1.790167947066942711e+00 1.790383767394809533e+00 1.790599587722676356e+00 1.790815408050543178e+00 1.791031228378410001e+00 1.791247048706276823e+00 1.791462869034143646e+00 1.791678689362010468e+00 1.791894509689877291e+00 1.792110330017744113e+00 1.792326150345610936e+00 1.792541970673477758e+00 1.792757791001344581e+00 1.792973611329211403e+00 1.793189431657078226e+00 1.793405251984945048e+00 1.793621072312811870e+00 1.793836892640678693e+00 1.794052712968545515e+00 1.794268533296412338e+00 1.794484353624279160e+00 1.794700173952145983e+00 1.794915994280012805e+00 1.795131814607879628e+00 1.795347634935746450e+00 1.795563455263613273e+00 1.795779275591480095e+00 1.795995095919346918e+00 1.796210916247213740e+00 1.796426736575080563e+00 1.796642556902947385e+00 1.796858377230814208e+00 1.797074197558681030e+00 1.797290017886547853e+00 1.797505838214414675e+00 1.797721658542281498e+00 1.797937478870148320e+00 1.798153299198015143e+00 1.798369119525881965e+00 1.798584939853748788e+00 1.798800760181615610e+00 1.799016580509482433e+00 1.799232400837349255e+00 1.799448221165216077e+00 1.799664041493082900e+00 1.799879861820949722e+00 1.800095682148816545e+00 1.800311502476683367e+00 1.800527322804550190e+00 1.800743143132417012e+00 1.800958963460283835e+00 1.801174783788150657e+00 1.801390604116017480e+00 1.801606424443884302e+00 1.801822244771751125e+00 1.802038065099617947e+00 1.802253885427484770e+00 1.802469705755351592e+00 1.802685526083218415e+00 1.802901346411085237e+00 1.803117166738952060e+00 1.803332987066818882e+00 1.803548807394685705e+00 1.803764627722552527e+00 1.803980448050419350e+00 1.804196268378286172e+00 1.804412088706152995e+00 1.804627909034019817e+00 1.804843729361886639e+00 1.805059549689753462e+00 1.805275370017620284e+00 1.805491190345487107e+00 1.805707010673353929e+00 1.805922831001220752e+00 1.806138651329087574e+00 1.806354471656954397e+00 1.806570291984821219e+00 1.806786112312688042e+00 1.807001932640554864e+00 1.807217752968421687e+00 1.807433573296288509e+00 1.807649393624155332e+00 1.807865213952022154e+00 1.808081034279888977e+00 1.808296854607755799e+00 1.808512674935622622e+00 1.808728495263489444e+00 1.808944315591356267e+00 1.809160135919223089e+00 1.809375956247089912e+00 1.809591776574956734e+00 1.809807596902823557e+00 1.810023417230690379e+00 1.810239237558557202e+00 1.810455057886424024e+00 1.810670878214290846e+00 1.810886698542157669e+00 1.811102518870024491e+00 1.811318339197891314e+00 1.811534159525758136e+00 1.811749979853624959e+00 1.811965800181491781e+00 1.812181620509358604e+00 1.812397440837225426e+00 1.812613261165092249e+00 1.812829081492959071e+00 1.813044901820825894e+00 1.813260722148692716e+00 1.813476542476559539e+00 1.813692362804426361e+00 1.813908183132293184e+00 1.814124003460160006e+00 1.814339823788026829e+00 1.814555644115893651e+00 1.814771464443760474e+00 1.814987284771627296e+00 1.815203105099494119e+00 1.815418925427360941e+00 1.815634745755227764e+00 1.815850566083094586e+00 1.816066386410961409e+00 1.816282206738828231e+00 1.816498027066695053e+00 1.816713847394561876e+00 1.816929667722428698e+00 1.817145488050295521e+00 1.817361308378162343e+00 1.817577128706029166e+00 1.817792949033895988e+00 1.818008769361762811e+00 1.818224589689629633e+00 1.818440410017496456e+00 1.818656230345363278e+00 1.818872050673230101e+00 1.819087871001096923e+00 1.819303691328963746e+00 1.819519511656830568e+00 1.819735331984697391e+00 1.819951152312564213e+00 1.820166972640431036e+00 1.820382792968297858e+00 1.820598613296164681e+00 1.820814433624031503e+00 1.821030253951898326e+00 1.821246074279765148e+00 1.821461894607631971e+00 1.821677714935498793e+00 1.821893535263365616e+00 1.822109355591232438e+00 1.822325175919099260e+00 1.822540996246966083e+00 1.822756816574832905e+00 1.822972636902699728e+00 1.823188457230566550e+00 1.823404277558433373e+00 1.823620097886300195e+00 1.823835918214167018e+00 1.824051738542033840e+00 1.824267558869900663e+00 1.824483379197767485e+00 1.824699199525634308e+00 1.824915019853501130e+00 1.825130840181367953e+00 1.825346660509234775e+00 1.825562480837101598e+00 1.825778301164968420e+00 1.825994121492835243e+00 1.826209941820702065e+00 1.826425762148568888e+00 1.826641582476435710e+00 1.826857402804302533e+00 1.827073223132169355e+00 1.827289043460036178e+00 1.827504863787903000e+00 1.827720684115769822e+00 1.827936504443636645e+00 1.828152324771503467e+00 1.828368145099370290e+00 1.828583965427237112e+00 1.828799785755103935e+00 1.829015606082970757e+00 1.829231426410837580e+00 1.829447246738704402e+00 1.829663067066571225e+00 1.829878887394438047e+00 1.830094707722304870e+00 1.830310528050171692e+00 1.830526348378038515e+00 1.830742168705905337e+00 1.830957989033772160e+00 1.831173809361638982e+00 1.831389629689505805e+00 1.831605450017372627e+00 1.831821270345239450e+00 1.832037090673106272e+00 1.832252911000973095e+00 1.832468731328839917e+00 1.832684551656706740e+00 1.832900371984573562e+00 1.833116192312440385e+00 1.833332012640307207e+00 1.833547832968174029e+00 1.833763653296040852e+00 1.833979473623907674e+00 1.834195293951774497e+00 1.834411114279641319e+00 1.834626934607508142e+00 1.834842754935374964e+00 1.835058575263241787e+00 1.835274395591108609e+00 1.835490215918975432e+00 1.835706036246842254e+00 1.835921856574709077e+00 1.836137676902575899e+00 1.836353497230442722e+00 1.836569317558309544e+00 1.836785137886176367e+00 1.837000958214043189e+00 1.837216778541910012e+00 1.837432598869776834e+00 1.837648419197643657e+00 1.837864239525510479e+00 1.838080059853377302e+00 1.838295880181244124e+00 1.838511700509110947e+00 1.838727520836977769e+00 1.838943341164844592e+00 1.839159161492711414e+00 1.839374981820578236e+00 1.839590802148445059e+00 1.839806622476311881e+00 1.840022442804178704e+00 1.840238263132045526e+00 1.840454083459912349e+00 1.840669903787779171e+00 1.840885724115645994e+00 1.841101544443512816e+00 1.841317364771379639e+00 1.841533185099246461e+00 1.841749005427113284e+00 1.841964825754980106e+00 1.842180646082846929e+00 1.842396466410713751e+00 1.842612286738580574e+00 1.842828107066447396e+00 1.843043927394314219e+00 1.843259747722181041e+00 1.843475568050047864e+00 1.843691388377914686e+00 1.843907208705781509e+00 1.844123029033648331e+00 1.844338849361515154e+00 1.844554669689381976e+00 1.844770490017248799e+00 1.844986310345115621e+00 1.845202130672982443e+00 1.845417951000849266e+00 1.845633771328716088e+00 1.845849591656582911e+00 1.846065411984449733e+00 1.846281232312316556e+00 1.846497052640183378e+00 1.846712872968050201e+00 1.846928693295917023e+00 1.847144513623783846e+00 1.847360333951650668e+00 1.847576154279517491e+00 1.847791974607384313e+00 1.848007794935251136e+00 1.848223615263117958e+00 1.848439435590984781e+00 1.848655255918851603e+00 1.848871076246718426e+00 1.849086896574585248e+00 1.849302716902452071e+00 1.849518537230318893e+00 1.849734357558185716e+00 1.849950177886052538e+00 1.850165998213919361e+00 1.850381818541786183e+00 1.850597638869653006e+00 1.850813459197519828e+00 1.851029279525386650e+00 1.851245099853253473e+00 1.851460920181120295e+00 1.851676740508987118e+00 1.851892560836853940e+00 1.852108381164720763e+00 1.852324201492587585e+00 1.852540021820454408e+00 1.852755842148321230e+00 1.852971662476188053e+00 1.853187482804054875e+00 1.853403303131921698e+00 1.853619123459788520e+00 1.853834943787655343e+00 1.854050764115522165e+00 1.854266584443388988e+00 1.854482404771255810e+00 1.854698225099122633e+00 1.854914045426989233e+00 1.855129865754856056e+00 1.855345686082722878e+00 1.855561506410589701e+00 1.855777326738456523e+00 1.855993147066323345e+00 1.856208967394190168e+00 1.856424787722056990e+00 1.856640608049923813e+00 1.856856428377790635e+00 1.857072248705657458e+00 1.857288069033524280e+00 1.857503889361391103e+00 1.857719709689257925e+00 1.857935530017124748e+00 1.858151350344991570e+00 1.858367170672858393e+00 1.858582991000725215e+00 1.858798811328592038e+00 1.859014631656458860e+00 1.859230451984325683e+00 1.859446272312192505e+00 1.859662092640059328e+00 1.859877912967926150e+00 1.860093733295792973e+00 1.860309553623659795e+00 1.860525373951526618e+00 1.860741194279393440e+00 1.860957014607260263e+00 1.861172834935127085e+00 1.861388655262993908e+00 1.861604475590860730e+00 1.861820295918727552e+00 1.862036116246594375e+00 1.862251936574461197e+00 1.862467756902328020e+00 1.862683577230194842e+00 1.862899397558061665e+00 1.863115217885928487e+00 1.863331038213795310e+00 1.863546858541662132e+00 1.863762678869528955e+00 1.863978499197395777e+00 1.864194319525262600e+00 1.864410139853129422e+00 1.864625960180996245e+00 1.864841780508863067e+00 1.865057600836729890e+00 1.865273421164596712e+00 1.865489241492463535e+00 1.865705061820330357e+00 1.865920882148197180e+00 1.866136702476064002e+00 1.866352522803930825e+00 1.866568343131797647e+00 1.866784163459664470e+00
0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 9.893075000000000000e+05 3.763376474380493164e-01 -5.201233125000000000e+05 3.921456336975097656e-01 3.509222865104675293e-01 -6.222582031250000000e+04 4.984916001558303833e-02 5.601079389452934265e-02 5.071456357836723328e-02 5.056487396359443665e-02 2.446034178137779236e-02 5.258665233850479126e-02 2.864748798310756683e-02 8.190216124057769775e-02 8.441486209630966187e-02 4.790310189127922058e-02 5.517511069774627686e-02 3.507046401500701904e-02 3.308347612619400024e-02 5.120605975389480591e-02 4.192712903022766113e-02 3.879539668560028076e-02 6.426925957202911377e-02 4.221209511160850525e-02 5.495750531554222107e-02 4.000554233789443970e-02 3.025957755744457245e-02 3.044047579169273376e-02 6.048889458179473877e-02 6.516438722610473633e-02 5.491125583648681641e-02 5.029944702982902527e-02 4.123722761869430542e-02 4.631431400775909424e-02 4.805455356836318970e-02 3.554148226976394653e-02 3.380828350782394409e-02 2.820298634469509125e-02 1.076214108616113663e-02 2.396056056022644043e-02 8.734851144254207611e-03 2.704616449773311615e-02 3.809946030378341675e-02 6.194206327199935913e-02 1.471940577030181885e-01 5.150396749377250671e-02 3.781000897288322449e-02 5.748713761568069458e-02 3.958263620734214783e-02 3.592116758227348328e-02 6.365028023719787598e-02 5.146368965506553650e-02 4.808987677097320557e-02 5.050751194357872009e-02 6.435196101665496826e-02 5.761781334877014160e-02 5.800418555736541748e-02 3.923595324158668518e-02 3.894504532217979431e-02 2.148589119315147400e-02 4.831873625516891479e-02 4.360217601060867310e-02 1.339521445333957672e-02 3.975571691989898682e-02 3.885012865066528320e-02 1.277779880911111832e-02 2.799362540245056152e-01 1.514087617397308350e-01 -1.008799374103546143e-01 -6.348625570535659790e-02 4.129476472735404968e-02 3.120912797749042511e-02 6.830738484859466553e-02 4.338015988469123840e-02 5.338671803474426270e-02 4.836222529411315918e-02 4.948516935110092163e-02 5.238113552331924438e-02 6.291333585977554321e-02 3.309762105345726013e-02 4.875492304563522339e-02 4.786004498600959778e-02 3.400940448045730591e-02 4.047134891152381897e-02 4.949846491217613220e-02 6.880691647529602051e-02 4.897598922252655029e-02 1.020610183477401733e-01 1.609139889478683472e-01 3.114286065101623535e-01 1.102968007326126099e-01 5.682687088847160339e-02 6.454207748174667358e-02 6.113698333501815796e-02 6.257274746894836426e-02 5.916605144739151001e-02 6.739464402198791504e-02 8.066913485527038574e-02 6.701239943504333496e-02 4.490350186824798584e-02 7.160191237926483154e-02 4.785795137286186218e-02 5.265415087342262268e-02 7.989266514778137207e-02 5.933333188295364380e-02 4.680299013853073120e-02 1.256647557020187378e-01 2.670747339725494385e-01 1.732018291950225830e-01 -2.051509544253349304e-02 5.297554656863212585e-02 6.940509378910064697e-02 6.046188995242118835e-02 8.897624909877777100e-02 6.469797343015670776e-02 7.493695616722106934e-02 7.437793910503387451e-02 7.128787040710449219e-02 9.126777946949005127e-02 7.155847549438476562e-02 4.710613936185836792e-02 7.156699895858764648e-02 6.851128488779067993e-02 7.572484016418457031e-02 7.780624926090240479e-02 6.786872446537017822e-02 5.447120591998100281e-02 7.151097059249877930e-02 5.307694524526596069e-02 3.884001821279525757e-02 7.503019273281097412e-02 6.584028899669647217e-02 5.604046955704689026e-02 8.667942136526107788e-02 1.125828623771667480e-01 1.836897134780883789e-01 2.041775435209274292e-01 8.709807693958282471e-02 7.273320108652114868e-02 6.976159662008285522e-02 5.584091320633888245e-02 8.036857843399047852e-02 7.102759182453155518e-02 5.462919175624847412e-02 4.838033393025398254e-02 4.233157634735107422e-02 5.267681181430816650e-02 6.295031309127807617e-02 6.655517965555191040e-02 1.509865075349807739e-01 1.761580854654312134e-01 6.772257387638092041e-02 1.345207244157791138e-01 1.524658203125000000e-01 9.759540855884552002e-02 4.477393999695777893e-02 4.648457840085029602e-02 6.564053148031234741e-02 6.790627539157867432e-02 6.622786819934844971e-02 7.701894640922546387e-02 4.434728249907493591e-02 4.467546567320823669e-02 4.986528307199478149e-02 3.791104629635810852e-02 4.514971747994422913e-02 9.185552597045898438e-02 4.509776830673217773e-02 5.103431269526481628e-02 1.950883865356445312e-02 3.901201859116554260e-02 1.125769168138504028e-01 1.517148781567811966e-02 7.533776015043258667e-02 6.115241348743438721e-02 5.736098811030387878e-02 6.228084489703178406e-02 7.375289499759674072e-02 1.189667060971260071e-01 6.830532848834991455e-02 8.100392669439315796e-02 8.229029923677444458e-02 8.421599864959716797e-02 5.729089304804801941e-02 6.657703220844268799e-02 1.098766624927520752e-01 1.097779572010040283e-01 6.204712018370628357e-02 5.417635291814804077e-02 6.479673087596893311e-02 1.638721227645874023e-01 2.491567134857177734e-01 1.260958015918731689e-01 6.183567643165588379e-02 8.681528270244598389e-02 5.948796123266220093e-02 1.389619410037994385e-01 1.043501123785972595e-01 1.416411101818084717e-01 1.181716099381446838e-01 1.238348931074142456e-01 1.734861135482788086e-01 9.017480909824371338e-02 5.715409666299819946e-02 6.462888419628143311e-02 5.704008415341377258e-02 5.953329801559448242e-02 4.605053737759590149e-02 5.649255216121673584e-02 6.317397952079772949e-02 5.200796946883201599e-02 4.189646989107131958e-02 1.346860527992248535e-01 3.277907371520996094e-01 2.581745982170104980e-01 9.095987677574157715e-02 6.175282970070838928e-02 5.313305556774139404e-02 6.334879249334335327e-02 5.883847177028656006e-02 5.094374716281890869e-02 7.402892410755157471e-02 5.557142943143844604e-02 5.424159765243530273e-02 7.845290750265121460e-02 5.713136494159698486e-02 7.040417939424514771e-02 1.604914069175720215e-01 1.501012444496154785e-01 1.021154820919036865e-01 9.557437151670455933e-02 6.453294306993484497e-02 5.701364576816558838e-02 2.996722608804702759e-02 6.953081488609313965e-02 6.297557055950164795e-02 9.521557390689849854e-02 2.571783661842346191e-01 7.493773102760314941e-02 1.973450183868408203e-01 1.205355599522590637e-01 1.005630195140838623e-01 4.359999299049377441e-02 5.522014200687408447e-02 8.357669413089752197e-02 7.542210817337036133e-02 9.002675116062164307e-02 1.475713253021240234e-01 1.444364041090011597e-01 1.181338429450988770e-01 1.131209358572959900e-01 8.030173927545547485e-02 7.335869967937469482e-02 7.413909584283828735e-02 7.475252449512481689e-02 7.544964551925659180e-02 6.788288056850433350e-02 1.382777988910675049e-01 1.587600708007812500e-01 9.226072579622268677e-02 7.124868780374526978e-02 2.655906602740287781e-02 7.899799942970275879e-02 1.065020859241485596e-01 8.524729311466217041e-02 8.507837355136871338e-02 9.455186128616333008e-02 1.017586886882781982e-01 9.588898718357086182e-02 8.015176653861999512e-02 7.377795875072479248e-02 7.478331029415130615e-02 8.583500981330871582e-02 5.092222243547439575e-02 7.254347205162048340e-02 6.903249770402908325e-02 7.182388007640838623e-02 5.032089352607727051e-02 9.535232186317443848e-02 1.063833609223365784e-01 8.819577097892761230e-02 7.235218584537506104e-02 7.574789226055145264e-02 7.020586729049682617e-02 8.246554434299468994e-02 7.637482881546020508e-02 8.899142593145370483e-02 1.064217537641525269e-01 9.573613107204437256e-02 7.444175332784652710e-02 9.084350615739822388e-02 7.473926246166229248e-02 5.353743955492973328e-02 7.652400434017181396e-02 8.788571506738662720e-02 7.713986188173294067e-02 7.465469837188720703e-02 5.792615562677383423e-02 6.607078015804290771e-02 6.341050565242767334e-02 6.683214008808135986e-02 7.163884490728378296e-02 6.159863620996475220e-02 1.243642121553421021e-01 6.253927946090698242e-02 5.605964362621307373e-02 7.874040305614471436e-02 1.069612577557563782e-01 9.316273033618927002e-02 8.351948857307434082e-02 4.670765250921249390e-02 6.932090222835540771e-02 8.919912576675415039e-02 7.093766331672668457e-02 1.751062721014022827e-01 2.552891373634338379e-01 -1.835960447788238525e-01 7.828296720981597900e-02 -1.065955758094787598e-01 1.165676116943359375e-01 1.392327714711427689e-02 8.607655763626098633e-02 1.674934178590774536e-01 2.841427922248840332e-01 1.067359447479248047e-01 7.619949430227279663e-02 9.943622350692749023e-02 4.562213644385337830e-02 3.143006935715675354e-02 1.021175980567932129e-01 1.750707328319549561e-01 1.070686876773834229e-01 9.748540818691253662e-02 1.312362253665924072e-01 9.548363089561462402e-02 7.480333745479583740e-02 9.257125109434127808e-02 7.062010467052459717e-02 6.833633780479431152e-02 5.483407527208328247e-02 7.990592718124389648e-02 5.205605924129486084e-02 8.951915800571441650e-02 7.614467293024063110e-02 1.189433634281158447e-01 1.092720031738281250e-01 5.399359390139579773e-02 6.705340743064880371e-02 8.469712734222412109e-02 8.735676854848861694e-02 8.539427071809768677e-02 7.283328473567962646e-02 7.711304724216461182e-02 9.768821299076080322e-02 1.170103996992111206e-01 1.087446063756942749e-01 7.022902369499206543e-02 5.853307992219924927e-02 8.458600938320159912e-02 1.023965179920196533e-01 5.767909437417984009e-02 7.239250838756561279e-02 9.094732999801635742e-02 1.123943179845809937e-01 9.958598762750625610e-02 7.228017598390579224e-02 8.812340348958969116e-02 7.965926826000213623e-02 9.392877668142318726e-02 7.245650887489318848e-02 6.221547350287437439e-02 8.087357878684997559e-02 6.805230677127838135e-02 8.677433431148529053e-02 5.846729129552841187e-02 5.498009920120239258e-02 1.464639306068420410e-01 1.834458708763122559e-01 2.910681068897247314e-01 1.468748748302459717e-01 1.029135286808013916e-01 8.724160492420196533e-02 6.854119151830673218e-02 1.089877262711524963e-01 5.336207896471023560e-02 4.762326180934906006e-02 6.777551770210266113e-02 6.573993712663650513e-02 5.123361200094223022e-02 7.728981226682662964e-02 1.116194352507591248e-01 1.175617054104804993e-01 1.007077991962432861e-01 8.891577273607254028e-02 1.105462238192558289e-01 1.153176873922348022e-01 1.313816905021667480e-01 5.249849334359169006e-02 1.759909391403198242e-01 8.804111182689666748e-02 1.781827658414840698e-01 3.668540418148040771e-01 -3.169712722301483154e-01 1.056363582611083984e-01 -3.638819325715303421e-03 7.308207452297210693e-02 6.342104822397232056e-02 8.248932659626007080e-02 7.360248267650604248e-02 8.194379508495330811e-02 1.025695651769638062e-01 8.605047315359115601e-02 8.638487756252288818e-02 5.994015559554100037e-02 6.096259504556655884e-02 5.694453045725822449e-02 8.871906995773315430e-02 6.738236546516418457e-02 5.918313935399055481e-02 8.108110725879669189e-02 6.841973215341567993e-02 5.572762340307235718e-02 1.867213547229766846e-01 3.632669448852539062e-01 1.571939885616302490e-01 1.677409559488296509e-01 6.145486980676651001e-02 6.979725509881973267e-02 5.940371006727218628e-02 8.668059110641479492e-02 8.647781610488891602e-02 7.518313080072402954e-02 6.848710775375366211e-02 6.146547570824623108e-02 1.021824777126312256e-01 6.457270681858062744e-02 7.219174504280090332e-02 7.160659879446029663e-02 7.098376005887985229e-02 8.838398754596710205e-02 8.726349472999572754e-02 8.250505477190017700e-02 7.649521529674530029e-02 5.836024880409240723e-03 2.781733274459838867e-01 2.523696422576904297e-01 1.200562864542007446e-01 7.335510849952697754e-02 8.059518039226531982e-02 3.940337896347045898e-02 6.554426997900009155e-02 6.338526308536529541e-02 4.896804690361022949e-02 8.491022884845733643e-02 3.946774452924728394e-02 4.535831511020660400e-02 3.550302982330322266e-02 4.281879216432571411e-02 4.487069696187973022e-02 5.756520852446556091e-02 5.622737109661102295e-02 8.027458190917968750e-02 7.980722188949584961e-02 6.272193044424057007e-02 9.955137968063354492e-02 5.237236246466636658e-02 4.947285354137420654e-02 1.233130842447280884e-01 8.647925406694412231e-02 7.136950641870498657e-02 8.193480968475341797e-02 7.452380657196044922e-02 1.205575764179229736e-01 3.847849965095520020e-01 3.435093164443969727e-01 1.873900443315505981e-01 1.143537908792495728e-01 7.943035662174224854e-02 7.183990627527236938e-02 8.245304226875305176e-02 9.713532030582427979e-02 6.325757503509521484e-02 6.256479024887084961e-02 9.078516066074371338e-02 7.054422795772552490e-02 9.418156743049621582e-02 9.142710268497467041e-02 7.220506668090820312e-02 8.488750457763671875e-02 -2.886776439845561981e-02 3.534977436065673828e-01 6.053315401077270508e-01 5.073674321174621582e-01 1.638576090335845947e-01 1.152569204568862915e-01 8.639349043369293213e-02 9.803058207035064697e-02 7.481414079666137695e-02 6.377647072076797485e-02 6.070787459611892700e-02 7.901737093925476074e-02 6.989096105098724365e-02 8.818288147449493408e-02 7.647308707237243652e-02 1.448677927255630493e-01 1.392782330513000488e-01 1.139651164412498474e-01 6.908491253852844238e-02 7.862804085016250610e-02 6.049735844135284424e-02 1.447504162788391113e-01 1.053012311458587646e-01 8.625662326812744141e-02 9.776056557893753052e-02 7.671520113945007324e-02 8.818995952606201172e-02 4.783411696553230286e-02 4.960084706544876099e-02 8.120143413543701172e-02 6.743064522743225098e-02 6.692121922969818115e-02 1.036379337310791016e-01 2.726437151432037354e-01 1.630010455846786499e-01 1.178195923566818237e-01 1.127369701862335205e-01 1.677323281764984131e-01 3.381957411766052246e-01 2.362146973609924316e-01 1.160707026720046997e-01 1.319130957126617432e-01 1.555149406194686890e-01 1.052585914731025696e-01 1.061656773090362549e-01 7.326582819223403931e-02 8.638811111450195312e-02 8.622775971889495850e-02 7.637877017259597778e-02 7.877019792795181274e-02 7.784798741340637207e-02 2.680636048316955566e-01 4.837217330932617188e-01 3.431893587112426758e-01 2.207229882478713989e-01 3.035431504249572754e-01 2.442421317100524902e-01 3.799953311681747437e-02 7.724307477474212646e-02 6.443555653095245361e-02 7.407347857952117920e-02 8.166649937629699707e-02 7.137882709503173828e-02 1.289950907230377197e-01 1.021145060658454895e-01 1.214937716722488403e-01 1.899712383747100830e-01 1.342263221740722656e-01 1.060280874371528625e-01 1.172618567943572998e-01 6.472511589527130127e-02 7.430434226989746094e-02 7.789392769336700439e-02 8.204537630081176758e-02 7.616645842790603638e-02 7.919220626354217529e-02 9.934678673744201660e-02 4.836835712194442749e-02 1.419721245765686035e-01 3.464605212211608887e-01 2.215869128704071045e-01 1.174761354923248291e-01 7.571066170930862427e-02 1.113510727882385254e-01 7.002936303615570068e-02 8.605689555406570435e-02 8.390647172927856445e-02 9.387292712926864624e-02 6.239753216505050659e-02 9.334380924701690674e-02 8.562849462032318115e-02 8.072819560766220093e-02 8.586080372333526611e-02 1.829470396041870117e-01 3.914228081703186035e-01 2.828680872917175293e-01 1.502936780452728271e-01 8.548063784837722778e-02 5.716383457183837891e-02 8.934707939624786377e-02 7.957364618778228760e-02 8.564166724681854248e-02 7.942404597997665405e-02 6.831744313240051270e-02 1.077522784471511841e-01 2.096510827541351318e-01 3.452160954475402832e-01 2.475560456514358521e-01 2.128580808639526367e-01 8.875186741352081299e-02 9.155113995075225830e-02 8.614692091941833496e-02 9.281775355339050293e-02 5.778022855520248413e-02 9.783251583576202393e-02 9.726708382368087769e-02 9.134258329868316650e-02 9.248904883861541748e-02 7.593099772930145264e-02 7.161109149456024170e-02 7.061483711004257202e-02 8.772652596235275269e-02 7.784480601549148560e-02 7.054243981838226318e-02 8.132553100585937500e-02 7.781154662370681763e-02 1.973276883363723755e-01 1.934875398874282837e-01 2.699501514434814453e-01 8.905090391635894775e-02 7.646616548299789429e-02 7.016251236200332642e-02 9.340316057205200195e-02 8.643044531345367432e-02 8.508684486150741577e-02 1.012526005506515503e-01 6.379611790180206299e-02 7.730183005332946777e-02 9.264324605464935303e-02 8.273653686046600342e-02 5.693143233656883240e-02 6.996327638626098633e-02 1.062499955296516418e-01 9.878953546285629272e-02 9.904006123542785645e-02 9.089119732379913330e-02 7.906263321638107300e-02 8.713801205158233643e-02 9.985989332199096680e-02 7.092197239398956299e-02 9.561836719512939453e-02 7.970197498798370361e-02 4.921359568834304810e-02 1.047335490584373474e-01 1.222895234823226929e-01 1.383828222751617432e-01 1.180173903703689575e-01 8.384968340396881104e-02 5.964794754981994629e-02 6.310164928436279297e-02 7.607230544090270996e-02 7.563352584838867188e-02 6.981043517589569092e-02 1.398817896842956543e-01 1.815927326679229736e-01 1.121599823236465454e-01 9.527343511581420898e-02 6.792409718036651611e-02 8.060289919376373291e-02 8.613718301057815552e-02 9.246425330638885498e-02 7.789501547813415527e-02 1.231085211038589478e-01 1.112937927246093750e-01 8.814410865306854248e-02 6.975427269935607910e-02 -1.385882776230573654e-02 5.927230417728424072e-02 6.159693002700805664e-02 8.606180548667907715e-02 7.450202107429504395e-02 8.696852624416351318e-02 8.390870690345764160e-02 9.676270931959152222e-02 1.944840513169765472e-02 1.191214025020599365e-01 -1.253806054592132568e-01 1.969061493873596191e-01 4.111790060997009277e-01 3.408116102218627930e-01 2.015501260757446289e-01 1.189121156930923462e-01 9.994026273488998413e-02 2.488353997468948364e-01 3.145471811294555664e-01 3.085721135139465332e-01 2.010748386383056641e-01 5.201677978038787842e-02 6.736079603433609009e-02 7.869733870029449463e-02 8.793766796588897705e-02 3.074478358030319214e-02 1.147790104150772095e-01 1.376854181289672852e-01 1.888215243816375732e-01 1.725765615701675415e-01 1.441849768161773682e-01 8.011923730373382568e-02 1.123972684144973755e-01 9.456874430179595947e-02 8.194050937891006470e-02 9.204255789518356323e-02 7.790359854698181152e-02 1.176127493381500244e-01 6.639439612627029419e-02 8.588524162769317627e-02 1.065974980592727661e-01 8.972092717885971069e-02 7.153750956058502197e-02 1.114859804511070251e-01 9.233677387237548828e-02 9.140651673078536987e-02 8.155131340026855469e-02 7.962998002767562866e-02 9.177353978157043457e-02 8.782911300659179688e-02 1.448885649442672729e-01 1.068792045116424561e-01 7.237432897090911865e-02 8.076240867376327515e-02 9.659312665462493896e-02 8.261715620756149292e-02 6.689950823783874512e-02 5.068381130695343018e-02 1.068507805466651917e-01 7.935258746147155762e-02 6.120168417692184448e-02 7.791779190301895142e-02 6.902579218149185181e-02 8.556192368268966675e-02 1.099459528923034668e-01 8.608989417552947998e-02 8.609734475612640381e-02 8.255532383918762207e-02 1.007802486419677734e-01 1.033569350838661194e-01 8.827635645866394043e-02 7.458268105983734131e-02 1.077922061085700989e-01 7.404184341430664062e-02 6.823209673166275024e-02 1.465494632720947266e-01 2.539539933204650879e-01 2.580983340740203857e-01 1.840558350086212158e-01 1.061875149607658386e-01 9.586764872074127197e-02 9.179475903511047363e-02 1.063723564147949219e-01 8.704759180545806885e-02 9.378503262996673584e-02 8.262376487255096436e-02 6.868170946836471558e-02 9.285569936037063599e-02 5.953324958682060242e-02 7.454615831375122070e-02 1.249559447169303894e-01 7.769859582185745239e-02 7.328596711158752441e-02 1.107433885335922241e-01 1.086291298270225525e-01 1.067186072468757629e-01 9.951512515544891357e-02 7.654257118701934814e-02 9.090711921453475952e-02 5.468199402093887329e-02 7.919558137655258179e-02 5.323675647377967834e-02 -2.952678203582763672e-01 6.388237327337265015e-02 2.902544736862182617e-01 1.145291477441787720e-01 4.744287207722663879e-02 9.161998331546783447e-02 6.458667665719985962e-02 9.750677645206451416e-02 6.386817991733551025e-02 8.521984517574310303e-02 6.732123345136642456e-02 6.830257177352905273e-02 5.165699869394302368e-02 7.471407204866409302e-02 7.063815742731094360e-02 8.796593546867370605e-02 8.732994645833969116e-02 7.397635281085968018e-02 7.481047511100769043e-02 6.538909673690795898e-02 5.370336025953292847e-02 7.722997665405273438e-02 1.040971949696540833e-01 2.504217624664306641e-01 4.653238356113433838e-01 1.320813447237014771e-01 7.981930673122406006e-02 5.786257982254028320e-02 7.154904305934906006e-02 7.897249609231948853e-02 8.512791246175765991e-02 5.718849226832389832e-02 7.682168483734130859e-02 8.119204640388488770e-02 6.526756286621093750e-02 8.674524724483489990e-02 6.767936795949935913e-02 5.850359052419662476e-02 8.579755574464797974e-02 5.245009809732437134e-02 6.948915123939514160e-02 8.295724540948867798e-02 1.126996949315071106e-01 6.169311329722404480e-02 7.083757966756820679e-02 -1.801868528127670288e-02 -3.393456339836120605e-03 2.949610650539398193e-01 4.211399853229522705e-01 1.082480549812316895e-01 7.469726353883743286e-02 9.955395758152008057e-02 4.620928317308425903e-02 5.272156000137329102e-02 6.226246431469917297e-02 8.114634454250335693e-02 6.435589492321014404e-02 6.138236820697784424e-02 9.113231301307678223e-02 7.312239706516265869e-02 6.305249780416488647e-02 8.660925924777984619e-02 9.039627015590667725e-02 6.301707029342651367e-02 4.842739179730415344e-02 6.589175760746002197e-02 8.065700531005859375e-02 9.269934147596359253e-02 6.944629549980163574e-02 5.872116237878799438e-02 4.841863363981246948e-02 7.139198482036590576e-02 6.680543720722198486e-02 7.311847805976867676e-02 6.074430048465728760e-02 6.121022254228591919e-02 2.124979197978973389e-01 3.511920869350433350e-01 2.331864535808563232e-01 1.381446123123168945e-01 5.780517309904098511e-02 9.028034657239913940e-02 7.827823609113693237e-02 8.734300732612609863e-02 1.073715388774871826e-01 1.264441609382629395e-01 7.497949898242950439e-02 6.700758635997772217e-02 7.896259427070617676e-02 9.087628126144409180e-02 1.631328016519546509e-01 1.379696428775787354e-01 8.054214715957641602e-02 1.013323366641998291e-01 1.267626695334911346e-02 -2.774026989936828613e-02 4.641250967979431152e-01 5.711619853973388672e-01 2.164787352085113525e-01 6.457398086786270142e-02 8.514466136693954468e-02 4.990261793136596680e-02 6.978814303874969482e-02 8.045975118875503540e-02 1.037691533565521240e-01 9.656818211078643799e-02 7.235673069953918457e-02 7.517941296100616455e-02 9.599516540765762329e-02 8.655068278312683105e-02 7.840090990066528320e-02 7.252937555313110352e-02 8.545464277267456055e-02 7.235768437385559082e-02 6.534688174724578857e-02 9.302791953086853027e-02 1.155026406049728394e-01 9.247937053442001343e-02 7.152390480041503906e-02 1.024109050631523132e-01 7.447549700736999512e-02 7.333093881607055664e-02 6.546507775783538818e-02 6.111309304833412170e-02 8.113850653171539307e-02 6.323289871215820312e-02 6.738853454589843750e-02 1.701055467128753662e-01 6.821808218955993652e-02 -1.197818759828805923e-02 6.853158771991729736e-02 8.607192337512969971e-02 9.669876098632812500e-02 2.227707654237747192e-01 3.620086908340454102e-01 1.871809661388397217e-01 1.142238155007362366e-01 7.434432208538055420e-02 8.397300541400909424e-02 7.299195975065231323e-02 8.365520834922790527e-02 8.878321200609207153e-02 9.483784437179565430e-02 5.335548892617225647e-02 1.495192646980285645e-01 2.313455492258071899e-01 1.468110680580139160e-01 1.516271829605102539e-01 1.071028336882591248e-01 2.683331370353698730e-01 5.495356321334838867e-01 3.425530195236206055e-01 1.078476533293724060e-01 1.288303434848785400e-01 1.648599505424499512e-01 4.892094433307647705e-02 9.093117713928222656e-02 5.659028142690658569e-02 9.039995074272155762e-02 8.979920297861099243e-02 7.350930571556091309e-02 8.465452492237091064e-02 1.098225042223930359e-01 8.582548797130584717e-02 7.988843321800231934e-02 2.676976844668388367e-02 1.677509546279907227e-01 4.593352973461151123e-01 2.438808381557464600e-01 7.067985832691192627e-02 7.559274882078170776e-02 5.995935201644897461e-02 6.067187711596488953e-02 8.086588978767395020e-02 8.122514933347702026e-02 7.917155325412750244e-02 9.341064095497131348e-02 8.877840638160705566e-02 7.947595417499542236e-02 1.931660622358322144e-01 2.470865845680236816e-01 1.233790665864944458e-01 1.081879287958145142e-01 8.548457920551300049e-02 9.962826967239379883e-02 9.903466701507568359e-02 9.597977995872497559e-02 1.099355146288871765e-01 1.070130020380020142e-01 9.200741350650787354e-02 3.896456584334373474e-02 8.988803625106811523e-02 1.723197698593139648e-01 3.186379671096801758e-01 2.676952183246612549e-01 2.173849940299987793e-01 1.272779405117034912e-01 7.808473706245422363e-02 1.000018268823623657e-01 6.754247844219207764e-02 1.128035336732864380e-01 7.287897914648056030e-02 6.494213640689849854e-02 7.570835947990417480e-02 8.690616488456726074e-02 6.941859424114227295e-02 3.054286912083625793e-02 2.357099801301956177e-01 3.680769801139831543e-01 4.087423980236053467e-01 1.733811497688293457e-01 1.062358617782592773e-01 5.500273406505584717e-02 6.205951794981956482e-02 6.485163420438766479e-02 7.123738527297973633e-02 8.035713434219360352e-02 1.039055362343788147e-01 5.637451261281967163e-02 2.634624019265174866e-02 -2.976236119866371155e-02 2.512893676757812500e-01 8.763739466667175293e-02 8.269909024238586426e-02 7.688066363334655762e-02 8.991055190563201904e-02 8.464579284191131592e-02 9.457102417945861816e-02 8.649306744337081909e-02 1.126124411821365356e-01 7.025134563446044922e-02 7.818853855133056641e-02 8.038912713527679443e-02 9.000404179096221924e-02 8.692046999931335449e-02 1.015989184379577637e-01 1.041803136467933655e-01 8.887036144733428955e-02 7.145253568887710571e-02 5.669591575860977173e-02 8.213429152965545654e-02 7.363463938236236572e-02 1.034007593989372253e-01 1.473822891712188721e-01 1.256417334079742432e-01 1.514970958232879639e-01 1.008394658565521240e-01 7.445395737886428833e-02 7.501503080129623413e-02 7.750488817691802979e-02 7.414422929286956787e-02 8.027231693267822266e-02 7.039051502943038940e-02 6.327009201049804688e-02 6.266593933105468750e-02 9.790256619453430176e-02 7.576336711645126343e-02 9.520345926284790039e-02 1.624718904495239258e-01 1.203210949897766113e-01 1.457056403160095215e-01 8.378344774246215820e-02 8.403410017490386963e-02 7.876130938529968262e-02 1.107008531689643860e-01 9.948818385601043701e-02 1.018174961209297180e-01 9.136562794446945190e-02 9.659351408481597900e-02 1.427384614944458008e-01 7.801631093025207520e-02 7.640630751848220825e-02 1.537411361932754517e-01 1.034283190965652466e-01 1.051045656204223633e-01 8.648605644702911377e-02 8.053112775087356567e-02 7.978624850511550903e-02 7.221269607543945312e-02 8.340188860893249512e-02 9.826646745204925537e-02 8.609247207641601562e-02 8.411277085542678833e-02 9.186975657939910889e-02 9.086015820503234863e-02 8.653153479099273682e-02 9.566891938447952271e-02 1.051893830299377441e-01 6.864988803863525391e-02 9.595757722854614258e-02 9.006360918283462524e-02 1.139159500598907471e-01 5.698667466640472412e-02 7.789527624845504761e-02 6.656961143016815186e-02 8.273037523031234741e-02 6.983357667922973633e-02 8.427691459655761719e-02 4.973739385604858398e-02 9.239603579044342041e-02 9.168814122676849365e-02 6.936582922935485840e-02 7.685878872871398926e-02 8.110873401165008545e-02 7.224586606025695801e-02 8.107896149158477783e-02 1.668702960014343262e-01 -4.973032772541046143e-01 -3.018078804016113281e-01 1.623419225215911865e-01 7.702265679836273193e-02 1.184192970395088196e-01 1.457826197147369385e-01 7.102504372596740723e-02 3.725374862551689148e-02 1.210888102650642395e-01 3.165026903152465820e-01 1.646607667207717896e-01 9.761860966682434082e-02 1.465233862400054932e-01 9.706167131662368774e-02 1.244549229741096497e-01 1.238178983330726624e-01 8.345328271389007568e-02 5.889546871185302734e-02 7.168760895729064941e-02 2.005190104246139526e-01 2.364133149385452271e-01 1.048823744058609009e-01 1.233791336417198181e-01 5.720194801688194275e-02 8.606168627738952637e-02 7.060397416353225708e-02 7.352695614099502563e-02 8.977793902158737183e-02 7.502466440200805664e-02 1.031579375267028809e-01 1.134361028671264648e-01 9.332824498414993286e-02 1.268983483314514160e-01 8.892855048179626465e-02 4.998502507805824280e-02 1.171194016933441162e-01 8.120589703321456909e-02 9.322065114974975586e-02 5.999106168746948242e-02 7.477737963199615479e-02 8.408382534980773926e-02 8.965381979942321777e-02 1.126970127224922180e-01 8.684678375720977783e-02 9.512121975421905518e-02 1.024971902370452881e-01 8.685158193111419678e-02 9.294842928647994995e-02 8.669739961624145508e-02 9.254569560289382935e-02 8.917086571455001831e-02 8.447803556919097900e-02 1.034524589776992798e-01 9.839552640914916992e-02 6.413279473781585693e-02 7.482564449310302734e-02 7.771421968936920166e-02 8.953753858804702759e-02 9.100717306137084961e-02 9.229640662670135498e-02 7.625087350606918335e-02 6.885942816734313965e-02 8.761674165725708008e-02 7.580037415027618408e-02 6.563235819339752197e-02 8.441113680601119995e-02 7.328148186206817627e-02 8.464537560939788818e-02 1.643087342381477356e-02 1.874266862869262695e-01 2.245195955038070679e-01 1.307233422994613647e-01 8.184616267681121826e-02 6.442809104919433594e-02 7.025719434022903442e-02 8.153885602951049805e-02 7.281600683927536011e-02 9.356011450290679932e-02 7.776938378810882568e-02 9.656682610511779785e-02 8.614930510520935059e-02 7.094722986221313477e-02 9.570418298244476318e-02 7.077503204345703125e-02 7.540361583232879639e-02 7.755446434020996094e-02 9.768858551979064941e-02 8.159458637237548828e-02 1.087556630373001099e-01 8.151601254940032959e-02 6.273765861988067627e-02 9.923846274614334106e-02 1.104371175169944763e-01 9.400115907192230225e-02 7.153037190437316895e-02 8.991952240467071533e-02 8.813859522342681885e-02 1.073390245437622070e-02 -1.995552778244018555e-01 -5.256456732749938965e-01 2.376036942005157471e-01 1.552149355411529541e-01 9.056769311428070068e-02 1.079743877053260803e-01 4.615328088402748108e-02 6.066858768463134766e-02 7.558709383010864258e-02 7.679191231727600098e-02 7.024008035659790039e-02 8.678045868873596191e-02 7.507181912660598755e-02 8.906692266464233398e-02 9.377127140760421753e-02 8.187057077884674072e-02 8.542791754007339478e-02 8.215500414371490479e-02 8.614026010036468506e-02 7.197205722332000732e-02 9.773088246583938599e-02 5.923847109079360962e-02 8.062447607517242432e-02 1.237795799970626831e-01 2.673112154006958008e-01 2.504203617572784424e-01 1.277415305376052856e-01 1.145507693290710449e-01 1.008569151163101196e-01 7.583220303058624268e-02 7.112853229045867920e-02 7.478426396846771240e-02 6.257390975952148438e-02 4.684301838278770447e-02 7.160955667495727539e-02 7.539078593254089355e-02 8.332790434360504150e-02 9.904054552316665649e-02 8.379248529672622681e-02 1.092111244797706604e-01 1.207335218787193298e-01 9.095786511898040771e-02 1.012810319662094116e-01 9.842421114444732666e-02 7.613067328929901123e-02 8.978348970413208008e-02 1.234890073537826538e-01 1.580172404646873474e-02 -2.272560074925422668e-02 -1.457381062209606171e-02 2.320451289415359497e-01 2.913475036621093750e-01 9.971485286951065063e-02 8.855929225683212280e-02 8.343977481126785278e-02 8.673408627510070801e-02 1.028860211372375488e-01 1.054219901561737061e-01 1.068774014711380005e-01 9.723418951034545898e-02 9.072218090295791626e-02 8.668585121631622314e-02 1.036580353975296021e-01 1.007220894098281860e-01 1.143958792090415955e-01 1.213882490992546082e-01 1.188620701432228088e-01 1.223615705966949463e-01 9.869395196437835693e-02 1.109290570020675659e-01 1.087866723537445068e-01 8.987067639827728271e-02 9.347803890705108643e-02 1.635392308235168457e-01 1.261036247014999390e-01 1.525732278823852539e-01 1.236694455146789551e-01 1.604261249303817749e-01 1.875925958156585693e-01 2.109818607568740845e-01 2.390896379947662354e-01 4.733612537384033203e-01 5.658577680587768555e-01 2.603526115417480469e-01 1.598927825689315796e-01 1.820366680622100830e-01 1.771942377090454102e-01 1.533035635948181152e-01 1.267806589603424072e-01 1.377903223037719727e-01 1.601769328117370605e-01 1.614705175161361694e-01 1.865316480398178101e-01 2.472106516361236572e-01 3.317109942436218262e-01 4.347914159297943115e-01 5.269495844841003418e-01 5.648677349090576172e-01 5.609875321388244629e-01 4.905115365982055664e-01 4.271653294563293457e-01 5.311445593833923340e-01 6.502562165260314941e-01 6.268603205680847168e-01 5.440295934677124023e-01 2.277240455150604248e-01 1.906502395868301392e-01 1.467006206512451172e-01 1.241998896002769470e-01 1.596081554889678955e-01 1.377043426036834717e-01 1.521077156066894531e-01 1.569601297378540039e-01 1.371911317110061646e-01 1.452171653509140015e-01 1.768759936094284058e-01 1.996870338916778564e-01 1.951667815446853638e-01 2.325803637504577637e-01 2.672563791275024414e-01 3.571678996086120605e-01 4.103176891803741455e-01 4.541602730751037598e-01 4.618191123008728027e-01 4.522996544837951660e-01 4.102518558502197266e-01 3.786519765853881836e-01 3.774987459182739258e-01 3.108129501342773438e-01 2.500469684600830078e-01 2.156101465225219727e-01 2.018543183803558350e-01 1.817986220121383667e-01 1.997143626213073730e-01 1.531256139278411865e-01 1.612360328435897827e-01 1.240558028221130371e-01 1.290572285652160645e-01 1.299760639667510986e-01 1.131633967161178589e-01 8.159912377595901489e-02 1.377907693386077881e-01 2.474061846733093262e-01 4.168674945831298828e-01 2.866297960281372070e-01 6.748150289058685303e-02 1.184177845716476440e-01 1.500504612922668457e-01 1.185761019587516785e-01 1.137383133172988892e-01 9.877634048461914062e-02 7.569609582424163818e-02 9.277711063623428345e-02 1.101514101028442383e-01 1.083910316228866577e-01 1.030472964048385620e-01 7.415995001792907715e-02 1.001859977841377258e-01 1.503206193447113037e-01 1.093320474028587341e-01 4.738251268863677979e-01 3.029946088790893555e-01 1.343712359666824341e-01 5.700264126062393188e-02 9.775803983211517334e-02 9.686750173568725586e-02 9.345112740993499756e-02 7.932373881340026855e-02 9.305611997842788696e-02 7.680825889110565186e-02 7.884570956230163574e-02 5.612789839506149292e-02 9.663136303424835205e-02 1.287052035331726074e-01 9.016740322113037109e-02 1.713306829333305359e-02 1.873145848512649536e-01 1.210745275020599365e-01 9.322179853916168213e-02 9.419646859169006348e-02 7.188197970390319824e-02 6.889659911394119263e-02 5.509892478585243225e-02 7.140564918518066406e-02 9.150655567646026611e-02 1.167630031704902649e-01 1.839486360549926758e-01 1.181752979755401611e-01 8.931931108236312866e-02 7.541283965110778809e-02 9.257727116346359253e-02 7.919168472290039062e-02 4.992890357971191406e-02 8.349431306123733521e-02 7.821138203144073486e-02 7.838568836450576782e-02 5.522895231842994690e-02 1.276807487010955811e-01 3.353155553340911865e-01 3.556355834007263184e-01 1.332222223281860352e-01 6.926393508911132812e-02 7.568721473217010498e-02 7.768121361732482910e-02 6.433514505624771118e-02 1.102818697690963745e-01 8.824417740106582642e-02 8.758580684661865234e-02 1.870785355567932129e-01 1.408653259277343750e-01 9.985472261905670166e-02 1.495106816291809082e-01 2.487174123525619507e-01 1.668449491262435913e-01 9.626977145671844482e-02 6.982050836086273193e-02 7.677723467350006104e-02 6.710396707057952881e-02 6.890391558408737183e-02 7.592067122459411621e-02 1.007039248943328857e-01 1.326496154069900513e-01 1.557577103376388550e-01 2.116802930831909180e-01 2.455435991287231445e-01 3.309842646121978760e-01 1.932778358459472656e-01 7.263901829719543457e-02 6.403951346874237061e-02 8.821852505207061768e-02 8.390210568904876709e-02 8.262638747692108154e-02 6.640136241912841797e-02 8.507923781871795654e-02 8.811326324939727783e-02 7.169246673583984375e-02 6.286273896694183350e-02 6.343767046928405762e-02 5.436321347951889038e-02 9.365043789148330688e-02 9.587088227272033691e-02 1.039260178804397583e-01 1.796031892299652100e-01 2.080318927764892578e-01 1.559396237134933472e-01 9.065765142440795898e-02 1.006001159548759460e-01 1.062748283147811890e-01 1.038147509098052979e-01 8.016557246446609497e-02 7.897958159446716309e-02 4.441505298018455505e-02 5.823984742164611816e-02 -1.257339864969253540e-01 1.206135451793670654e-01 1.986545473337173462e-01 7.736948132514953613e-02 8.245320618152618408e-02 7.921904325485229492e-02 7.615290582180023193e-02 9.274667501449584961e-02 6.268481165170669556e-02 8.273157477378845215e-02 9.280045330524444580e-02 7.237730175256729126e-02 9.081242978572845459e-02 6.582871079444885254e-02 8.032217621803283691e-02 1.166266649961471558e-01 8.286929875612258911e-02 7.561501860618591309e-02 7.280655205249786377e-02 8.252380788326263428e-02 7.755906134843826294e-02 7.631595432758331299e-02 9.543871879577636719e-02 1.013810783624649048e-01 1.608791649341583252e-01 2.365878671407699585e-01 2.221406251192092896e-01 2.807315587997436523e-01 1.617125868797302246e-01 1.226223260164260864e-01 1.410173922777175903e-01 1.280915439128875732e-01 1.449513137340545654e-01 1.191545203328132629e-01 1.318360418081283569e-01 1.016137748956680298e-01 1.996567249298095703e-01 1.185288280248641968e-01 1.973873376846313477e-01 1.135131567716598511e-01 1.159630492329597473e-01 6.718114018440246582e-02 9.939292073249816895e-02 1.161520183086395264e-01 1.160807535052299500e-01 1.294320374727249146e-01 1.226528137922286987e-01 1.064758598804473877e-01 8.766382187604904175e-02 1.122872531414031982e-01 1.281851530075073242e-01 1.182016953825950623e-01 1.040323227643966675e-01 1.156497448682785034e-01 1.055868938565254211e-01 7.945767045021057129e-02 7.530514895915985107e-02 9.030647575855255127e-02 8.142048120498657227e-02 8.233244717121124268e-02 8.708357810974121094e-02 9.014472365379333496e-02 6.406205892562866211e-02 9.031660109758377075e-02 8.041051775217056274e-02 9.371992200613021851e-02 8.743032813072204590e-02 9.378308057785034180e-02 8.047853410243988037e-02 7.059926539659500122e-02 7.947425544261932373e-02 8.634980022907257080e-02 9.924910962581634521e-02 8.635267615318298340e-02 6.095032393932342529e-02 7.371938973665237427e-02 9.731939435005187988e-02 7.976157963275909424e-02 9.679283946752548218e-02 7.683420181274414062e-02 4.657112061977386475e-02 5.433542281389236450e-02 7.252714037895202637e-02 7.451856136322021484e-02 8.925227820873260498e-02 8.529826998710632324e-02 8.194833248853683472e-02 9.042514860630035400e-02 8.380949497222900391e-02 6.830995529890060425e-02 7.586936652660369873e-02 6.918855011463165283e-02 4.477225244045257568e-02 -1.463630199432373047e-01 -3.295584321022033691e-01 -3.455910682678222656e-01 1.965761482715606689e-01 1.276302337646484375e-01 2.368366718292236328e-02 1.854662783443927765e-02 1.178216934204101562e-01 8.831505477428436279e-02 -5.396809428930282593e-03 2.627942562103271484e-01 3.955434560775756836e-01 1.238451153039932251e-01 7.152032852172851562e-02 5.598205327987670898e-02 9.481390565633773804e-02 1.026154309511184692e-01 1.007265150547027588e-01 9.940445423126220703e-02 8.514635264873504639e-02 1.136429905891418457e-01 7.172015309333801270e-02 4.068103060126304626e-02 1.412751376628875732e-01 1.548692882061004639e-01 1.057444363832473755e-01 6.752882152795791626e-02 6.079218909144401550e-02 6.188428774476051331e-02 5.716869980096817017e-02 7.330493628978729248e-02 8.146510273218154907e-02 8.761027455329895020e-02 9.082908928394317627e-02 7.507036626338958740e-02 1.057051420211791992e-01 6.844143569469451904e-02 7.323452830314636230e-02 1.151022762060165405e-01 9.938117861747741699e-02 7.338645309209823608e-02 8.186253905296325684e-02 7.571256160736083984e-02 6.690592318773269653e-02 6.994682550430297852e-02 7.894036173820495605e-02 7.230118662118911743e-02 6.679899245500564575e-02 7.438559830188751221e-02 7.579404115676879883e-02 6.430549174547195435e-02 6.953737139701843262e-02 6.729471683502197266e-02 7.717177271842956543e-02 9.964392334222793579e-02 9.493038803339004517e-02 9.431837499141693115e-02 1.149688884615898132e-01 9.205444157123565674e-02 7.301957905292510986e-02 1.121078580617904663e-01 6.672290712594985962e-02 7.331418991088867188e-02 4.480200260877609253e-02 7.613928616046905518e-02 6.698735058307647705e-02 8.748440444469451904e-02 7.168821245431900024e-02 8.046057820320129395e-02 7.482716441154479980e-02 7.376432418823242188e-02 6.142283976078033447e-02 7.723391056060791016e-02 5.832781642675399780e-02 8.665271103382110596e-02 2.476318925619125366e-02 1.079089939594268799e-01 1.014372706413269043e-01 7.432992756366729736e-02 9.043520689010620117e-02 8.074717223644256592e-02 1.022925302386283875e-01 6.542439758777618408e-02 9.769278764724731445e-02 6.009139865636825562e-02 6.243196129798889160e-02 6.398315727710723877e-02 7.471721619367599487e-02 5.941942334175109863e-02 6.415978074073791504e-02 8.286710083484649658e-02 9.536203742027282715e-02 6.707192212343215942e-02 8.844295144081115723e-02 1.246365159749984741e-01 6.024850159883499146e-02 5.870559439063072205e-02 6.279203295707702637e-02 3.592381626367568970e-02 7.127384841442108154e-02 7.228699326515197754e-02 8.126354217529296875e-02 6.248681992292404175e-02 5.038769543170928955e-02 3.980510681867599487e-02 6.393943727016448975e-02 1.341601461172103882e-02 1.251750439405441284e-01 -9.629782289266586304e-03 3.891469910740852356e-03 6.931350380182266235e-02 7.137586176395416260e-02 5.746113508939743042e-02 5.775991827249526978e-02 5.450525879859924316e-02 7.555618137121200562e-02 5.646111816167831421e-02 6.154002994298934937e-02 5.007620900869369507e-02 5.491344630718231201e-02 4.521125927567481995e-02 7.166139036417007446e-02 6.150899827480316162e-02 7.954743504524230957e-02 6.269857287406921387e-02 6.093420088291168213e-02 4.326999932527542114e-02 6.367962807416915894e-02 3.558283299207687378e-02 7.033987343311309814e-02 8.990464359521865845e-02 4.440158233046531677e-02 3.652753308415412903e-02 5.383420363068580627e-02 7.654480636119842529e-02 4.792015999555587769e-02 6.643491983413696289e-02 5.872053280472755432e-02 7.427954673767089844e-02 8.059905469417572021e-02 3.980723395943641663e-02 4.635817557573318481e-02 4.728683084249496460e-02 4.803176969289779663e-02 6.145752966403961182e-02 5.716505646705627441e-02 7.424797117710113525e-02 8.298888802528381348e-02 4.422539845108985901e-02 3.553266078233718872e-02 6.789734959602355957e-02 5.600437149405479431e-02 7.415065169334411621e-02 7.176709920167922974e-02 6.529775261878967285e-02 5.979330837726593018e-02 6.843040883541107178e-02 4.839095845818519592e-02 5.721842497587203979e-02 1.363544762134552002e-01 5.298940092325210571e-02 -3.218943998217582703e-02 6.817787885665893555e-02 4.894980415701866150e-02 6.577092409133911133e-02 6.550318002700805664e-02 4.648093134164810181e-02 3.716292977333068848e-02 3.893322497606277466e-02 4.147887229919433594e-02 5.283530801534652710e-02 3.869493678212165833e-02 5.862106382846832275e-02 4.353717342019081116e-02 4.067567735910415649e-02 7.803036272525787354e-02 3.532610088586807251e-02 7.046695053577423096e-02 6.278304755687713623e-02 9.017291478812694550e-03 6.425720453262329102e-02 6.679788231849670410e-02 8.134102821350097656e-02 6.199019402265548706e-02 7.251790910959243774e-02 6.419564783573150635e-02 6.655308604240417480e-02 6.945609301328659058e-02 9.107804298400878906e-02 5.973722785711288452e-02 3.979101777076721191e-02 1.780437678098678589e-02 3.342819958925247192e-02 1.143028810620307922e-01 3.185093700885772705e-01 1.939664334058761597e-01 8.652576804161071777e-02 1.486591435968875885e-02 5.078157037496566772e-02 4.175429791212081909e-02 5.292602255940437317e-02 5.485769361257553101e-02 6.665195524692535400e-02 5.882811546325683594e-02 6.436119973659515381e-02 6.123787909746170044e-02 7.294416427612304688e-02 6.167946010828018188e-02 7.228529453277587891e-02 5.471129715442657471e-02 5.514866858720779419e-02 1.910217478871345520e-02 5.858596786856651306e-02 6.421076506376266479e-02 8.190160989761352539e-02 8.156336843967437744e-03 7.959783822298049927e-02 6.367573887109756470e-02 6.630816310644149780e-02 2.404281944036483765e-01 4.564971476793289185e-02 3.740286827087402344e-02 1.335703488439321518e-02 3.014416247606277466e-02 6.139772757887840271e-02 7.205715030431747437e-02 3.598803281784057617e-02 6.103505194187164307e-02 5.559051036834716797e-02 7.960018515586853027e-02 6.809270381927490234e-02 6.581398099660873413e-02 2.213760651648044586e-02 4.172492399811744690e-02 4.851870238780975342e-02 1.734783872961997986e-02 1.965820044279098511e-02 3.407986089587211609e-02 2.958010509610176086e-02 3.971255570650100708e-02 5.289695411920547485e-02 4.758442193269729614e-02 4.589200764894485474e-02 3.252120316028594971e-02 6.232168152928352356e-02 6.309131532907485962e-02 6.067282706499099731e-02 4.885577410459518433e-02 3.805786371231079102e-02 2.134032174944877625e-02 3.562936931848526001e-02 4.467134922742843628e-02 6.091981008648872375e-02 3.582077473402023315e-02 2.796735428273677826e-02 3.149657323956489563e-02 2.597168833017349243e-02 1.123700104653835297e-02 -5.541220307350158691e-04 1.133775524795055389e-02 9.190834313631057739e-02 2.201132923364639282e-01 6.245213374495506287e-02 2.354013174772262573e-02 2.667670696973800659e-02 -1.922849798575043678e-03 2.408304065465927124e-02 1.565489545464515686e-02 2.593583986163139343e-02 2.671168558299541473e-02 8.037953078746795654e-02 1.040159016847610474e-01 7.675170898437500000e-02 7.519637048244476318e-02 5.788649246096611023e-02 6.481631100177764893e-02 4.145824909210205078e-02 4.533668607473373413e-02 9.057523310184478760e-02 1.137312799692153931e-01 1.903767883777618408e-01 1.946967542171478271e-01 9.984244406223297119e-02 -5.846176296472549438e-03 2.646779641509056091e-02 -1.956508867442607880e-02 -1.751770824193954468e-02 3.322740644216537476e-02 4.333442449569702148e-02 3.989156335592269897e-02 4.717747867107391357e-02 5.377367511391639709e-02 2.191789820790290833e-02 2.623636275529861450e-02 -1.208719518035650253e-02 1.549704745411872864e-02 -3.285260871052742004e-02 2.727704122662544250e-04 2.625153958797454834e-02 6.564559042453765869e-02 4.388273134827613831e-02 2.038458362221717834e-02 1.649267598986625671e-02 9.276981465518474579e-03 4.483462870121002197e-02 3.922940045595169067e-02 3.213620185852050781e-02 2.292003296315670013e-02 7.688950281590223312e-03 4.585344344377517700e-02 3.824809193611145020e-02 6.143895909190177917e-02 8.341333828866481781e-03 2.546457946300506592e-02 -2.007986418902873993e-03 3.731657564640045166e-02 5.052319169044494629e-02 4.397450760006904602e-02 6.186711788177490234e-02 4.732521623373031616e-02 5.204844102263450623e-02 3.385719656944274902e-02 4.919156059622764587e-02 2.974762581288814545e-03 3.511663526296615601e-03 1.811085455119609833e-02 1.554967649281024933e-02 4.027861356735229492e-02 1.819788292050361633e-02 1.632182672619819641e-02 9.845878928899765015e-03 4.082462750375270844e-03 1.866355538368225098e-02 3.680451586842536926e-02 3.199714049696922302e-02 4.104576259851455688e-02 -1.252898480743169785e-03 -3.164038294926285744e-03 1.022569462656974792e-02 1.276079192757606506e-02 2.803822048008441925e-02 1.975268870592117310e-02 4.672049731016159058e-02 3.972567990422248840e-02 4.896831884980201721e-02 4.008322581648826599e-02 4.735351540148258209e-03 8.222051896154880524e-03 1.133002620190382004e-02 -1.315039768815040588e-02 8.549341931939125061e-03 2.122045680880546570e-02 4.146472364664077759e-02 2.301682345569133759e-02 1.738906279206275940e-02 -4.575648345053195953e-04 1.301501505076885223e-02 -3.769686445593833923e-03 -3.373812884092330933e-03 -9.788947179913520813e-03 3.297369927167892456e-02 4.791263118386268616e-02 5.044362694025039673e-02 1.146027669310569763e-01 6.603814661502838135e-02 3.594057634472846985e-02 9.682928211987018585e-03 3.070175461471080780e-02 4.293839260935783386e-02 5.271931737661361694e-02 4.620967060327529907e-02 6.166753172874450684e-02 6.683246791362762451e-02 5.244350805878639221e-02 3.557343035936355591e-02 3.800264745950698853e-02 1.204421520233154297e-01 8.801086992025375366e-02 -9.551652707159519196e-03 -1.200539618730545044e-02 2.329643070697784424e-02 -1.826578564941883087e-02 -1.085767522454261780e-03 -1.056978944689035416e-02 -9.736166335642337799e-03 1.072246953845024109e-02 -5.443892441689968109e-03 -2.258805930614471436e-02 1.263201702386140823e-02 2.655237354338169098e-02 -5.099311238154768944e-04 1.232955045998096466e-02 1.016622222959995270e-02 2.846354432404041290e-02 4.524710029363632202e-02 1.650795526802539825e-02 -2.981994859874248505e-02 1.097267959266901016e-02 1.606850698590278625e-02 2.188430726528167725e-02 6.356534957885742188e-01 1.618970870971679688e+00 1.343502283096313477e+00 2.303254127502441406e+00 3.826373577117919922e+00 1.413073921203613281e+01 3.961397171020507812e+01 3.095133972167968750e+01 6.596327781677246094e+00 1.432899355888366699e+00 -5.431746244430541992e-01 1.695312142372131348e+00 -1.601523756980895996e+00 1.137202262878417969e+00 7.180824279785156250e-01 1.407403498888015747e-01 1.936135649681091309e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00
1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02 1.601825281977653503e-02
1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00

```

`Qubespec/Tutorial/cdfs_701_YJ_inner_1Dspectrum.txt`:

```txt
1.000000000000000000e+00 1.000175292952917516e+00 1.000350585905835032e+00 1.000525878858752549e+00 1.000701171811670065e+00 1.000876464764587581e+00 1.001051757717505097e+00 1.001227050670422614e+00 1.001402343623340130e+00 1.001577636576257646e+00 1.001752929529175162e+00 1.001928222482092679e+00 1.002103515435010195e+00 1.002278808387927711e+00 1.002454101340845227e+00 1.002629394293762743e+00 1.002804687246680260e+00 1.002979980199597776e+00 1.003155273152515292e+00 1.003330566105432808e+00 1.003505859058350325e+00 1.003681152011267841e+00 1.003856444964185357e+00 1.004031737917102873e+00 1.004207030870020390e+00 1.004382323822937906e+00 1.004557616775855422e+00 1.004732909728772938e+00 1.004908202681690454e+00 1.005083495634607971e+00 1.005258788587525487e+00 1.005434081540443003e+00 1.005609374493360519e+00 1.005784667446278036e+00 1.005959960399195552e+00 1.006135253352113068e+00 1.006310546305030584e+00 1.006485839257948101e+00 1.006661132210865617e+00 1.006836425163783133e+00 1.007011718116700649e+00 1.007187011069618165e+00 1.007362304022535682e+00 1.007537596975453198e+00 1.007712889928370714e+00 1.007888182881288230e+00 1.008063475834205747e+00 1.008238768787123263e+00 1.008414061740040779e+00 1.008589354692958295e+00 1.008764647645875812e+00 1.008939940598793328e+00 1.009115233551710844e+00 1.009290526504628360e+00 1.009465819457545877e+00 1.009641112410463393e+00 1.009816405363380909e+00 1.009991698316298425e+00 1.010166991269215941e+00 1.010342284222133458e+00 1.010517577175050974e+00 1.010692870127968490e+00 1.010868163080886006e+00 1.011043456033803523e+00 1.011218748986721039e+00 1.011394041939638555e+00 1.011569334892556071e+00 1.011744627845473588e+00 1.011919920798391104e+00 1.012095213751308620e+00 1.012270506704226136e+00 1.012445799657143652e+00 1.012621092610061169e+00 1.012796385562978685e+00 1.012971678515896201e+00 1.013146971468813717e+00 1.013322264421731234e+00 1.013497557374648750e+00 1.013672850327566266e+00 1.013848143280483782e+00 1.014023436233401299e+00 1.014198729186318815e+00 1.014374022139236331e+00 1.014549315092153847e+00 1.014724608045071363e+00 1.014899900997988880e+00 1.015075193950906396e+00 1.015250486903823912e+00 1.015425779856741428e+00 1.015601072809658945e+00 1.015776365762576461e+00 1.015951658715493977e+00 1.016126951668411493e+00 1.016302244621329010e+00 1.016477537574246526e+00 1.016652830527164042e+00 1.016828123480081558e+00 1.017003416432999074e+00 1.017178709385916591e+00 1.017354002338834107e+00 1.017529295291751623e+00 1.017704588244669139e+00 1.017879881197586656e+00 1.018055174150504172e+00 1.018230467103421688e+00 1.018405760056339204e+00 1.018581053009256721e+00 1.018756345962174237e+00 1.018931638915091753e+00 1.019106931868009269e+00 1.019282224820926785e+00 1.019457517773844302e+00 1.019632810726761818e+00 1.019808103679679334e+00 1.019983396632596850e+00 1.020158689585514367e+00 1.020333982538431883e+00 1.020509275491349399e+00 1.020684568444266915e+00 1.020859861397184432e+00 1.021035154350101948e+00 1.021210447303019464e+00 1.021385740255936980e+00 1.021561033208854496e+00 1.021736326161772013e+00 1.021911619114689529e+00 1.022086912067607045e+00 1.022262205020524561e+00 1.022437497973442078e+00 1.022612790926359594e+00 1.022788083879277110e+00 1.022963376832194626e+00 1.023138669785112143e+00 1.023313962738029659e+00 1.023489255690947175e+00 1.023664548643864691e+00 1.023839841596782207e+00 1.024015134549699724e+00 1.024190427502617240e+00 1.024365720455534756e+00 1.024541013408452272e+00 1.024716306361369789e+00 1.024891599314287305e+00 1.025066892267204821e+00 1.025242185220122337e+00 1.025417478173039854e+00 1.025592771125957370e+00 1.025768064078874886e+00 1.025943357031792402e+00 1.026118649984709918e+00 1.026293942937627435e+00 1.026469235890544951e+00 1.026644528843462467e+00 1.026819821796379983e+00 1.026995114749297500e+00 1.027170407702215016e+00 1.027345700655132532e+00 1.027520993608050048e+00 1.027696286560967565e+00 1.027871579513885081e+00 1.028046872466802597e+00 1.028222165419720113e+00 1.028397458372637630e+00 1.028572751325555146e+00 1.028748044278472662e+00 1.028923337231390178e+00 1.029098630184307694e+00 1.029273923137225211e+00 1.029449216090142727e+00 1.029624509043060243e+00 1.029799801995977759e+00 1.029975094948895276e+00 1.030150387901812792e+00 1.030325680854730308e+00 1.030500973807647824e+00 1.030676266760565341e+00 1.030851559713482857e+00 1.031026852666400373e+00 1.031202145619317889e+00 1.031377438572235405e+00 1.031552731525152922e+00 1.031728024478070438e+00 1.031903317430987954e+00 1.032078610383905470e+00 1.032253903336822987e+00 1.032429196289740503e+00 1.032604489242658019e+00 1.032779782195575535e+00 1.032955075148493052e+00 1.033130368101410568e+00 1.033305661054328084e+00 1.033480954007245600e+00 1.033656246960163116e+00 1.033831539913080633e+00 1.034006832865998149e+00 1.034182125818915665e+00 1.034357418771833181e+00 1.034532711724750698e+00 1.034708004677668214e+00 1.034883297630585730e+00 1.035058590583503246e+00 1.035233883536420763e+00 1.035409176489338279e+00 1.035584469442255795e+00 1.035759762395173311e+00 1.035935055348090827e+00 1.036110348301008344e+00 1.036285641253925860e+00 1.036460934206843376e+00 1.036636227159760892e+00 1.036811520112678409e+00 1.036986813065595925e+00 1.037162106018513441e+00 1.037337398971430957e+00 1.037512691924348474e+00 1.037687984877265990e+00 1.037863277830183506e+00 1.038038570783101022e+00 1.038213863736018538e+00 1.038389156688936055e+00 1.038564449641853571e+00 1.038739742594771087e+00 1.038915035547688603e+00 1.039090328500606120e+00 1.039265621453523636e+00 1.039440914406441152e+00 1.039616207359358668e+00 1.039791500312276185e+00 1.039966793265193701e+00 1.040142086218111217e+00 1.040317379171028733e+00 1.040492672123946249e+00 1.040667965076863766e+00 1.040843258029781282e+00 1.041018550982698798e+00 1.041193843935616314e+00 1.041369136888533831e+00 1.041544429841451347e+00 1.041719722794368863e+00 1.041895015747286379e+00 1.042070308700203896e+00 1.042245601653121412e+00 1.042420894606038928e+00 1.042596187558956444e+00 1.042771480511873960e+00 1.042946773464791477e+00 1.043122066417708993e+00 1.043297359370626509e+00 1.043472652323544025e+00 1.043647945276461542e+00 1.043823238229379058e+00 1.043998531182296574e+00 1.044173824135214090e+00 1.044349117088131607e+00 1.044524410041049123e+00 1.044699702993966639e+00 1.044874995946884155e+00 1.045050288899801672e+00 1.045225581852719188e+00 1.045400874805636704e+00 1.045576167758554220e+00 1.045751460711471736e+00 1.045926753664389253e+00 1.046102046617306769e+00 1.046277339570224285e+00 1.046452632523141801e+00 1.046627925476059318e+00 1.046803218428976834e+00 1.046978511381894350e+00 1.047153804334811866e+00 1.047329097287729383e+00 1.047504390240646899e+00 1.047679683193564415e+00 1.047854976146481931e+00 1.048030269099399447e+00 1.048205562052316964e+00 1.048380855005234480e+00 1.048556147958151996e+00 1.048731440911069512e+00 1.048906733863987029e+00 1.049082026816904545e+00 1.049257319769822061e+00 1.049432612722739577e+00 1.049607905675657094e+00 1.049783198628574610e+00 1.049958491581492126e+00 1.050133784534409642e+00 1.050309077487327158e+00 1.050484370440244675e+00 1.050659663393162191e+00 1.050834956346079707e+00 1.051010249298997223e+00 1.051185542251914740e+00 1.051360835204832256e+00 1.051536128157749772e+00 1.051711421110667288e+00 1.051886714063584805e+00 1.052062007016502321e+00 1.052237299969419837e+00 1.052412592922337353e+00 1.052587885875254869e+00 1.052763178828172386e+00 1.052938471781089902e+00 1.053113764734007418e+00 1.053289057686924934e+00 1.053464350639842451e+00 1.053639643592759967e+00 1.053814936545677483e+00 1.053990229498594999e+00 1.054165522451512516e+00 1.054340815404430032e+00 1.054516108357347548e+00 1.054691401310265064e+00 1.054866694263182580e+00 1.055041987216100097e+00 1.055217280169017613e+00 1.055392573121935129e+00 1.055567866074852645e+00 1.055743159027770162e+00 1.055918451980687678e+00 1.056093744933605194e+00 1.056269037886522710e+00 1.056444330839440227e+00 1.056619623792357743e+00 1.056794916745275259e+00 1.056970209698192775e+00 1.057145502651110291e+00 1.057320795604027808e+00 1.057496088556945324e+00 1.057671381509862840e+00 1.057846674462780356e+00 1.058021967415697873e+00 1.058197260368615389e+00 1.058372553321532905e+00 1.058547846274450421e+00 1.058723139227367938e+00 1.058898432180285454e+00 1.059073725133202970e+00 1.059249018086120486e+00 1.059424311039038002e+00 1.059599603991955519e+00 1.059774896944873035e+00 1.059950189897790551e+00 1.060125482850708067e+00 1.060300775803625584e+00 1.060476068756543100e+00 1.060651361709460616e+00 1.060826654662378132e+00 1.061001947615295649e+00 1.061177240568213165e+00 1.061352533521130681e+00 1.061527826474048197e+00 1.061703119426965714e+00 1.061878412379883230e+00 1.062053705332800746e+00 1.062228998285718262e+00 1.062404291238635778e+00 1.062579584191553295e+00 1.062754877144470811e+00 1.062930170097388327e+00 1.063105463050305843e+00 1.063280756003223360e+00 1.063456048956140876e+00 1.063631341909058392e+00 1.063806634861975908e+00 1.063981927814893425e+00 1.064157220767810941e+00 1.064332513720728457e+00 1.064507806673645973e+00 1.064683099626563489e+00 1.064858392579481006e+00 1.065033685532398522e+00 1.065208978485316038e+00 1.065384271438233554e+00 1.065559564391151071e+00 1.065734857344068587e+00 1.065910150296986103e+00 1.066085443249903619e+00 1.066260736202821136e+00 1.066436029155738652e+00 1.066611322108656168e+00 1.066786615061573684e+00 1.066961908014491200e+00 1.067137200967408717e+00 1.067312493920326233e+00 1.067487786873243749e+00 1.067663079826161265e+00 1.067838372779078782e+00 1.068013665731996298e+00 1.068188958684913814e+00 1.068364251637831330e+00 1.068539544590748847e+00 1.068714837543666363e+00 1.068890130496583879e+00 1.069065423449501395e+00 1.069240716402418911e+00 1.069416009355336428e+00 1.069591302308253944e+00 1.069766595261171460e+00 1.069941888214088976e+00 1.070117181167006493e+00 1.070292474119924009e+00 1.070467767072841525e+00 1.070643060025759041e+00 1.070818352978676558e+00 1.070993645931594074e+00 1.071168938884511590e+00 1.071344231837429106e+00 1.071519524790346622e+00 1.071694817743264139e+00 1.071870110696181655e+00 1.072045403649099171e+00 1.072220696602016687e+00 1.072395989554934204e+00 1.072571282507851720e+00 1.072746575460769236e+00 1.072921868413686752e+00 1.073097161366604269e+00 1.073272454319521785e+00 1.073447747272439301e+00 1.073623040225356817e+00 1.073798333178274333e+00 1.073973626131191850e+00 1.074148919084109366e+00 1.074324212037026882e+00 1.074499504989944398e+00 1.074674797942861915e+00 1.074850090895779431e+00 1.075025383848696947e+00 1.075200676801614463e+00 1.075375969754531980e+00 1.075551262707449496e+00 1.075726555660367012e+00 1.075901848613284528e+00 1.076077141566202044e+00 1.076252434519119561e+00 1.076427727472037077e+00 1.076603020424954593e+00 1.076778313377872109e+00 1.076953606330789626e+00 1.077128899283707142e+00 1.077304192236624658e+00 1.077479485189542174e+00 1.077654778142459691e+00 1.077830071095377207e+00 1.078005364048294723e+00 1.078180657001212239e+00 1.078355949954129755e+00 1.078531242907047272e+00 1.078706535859964788e+00 1.078881828812882304e+00 1.079057121765799820e+00 1.079232414718717337e+00 1.079407707671634853e+00 1.079583000624552369e+00 1.079758293577469885e+00 1.079933586530387402e+00 1.080108879483304918e+00 1.080284172436222434e+00 1.080459465389139950e+00 1.080634758342057467e+00 1.080810051294974983e+00 1.080985344247892499e+00 1.081160637200810015e+00 1.081335930153727531e+00 1.081511223106645048e+00 1.081686516059562564e+00 1.081861809012480080e+00 1.082037101965397596e+00 1.082212394918315113e+00 1.082387687871232629e+00 1.082562980824150145e+00 1.082738273777067661e+00 1.082913566729985178e+00 1.083088859682902694e+00 1.083264152635820210e+00 1.083439445588737726e+00 1.083614738541655242e+00 1.083790031494572759e+00 1.083965324447490275e+00 1.084140617400407791e+00 1.084315910353325307e+00 1.084491203306242824e+00 1.084666496259160340e+00 1.084841789212077634e+00 1.085017082164995150e+00 1.085192375117912666e+00 1.085367668070830183e+00 1.085542961023747699e+00 1.085718253976665215e+00 1.085893546929582731e+00 1.086068839882500248e+00 1.086244132835417764e+00 1.086419425788335280e+00 1.086594718741252796e+00 1.086770011694170313e+00 1.086945304647087829e+00 1.087120597600005345e+00 1.087295890552922861e+00 1.087471183505840377e+00 1.087646476458757894e+00 1.087821769411675410e+00 1.087997062364592926e+00 1.088172355317510442e+00 1.088347648270427959e+00 1.088522941223345475e+00 1.088698234176262991e+00 1.088873527129180507e+00 1.089048820082098024e+00 1.089224113035015540e+00 1.089399405987933056e+00 1.089574698940850572e+00 1.089749991893768089e+00 1.089925284846685605e+00 1.090100577799603121e+00 1.090275870752520637e+00 1.090451163705438153e+00 1.090626456658355670e+00 1.090801749611273186e+00 1.090977042564190702e+00 1.091152335517108218e+00 1.091327628470025735e+00 1.091502921422943251e+00 1.091678214375860767e+00 1.091853507328778283e+00 1.092028800281695800e+00 1.092204093234613316e+00 1.092379386187530832e+00 1.092554679140448348e+00 1.092729972093365864e+00 1.092905265046283381e+00 1.093080557999200897e+00 1.093255850952118413e+00 1.093431143905035929e+00 1.093606436857953446e+00 1.093781729810870962e+00 1.093957022763788478e+00 1.094132315716705994e+00 1.094307608669623511e+00 1.094482901622541027e+00 1.094658194575458543e+00 1.094833487528376059e+00 1.095008780481293575e+00 1.095184073434211092e+00 1.095359366387128608e+00 1.095534659340046124e+00 1.095709952292963640e+00 1.095885245245881157e+00 1.096060538198798673e+00 1.096235831151716189e+00 1.096411124104633705e+00 1.096586417057551222e+00 1.096761710010468738e+00 1.096937002963386254e+00 1.097112295916303770e+00 1.097287588869221286e+00 1.097462881822138803e+00 1.097638174775056319e+00 1.097813467727973835e+00 1.097988760680891351e+00 1.098164053633808868e+00 1.098339346586726384e+00 1.098514639539643900e+00 1.098689932492561416e+00 1.098865225445478933e+00 1.099040518398396449e+00 1.099215811351313965e+00 1.099391104304231481e+00 1.099566397257148997e+00 1.099741690210066514e+00 1.099916983162984030e+00 1.100092276115901546e+00 1.100267569068819062e+00 1.100442862021736579e+00 1.100618154974654095e+00 1.100793447927571611e+00 1.100968740880489127e+00 1.101144033833406644e+00 1.101319326786324160e+00 1.101494619739241676e+00 1.101669912692159192e+00 1.101845205645076708e+00 1.102020498597994225e+00 1.102195791550911741e+00 1.102371084503829257e+00 1.102546377456746773e+00 1.102721670409664290e+00 1.102896963362581806e+00 1.103072256315499322e+00 1.103247549268416838e+00 1.103422842221334355e+00 1.103598135174251871e+00 1.103773428127169387e+00 1.103948721080086903e+00 1.104124014033004419e+00 1.104299306985921936e+00 1.104474599938839452e+00 1.104649892891756968e+00 1.104825185844674484e+00 1.105000478797592001e+00 1.105175771750509517e+00 1.105351064703427033e+00 1.105526357656344549e+00 1.105701650609262066e+00 1.105876943562179582e+00 1.106052236515097098e+00 1.106227529468014614e+00 1.106402822420932130e+00 1.106578115373849647e+00 1.106753408326767163e+00 1.106928701279684679e+00 1.107103994232602195e+00 1.107279287185519712e+00 1.107454580138437228e+00 1.107629873091354744e+00 1.107805166044272260e+00 1.107980458997189777e+00 1.108155751950107293e+00 1.108331044903024809e+00 1.108506337855942325e+00 1.108681630808859842e+00 1.108856923761777358e+00 1.109032216714694874e+00 1.109207509667612390e+00 1.109382802620529906e+00 1.109558095573447423e+00 1.109733388526364939e+00 1.109908681479282455e+00 1.110083974432199971e+00 1.110259267385117488e+00 1.110434560338035004e+00 1.110609853290952520e+00 1.110785146243870036e+00 1.110960439196787553e+00 1.111135732149705069e+00 1.111311025102622585e+00 1.111486318055540101e+00 1.111661611008457617e+00 1.111836903961375134e+00 1.112012196914292650e+00 1.112187489867210166e+00 1.112362782820127682e+00 1.112538075773045199e+00 1.112713368725962715e+00 1.112888661678880231e+00 1.113063954631797747e+00 1.113239247584715264e+00 1.113414540537632780e+00 1.113589833490550296e+00 1.113765126443467812e+00 1.113940419396385328e+00 1.114115712349302845e+00 1.114291005302220361e+00 1.114466298255137877e+00 1.114641591208055393e+00 1.114816884160972910e+00 1.114992177113890426e+00 1.115167470066807942e+00 1.115342763019725458e+00 1.115518055972642975e+00 1.115693348925560491e+00 1.115868641878478007e+00 1.116043934831395523e+00 1.116219227784313039e+00 1.116394520737230556e+00 1.116569813690148072e+00 1.116745106643065588e+00 1.116920399595983104e+00 1.117095692548900621e+00 1.117270985501818137e+00 1.117446278454735653e+00 1.117621571407653169e+00 1.117796864360570686e+00 1.117972157313488202e+00 1.118147450266405718e+00 1.118322743219323234e+00 1.118498036172240750e+00 1.118673329125158267e+00 1.118848622078075783e+00 1.119023915030993299e+00 1.119199207983910815e+00 1.119374500936828332e+00 1.119549793889745848e+00 1.119725086842663364e+00 1.119900379795580880e+00 1.120075672748498397e+00 1.120250965701415913e+00 1.120426258654333429e+00 1.120601551607250945e+00 1.120776844560168461e+00 1.120952137513085978e+00 1.121127430466003494e+00 1.121302723418921010e+00 1.121478016371838526e+00 1.121653309324756043e+00 1.121828602277673559e+00 1.122003895230591075e+00 1.122179188183508591e+00 1.122354481136426108e+00 1.122529774089343624e+00 1.122705067042261140e+00 1.122880359995178656e+00 1.123055652948096172e+00 1.123230945901013689e+00 1.123406238853931205e+00 1.123581531806848721e+00 1.123756824759766237e+00 1.123932117712683754e+00 1.124107410665601270e+00 1.124282703618518786e+00 1.124457996571436302e+00 1.124633289524353819e+00 1.124808582477271335e+00 1.124983875430188851e+00 1.125159168383106367e+00 1.125334461336023884e+00 1.125509754288941400e+00 1.125685047241858916e+00 1.125860340194776432e+00 1.126035633147693948e+00 1.126210926100611465e+00 1.126386219053528981e+00 1.126561512006446497e+00 1.126736804959364013e+00 1.126912097912281530e+00 1.127087390865199046e+00 1.127262683818116562e+00 1.127437976771034078e+00 1.127613269723951595e+00 1.127788562676869111e+00 1.127963855629786627e+00 1.128139148582704143e+00 1.128314441535621659e+00 1.128489734488539176e+00 1.128665027441456692e+00 1.128840320394374208e+00 1.129015613347291724e+00 1.129190906300209241e+00 1.129366199253126757e+00 1.129541492206044273e+00 1.129716785158961789e+00 1.129892078111879306e+00 1.130067371064796822e+00 1.130242664017714338e+00 1.130417956970631854e+00 1.130593249923549370e+00 1.130768542876466887e+00 1.130943835829384403e+00 1.131119128782301919e+00 1.131294421735219435e+00 1.131469714688136952e+00 1.131645007641054468e+00 1.131820300593971984e+00 1.131995593546889500e+00 1.132170886499807017e+00 1.132346179452724533e+00 1.132521472405642049e+00 1.132696765358559565e+00 1.132872058311477081e+00 1.133047351264394598e+00 1.133222644217312114e+00 1.133397937170229630e+00 1.133573230123147146e+00 1.133748523076064663e+00 1.133923816028982179e+00 1.134099108981899695e+00 1.134274401934817211e+00 1.134449694887734728e+00 1.134624987840652244e+00 1.134800280793569760e+00 1.134975573746487276e+00 1.135150866699404792e+00 1.135326159652322309e+00 1.135501452605239825e+00 1.135676745558157341e+00 1.135852038511074857e+00 1.136027331463992374e+00 1.136202624416909890e+00 1.136377917369827406e+00 1.136553210322744922e+00 1.136728503275662439e+00 1.136903796228579955e+00 1.137079089181497471e+00 1.137254382134414987e+00 1.137429675087332503e+00 1.137604968040250020e+00 1.137780260993167536e+00 1.137955553946085052e+00 1.138130846899002568e+00 1.138306139851920085e+00 1.138481432804837601e+00 1.138656725757755117e+00 1.138832018710672633e+00 1.139007311663590150e+00 1.139182604616507666e+00 1.139357897569425182e+00 1.139533190522342698e+00 1.139708483475260214e+00 1.139883776428177731e+00 1.140059069381095247e+00 1.140234362334012763e+00 1.140409655286930279e+00 1.140584948239847796e+00 1.140760241192765312e+00 1.140935534145682828e+00 1.141110827098600344e+00 1.141286120051517861e+00 1.141461413004435377e+00 1.141636705957352893e+00 1.141811998910270409e+00 1.141987291863187926e+00 1.142162584816105442e+00 1.142337877769022958e+00 1.142513170721940474e+00 1.142688463674857990e+00 1.142863756627775507e+00 1.143039049580693023e+00 1.143214342533610539e+00 1.143389635486528055e+00 1.143564928439445572e+00 1.143740221392363088e+00 1.143915514345280604e+00 1.144090807298198120e+00 1.144266100251115637e+00 1.144441393204033153e+00 1.144616686156950669e+00 1.144791979109868185e+00 1.144967272062785701e+00 1.145142565015703218e+00 1.145317857968620734e+00 1.145493150921538250e+00 1.145668443874455766e+00 1.145843736827373283e+00 1.146019029780290799e+00 1.146194322733208315e+00 1.146369615686125831e+00 1.146544908639043348e+00 1.146720201591960864e+00 1.146895494544878380e+00 1.147070787497795896e+00 1.147246080450713412e+00 1.147421373403630929e+00 1.147596666356548445e+00 1.147771959309465961e+00 1.147947252262383477e+00 1.148122545215300994e+00 1.148297838168218510e+00 1.148473131121136026e+00 1.148648424074053542e+00 1.148823717026971059e+00 1.148999009979888575e+00 1.149174302932806091e+00 1.149349595885723607e+00 1.149524888838641123e+00 1.149700181791558640e+00 1.149875474744476156e+00 1.150050767697393672e+00 1.150226060650311188e+00 1.150401353603228705e+00 1.150576646556146221e+00 1.150751939509063737e+00 1.150927232461981253e+00 1.151102525414898770e+00 1.151277818367816286e+00 1.151453111320733802e+00 1.151628404273651318e+00 1.151803697226568834e+00 1.151978990179486351e+00 1.152154283132403867e+00 1.152329576085321383e+00 1.152504869038238899e+00 1.152680161991156416e+00 1.152855454944073932e+00 1.153030747896991448e+00 1.153206040849908964e+00 1.153381333802826481e+00 1.153556626755743997e+00 1.153731919708661513e+00 1.153907212661579029e+00 1.154082505614496545e+00 1.154257798567414062e+00 1.154433091520331578e+00 1.154608384473249094e+00 1.154783677426166610e+00 1.154958970379084127e+00 1.155134263332001643e+00 1.155309556284919159e+00 1.155484849237836675e+00 1.155660142190754192e+00 1.155835435143671708e+00 1.156010728096589224e+00 1.156186021049506740e+00 1.156361314002424256e+00 1.156536606955341773e+00 1.156711899908259289e+00 1.156887192861176805e+00 1.157062485814094321e+00 1.157237778767011838e+00 1.157413071719929354e+00 1.157588364672846870e+00 1.157763657625764386e+00 1.157938950578681903e+00 1.158114243531599419e+00 1.158289536484516935e+00 1.158464829437434451e+00 1.158640122390351967e+00 1.158815415343269484e+00 1.158990708296187000e+00 1.159166001249104516e+00 1.159341294202022032e+00 1.159516587154939549e+00 1.159691880107857065e+00 1.159867173060774581e+00 1.160042466013692097e+00 1.160217758966609614e+00 1.160393051919527130e+00 1.160568344872444646e+00 1.160743637825362162e+00 1.160918930778279679e+00 1.161094223731197195e+00 1.161269516684114711e+00 1.161444809637032227e+00 1.161620102589949743e+00 1.161795395542867260e+00 1.161970688495784776e+00 1.162145981448702292e+00 1.162321274401619808e+00 1.162496567354537325e+00 1.162671860307454841e+00 1.162847153260372357e+00 1.163022446213289873e+00 1.163197739166207390e+00 1.163373032119124906e+00 1.163548325072042422e+00 1.163723618024959938e+00 1.163898910977877454e+00 1.164074203930794971e+00 1.164249496883712487e+00 1.164424789836630003e+00 1.164600082789547519e+00 1.164775375742465036e+00 1.164950668695382552e+00 1.165125961648300068e+00 1.165301254601217584e+00 1.165476547554135101e+00 1.165651840507052617e+00 1.165827133459970133e+00 1.166002426412887649e+00 1.166177719365805165e+00 1.166353012318722682e+00 1.166528305271640198e+00 1.166703598224557714e+00 1.166878891177475230e+00 1.167054184130392747e+00 1.167229477083310263e+00 1.167404770036227779e+00 1.167580062989145295e+00 1.167755355942062812e+00 1.167930648894980328e+00 1.168105941847897844e+00 1.168281234800815360e+00 1.168456527753732876e+00 1.168631820706650393e+00 1.168807113659567909e+00 1.168982406612485425e+00 1.169157699565402941e+00 1.169332992518320458e+00 1.169508285471237974e+00 1.169683578424155490e+00 1.169858871377073006e+00 1.170034164329990523e+00 1.170209457282908039e+00 1.170384750235825555e+00 1.170560043188743071e+00 1.170735336141660587e+00 1.170910629094578104e+00 1.171085922047495620e+00 1.171261215000413136e+00 1.171436507953330652e+00 1.171611800906248169e+00 1.171787093859165685e+00 1.171962386812083201e+00 1.172137679765000717e+00 1.172312972717918234e+00 1.172488265670835750e+00 1.172663558623753266e+00 1.172838851576670782e+00 1.173014144529588298e+00 1.173189437482505815e+00 1.173364730435423331e+00 1.173540023388340847e+00 1.173715316341258363e+00 1.173890609294175880e+00 1.174065902247093396e+00 1.174241195200010912e+00 1.174416488152928428e+00 1.174591781105845945e+00 1.174767074058763461e+00 1.174942367011680977e+00 1.175117659964598493e+00 1.175292952917516009e+00 1.175468245870433526e+00 1.175643538823351042e+00 1.175818831776268558e+00 1.175994124729186074e+00 1.176169417682103591e+00 1.176344710635021107e+00 1.176520003587938623e+00 1.176695296540856139e+00 1.176870589493773656e+00 1.177045882446691172e+00 1.177221175399608688e+00 1.177396468352526204e+00 1.177571761305443721e+00 1.177747054258361237e+00 1.177922347211278753e+00 1.178097640164196269e+00 1.178272933117113785e+00 1.178448226070031302e+00 1.178623519022948818e+00 1.178798811975866334e+00 1.178974104928783850e+00 1.179149397881701367e+00 1.179324690834618883e+00 1.179499983787536399e+00 1.179675276740453915e+00 1.179850569693371432e+00 1.180025862646288948e+00 1.180201155599206464e+00 1.180376448552123980e+00 1.180551741505041496e+00 1.180727034457959013e+00 1.180902327410876529e+00 1.181077620363794045e+00 1.181252913316711561e+00 1.181428206269629078e+00 1.181603499222546594e+00 1.181778792175464110e+00 1.181954085128381626e+00 1.182129378081299143e+00 1.182304671034216659e+00 1.182479963987134175e+00 1.182655256940051691e+00 1.182830549892969207e+00 1.183005842845886724e+00 1.183181135798804240e+00 1.183356428751721756e+00 1.183531721704639272e+00 1.183707014657556789e+00 1.183882307610474305e+00 1.184057600563391821e+00 1.184232893516309337e+00 1.184408186469226854e+00 1.184583479422144370e+00 1.184758772375061886e+00 1.184934065327979402e+00 1.185109358280896918e+00 1.185284651233814435e+00 1.185459944186731951e+00 1.185635237139649467e+00 1.185810530092566983e+00 1.185985823045484500e+00 1.186161115998402016e+00 1.186336408951319532e+00 1.186511701904237048e+00 1.186686994857154565e+00 1.186862287810072081e+00 1.187037580762989597e+00 1.187212873715907113e+00 1.187388166668824629e+00 1.187563459621742146e+00 1.187738752574659662e+00 1.187914045527577178e+00 1.188089338480494694e+00 1.188264631433412211e+00 1.188439924386329727e+00 1.188615217339247243e+00 1.188790510292164759e+00 1.188965803245082276e+00 1.189141096197999792e+00 1.189316389150917308e+00 1.189491682103834824e+00 1.189666975056752340e+00 1.189842268009669857e+00 1.190017560962587373e+00 1.190192853915504889e+00 1.190368146868422405e+00 1.190543439821339922e+00 1.190718732774257438e+00 1.190894025727174954e+00 1.191069318680092470e+00 1.191244611633009987e+00 1.191419904585927503e+00 1.191595197538845019e+00 1.191770490491762535e+00 1.191945783444680051e+00 1.192121076397597568e+00 1.192296369350515084e+00 1.192471662303432600e+00 1.192646955256350116e+00 1.192822248209267633e+00 1.192997541162185149e+00 1.193172834115102665e+00 1.193348127068020181e+00 1.193523420020937698e+00 1.193698712973855214e+00 1.193874005926772730e+00 1.194049298879690246e+00 1.194224591832607762e+00 1.194399884785525279e+00 1.194575177738442795e+00 1.194750470691360311e+00 1.194925763644277827e+00 1.195101056597195344e+00 1.195276349550112860e+00 1.195451642503030376e+00 1.195626935455947892e+00 1.195802228408865409e+00 1.195977521361782925e+00 1.196152814314700441e+00 1.196328107267617957e+00 1.196503400220535474e+00 1.196678693173452990e+00 1.196853986126370506e+00 1.197029279079288022e+00 1.197204572032205538e+00 1.197379864985123055e+00 1.197555157938040571e+00 1.197730450890958087e+00 1.197905743843875603e+00 1.198081036796793120e+00 1.198256329749710636e+00 1.198431622702628152e+00 1.198606915655545668e+00 1.198782208608463185e+00 1.198957501561380701e+00 1.199132794514298217e+00 1.199308087467215733e+00 1.199483380420133249e+00 1.199658673373050766e+00 1.199833966325968282e+00 1.200009259278885798e+00 1.200184552231803314e+00 1.200359845184720831e+00 1.200535138137638347e+00 1.200710431090555863e+00 1.200885724043473379e+00 1.201061016996390896e+00 1.201236309949308412e+00 1.201411602902225928e+00 1.201586895855143444e+00 1.201762188808060960e+00 1.201937481760978477e+00 1.202112774713895993e+00 1.202288067666813509e+00 1.202463360619731025e+00 1.202638653572648542e+00 1.202813946525566058e+00 1.202989239478483574e+00 1.203164532431401090e+00 1.203339825384318607e+00 1.203515118337236123e+00 1.203690411290153639e+00 1.203865704243071155e+00 1.204040997195988671e+00 1.204216290148906188e+00 1.204391583101823704e+00 1.204566876054741220e+00 1.204742169007658736e+00 1.204917461960576253e+00 1.205092754913493769e+00 1.205268047866411285e+00 1.205443340819328801e+00 1.205618633772246318e+00 1.205793926725163834e+00 1.205969219678081350e+00 1.206144512630998866e+00 1.206319805583916382e+00 1.206495098536833899e+00 1.206670391489751415e+00 1.206845684442668931e+00 1.207020977395586447e+00 1.207196270348503964e+00 1.207371563301421480e+00 1.207546856254338996e+00 1.207722149207256512e+00 1.207897442160174029e+00 1.208072735113091545e+00 1.208248028066009061e+00 1.208423321018926577e+00 1.208598613971844093e+00 1.208773906924761610e+00 1.208949199877679126e+00 1.209124492830596642e+00 1.209299785783514158e+00 1.209475078736431675e+00 1.209650371689349191e+00 1.209825664642266707e+00 1.210000957595184223e+00 1.210176250548101740e+00 1.210351543501019256e+00 1.210526836453936772e+00 1.210702129406854288e+00 1.210877422359771804e+00 1.211052715312689321e+00 1.211228008265606837e+00 1.211403301218524353e+00 1.211578594171441869e+00 1.211753887124359386e+00 1.211929180077276902e+00 1.212104473030194418e+00 1.212279765983111934e+00 1.212455058936029451e+00 1.212630351888946967e+00 1.212805644841864483e+00 1.212980937794781999e+00 1.213156230747699516e+00 1.213331523700617032e+00 1.213506816653534548e+00 1.213682109606452064e+00 1.213857402559369580e+00 1.214032695512287097e+00 1.214207988465204613e+00 1.214383281418122129e+00 1.214558574371039645e+00 1.214733867323957162e+00 1.214909160276874678e+00 1.215084453229792194e+00 1.215259746182709710e+00 1.215435039135627227e+00 1.215610332088544743e+00 1.215785625041462259e+00 1.215960917994379775e+00 1.216136210947297291e+00 1.216311503900214808e+00 1.216486796853132324e+00 1.216662089806049840e+00 1.216837382758967356e+00 1.217012675711884873e+00 1.217187968664802389e+00 1.217363261617719905e+00 1.217538554570637421e+00 1.217713847523554938e+00 1.217889140476472454e+00 1.218064433429389970e+00 1.218239726382307486e+00 1.218415019335225002e+00 1.218590312288142519e+00 1.218765605241060035e+00 1.218940898193977551e+00 1.219116191146895067e+00 1.219291484099812584e+00 1.219466777052730100e+00 1.219642070005647616e+00 1.219817362958565132e+00 1.219992655911482649e+00 1.220167948864400165e+00 1.220343241817317681e+00 1.220518534770235197e+00 1.220693827723152713e+00 1.220869120676070230e+00 1.221044413628987746e+00 1.221219706581905262e+00 1.221394999534822778e+00 1.221570292487740295e+00 1.221745585440657811e+00 1.221920878393575327e+00 1.222096171346492843e+00 1.222271464299410360e+00 1.222446757252327876e+00 1.222622050205245392e+00 1.222797343158162908e+00 1.222972636111080424e+00 1.223147929063997941e+00 1.223323222016915457e+00 1.223498514969832973e+00 1.223673807922750489e+00 1.223849100875668006e+00 1.224024393828585522e+00 1.224199686781503038e+00 1.224374979734420554e+00 1.224550272687338071e+00 1.224725565640255587e+00 1.224900858593173103e+00 1.225076151546090619e+00 1.225251444499008135e+00 1.225426737451925652e+00 1.225602030404843168e+00 1.225777323357760684e+00 1.225952616310678200e+00 1.226127909263595717e+00 1.226303202216513233e+00 1.226478495169430749e+00 1.226653788122348265e+00 1.226829081075265782e+00 1.227004374028183298e+00 1.227179666981100814e+00 1.227354959934018330e+00 1.227530252886935846e+00 1.227705545839853363e+00 1.227880838792770879e+00 1.228056131745688395e+00 1.228231424698605911e+00 1.228406717651523428e+00 1.228582010604440944e+00 1.228757303557358460e+00 1.228932596510275976e+00 1.229107889463193493e+00 1.229283182416111009e+00 1.229458475369028303e+00 1.229633768321945819e+00 1.229809061274863335e+00 1.229984354227780852e+00 1.230159647180698368e+00 1.230334940133615884e+00 1.230510233086533400e+00 1.230685526039450917e+00 1.230860818992368433e+00 1.231036111945285949e+00 1.231211404898203465e+00 1.231386697851120982e+00 1.231561990804038498e+00 1.231737283756956014e+00 1.231912576709873530e+00 1.232087869662791046e+00 1.232263162615708563e+00 1.232438455568626079e+00 1.232613748521543595e+00 1.232789041474461111e+00 1.232964334427378628e+00 1.233139627380296144e+00 1.233314920333213660e+00 1.233490213286131176e+00 1.233665506239048693e+00 1.233840799191966209e+00 1.234016092144883725e+00 1.234191385097801241e+00 1.234366678050718757e+00 1.234541971003636274e+00 1.234717263956553790e+00 1.234892556909471306e+00 1.235067849862388822e+00 1.235243142815306339e+00 1.235418435768223855e+00 1.235593728721141371e+00 1.235769021674058887e+00 1.235944314626976404e+00 1.236119607579893920e+00 1.236294900532811436e+00 1.236470193485728952e+00 1.236645486438646468e+00 1.236820779391563985e+00 1.236996072344481501e+00 1.237171365297399017e+00 1.237346658250316533e+00 1.237521951203234050e+00 1.237697244156151566e+00 1.237872537109069082e+00 1.238047830061986598e+00 1.238223123014904115e+00 1.238398415967821631e+00 1.238573708920739147e+00 1.238749001873656663e+00 1.238924294826574179e+00 1.239099587779491696e+00 1.239274880732409212e+00 1.239450173685326728e+00 1.239625466638244244e+00 1.239800759591161761e+00 1.239976052544079277e+00 1.240151345496996793e+00 1.240326638449914309e+00 1.240501931402831826e+00 1.240677224355749342e+00 1.240852517308666858e+00 1.241027810261584374e+00 1.241203103214501891e+00 1.241378396167419407e+00 1.241553689120336923e+00 1.241728982073254439e+00 1.241904275026171955e+00 1.242079567979089472e+00 1.242254860932006988e+00 1.242430153884924504e+00 1.242605446837842020e+00 1.242780739790759537e+00 1.242956032743677053e+00 1.243131325696594569e+00 1.243306618649512085e+00 1.243481911602429602e+00 1.243657204555347118e+00 1.243832497508264634e+00 1.244007790461182150e+00 1.244183083414099666e+00 1.244358376367017183e+00 1.244533669319934699e+00 1.244708962272852215e+00 1.244884255225769731e+00 1.245059548178687248e+00 1.245234841131604764e+00 1.245410134084522280e+00 1.245585427037439796e+00 1.245760719990357313e+00 1.245936012943274829e+00 1.246111305896192345e+00 1.246286598849109861e+00 1.246461891802027377e+00 1.246637184754944894e+00 1.246812477707862410e+00 1.246987770660779926e+00 1.247163063613697442e+00 1.247338356566614959e+00 1.247513649519532475e+00 1.247688942472449991e+00 1.247864235425367507e+00 1.248039528378285024e+00 1.248214821331202540e+00 1.248390114284120056e+00 1.248565407237037572e+00 1.248740700189955088e+00 1.248915993142872605e+00 1.249091286095790121e+00 1.249266579048707637e+00 1.249441872001625153e+00 1.249617164954542670e+00 1.249792457907460186e+00 1.249967750860377702e+00 1.250143043813295218e+00 1.250318336766212735e+00 1.250493629719130251e+00 1.250668922672047767e+00 1.250844215624965283e+00 1.251019508577882799e+00 1.251194801530800316e+00 1.251370094483717832e+00 1.251545387436635348e+00 1.251720680389552864e+00 1.251895973342470381e+00 1.252071266295387897e+00 1.252246559248305413e+00 1.252421852201222929e+00 1.252597145154140446e+00 1.252772438107057962e+00 1.252947731059975478e+00 1.253123024012892994e+00 1.253298316965810510e+00 1.253473609918728027e+00 1.253648902871645543e+00 1.253824195824563059e+00 1.253999488777480575e+00 1.254174781730398092e+00 1.254350074683315608e+00 1.254525367636233124e+00 1.254700660589150640e+00 1.254875953542068157e+00 1.255051246494985673e+00 1.255226539447903189e+00 1.255401832400820705e+00 1.255577125353738221e+00 1.255752418306655738e+00 1.255927711259573254e+00 1.256103004212490770e+00 1.256278297165408286e+00 1.256453590118325803e+00 1.256628883071243319e+00 1.256804176024160835e+00 1.256979468977078351e+00 1.257154761929995868e+00 1.257330054882913384e+00 1.257505347835830900e+00 1.257680640788748416e+00 1.257855933741665933e+00 1.258031226694583449e+00 1.258206519647500965e+00 1.258381812600418481e+00 1.258557105553335997e+00 1.258732398506253514e+00 1.258907691459171030e+00 1.259082984412088546e+00 1.259258277365006062e+00 1.259433570317923579e+00 1.259608863270841095e+00 1.259784156223758611e+00 1.259959449176676127e+00 1.260134742129593644e+00 1.260310035082511160e+00 1.260485328035428676e+00 1.260660620988346192e+00 1.260835913941263708e+00 1.261011206894181225e+00 1.261186499847098741e+00 1.261361792800016257e+00 1.261537085752933773e+00 1.261712378705851290e+00 1.261887671658768806e+00 1.262062964611686322e+00 1.262238257564603838e+00 1.262413550517521355e+00 1.262588843470438871e+00 1.262764136423356387e+00 1.262939429376273903e+00 1.263114722329191419e+00 1.263290015282108936e+00 1.263465308235026452e+00 1.263640601187943968e+00 1.263815894140861484e+00 1.263991187093779001e+00 1.264166480046696517e+00 1.264341772999614033e+00 1.264517065952531549e+00 1.264692358905449066e+00 1.264867651858366582e+00 1.265042944811284098e+00 1.265218237764201614e+00 1.265393530717119130e+00 1.265568823670036647e+00 1.265744116622954163e+00 1.265919409575871679e+00 1.266094702528789195e+00 1.266269995481706712e+00 1.266445288434624228e+00 1.266620581387541744e+00 1.266795874340459260e+00 1.266971167293376777e+00 1.267146460246294293e+00 1.267321753199211809e+00 1.267497046152129325e+00 1.267672339105046841e+00 1.267847632057964358e+00 1.268022925010881874e+00 1.268198217963799390e+00 1.268373510916716906e+00 1.268548803869634423e+00 1.268724096822551939e+00 1.268899389775469455e+00 1.269074682728386971e+00 1.269249975681304488e+00 1.269425268634222004e+00 1.269600561587139520e+00 1.269775854540057036e+00 1.269951147492974552e+00 1.270126440445892069e+00 1.270301733398809585e+00 1.270477026351727101e+00 1.270652319304644617e+00 1.270827612257562134e+00 1.271002905210479650e+00 1.271178198163397166e+00 1.271353491116314682e+00 1.271528784069232199e+00 1.271704077022149715e+00 1.271879369975067231e+00 1.272054662927984747e+00 1.272229955880902263e+00 1.272405248833819780e+00 1.272580541786737296e+00 1.272755834739654812e+00 1.272931127692572328e+00 1.273106420645489845e+00 1.273281713598407361e+00 1.273457006551324877e+00 1.273632299504242393e+00 1.273807592457159910e+00 1.273982885410077426e+00 1.274158178362994942e+00 1.274333471315912458e+00 1.274508764268829974e+00 1.274684057221747491e+00 1.274859350174665007e+00 1.275034643127582523e+00 1.275209936080500039e+00 1.275385229033417556e+00 1.275560521986335072e+00 1.275735814939252588e+00 1.275911107892170104e+00 1.276086400845087621e+00 1.276261693798005137e+00 1.276436986750922653e+00 1.276612279703840169e+00 1.276787572656757686e+00 1.276962865609675202e+00 1.277138158562592718e+00 1.277313451515510234e+00 1.277488744468427750e+00 1.277664037421345267e+00 1.277839330374262783e+00 1.278014623327180299e+00 1.278189916280097815e+00 1.278365209233015332e+00 1.278540502185932848e+00 1.278715795138850364e+00 1.278891088091767880e+00 1.279066381044685397e+00 1.279241673997602913e+00 1.279416966950520429e+00 1.279592259903437945e+00 1.279767552856355461e+00 1.279942845809272978e+00 1.280118138762190494e+00 1.280293431715108010e+00 1.280468724668025526e+00 1.280644017620943043e+00 1.280819310573860559e+00 1.280994603526778075e+00 1.281169896479695591e+00 1.281345189432613108e+00 1.281520482385530624e+00 1.281695775338448140e+00 1.281871068291365656e+00 1.282046361244283172e+00 1.282221654197200689e+00 1.282396947150118205e+00 1.282572240103035721e+00 1.282747533055953237e+00 1.282922826008870754e+00 1.283098118961788270e+00 1.283273411914705786e+00 1.283448704867623302e+00 1.283623997820540819e+00 1.283799290773458335e+00 1.283974583726375851e+00 1.284149876679293367e+00 1.284325169632210883e+00 1.284500462585128400e+00 1.284675755538045916e+00 1.284851048490963432e+00 1.285026341443880948e+00 1.285201634396798465e+00 1.285376927349715981e+00 1.285552220302633497e+00 1.285727513255551013e+00 1.285902806208468530e+00 1.286078099161386046e+00 1.286253392114303562e+00 1.286428685067221078e+00 1.286603978020138594e+00 1.286779270973056111e+00 1.286954563925973627e+00 1.287129856878891143e+00 1.287305149831808659e+00 1.287480442784726176e+00 1.287655735737643692e+00 1.287831028690561208e+00 1.288006321643478724e+00 1.288181614596396241e+00 1.288356907549313757e+00 1.288532200502231273e+00 1.288707493455148789e+00 1.288882786408066305e+00 1.289058079360983822e+00 1.289233372313901338e+00 1.289408665266818854e+00 1.289583958219736370e+00 1.289759251172653887e+00 1.289934544125571403e+00 1.290109837078488919e+00 1.290285130031406435e+00 1.290460422984323952e+00 1.290635715937241468e+00 1.290811008890158984e+00 1.290986301843076500e+00 1.291161594795994016e+00 1.291336887748911533e+00 1.291512180701829049e+00 1.291687473654746565e+00 1.291862766607664081e+00 1.292038059560581598e+00 1.292213352513499114e+00 1.292388645466416630e+00 1.292563938419334146e+00 1.292739231372251663e+00 1.292914524325169179e+00 1.293089817278086695e+00 1.293265110231004211e+00 1.293440403183921728e+00 1.293615696136839244e+00 1.293790989089756760e+00 1.293966282042674276e+00 1.294141574995591792e+00 1.294316867948509309e+00 1.294492160901426825e+00 1.294667453854344341e+00 1.294842746807261857e+00 1.295018039760179374e+00 1.295193332713096890e+00 1.295368625666014406e+00 1.295543918618931922e+00 1.295719211571849439e+00 1.295894504524766955e+00 1.296069797477684471e+00 1.296245090430601987e+00 1.296420383383519503e+00 1.296595676336437020e+00 1.296770969289354536e+00 1.296946262242272052e+00 1.297121555195189568e+00 1.297296848148107085e+00 1.297472141101024601e+00 1.297647434053942117e+00 1.297822727006859633e+00 1.297998019959777150e+00 1.298173312912694666e+00 1.298348605865612182e+00 1.298523898818529698e+00 1.298699191771447214e+00 1.298874484724364731e+00 1.299049777677282247e+00 1.299225070630199763e+00 1.299400363583117279e+00 1.299575656536034796e+00 1.299750949488952312e+00 1.299926242441869828e+00 1.300101535394787344e+00 1.300276828347704861e+00 1.300452121300622377e+00 1.300627414253539893e+00 1.300802707206457409e+00 1.300978000159374925e+00 1.301153293112292442e+00 1.301328586065209958e+00 1.301503879018127474e+00 1.301679171971044990e+00 1.301854464923962507e+00 1.302029757876880023e+00 1.302205050829797539e+00 1.302380343782715055e+00 1.302555636735632572e+00 1.302730929688550088e+00 1.302906222641467604e+00 1.303081515594385120e+00 1.303256808547302636e+00 1.303432101500220153e+00 1.303607394453137669e+00 1.303782687406055185e+00 1.303957980358972701e+00 1.304133273311890218e+00 1.304308566264807734e+00 1.304483859217725250e+00 1.304659152170642766e+00 1.304834445123560283e+00 1.305009738076477799e+00 1.305185031029395315e+00 1.305360323982312831e+00 1.305535616935230347e+00 1.305710909888147864e+00 1.305886202841065380e+00 1.306061495793982896e+00 1.306236788746900412e+00 1.306412081699817929e+00 1.306587374652735445e+00 1.306762667605652961e+00 1.306937960558570477e+00 1.307113253511487994e+00 1.307288546464405510e+00 1.307463839417323026e+00 1.307639132370240542e+00 1.307814425323158058e+00 1.307989718276075575e+00 1.308165011228993091e+00 1.308340304181910607e+00 1.308515597134828123e+00 1.308690890087745640e+00 1.308866183040663156e+00 1.309041475993580672e+00 1.309216768946498188e+00 1.309392061899415705e+00 1.309567354852333221e+00 1.309742647805250737e+00 1.309917940758168253e+00 1.310093233711085769e+00 1.310268526664003286e+00 1.310443819616920802e+00 1.310619112569838318e+00 1.310794405522755834e+00 1.310969698475673351e+00 1.311144991428590867e+00 1.311320284381508383e+00 1.311495577334425899e+00 1.311670870287343416e+00 1.311846163240260932e+00 1.312021456193178448e+00 1.312196749146095964e+00 1.312372042099013481e+00 1.312547335051930997e+00 1.312722628004848513e+00 1.312897920957766029e+00 1.313073213910683545e+00 1.313248506863601062e+00 1.313423799816518578e+00 1.313599092769436094e+00 1.313774385722353610e+00 1.313949678675271127e+00 1.314124971628188643e+00 1.314300264581106159e+00 1.314475557534023675e+00 1.314650850486941192e+00 1.314826143439858708e+00 1.315001436392776224e+00 1.315176729345693740e+00 1.315352022298611256e+00 1.315527315251528773e+00 1.315702608204446289e+00 1.315877901157363805e+00 1.316053194110281321e+00 1.316228487063198838e+00 1.316403780016116354e+00 1.316579072969033870e+00 1.316754365921951386e+00 1.316929658874868903e+00 1.317104951827786419e+00 1.317280244780703935e+00 1.317455537733621451e+00 1.317630830686538967e+00 1.317806123639456484e+00 1.317981416592374000e+00 1.318156709545291516e+00 1.318332002498209032e+00 1.318507295451126549e+00 1.318682588404044065e+00 1.318857881356961581e+00 1.319033174309879097e+00 1.319208467262796614e+00 1.319383760215714130e+00 1.319559053168631646e+00 1.319734346121549162e+00 1.319909639074466678e+00 1.320084932027384195e+00 1.320260224980301711e+00 1.320435517933219227e+00 1.320610810886136743e+00 1.320786103839054260e+00 1.320961396791971776e+00 1.321136689744889292e+00 1.321311982697806808e+00 1.321487275650724325e+00 1.321662568603641841e+00 1.321837861556559357e+00 1.322013154509476873e+00 1.322188447462394389e+00 1.322363740415311906e+00 1.322539033368229422e+00 1.322714326321146938e+00 1.322889619274064454e+00 1.323064912226981971e+00 1.323240205179899487e+00 1.323415498132817003e+00 1.323590791085734519e+00 1.323766084038652036e+00 1.323941376991569552e+00 1.324116669944487068e+00 1.324291962897404584e+00 1.324467255850322100e+00 1.324642548803239617e+00 1.324817841756157133e+00 1.324993134709074649e+00 1.325168427661992165e+00 1.325343720614909682e+00 1.325519013567827198e+00 1.325694306520744714e+00 1.325869599473662230e+00 1.326044892426579747e+00 1.326220185379497263e+00 1.326395478332414779e+00 1.326570771285332295e+00 1.326746064238249811e+00 1.326921357191167328e+00 1.327096650144084844e+00 1.327271943097002360e+00 1.327447236049919876e+00 1.327622529002837393e+00 1.327797821955754909e+00 1.327973114908672425e+00 1.328148407861589941e+00 1.328323700814507458e+00 1.328498993767424974e+00 1.328674286720342490e+00 1.328849579673260006e+00 1.329024872626177523e+00 1.329200165579095039e+00 1.329375458532012555e+00 1.329550751484930071e+00 1.329726044437847587e+00 1.329901337390765104e+00 1.330076630343682620e+00 1.330251923296600136e+00 1.330427216249517652e+00 1.330602509202435169e+00 1.330777802155352685e+00 1.330953095108270201e+00 1.331128388061187717e+00 1.331303681014105234e+00 1.331478973967022750e+00 1.331654266919940266e+00 1.331829559872857782e+00 1.332004852825775298e+00 1.332180145778692815e+00 1.332355438731610331e+00 1.332530731684527847e+00 1.332706024637445363e+00 1.332881317590362880e+00 1.333056610543280396e+00 1.333231903496197912e+00 1.333407196449115428e+00 1.333582489402032945e+00 1.333757782354950461e+00 1.333933075307867977e+00 1.334108368260785493e+00 1.334283661213703009e+00 1.334458954166620526e+00 1.334634247119538042e+00 1.334809540072455558e+00 1.334984833025373074e+00 1.335160125978290591e+00 1.335335418931208107e+00 1.335510711884125623e+00 1.335686004837043139e+00 1.335861297789960656e+00 1.336036590742878172e+00 1.336211883695795688e+00 1.336387176648713204e+00 1.336562469601630720e+00 1.336737762554548237e+00 1.336913055507465753e+00 1.337088348460383269e+00 1.337263641413300785e+00 1.337438934366218302e+00 1.337614227319135818e+00 1.337789520272053334e+00 1.337964813224970850e+00 1.338140106177888367e+00 1.338315399130805883e+00 1.338490692083723399e+00 1.338665985036640915e+00 1.338841277989558431e+00 1.339016570942475948e+00 1.339191863895393464e+00 1.339367156848310980e+00 1.339542449801228496e+00 1.339717742754146013e+00 1.339893035707063529e+00 1.340068328659981045e+00 1.340243621612898561e+00 1.340418914565816078e+00 1.340594207518733594e+00 1.340769500471651110e+00 1.340944793424568626e+00 1.341120086377486142e+00 1.341295379330403659e+00 1.341470672283321175e+00 1.341645965236238691e+00 1.341821258189156207e+00 1.341996551142073724e+00 1.342171844094991240e+00 1.342347137047908756e+00 1.342522430000826272e+00 1.342697722953743789e+00 1.342873015906661305e+00 1.343048308859578821e+00 1.343223601812496337e+00 1.343398894765413853e+00 1.343574187718331370e+00 1.343749480671248886e+00 1.343924773624166402e+00 1.344100066577083918e+00 1.344275359530001435e+00 1.344450652482918951e+00 1.344625945435836467e+00 1.344801238388753983e+00 1.344976531341671500e+00 1.345151824294589016e+00 1.345327117247506532e+00 1.345502410200424048e+00 1.345677703153341565e+00 1.345852996106259081e+00 1.346028289059176597e+00 1.346203582012094113e+00 1.346378874965011629e+00 1.346554167917929146e+00 1.346729460870846662e+00 1.346904753823764178e+00 1.347080046776681694e+00 1.347255339729599211e+00 1.347430632682516727e+00 1.347605925635434243e+00 1.347781218588351759e+00 1.347956511541269276e+00 1.348131804494186792e+00 1.348307097447104308e+00 1.348482390400021824e+00 1.348657683352939340e+00 1.348832976305856857e+00 1.349008269258774373e+00 1.349183562211691889e+00 1.349358855164609405e+00 1.349534148117526922e+00 1.349709441070444438e+00 1.349884734023361954e+00 1.350060026976279470e+00 1.350235319929196987e+00 1.350410612882114503e+00 1.350585905835032019e+00 1.350761198787949535e+00 1.350936491740867051e+00 1.351111784693784568e+00 1.351287077646702084e+00 1.351462370599619600e+00 1.351637663552537116e+00 1.351812956505454633e+00 1.351988249458372149e+00 1.352163542411289665e+00 1.352338835364207181e+00 1.352514128317124698e+00 1.352689421270042214e+00 1.352864714222959730e+00 1.353040007175877246e+00 1.353215300128794762e+00 1.353390593081712279e+00 1.353565886034629795e+00 1.353741178987547311e+00 1.353916471940464827e+00 1.354091764893382344e+00 1.354267057846299860e+00 1.354442350799217376e+00 1.354617643752134892e+00 1.354792936705052409e+00 1.354968229657969925e+00 1.355143522610887441e+00 1.355318815563804957e+00 1.355494108516722473e+00 1.355669401469639990e+00 1.355844694422557506e+00 1.356019987375475022e+00 1.356195280328392538e+00 1.356370573281310055e+00 1.356545866234227571e+00 1.356721159187145087e+00 1.356896452140062603e+00 1.357071745092980120e+00 1.357247038045897636e+00 1.357422330998815152e+00 1.357597623951732668e+00 1.357772916904650184e+00 1.357948209857567701e+00 1.358123502810485217e+00 1.358298795763402733e+00 1.358474088716320249e+00 1.358649381669237766e+00 1.358824674622155282e+00
0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 -3.262660205364227295e-01 -9.548651427030563354e-02 -1.196765899658203125e-02 -4.704985022544860840e-02 -1.084022037684917450e-02 -3.114815428853034973e-02 4.339638724923133850e-02 4.434432834386825562e-03 1.430191844701766968e-02 6.297444552183151245e-02 1.725374907255172729e-02 5.398636683821678162e-03 -2.276854030787944794e-02 2.663609758019447327e-02 2.827532216906547546e-02 1.055933721363544464e-02 1.358779799193143845e-02 -1.414506696164608002e-02 2.563362568616867065e-02 -3.942670300602912903e-02 -3.696728870272636414e-02 4.185587912797927856e-02 1.992157474160194397e-02 -8.580147475004196167e-02 2.012974396347999573e-02 6.519420444965362549e-02 3.858647122979164124e-02 4.896323382854461670e-02 -2.999962307512760162e-04 -5.685858428478240967e-03 1.833704486489295959e-02 4.971750080585479736e-02 1.221981421113014221e-01 9.299759566783905029e-02 -1.974016614258289337e-02 -2.643720433115959167e-02 2.021844685077667236e-02 8.635331690311431885e-02 1.774228736758232117e-02 -1.583334989845752716e-03 1.525458879768848419e-03 7.744703441858291626e-03 1.581137627363204956e-02 2.634599059820175171e-02 9.212154150009155273e-02 4.844800755381584167e-02 -4.294511303305625916e-02 3.283190727233886719e-02 4.990606009960174561e-02 5.209930241107940674e-02 -2.783106639981269836e-02 5.328173190355300903e-02 4.699863120913505554e-02 1.939550787210464478e-02 -5.499488860368728638e-02 1.529990509152412415e-02 -1.517640054225921631e-02 -1.088473945856094360e-02 2.878255024552345276e-02 -5.802213400602340698e-02 4.467773064970970154e-02 3.300739452242851257e-02 1.189504843205213547e-02 2.669482678174972534e-02 3.801729530096054077e-02 1.436842232942581177e-02 5.706787854433059692e-02 -1.546694431453943253e-02 1.761169172823429108e-03 -2.268198877573013306e-02 6.424819584935903549e-03 2.093656361103057861e-02 -6.159517914056777954e-03 5.678497254848480225e-02 1.431703288108110428e-02 -4.395159333944320679e-02 -1.801505312323570251e-02 1.528014615178108215e-02 2.803304418921470642e-02 3.318936005234718323e-02 3.236373513936996460e-02 -6.840049475431442261e-02 -6.451471149921417236e-02 -4.542803391814231873e-03 -1.384951826184988022e-02 -4.786432720720767975e-03 -5.429887212812900543e-03 -1.260759867727756500e-02 3.828912228345870972e-02 4.993832483887672424e-02 9.132734499871730804e-03 2.333934977650642395e-02 1.070372574031352997e-02 3.769061993807554245e-03 8.183617144823074341e-03 2.588235028088092804e-02 7.894597202539443970e-02 4.161505401134490967e-02 -1.129166632890701294e-01 2.758340351283550262e-02 4.758244380354881287e-03 1.332999765872955322e-02 2.321311086416244507e-02 9.507238119840621948e-02 5.068144202232360840e-02 -5.390298739075660706e-02 1.760341692715883255e-03 -2.290362492203712463e-03 4.313169419765472412e-02 4.271855577826499939e-02 1.017224602401256561e-02 1.766713336110115051e-02 -5.457723140716552734e-02 -1.390760205686092377e-02 2.607293426990509033e-03 5.647762119770050049e-02 7.409014739096164703e-03 3.074241429567337036e-02 8.194643259048461914e-02 -5.233389139175415039e-02 -5.303094163537025452e-03 -3.040914051234722137e-02 -7.848890125751495361e-02 -3.513712808489799500e-02 -5.850498378276824951e-02 -4.143683612346649170e-02 4.790956526994705200e-02 1.157189253717660904e-02 4.665906541049480438e-03 6.168954074382781982e-02 -3.920684382319450378e-02 -2.414987795054912567e-02 6.281308084726333618e-02 7.095234096050262451e-02 -3.864514455199241638e-02 4.407343640923500061e-02 7.298796623945236206e-02 4.632940143346786499e-02 1.471496000885963440e-02 -4.568073153495788574e-02 1.967412605881690979e-02 5.310813337564468384e-02 3.446950390934944153e-02 1.856810227036476135e-02 3.637596964836120605e-04 6.137356907129287720e-02 3.665257990360260010e-02 6.083559244871139526e-03 -9.300898015499114990e-02 -2.546878531575202942e-02 4.085212573409080505e-02 -1.046529971063137054e-03 2.241892740130424500e-02 -4.389844089746475220e-02 5.530557408928871155e-02 -2.064491249620914459e-02 2.048500068485736847e-02 -6.952126510441303253e-03 -3.278642147779464722e-02 3.775510564446449280e-02 -3.323206678032875061e-03 6.096102297306060791e-04 2.743955701589584351e-03 -4.389552399516105652e-02 4.859047383069992065e-02 5.925404280424118042e-02 1.579891145229339600e-02 -1.078034564852714539e-02 -1.123129762709140778e-02 2.615590766072273254e-02 3.863463178277015686e-02 1.112935785204172134e-02 -8.918413519859313965e-02 -4.660163074731826782e-02 1.536254882812500000e-01 4.739401116967201233e-02 -6.308379769325256348e-02 -2.153543569147586823e-02 -5.294649302959442139e-02 4.309090785682201385e-03 4.313973337411880493e-02 5.720897577702999115e-03 2.467733994126319885e-02 -7.265497744083404541e-02 -4.643856734037399292e-02 -4.452001303434371948e-05 -1.203607395291328430e-02 3.421725705265998840e-04 -6.958512961864471436e-02 -1.789601519703865051e-02 -3.372584283351898193e-02 2.534764632582664490e-02 1.136442124843597412e-01 -5.561415851116180420e-02 8.959254249930381775e-03 -5.222121253609657288e-02 -1.003713160753250122e-02 1.820106431841850281e-02 -2.174152806401252747e-02 -1.390241645276546478e-02 5.780634656548500061e-02 -6.260789930820465088e-02 3.124530613422393799e-02 1.144692823290824890e-01 8.827161043882369995e-03 8.748375810682773590e-03 1.869994774460792542e-02 -3.216246515512466431e-02 1.045455411076545715e-02 -2.091796323657035828e-02 -9.663623571395874023e-02 -8.821426331996917725e-02 -1.515512727200984955e-02 -1.743796654045581818e-02 1.580934040248394012e-02 1.065413653850555420e-02 -1.316790096461772919e-02 3.265173360705375671e-02 -7.460527122020721436e-04 7.546211779117584229e-02 1.758798211812973022e-02 -1.324063539505004883e-02 4.782409407198429108e-03 2.842077799141407013e-02 -1.584467664361000061e-02 -1.771669834852218628e-03 -8.154597878456115723e-02 2.754237502813339233e-04 -1.263649854809045792e-02 4.357339069247245789e-02 1.638786122202873230e-02 -6.163196265697479248e-02 -8.113311603665351868e-03 2.503296174108982086e-02 -1.153791844844818115e-01 -9.194342792034149170e-02 1.196477934718132019e-02 4.240589588880538940e-02 2.572348341345787048e-02 7.618657499551773071e-02 -5.603348836302757263e-02 6.403201818466186523e-02 -1.217048428952693939e-02 -6.842214614152908325e-03 -6.766837090253829956e-03 -4.981577768921852112e-02 3.408054262399673462e-02 2.645304426550865173e-02 1.686089858412742615e-02 5.876908078789710999e-03 -2.538780309259891510e-02 -3.309181332588195801e-02 -3.047875314950942993e-02 -1.776641421020030975e-02 -1.006783545017242432e-02 7.140303403139114380e-02 4.074513912200927734e-02 4.790127277374267578e-04 -3.053349815309047699e-02 -1.328205596655607224e-02 -1.339364796876907349e-02 -8.629345893859863281e-02 -8.185555040836334229e-02 -2.892614528536796570e-02 4.947065934538841248e-02 -7.018376141786575317e-03 6.577430665493011475e-02 3.605193272233009338e-02 8.213339745998382568e-02 5.245543271303176880e-02 1.041735429316759109e-02 -5.458039045333862305e-02 2.414351888000965118e-02 -9.915785863995552063e-03 4.651671275496482849e-03 7.137029431760311127e-03 -6.159686483442783356e-03 4.579836875200271606e-02 5.103757977485656738e-02 2.806352265179157257e-02 2.458191290497779846e-02 -3.095334954559803009e-02 -1.944317296147346497e-02 5.125761032104492188e-02 -1.068337541073560715e-02 -3.153739869594573975e-02 1.900732144713401794e-02 5.741589237004518509e-03 1.284998934715986252e-02 7.560338079929351807e-02 4.647517949342727661e-02 2.662470750510692596e-02 -1.071571931242942810e-02 -1.735826954245567322e-02 1.219984889030456543e-02 -1.194125935435295105e-01 -8.765730075538158417e-03 7.721323519945144653e-03 -4.194568842649459839e-02 -2.820277586579322815e-05 -1.705984771251678467e-02 -3.883108124136924744e-02 -7.586190477013587952e-03 -1.281024143099784851e-02 -1.355835143476724625e-02 -2.868660166859626770e-02 4.560255259275436401e-02 -9.727966040372848511e-03 -5.392710119485855103e-02 4.292393568903207779e-03 -3.007706627249717712e-02 -6.991355121135711670e-02 -4.509659856557846069e-02 -1.792291551828384399e-02 -7.780309021472930908e-02 -7.393917068839073181e-03 2.456624992191791534e-02 -4.870087653398513794e-02 -1.557577401399612427e-02 -1.293494272977113724e-02 -8.345137350261211395e-03 -5.334193818271160126e-03 -3.147719427943229675e-02 -4.286605864763259888e-02 -6.354628503322601318e-02 -3.065946698188781738e-02 -2.410110086202621460e-03 4.268510639667510986e-02 -6.239475682377815247e-03 -7.600253913551568985e-03 -5.308838561177253723e-03 5.710185691714286804e-02 6.418111920356750488e-02 -3.860581666231155396e-03 -1.555512286722660065e-02 3.442586958408355713e-02 1.061590574681758881e-02 -7.550409063696861267e-04 3.720178455114364624e-02 -1.432515960186719894e-02 -3.131055831909179688e-02 -8.409859985113143921e-02 -3.121772781014442444e-02 6.267706304788589478e-02 4.595099762082099915e-02 2.579513750970363617e-02 3.644801676273345947e-02 -4.449919611215591431e-02 -7.324273884296417236e-02 -6.368743628263473511e-02 -1.441404670476913452e-01 -1.238901726901531219e-02 -3.565970808267593384e-03 -1.961897127330303192e-02 3.657000511884689331e-02 -4.510211758315563202e-03 2.280305325984954834e-02 -1.694207638502120972e-02 -3.357918933033943176e-02 -5.533219873905181885e-02 -2.998529374599456787e-02 -2.516175620257854462e-02 -5.222103372216224670e-02 -4.068614542484283447e-02 -4.393713548779487610e-03 2.195725962519645691e-02 -8.203285746276378632e-03 -3.971654176712036133e-02 -1.865662634372711182e-03 -6.109625101089477539e-02 -5.797624588012695312e-03 1.765786670148372650e-02 1.630318909883499146e-02 -1.309823989868164062e-01 -5.284535884857177734e-02 7.725156843662261963e-02 4.022140800952911377e-02 -1.996343210339546204e-02 -7.796126417815685272e-03 -9.194781072437763214e-03 -1.512254495173692703e-02 -2.766998298466205597e-02 -5.229005217552185059e-02 -3.776042163372039795e-02 3.299759700894355774e-04 -4.122542962431907654e-02 -9.996425360441207886e-04 2.435979247093200684e-02 -5.021258257329463959e-03 2.033185586333274841e-02 3.142726421356201172e-02 -1.855798251926898956e-02 3.574857115745544434e-02 1.521824579685926437e-02 1.200132444500923157e-02 3.828198462724685669e-02 1.503693126142024994e-02 1.513891853392124176e-02 -1.921389624476432800e-02 -3.985217213630676270e-02 -1.137656159698963165e-02 -8.450768887996673584e-03 2.678773738443851471e-02 5.065390840172767639e-03 2.464294899255037308e-03 -2.486662752926349640e-02 -4.345061630010604858e-02 -5.488754808902740479e-02 -9.163460135459899902e-02 -6.053183972835540771e-02 -7.911783456802368164e-02 5.007030814886093140e-02 -4.457908868789672852e-02 5.812714807689189911e-03 1.218873858451843262e-01 9.170733392238616943e-05 -7.623130083084106445e-02 3.933541942387819290e-03 4.238756000995635986e-02 2.653751522302627563e-03 3.115293383598327637e-02 -6.681258976459503174e-02 -1.607187092304229736e-03 1.057321485131978989e-02 7.742996513843536377e-02 2.493849396705627441e-02 -4.767706245183944702e-02 -3.537383303046226501e-02 6.702969968318939209e-02 4.544325172901153564e-02 3.711665049195289612e-02 -6.873092800378799438e-02 -1.467852853238582611e-02 7.718764245510101318e-02 6.686551496386528015e-04 6.213276833295822144e-02 6.019284203648567200e-02 -5.382862687110900879e-02 7.393890619277954102e-02 1.085976138710975647e-02 2.334767207503318787e-02 -2.733401954174041748e-02 -4.373157396912574768e-02 1.434462144970893860e-02 -3.954690694808959961e-02 6.242001801729202271e-02 6.204074621200561523e-02 4.308725893497467041e-02 -5.776833370327949524e-02 4.122413694858551025e-02 -2.900114655494689941e-02 -8.822945877909660339e-03 -3.937658667564392090e-02 -3.041195683181285858e-02 -5.449576675891876221e-02 -4.460883140563964844e-02 -3.691527247428894043e-02 2.897060289978981018e-02 2.307478711009025574e-02 -4.625889658927917480e-02 1.755066365003585815e-01 8.102796226739883423e-02 9.999699890613555908e-02 -6.261725723743438721e-02 -1.570498198270797729e-02 -8.341879397630691528e-02 -2.146285027265548706e-03 -1.701549813151359558e-02 3.637015819549560547e-02 -3.611552342772483826e-02 -1.956448657438158989e-03 -2.787723764777183533e-02 -1.892369240522384644e-02 -2.763699926435947418e-02 -5.062992870807647705e-02 6.870185583829879761e-02 -2.827017195522785187e-02 -1.103275194764137268e-01 -4.573908075690269470e-02 -4.492663219571113586e-02 3.319149464368820190e-02 2.598551288247108459e-02 -1.137855183333158493e-02 -1.912095397710800171e-02 -4.574908688664436340e-02 -9.184165857732295990e-03 4.088666290044784546e-02 -9.372452273964881897e-03 5.277495831251144409e-03 2.206857353448867798e-01 1.433382779359817505e-01 1.613945811986923218e-01 2.738902717828750610e-02 -5.003781616687774658e-02 -4.135204479098320007e-02 3.075759857892990112e-03 -4.425424337387084961e-02 -1.775608211755752563e-02 3.469007089734077454e-03 1.813867688179016113e-02 4.899483174085617065e-04 1.811040192842483521e-02 -1.129812933504581451e-02 2.298462763428688049e-02 2.469767816364765167e-03 -5.022352561354637146e-03 -2.669125795364379883e-02 5.702262744307518005e-02 -4.334546625614166260e-03 -5.124051123857498169e-02 -3.931721672415733337e-02 1.939278282225131989e-02 9.629930369555950165e-03 -3.989621624350547791e-02 1.839513331651687622e-02 -8.848964236676692963e-03 1.501295343041419983e-02 3.004766255617141724e-02 -8.434941060841083527e-03 -3.989071585237979889e-03 6.766834855079650879e-02 1.978665888309478760e-01 1.420884393155574799e-02 -3.930493444204330444e-02 -4.972249642014503479e-02 4.440099373459815979e-02 -2.118993736803531647e-02 3.147348389029502869e-02 -4.721708595752716064e-03 -1.831984706223011017e-02 1.782410964369773865e-02 -2.508113905787467957e-02 -2.436060272157192230e-02 4.487038403749465942e-02 -1.377826370298862457e-02 -5.892547219991683960e-02 -6.150731444358825684e-02 1.114061940461397171e-02 -3.086137771606445312e-02 4.413976147770881653e-02 -7.231824100017547607e-03 4.778602160513401031e-03 6.943110376596450806e-02 -7.734454702585935593e-04 5.177284032106399536e-02 2.910214103758335114e-02 1.168888993561267853e-02 1.689033582806587219e-02 -2.525516785681247711e-02 -2.470764145255088806e-02 -7.317297160625457764e-02 -4.377876222133636475e-02 -1.199878379702568054e-02 1.485387235879898071e-02 4.907310754060745239e-02 8.108838647603988647e-02 7.222279906272888184e-03 -4.003657028079032898e-02 -4.227140173316001892e-02 -3.236580640077590942e-02 4.846543818712234497e-02 -2.581863105297088623e-02 -7.091456651687622070e-02 -2.704088389873504639e-02 2.332324534654617310e-02 5.325395613908767700e-03 -2.236854285001754761e-02 -6.395481526851654053e-02 -1.499783247709274292e-04 -1.359753496944904327e-02 -1.869999431073665619e-02 1.600949652493000031e-02 -2.196701616048812866e-02 -1.048061437904834747e-02 2.985335327684879303e-02 1.390291377902030945e-03 -3.577046841382980347e-02 -2.758373878896236420e-02 -2.409970574080944061e-02 -5.259582772850990295e-03 -6.268130615353584290e-03 2.252421155571937561e-02 -4.475066810846328735e-02 -8.527137339115142822e-02 -9.326292574405670166e-02 2.398987486958503723e-02 1.066193543374538422e-02 3.334913402795791626e-02 1.861614361405372620e-02 4.884040355682373047e-02 4.451365023851394653e-02 1.197092514485120773e-02 4.693840071558952332e-02 4.550049081444740295e-02 5.661660805344581604e-02 3.478250652551651001e-02 -6.362767890095710754e-04 3.979866206645965576e-02 1.873525790870189667e-02 4.404554888606071472e-02 1.581671461462974548e-02 -3.467302024364471436e-02 -3.671136870980262756e-02 2.913706004619598389e-02 -5.968448519706726074e-02 -1.076887734234333038e-02 2.696420997381210327e-03 -2.937325276434421539e-02 -8.172763511538505554e-03 -1.984944567084312439e-03 -6.204803474247455597e-03 9.127752855420112610e-04 -6.798034906387329102e-02 -3.163537755608558655e-02 1.469572819769382477e-02 2.375543117523193359e-02 -3.182364627718925476e-02 -2.859787270426750183e-02 -1.434230245649814606e-02 -3.471787646412849426e-02 6.794407963752746582e-03 7.329219579696655273e-02 -1.272779144346714020e-02 8.977219462394714355e-03 -8.833006024360656738e-03 -7.057837396860122681e-02 1.220433786511421204e-02 6.332623958587646484e-02 6.254252046346664429e-03 2.327424660325050354e-02 -2.780093438923358917e-02 1.163914427161216736e-02 1.909946836531162262e-02 -4.267366230487823486e-02 2.607082203030586243e-02 -2.197200059890747070e-02 -7.529408205300569534e-03 -5.404498800635337830e-02 -3.265317529439926147e-02 7.088695466518402100e-02 -1.367698609828948975e-01 1.691772788763046265e-02 -3.938712179660797119e-02 3.217453882098197937e-02 5.407945439219474792e-02 -1.086235418915748596e-02 -9.465384483337402344e-02 8.235236629843711853e-03 -4.735986236482858658e-03 -5.352310836315155029e-02 -1.837940514087677002e-02 -5.577791482210159302e-03 -1.800955459475517273e-02 -6.586503237485885620e-02 -4.806473106145858765e-02 -4.617536440491676331e-02 -1.428159698843955994e-02 -3.933653235435485840e-02 -4.292440414428710938e-02 4.061306267976760864e-02 9.817752987146377563e-03 -2.984168194234371185e-02 2.094441093504428864e-02 -1.898648217320442200e-03 1.892452128231525421e-02 3.837433829903602600e-02 -5.939898546785116196e-03 6.306517124176025391e-02 6.238802522420883179e-02 1.983197964727878571e-02 3.884783387184143066e-02 5.046148598194122314e-02 -7.824931293725967407e-02 -2.547158673405647278e-02 -6.522992998361587524e-02 1.749441772699356079e-01 8.998820930719375610e-02 1.783393695950508118e-02 -6.219428405165672302e-02 3.457874804735183716e-02 -6.768673658370971680e-03 -1.298667490482330322e-02 -1.248233020305633545e-01 -3.091108240187168121e-02 2.874647639691829681e-02 -3.521244227886199951e-02 -1.383580546826124191e-02 6.710924208164215088e-03 8.415795862674713135e-02 -2.498467825353145599e-02 -1.381285116076469421e-02 1.458937376737594604e-01 5.734916403889656067e-02 -8.419651538133621216e-02 -1.393117848783731461e-02 -3.238860517740249634e-02 -1.183036249130964279e-03 2.040280215442180634e-02 1.128469035029411316e-02 -1.541042141616344452e-02 3.810813650488853455e-02 -2.077980153262615204e-02 -1.445158943533897400e-02 -3.724854066967964172e-02 -4.196582362055778503e-02 -1.083444133400917053e-01 -4.758816584944725037e-02 1.893410272896289825e-02 -6.050897017121315002e-02 -3.403293341398239136e-02 -1.647522300481796265e-02 7.902495563030242920e-03 -2.966259047389030457e-02 -4.235777258872985840e-02 -1.453797426074743271e-02 -1.873375847935676575e-02 -4.664386436343193054e-02 -9.884622879326343536e-03 -5.107683688402175903e-02 -9.414993226528167725e-03 -1.297005359083414078e-02 -1.380515657365322113e-02 -8.677271194756031036e-03 -8.219733834266662598e-03 7.870345376431941986e-03 4.657489061355590820e-02 3.098713606595993042e-02 -2.933944761753082275e-02 -3.459493070840835571e-02 -3.557313932105898857e-03 -1.940310373902320862e-02 -3.997635468840599060e-02 9.074877947568893433e-03 2.598555944859981537e-02 3.906325902789831161e-03 4.066497087478637695e-02 1.004015747457742691e-02 -3.373606130480766296e-02 4.242597147822380066e-03 -2.937799319624900818e-02 -4.851417616009712219e-03 -4.046699032187461853e-02 2.696444466710090637e-02 -1.837537810206413269e-02 4.517304711043834686e-03 2.235775068402290344e-02 1.846790499985218048e-02 -2.411076985299587250e-02 -3.638245165348052979e-02 -1.854898966848850250e-02 -3.218746185302734375e-02 3.619718365371227264e-03 1.779995858669281006e-02 8.600747585296630859e-02 1.863952353596687317e-02 -4.213798046112060547e-02 -5.644915997982025146e-02 1.286340598016977310e-02 9.465503692626953125e-02 -1.665850728750228882e-02 -1.365151852369308472e-01 -6.483430415391921997e-02 -9.521561861038208008e-02 -4.812045395374298096e-02 5.476819723844528198e-02 8.668687194585800171e-03 2.183826267719268799e-02 -1.518620643764734268e-02 -2.375079318881034851e-02 -5.290724337100982666e-02 -1.656119711697101593e-02 -4.180664569139480591e-02 1.308707427233457565e-02 5.404815077781677246e-02 1.768126524984836578e-02 -1.239237468689680099e-02 2.655032835900783539e-02 -9.413642808794975281e-03 3.123761154711246490e-02 6.564924027770757675e-03 6.796361878514289856e-03 -5.426594614982604980e-02 -6.001014634966850281e-02 -1.071485783904790878e-02 -4.256044328212738037e-02 4.093104973435401917e-03 -1.368190441280603409e-02 -3.767913207411766052e-02 5.928170867264270782e-03 4.599417001008987427e-02 6.280297040939331055e-02 5.148629099130630493e-02 -1.824883371591567993e-02 -2.151121199131011963e-02 -4.572925716638565063e-02 -1.726319640874862671e-02 -6.206153333187103271e-02 6.197485700249671936e-02 -2.813621237874031067e-02 -3.170480951666831970e-02 -1.034293323755264282e-03 -5.845943093299865723e-02 -2.422199770808219910e-02 1.879354752600193024e-02 -5.591274797916412354e-02 -1.330320239067077637e-01 -4.060177877545356750e-02 2.586021460592746735e-02 -2.726626023650169373e-02 -1.789063215255737305e-02 1.266580671072006226e-01 -7.714828848838806152e-02 5.489425361156463623e-02 -1.113919634371995926e-02 2.788150869309902191e-02 5.772677436470985413e-02 6.197214126586914062e-02 -1.876361668109893799e-02 3.727497160434722900e-02 8.383011445403099060e-03 -1.147176604717969894e-02 8.015837520360946655e-04 2.832277864217758179e-02 7.394207268953323364e-02 1.328704599291086197e-02 -1.983957365155220032e-03 1.428672485053539276e-02 6.021551415324211121e-02 5.103737115859985352e-02 1.102803740650415421e-02 2.623289823532104492e-03 4.027721658349037170e-02 2.075234800577163696e-02 9.754354134202003479e-03 5.439650267362594604e-03 2.659966051578521729e-02 6.545509397983551025e-02 2.265052124857902527e-02 2.433326840400695801e-02 -4.292541742324829102e-02 -1.480120569467544556e-01 -1.520444303750991821e-01 1.456295326352119446e-02 4.403807967901229858e-02 -3.908860683441162109e-02 -5.742080509662628174e-02 3.028183430433273315e-02 -2.938366308808326721e-02 4.058835096657276154e-03 1.286727655678987503e-02 5.580396205186843872e-02 -5.197423696517944336e-02 9.247684851288795471e-03 1.561297625303268433e-01 9.188532084226608276e-02 8.411152660846710205e-02 9.244736284017562866e-02 1.224053502082824707e-01 5.562790483236312866e-02 -3.095718473196029663e-02 6.056616827845573425e-02 -1.014494523406028748e-02 -1.138640344142913818e-01 -1.860310696065425873e-02 6.289465725421905518e-02 4.684486240148544312e-02 -1.761596649885177612e-05 5.473976209759712219e-02 5.296950414776802063e-02 7.710891962051391602e-02 3.264525532722473145e-02 4.879687912762165070e-03 6.134080886840820312e-02 -1.084208637475967407e-01 -9.894859790802001953e-02 -1.981860250234603882e-01 -6.271293014287948608e-02 -2.390430122613906860e-02 -2.165980078279972076e-02 3.692107275128364563e-04 3.149694949388504028e-02 5.011447519063949585e-02 -2.113630995154380798e-02 3.725218027830123901e-02 -1.599038392305374146e-02 2.208838425576686859e-02 -2.646311186254024506e-04 -1.533766277134418488e-03 2.850586175918579102e-02 -7.960938662290573120e-02 2.910122461616992950e-02 2.236740849912166595e-02 -6.407245993614196777e-02 -9.065493941307067871e-02 -2.193554118275642395e-02 -1.253532245755195618e-03 -2.165775280445814133e-03 2.387741953134536743e-02 1.228731870651245117e-02 -2.246553078293800354e-02 -2.781066671013832092e-02 -1.226681321859359741e-01 3.723768517374992371e-03 2.020637691020965576e-02 -1.668423414230346680e-02 -5.460039153695106506e-02 3.153082448989152908e-03 2.373248711228370667e-02 1.152507960796356201e-02 -5.989459156990051270e-02 -2.254429459571838379e-02 -2.988737076520919800e-03 8.323785662651062012e-02 -6.469627469778060913e-02 -2.238243445754051208e-02 -6.294537335634231567e-03 -3.885622695088386536e-02 8.740530908107757568e-02 -2.363708429038524628e-02 2.844165544956922531e-03 1.526041887700557709e-03 -1.763304695487022400e-03 -5.590468645095825195e-04 -4.724249243736267090e-02 1.234657503664493561e-02 -3.207639604806900024e-02 1.737391948699951172e-02 4.933830723166465759e-02 4.453156515955924988e-02 -3.848002105951309204e-02 -1.856757141649723053e-02 2.141521871089935303e-02 6.783637404441833496e-02 2.841905131936073303e-02 -4.612356051802635193e-02 2.702824398875236511e-02 3.935144096612930298e-02 4.525255411863327026e-02 8.746519684791564941e-03 -1.599237695336341858e-02 2.689979039132595062e-02 -1.504945661872625351e-02 8.175360038876533508e-03 4.024489223957061768e-02 -1.327559500932693481e-01 5.270897969603538513e-02 -8.390886709094047546e-03 -3.155437856912612915e-02 -1.119918376207351685e-02 4.589123651385307312e-02 -3.104606643319129944e-02 -1.692220382392406464e-02 -6.306840479373931885e-02 1.261016726493835449e-02 -2.814948558807373047e-02 2.121558040380477905e-02 2.488523535430431366e-02 1.050852332264184952e-02 1.439996995031833649e-02 -6.967964023351669312e-02 -5.534305237233638763e-03 -1.950455456972122192e-02 4.013026878237724304e-02 6.383117288351058960e-03 -1.536118239164352417e-02 3.820547461509704590e-02 -9.584171697497367859e-03 2.572442218661308289e-02 -4.046699404716491699e-02 -6.100447475910186768e-02 -7.995437830686569214e-03 -5.438961833715438843e-02 -7.368928287178277969e-03 6.550876796245574951e-02 2.647614665329456329e-02 1.172489766031503677e-02 4.682464525103569031e-02 2.731181681156158447e-02 1.167889125645160675e-02 -3.448117524385452271e-03 -1.354103349149227142e-02 5.878142081201076508e-03 -1.567482948303222656e-02 2.592988498508930206e-02 1.281330129131674767e-03 4.638119786977767944e-02 1.128860265016555786e-01 1.190012171864509583e-01 1.250190436840057373e-01 1.763032078742980957e-01 1.159883439540863037e-01 5.230284761637449265e-03 3.024296835064888000e-02 4.904679208993911743e-02 3.218121081590652466e-02 4.608558863401412964e-02 2.837309148162603378e-03 -2.822056971490383148e-02 -5.478858947753906250e-04 3.400054201483726501e-02 4.001886025071144104e-02 -2.710508368909358978e-02 6.798833608627319336e-03 -2.053156495094299316e-02 -1.289671752601861954e-02 4.915536940097808838e-02 -2.303506061434745789e-02 -8.304152637720108032e-03 -1.430751755833625793e-03 -6.098657380789518356e-03 2.586223557591438293e-02 1.436527259647846222e-02 -5.467045307159423828e-02 -2.965041622519493103e-02 -1.781388185918331146e-03 -5.784563720226287842e-02 -1.372555643320083618e-02 7.880506664514541626e-02 2.816653251647949219e-02 -2.650554664433002472e-02 -2.249343693256378174e-02 2.613014355301856995e-02 -4.113155975937843323e-02 -5.118404328823089600e-02 4.306649789214134216e-02 -1.128679607063531876e-02 3.253786265850067139e-02 2.017829567193984985e-02 -7.582042366266250610e-02 2.471260353922843933e-02 1.234757993370294571e-02 -1.281104702502489090e-02 2.565838396549224854e-02 -1.632904261350631714e-02 4.354880750179290771e-02 1.035077497363090515e-02 2.169794216752052307e-02 -2.010148763656616211e-02 1.796306110918521881e-02 3.867433220148086548e-02 5.062650889158248901e-02 1.300829648971557617e-02 3.598639369010925293e-02 8.047558367252349854e-04 -5.795873701572418213e-02 -5.545775219798088074e-02 1.166681014001369476e-02 -5.976255983114242554e-03 8.661530166864395142e-02 1.718092858791351318e-01 1.626835167407989502e-01 2.260940670967102051e-01 3.844222426414489746e-01 3.765868842601776123e-01 3.767930269241333008e-01 4.326905012130737305e-01 2.217053174972534180e-01 1.972687244415283203e-01 8.118423819541931152e-02 1.367239207029342651e-01 5.779064446687698364e-02 3.956973180174827576e-02 -2.077128551900386810e-02 -3.981266543269157410e-02 -1.539487391710281372e-03 2.344526350498199463e-02 -8.886522799730300903e-02 -7.429088652133941650e-02 -4.461340606212615967e-03 6.234760954976081848e-02 1.052539423108100891e-02 5.410779267549514771e-02 -6.876869127154350281e-03 6.171533092856407166e-02 -4.206581413745880127e-02 2.553310617804527283e-02 1.681790314614772797e-02 -3.852910175919532776e-02 1.596284359693527222e-01 4.789864271879196167e-02 -1.314936578273773193e-02 -2.756694331765174866e-02 2.808859106153249741e-03 1.149528473615646362e-02 1.657342538237571716e-03 -7.714769337326288223e-03 7.868250831961631775e-04 -4.231775552034378052e-02 2.071676217019557953e-02 1.028590053319931030e-01 -1.006989181041717529e-01 1.667230278253555298e-01 8.780829608440399170e-02 3.549095615744590759e-02 -4.629204422235488892e-02 1.521755289286375046e-02 3.255279734730720520e-04 3.387492895126342773e-02 -2.328639104962348938e-02 5.431837588548660278e-02 3.145089372992515564e-02 3.401322662830352783e-02 2.671907469630241394e-02 4.483200982213020325e-02 2.054325491189956665e-02 2.422535046935081482e-02 9.254757314920425415e-03 4.153176024556159973e-02 2.382505312561988831e-02 1.218046434223651886e-02 4.608169943094253540e-02 6.934183184057474136e-04 2.153943851590156555e-02 -8.846230804920196533e-03 4.289773479104042053e-02 5.144127644598484039e-03 3.077412024140357971e-02 3.514984622597694397e-02 -3.867707215249538422e-03 -7.317706942558288574e-03 5.719756335020065308e-02 8.953748270869255066e-03 -1.821326091885566711e-02 2.917329221963882446e-02 2.862675115466117859e-02 -1.290751341730356216e-02 4.387371242046356201e-02 9.458268992602825165e-03 -5.241925641894340515e-02 5.432250350713729858e-02 5.272951349616050720e-02 1.974659226834774017e-02 3.690868616104125977e-02 2.811890468001365662e-02 -6.838031113147735596e-04 -9.669050574302673340e-03 -3.038416849449276924e-03 -1.393631007522344589e-02 -4.754714667797088623e-02 -1.900491677224636078e-02 1.447094976902008057e-02 -1.336510200053453445e-02 -1.921426504850387573e-02 -1.817782223224639893e-01 -2.177395224571228027e-01 -1.088409870862960815e-02 5.786696821451187134e-02 1.019389741122722626e-02 5.907489359378814697e-02 1.805298030376434326e-02 -1.191106736660003662e-01 -8.698181062936782837e-02 -1.588856987655162811e-02 1.439054012298583984e-01 2.733613550662994385e-02 5.078354477882385254e-02 1.356576383113861084e-02 2.874146215617656708e-02 4.738655872642993927e-03 5.292960256338119507e-02 -5.316527560353279114e-02 -4.757503792643547058e-02 -7.878073304891586304e-02 -1.612052470445632935e-01 -6.018968671560287476e-02 -4.841417074203491211e-02 2.280850894749164581e-02 7.945906370878219604e-02 -5.979561060667037964e-02 3.867377713322639465e-02 4.482308030128479004e-02 -1.142871193587779999e-02 -1.482108421623706818e-02 -1.217274554073810577e-02 -2.209564670920372009e-03 -5.023584887385368347e-02 -2.714171633124351501e-02 6.982813030481338501e-02 5.114747211337089539e-03 -5.378105677664279938e-03 6.095899641513824463e-02 -3.827522695064544678e-02 -1.469537150114774704e-02 -6.345006637275218964e-03 4.317009076476097107e-02 -1.572235226631164551e-01 -1.238150000572204590e-01 3.012085519731044769e-02 -7.194201648235321045e-02 -1.250842679291963577e-02 -3.311768174171447754e-03 -2.200652658939361572e-02 2.702794969081878662e-02 -4.965633153915405273e-03 -3.079893998801708221e-03 2.445005066692829132e-02 -2.236571907997131348e-02 -2.457338571548461914e-02 1.394108869135379791e-03 1.236775889992713928e-02 8.165933191776275635e-03 -4.954309761524200439e-02 4.999434947967529297e-02 -8.705730736255645752e-02 1.735725104808807373e-01 -1.767504364252090454e-01 -1.596201658248901367e-01 3.133719414472579956e-02 -2.597257122397422791e-02 2.984708920121192932e-02 3.603942692279815674e-02 -1.309648249298334122e-02 3.798356279730796814e-03 3.699186444282531738e-02 -1.315072178840637207e-02 4.627499729394912720e-02 2.339086681604385376e-02 -5.426381528377532959e-02 1.818128675222396851e-02 -3.778313845396041870e-02 -1.556321829557418823e-01 -2.480508238077163696e-01 -8.334201574325561523e-02 -2.001235634088516235e-02 1.344345808029174805e-01 2.326188050210475922e-02 3.931667283177375793e-02 -9.592123329639434814e-03 4.378558136522769928e-03 1.081557758152484894e-02 2.719110809266567230e-02 -2.053315937519073486e-01 -2.315225452184677124e-01 3.529062122106552124e-02 8.013511076569557190e-03 -4.785663634538650513e-02 1.036999821662902832e-01 -2.266113013029098511e-01 6.369909644126892090e-02 -7.605249434709548950e-02 6.999150663614273071e-02 -2.625116333365440369e-02 -7.870174944400787354e-02 5.109153687953948975e-03 -3.357409313321113586e-02 2.146323770284652710e-02 5.077733471989631653e-02 8.427708409726619720e-03 -5.788192152976989746e-02 5.885786563158035278e-02 8.279229700565338135e-02 3.301155567169189453e-02 3.118337690830230713e-02 3.579511493444442749e-02 4.949183389544487000e-02 -2.547107264399528503e-02 3.722607716917991638e-02 1.030467823147773743e-02 6.940420717000961304e-02 2.594678476452827454e-02 1.381268650293350220e-01 9.955512732267379761e-02 9.997969493269920349e-03 9.114630520343780518e-04 -2.137904986739158630e-02 -8.764676749706268311e-04 3.171755373477935791e-02 -1.573340408504009247e-02 2.308998629450798035e-02 4.819897934794425964e-02 -9.842009097337722778e-02 -1.802331954240798950e-02 -7.081927359104156494e-02 -7.391667366027832031e-02 -7.081122696399688721e-02 -3.472879230976104736e-01 5.416948348283767700e-02 -9.046830236911773682e-03 -2.194434404373168945e-02 1.084779575467109680e-02 -6.386259943246841431e-02 -7.934454083442687988e-02 -3.997064381837844849e-02 4.677331447601318359e-02 3.435464948415756226e-02 -3.396397456526756287e-03 1.577240973711013794e-02 -1.376094296574592590e-04 -3.673317283391952515e-02 1.406365353614091873e-02 -1.815070025622844696e-02 -1.439053844660520554e-02 3.875068947672843933e-02 3.822591155767440796e-02 1.956063136458396912e-02 2.130694501101970673e-02 -6.977832317352294922e-02 1.121204812079668045e-02 9.912461042404174805e-03 2.657072059810161591e-02 1.998603716492652893e-02 3.278763592243194580e-02 5.812122300267219543e-02 5.344860255718231201e-03 1.600977592170238495e-02 5.396290868520736694e-02 4.912739619612693787e-02 5.596709996461868286e-02 1.507277972996234894e-02 -1.772116497159004211e-02 -3.157250583171844482e-02 2.127693779766559601e-02 -6.102737784385681152e-02 5.439314991235733032e-02 9.263474494218826294e-03 -5.508171766996383667e-02 -8.617963641881942749e-03 -7.211612910032272339e-02 4.526108130812644958e-02 2.136201784014701843e-02 -2.779615670442581177e-02 2.993082627654075623e-03 8.086353540420532227e-03 4.542910680174827576e-02 1.097937021404504776e-02 -3.158219903707504272e-02 9.291665628552436829e-04 4.626637697219848633e-02 2.400328405201435089e-03 -2.549982815980911255e-02 2.282712608575820923e-02 2.448879182338714600e-02 6.368088535964488983e-03 -2.216842211782932281e-02 5.494163930416107178e-02 2.529356628656387329e-02 -4.104150831699371338e-02 -5.233431607484817505e-02 5.524463951587677002e-03 5.769209563732147217e-02 3.930123895406723022e-02 -3.247557207942008972e-02 -7.433158159255981445e-02 -6.903514266014099121e-02 4.700540006160736084e-02 -2.635583281517028809e-02 2.930519171059131622e-02 2.466813474893569946e-02 -6.516405940055847168e-02 -3.793381154537200928e-02 9.174015372991561890e-03 3.155141323804855347e-02 2.373507246375083923e-03 -1.628542318940162659e-03 -5.238666385412216187e-02 -2.796457707881927490e-02 7.039405405521392822e-03 -8.270229399204254150e-02 1.108478754758834839e-04 -3.398294746875762939e-02 6.543993949890136719e-02 1.358592510223388672e-01 2.382741495966911316e-02 -3.563916310667991638e-03 3.050959669053554535e-02 3.197540715336799622e-02 5.686077848076820374e-02 6.216338276863098145e-02 -4.216317459940910339e-02 -4.305374808609485626e-03 5.733693391084671021e-02 2.261677198112010956e-02 6.413424015045166016e-02 -1.820511370897293091e-02 8.493535220623016357e-02 7.056965678930282593e-02 -3.298512846231460571e-02 3.771837055683135986e-02 6.013107299804687500e-02 4.652676731348037720e-02 1.082463935017585754e-02 4.489693790674209595e-02 -8.408352732658386230e-04 -1.080824434757232666e-02 6.510004401206970215e-02 1.188684441149234772e-02 -1.768764853477478027e-02 -1.887913048267364502e-02 -1.325409859418869019e-02 -2.982603758573532104e-02 3.695328533649444580e-02 2.606806531548500061e-02 7.287687063217163086e-02 4.523414000868797302e-02 -5.983960814774036407e-03 -1.793172024190425873e-02 2.708412520587444305e-02 6.202016025781631470e-02 -5.991620011627674103e-03 5.254328250885009766e-02 2.849155291914939880e-02 8.053988218307495117e-02 3.785885870456695557e-02 -1.104100793600082397e-02 1.657747849822044373e-02 -2.578971907496452332e-02 3.862952813506126404e-03 -2.244233153760433197e-03 -9.460497647523880005e-03 4.495860263705253601e-02 1.305619478225708008e-01 8.103965222835540771e-02 3.411665558815002441e-02 6.402679532766342163e-02 1.125908643007278442e-01 6.420793384313583374e-02 3.279943019151687622e-03 -2.367199398577213287e-03 3.421928733587265015e-02 4.783419892191886902e-02 8.837588876485824585e-02 1.744990646839141846e-01 1.224852800369262695e-01 1.271546483039855957e-01 7.266435027122497559e-02 4.973281174898147583e-02 8.625154942274093628e-02 2.639762498438358307e-02 5.377319082617759705e-02 -1.263059582561254501e-02 8.042099326848983765e-02 9.927465021610260010e-02 -3.612611442804336548e-03 5.369331687688827515e-03 1.342470012605190277e-02 3.133210167288780212e-02 -5.152595415711402893e-02 4.281098395586013794e-02 -2.394318394362926483e-02 9.379216283559799194e-02 9.850656986236572266e-02 1.978532373905181885e-01 1.051181703805923462e-01 2.539685368537902832e-02 2.718851901590824127e-02 4.925771802663803101e-02 -5.555067677050828934e-03 1.379825361073017120e-02 8.011523634195327759e-02 1.555251143872737885e-02 3.730836138129234314e-02 8.746784925460815430e-02 9.941296279430389404e-02 1.042508780956268311e-01 3.941625729203224182e-02 -7.143857330083847046e-02 4.404161870479583740e-02 -8.193954825401306152e-03 1.322844475507736206e-01 -1.400150358676910400e-03 1.189537718892097473e-02 -8.419074118137359619e-02 5.852906405925750732e-02 1.034639179706573486e-01 2.657194435596466064e-01 4.030555486679077148e-01 3.368929922580718994e-01 2.055655866861343384e-01 1.620694249868392944e-01 2.553690671920776367e-01 2.027197331190109253e-01 3.352349400520324707e-01 1.894859969615936279e-01 1.323291659355163574e-01 5.424861982464790344e-02 3.207094967365264893e-02 4.918845742940902710e-02 1.686415821313858032e-01 1.373208761215209961e-01 3.222045302391052246e-01 2.501747012138366699e-01 1.359375193715095520e-02 2.425504475831985474e-02 1.980539411306381226e-02 6.525427848100662231e-02 1.450277119874954224e-01 3.248069435358047485e-03 5.426918715238571167e-02 5.154528841376304626e-02 1.301944851875305176e-01 4.669012501835823059e-02 1.821173541247844696e-02 3.504198789596557617e-02 9.511790703982114792e-04 4.600866511464118958e-02 4.139666259288787842e-02 1.682027056813240051e-02 -2.936396747827529907e-03 6.584136188030242920e-02 5.371066741645336151e-03 1.825517416000366211e-02 1.617604494094848633e-01 6.587593257427215576e-02 -4.942972213029861450e-02 7.184288650751113892e-02 1.173106953501701355e-01 -3.300396353006362915e-02 1.687331050634384155e-01 2.496588230133056641e-01 1.964497119188308716e-01 3.699479997158050537e-01 -5.759317427873611450e-02 -4.090247303247451782e-02 -1.282864995300769806e-02 1.304398030042648315e-01 1.763864457607269287e-01 9.002453088760375977e-02 1.390441358089447021e-01 1.647955775260925293e-01 3.933954983949661255e-02 1.583812683820724487e-01 6.015827059745788574e-01 6.239820271730422974e-03 3.488671034574508667e-02 9.391601197421550751e-03 -1.140225082635879517e-01 -7.224805653095245361e-02 1.522528529167175293e-01 -3.806864842772483826e-03 2.138088047504425049e-01 6.522292271256446838e-03 1.806607842445373535e-01 2.334948629140853882e-01 6.919959187507629395e-02 -1.810773611068725586e-01 7.528943568468093872e-02 -5.460136383771896362e-02 3.585281595587730408e-02 4.903925210237503052e-02 3.790136054158210754e-02 8.778162300586700439e-03 -1.036395225673913956e-02 6.368825584650039673e-02 -8.407373726367950439e-02 1.710590720176696777e-01 1.186265945434570312e-01 -3.385772556066513062e-02 -3.447438776493072510e-02 3.165795654058456421e-02 6.094074621796607971e-02 -6.081990152597427368e-02 5.155102163553237915e-02 -4.480911791324615479e-02 7.796764373779296875e-03 2.815724350512027740e-02 -6.850515492260456085e-03 5.159988626837730408e-02 1.159814149141311646e-01 -2.818093448877334595e-02 1.374456007033586502e-02 -2.372283115983009338e-02 4.694541543722152710e-02 7.541543245315551758e-02 8.074026554822921753e-02 4.639137163758277893e-02 7.137015461921691895e-02 -1.383641362190246582e-02 5.647269636392593384e-02 -7.854643464088439941e-02 6.733906269073486328e-02 1.034780740737915039e-01 -5.148998275399208069e-02 3.025017678737640381e-03 -7.685677707195281982e-02 -8.914135396480560303e-04 -1.741619966924190521e-02 4.780268296599388123e-03 1.846450008451938629e-02 7.634218037128448486e-02 1.157394144684076309e-02 8.791514486074447632e-02 6.952288746833801270e-02 -2.526327595114707947e-02 3.573338687419891357e-02 -2.883139252662658691e-02 6.809001415967941284e-02 8.479393273591995239e-02 6.515795364975929260e-03 2.705201506614685059e-02 2.003393620252609253e-01 4.611967504024505615e-01 4.556366503238677979e-01 1.977356523275375366e-02 -1.454207301139831543e-02 8.315201103687286377e-02 7.301349937915802002e-02 -5.006141960620880127e-03 2.566217258572578430e-02 1.828480660915374756e-01 -7.730109989643096924e-02 -1.558574736118316650e-01 -6.143662333488464355e-02 5.387228727340698242e-02 4.166629910469055176e-02 -1.154234167188405991e-02 6.415832042694091797e-02 6.705959886312484741e-02 -2.362271025776863098e-02 -9.535111486911773682e-03 6.695340573787689209e-02 6.283193826675415039e-03 -3.514929488301277161e-02 7.462557405233383179e-02 8.027273416519165039e-02 -1.092810370028018951e-02 3.592509031295776367e-02 5.821089074015617371e-02 -2.568334154784679413e-02 1.580458879470825195e-02 1.221138685941696167e-01 3.512091934680938721e-02 2.273471653461456299e-02 3.097933344542980194e-02 3.016868606209754944e-03 1.602346077561378479e-02 4.078160226345062256e-02 4.419736936688423157e-02 -5.388611182570457458e-02 3.148524463176727295e-02 5.464882031083106995e-02 6.458632647991180420e-02 -1.033600606024265289e-02 5.755781754851341248e-02 2.228421717882156372e-02 3.418678045272827148e-02 -3.316787630319595337e-02 -8.127517998218536377e-02 -1.782937906682491302e-02 3.781509399414062500e-02 3.330184146761894226e-03 -1.437126193195581436e-02 -1.294322870671749115e-02 -1.175082102417945862e-02 -6.867149472236633301e-02 -2.757912501692771912e-02 -1.245473325252532959e-02 -1.735729724168777466e-02 1.107592433691024780e-01 4.559513181447982788e-02 -3.460372611880302429e-02 -2.999871969223022461e-02 -3.832960966974496841e-03 6.589299440383911133e-02 1.448907852172851562e-01 -2.075850218534469604e-02 -2.672472968697547913e-03 -8.983958512544631958e-02 -9.080363810062408447e-02 -9.675670415163040161e-03 -3.558267280459403992e-02 -1.345325820147991180e-02 3.342987224459648132e-02 1.074377913028001785e-02 -3.664419054985046387e-04 1.654963940382003784e-02 3.969080001115798950e-02 -4.112702235579490662e-02 1.322726625949144363e-02 -1.607806608080863953e-02 -5.210395529866218567e-02 9.058929048478603363e-03 3.697027266025543213e-02 -1.420149113982915878e-02 5.036836862564086914e-02 2.895312756299972534e-02 -5.457301065325737000e-02 1.902164146304130554e-02 -6.013094261288642883e-02 -2.824822440743446350e-02 6.453365087509155273e-02 6.359286606311798096e-02 -5.135763436555862427e-02 2.903104014694690704e-02 -3.638591617345809937e-02 -3.989070653915405273e-02 3.992768377065658569e-02 6.060156971216201782e-03 4.047486186027526855e-02 2.523634582757949829e-02 -2.023570798337459564e-02 1.177140697836875916e-02 -3.452155739068984985e-02 4.193780943751335144e-02 9.429141879081726074e-02 -5.863237008452415466e-02 -2.906356193125247955e-02 4.520604386925697327e-02 4.318761453032493591e-02 5.149526987224817276e-03 -3.265538439154624939e-02 2.576206810772418976e-02 2.915959432721138000e-02 1.588471978902816772e-02 3.038051724433898926e-02 3.653502836823463440e-02 -7.355552166700363159e-03 -7.870379835367202759e-03 -7.069896161556243896e-02 3.030242584645748138e-02 2.375106513500213623e-02 2.714648284018039703e-02 7.613668218255043030e-03 3.357002884149551392e-02 3.136444836854934692e-02 4.456460848450660706e-02 -2.582600526511669159e-02 -2.004175074398517609e-02 -1.580227464437484741e-01 3.941075876355171204e-03 6.410767138004302979e-02 3.261383250355720520e-02 -1.683278754353523254e-02 -2.981482818722724915e-02 3.389740735292434692e-02 7.790189981460571289e-02 -8.691191673278808594e-03 -1.677281968295574188e-02 5.588278546929359436e-02 7.594645023345947266e-02 -3.078671358525753021e-02 1.113773044198751450e-02 3.762791305780410767e-02 1.814810931682586670e-02 -2.872568070888519287e-01 -3.019541203975677490e-01 -7.481963932514190674e-02 -4.287304356694221497e-02 -5.446007475256919861e-03 -2.783084660768508911e-02 -5.151780694723129272e-02 -3.912121802568435669e-02 7.781560532748699188e-03 -6.664258427917957306e-03 -5.153093487024307251e-02 5.541887879371643066e-02 -1.228688843548297882e-02 -3.439182415604591370e-03 3.932515531778335571e-02 -7.744981348514556885e-02 1.822061091661453247e-02 1.502270158380270004e-02 1.408887375146150589e-02 7.616027444601058960e-02 -3.719247877597808838e-02 -2.486124634742736816e-03 4.393981769680976868e-03 -3.785564750432968140e-02 -5.381403490900993347e-02 -9.431609883904457092e-03 1.257359050214290619e-03 3.659608960151672363e-02 -5.943367257714271545e-03 1.661598682403564453e-03 4.933179169893264771e-02 3.994870930910110474e-02 5.758832022547721863e-02 -5.622530356049537659e-03 -6.475085765123367310e-02 -1.329563558101654053e-02 -1.653129234910011292e-02 -6.930960714817047119e-02 1.782362163066864014e-02 6.450302153825759888e-02 -3.609491884708404541e-02 7.872433215379714966e-02 5.100326612591743469e-02 -1.727343350648880005e-02 -3.029450960457324982e-02 7.413114607334136963e-02 2.456108331680297852e-01 1.968255341053009033e-01 -2.625867910683155060e-02 1.080604791641235352e-01 -1.407742872834205627e-02 2.744488418102264404e-02 6.936875730752944946e-02 -1.029236614704132080e-02 -6.014436483383178711e-02 2.455498650670051575e-02 1.006181817501783371e-03 -3.770396858453750610e-02 -3.233527764678001404e-02 2.514237910509109497e-02 -5.654800683259963989e-03 2.950102090835571289e-02 2.207988500595092773e-02 -8.190073072910308838e-02 9.394396096467971802e-03 2.860762365162372589e-02 -2.580011263489723206e-02 2.813618630170822144e-05 4.264488816261291504e-02 -1.194360200315713882e-02 -1.869336329400539398e-02 -1.859867572784423828e-02 1.327168475836515427e-02 1.353608444333076477e-03 -2.132673561573028564e-02 -2.000735327601432800e-02 2.919827029109001160e-02 5.853868275880813599e-02 -3.122472576797008514e-02 -4.114613868296146393e-03 6.552499532699584961e-02 4.731828346848487854e-02 -2.950651384890079498e-02 2.101218514144420624e-02 -1.425568573176860809e-02 7.530815899372100830e-03 -4.015375673770904541e-02 3.825510852038860321e-03 6.731152534484863281e-02 6.071034073829650879e-02 5.639189854264259338e-03 1.249505206942558289e-02 1.649795100092887878e-03 3.289414197206497192e-02 5.352638661861419678e-03 -6.794594228267669678e-03 6.762322038412094116e-02 1.530444622039794922e-01 7.649122178554534912e-02 5.092373117804527283e-02 -6.181253492832183838e-02 4.182489216327667236e-02 -3.565334156155586243e-02 9.162452071905136108e-03 3.282965719699859619e-02 -1.068740710616111755e-02 -1.864900439977645874e-02 2.257884480059146881e-02 1.764628663659095764e-02 6.016458943486213684e-02 5.773075670003890991e-02 -3.265834599733352661e-02 -5.787747912108898163e-03 -1.009536460041999817e-01 -4.294127970933914185e-02 5.268214643001556396e-02 2.961918525397777557e-02 1.566846854984760284e-03 5.279645323753356934e-02 1.651480048894882202e-02 4.802640527486801147e-03 1.485258713364601135e-02 3.877969086170196533e-02 1.333037298172712326e-02 1.009993255138397217e-02 -3.347801789641380310e-02 3.105415776371955872e-02 2.608181443065404892e-03 -9.749267250299453735e-03 2.158283442258834839e-02 -3.736718557775020599e-03 1.039068214595317841e-03 -1.130432263016700745e-02 -2.168260887265205383e-02 3.263525199145078659e-03 -7.140269130468368530e-02 -1.911579817533493042e-02 -1.014827750623226166e-02 4.899560660123825073e-02 1.320280600339174271e-02 1.068681851029396057e-02 2.362934127449989319e-02 -3.225983679294586182e-02 1.969642937183380127e-02 -1.897183433175086975e-02 -2.284511551260948181e-02 -2.189695090055465698e-02 2.835126593708992004e-02 -6.459687650203704834e-02 2.865084260702133179e-02 1.712991483509540558e-02 -2.742576226592063904e-02 1.409999728202819824e-01 9.304574877023696899e-02 -1.693539321422576904e-03 -4.403734579682350159e-02 -6.224150955677032471e-02 9.590355679392814636e-03 7.381357252597808838e-02 -2.901347726583480835e-02 1.702622883021831512e-02 3.290290385484695435e-02 5.391386337578296661e-03 -2.884678542613983154e-03 3.703621774911880493e-02 9.432851336896419525e-03 -8.667454123497009277e-03 -2.402236498892307281e-02 1.722944527864456177e-02 -1.526711508631706238e-02 1.975703239440917969e-02 -1.281448639929294586e-04 1.968167163431644440e-02 -2.379987388849258423e-03 -2.627753838896751404e-02 -1.189159229397773743e-03 -1.541208475828170776e-04 -4.361502826213836670e-02 2.044034004211425781e-02 1.775247976183891296e-02 4.280947893857955933e-02 -8.956980705261230469e-02 -2.428522147238254547e-02 -6.441603414714336395e-03 -3.392752259969711304e-02 -3.123552165925502777e-02 -1.624913513660430908e-02 4.678813740611076355e-02 -4.610278829932212830e-02 1.941065490245819092e-02 1.742441952228546143e-01 -2.398491352796554565e-01 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00
2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02 2.893929928541183472e-02
1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 0.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00 1.000000000000000000e+00

```

`Qubespec/docs/conf.py`:

```py
# -*- coding: utf-8 -*-
#
# Bagpipes documentation build configuration file, created by
# sphinx-quickstart on Sat Nov 11 12:56:48 2017.
#
# This file is execfile()d with the current directory set to its
# containing dir.
#
# Note that not all possible configuration values are present in this
# autogenerated file.
#
# All configuration values have a default; values that are commented out
# serve to show the default.

# If extensions (or modules to document with autodoc) are in another directory,
# add these directories to sys.path here. If the directory is relative to the
# documentation root, use os.path.abspath to make it absolute, like shown here.
#
import os
import sys
sys.path.insert(0, os.path.abspath('..'))
import QubeSpec

# -- General configuration ------------------------------------------------

# If your documentation needs a minimal Sphinx version, state it here.
#
# needs_sphinx = '1.0'

# Add any Sphinx extension module names here, as strings. They can be
# extensions coming with Sphinx (named 'sphinx.ext.*') or your custom
# ones.
extensions = ['sphinx.ext.autodoc', 'sphinx.ext.napoleon']

# Add any paths that contain templates here, relative to this directory.
templates_path = ['_templates']

# The suffix(es) of source filenames.
# You can specify multiple suffix as a list of string:
#
# source_suffix = ['.rst', '.md']
source_suffix = '.rst'

# The master toctree document.
master_doc = 'index'

# General information about the project.
project = u'QubeSpec'
copyright = u'2023-2024, Jan Scholtz'
author = u'Jan Scholtz'

# The version info for the project you're documenting, acts as replacement for
# |version| and |release|, also used in various other places throughout the
# built documents.
#
# The short X.Y version.
version = u'1.0.0'
# The full version, including alpha/beta/rc tags.
release = u'1.0.0'

# The language for content autogenerated by Sphinx. Refer to documentation
# for a list of supported languages.
#
# This is also used if you do content translation via gettext catalogs.
# Usually you set "language" from the command line for these cases.
language = None

# List of patterns, relative to source directory, that match files and
# directories to ignore when looking for source files.
# This patterns also effect to html_static_path and html_extra_path
exclude_patterns = ['_build', 'Thumbs.db', '.DS_Store']

# The name of the Pygments (syntax highlighting) style to use.
pygments_style = 'sphinx'

# If true, `todo` and `todoList` produce output, else they produce nothing.
todo_include_todos = False

# -- Options for HTML output ----------------------------------------------

# The theme to use for HTML and HTML Help pages.  See the documentation for
# a list of builtin themes.
#
html_theme = 'sphinx_rtd_theme'

# Theme options are theme-specific and customize the look and feel of a theme
# further.  For a list of options available for each theme, see the
# documentation.
#
html_theme_options = {"navigation_depth": 1}

# Add any paths that contain custom static files (such as style sheets) here,
# relative to this directory. They are copied after the builtin static files,
# so a file named "default.css" will overwrite the builtin "default.css".
html_static_path = ['_static']


# -- Options for HTMLHelp output ------------------------------------------

# Output file base name for HTML help builder.
htmlhelp_basename = 'QubeSpecdoc'


# -- Options for LaTeX output ---------------------------------------------

latex_elements = {
    # The paper size ('letterpaper' or 'a4paper').
    #
    # 'papersize': 'letterpaper',

    # The font size ('10pt', '11pt' or '12pt').
    #
    # 'pointsize': '10pt',

    # Additional stuff for the LaTeX preamble.
    #
    # 'preamble': '',

    # Latex figure (float) alignment
    #
    # 'figure_align': 'htbp',
}

# Grouping the document tree into LaTeX files. List of tuples
# (source start file, target name, title,
#  author, documentclass [howto, manual, or own class]).
latex_documents = [
    (master_doc, 'QubeSpec.tex', u'QubeSpec Documentation',
     u'Jan Scholtz', 'manual'),
]


# -- Options for manual page output ---------------------------------------

# One entry per manual page. List of tuples
# (source start file, name, description, authors, manual section).
man_pages = [
    (master_doc, 'qubespec', u'QubeSpec Documentation',
     [author], 1)
]


# -- Options for Texinfo output -------------------------------------------

# Grouping the document tree into Texinfo files. List of tuples
# (source start file, target name, title, author,
#  dir menu entry, description, category)
texinfo_documents = [
    (master_doc, 'QubeSpec', u'QubeSpec Documentation',
     author, 'Jan Scholtz', 'One line description of project.',
     'Miscellaneous'),
]
```

`Qubespec/docs/requirements.txt`:

```txt
astropy
corner
numpy
photoutils
emcee
multiprocess
scipy
brokenaxes
tqdm
numba
sphinx_rtd_theme
```

`Qubespec/setup.py`:

```py
import subprocess
from setuptools import setup
from setuptools import find_packages

def readme():
    with open('README.md') as file:
        return(file.read())

version = '0.1.0'

setup(name='QubeSpec',
      version=version,
      description='A library to optical/IFS spectra',
      long_description=readme(),
      classifiers=[
        'Development Status :: 0 - Production/Stable',
        'Intended Audience :: Science/Research',
        'License :: Other/Proprietary License',
        'Programming Language :: Python :: 3',
        'Topic :: Scientific/Engineering :: Astronomy',
      ],
      url='https://github.com/honzascholtz/qubespec',
      author='Jan Scholtz',
      author_email='honzascholtz@gmail.com',
      license='Other/Proprietary License',
      packages=["QubeSpec", "QubeSpec.detection", "QubeSpec.Dust", "QubeSpec.Fitting", "QubeSpec.Maps", "QubeSpec.Models",
                "QubeSpec.Plotting","QubeSpec.Spaxel_fitting", "QubeSpec.Utils", "QubeSpec.Visualizations" ],
      install_requires=[
        'astropy>=5.2.0',
        'ipython>7.31.0',
        'matplotlib>=3.5.3',
        'numba>=0.56.3',
        'tqdm>=4.40.0',
        'emcee>=3.1.0',
        'brokenaxes>=0.5.0',
        'corner>=2.2.1',
        'scipy>=1.9.1',
        'multiprocess',
        'spectres',
        'photutils',
        'sep'],
      python_requires='>=3.8.0',
      #entry_points={
      #  'console_scripts': [
      #      'inzimar = inzimar.inzimar:main',
      #      ],
      #},
      include_package_data=True,
      #package_data={'': ['/jadify_temp/*', '/Models/FeII_templates/*']},
      zip_safe=False
     )

```

`Qubespec/workshop_nested_sampling.py`:

```py
# | # BlackJAX Nested Sampling Workshop
# |
# | This workshop demonstrates GPU-native nested sampling using BlackJAX. We'll progress through three examples: line fitting, 2D Gaussian inference, and performance comparisons with other samplers. The workshop showcases JAX's key strengths: automatic differentiation and JIT compilation for high-performance Bayesian inference.
# ------------------------------------------------
# | ## Installation for Google Colab
# |```bash
# | pip install git+https://github.com/handley-lab/blackjax@nested_sampling
# | pip install anesthetic tqdm
# |```

import jax
# | Configure JAX immediately after import
jax.config.update("jax_enable_x64", True)

import jax.numpy as jnp
import numpy as np
import matplotlib.pyplot as plt
import tqdm
import time
import blackjax
from anesthetic import NestedSamples

# | ## Part 1: Line Fitting with Nested Sampling
# |
# | We start with the classic problem of fitting a linear model y = mx + c to noisy data.
# | This introduces the basic nested sampling workflow in BlackJAX.


# | ### 1.1 Nested Sampling Configuration
# | 
# | Key parameters for workshop timing and educational value:
# | - `num_live=100`: Fast convergence for workshop setting
# | - `num_delete=50`: Parallelization parameter
# | - `num_inner_steps`: Reliability parameter (rule of thumb: 5 * num_dims)
rng_key = jax.random.PRNGKey(42)
num_live = 100
num_delete = 50

# | ### 1.2 Generate Synthetic Line Data
# |
# | True model: y = 2x + 1 + noise, with σ = 0.5
num_data = 15
x = jnp.linspace(-2.0, 2.0, num_data)
true = {'m': 2.0, 'c': 1.0, 'sigma': 0.5}

key, rng_key = jax.random.split(rng_key)
noise = true['sigma'] * jax.random.normal(key, (num_data,))
y = true['m'] * x + true['c'] + noise

# | Visualize the data
fig, ax = plt.subplots(figsize=(8, 5))
ax.errorbar(x, y, yerr=true['sigma'], fmt="o", label="Observed data", color='black')
ax.plot(x, true['m'] * x + true['c'], '--', label="True model", color='red', alpha=0.7)
ax.set_xlabel("x")
ax.set_ylabel("y")
ax.legend()
ax.set_title("Linear Model: Bayesian Parameter Estimation")

# | ### 1.3 Define Likelihood Function
# |
# | Gaussian likelihood with unknown slope, intercept, and noise level
def line_loglikelihood(params):
    """Log-likelihood for linear model with Gaussian noise."""
    m, c, sigma = params["m"], params["c"], params["sigma"]
    y_model = m * x + c
    # Vectorized normal log-likelihood
    return jax.scipy.stats.multivariate_normal.logpdf(y, y_model, sigma**2)

# | ### 1.4 Define Prior Distributions
prior_bounds = {
    "m": (-5.0, 5.0),      # slope
    "c": (-5.0, 5.0),      # intercept  
    "sigma": (0.1, 2.0),   # noise level (positive)
}

num_dims = len(prior_bounds)
num_inner_steps = num_dims * 5

# | ### 1.5 Initialize Nested Sampler
rng_key, prior_key = jax.random.split(rng_key)
particles, logprior_fn = blackjax.ns.utils.uniform_prior(prior_key, num_live, prior_bounds)

nested_sampler = blackjax.nss(
    logprior_fn=logprior_fn,
    loglikelihood_fn=line_loglikelihood,
    num_delete=num_delete,
    num_inner_steps=num_inner_steps,
)
print(f"Initialized nested sampler with {num_live} live points")

# | ### 1.6 JIT Compile for Performance
init_fn = jax.jit(nested_sampler.init)
step_fn = jax.jit(nested_sampler.step)
print("Functions compiled - ready to run!")

# | ### 1.7 Run the Nested Sampling
print("Running nested sampling for line fitting...")
ns_start = time.time()
live = init_fn(particles)
dead = []

with tqdm.tqdm(desc="Dead points", unit=" dead points") as pbar:
    while not live.logZ_live - live.logZ < -3:  # Convergence criterion
        rng_key, subkey = jax.random.split(rng_key, 2)
        live, dead_info = step_fn(subkey, live)
        dead.append(dead_info)
        pbar.update(num_delete)

dead = blackjax.ns.utils.finalise(live, dead)
ns_time = time.time() - ns_start

# | ### 1.8 Process Results with Anesthetic
columns = ["m", "c", "sigma"]
labels = [r"$m$", r"$c$", r"$\sigma$"]
data = jnp.vstack([dead.particles[key] for key in columns]).T

line_samples = NestedSamples(
    data,
    logL=dead.loglikelihood,
    logL_birth=dead.loglikelihood_birth,
    columns=columns,
    labels=labels,
    logzero=jnp.nan,
)

# | ### 1.9 Results Analysis and Visualization
print(f"Nested sampling runtime: {ns_time:.2f} seconds")
print(f"Log Evidence: {line_samples.logZ():.2f} ± {line_samples.logZ(100).std():.2f}")
print(f"True parameters: m={true['m']}, c={true['c']}, σ={true['sigma']}")
print(f"Posterior means: m={line_samples.m.mean():.2f}, c={line_samples.c.mean():.2f}, σ={line_samples.sigma.mean():.2f}")

# Create posterior corner plot with true values marked
kinds = {'lower': 'kde_2d', 'diagonal': 'hist_1d', 'upper': 'scatter_2d'}
axes = line_samples.plot_2d(columns, kinds=kinds, label='Posterior')
axes.axlines(true, color='red', linestyle='--', alpha=0.8)
plt.suptitle("Line Fitting: Posterior Distributions")

# | ## Part 2: 2D Gaussian Parameter Inference
# |
# | Now we tackle a more complex problem: inferring the parameters of a 2D Gaussian distribution
# | including the correlation coefficient. This demonstrates parameter transforms and constrained sampling.


# | ### 2.1 Define 2D Gaussian Parameters
true.update({
    'mu1': 1.0, 'mu2': -0.5,
    'sigma1': 1.2, 'sigma2': 0.8, 
    'rho': 0.6
})
print("True parameters:", {k: v for k, v in true.items() if k in ['mu1', 'mu2', 'sigma1', 'sigma2', 'rho']})

# | ### 2.2 Generate Correlated 2D Data
true_mu = jnp.array([true['mu1'], true['mu2']])
true_cov = jnp.array([
    [true['sigma1']**2, true['rho'] * true['sigma1'] * true['sigma2']],
    [true['rho'] * true['sigma1'] * true['sigma2'], true['sigma2']**2]
])

num_samples = 200
key, rng_key = jax.random.split(rng_key)
gaussian_data = jax.random.multivariate_normal(key, true_mu, true_cov, (num_samples,))

print(f"Generated {num_samples} correlated 2D samples")
print(f"Sample mean: [{gaussian_data.mean(0)[0]:.2f}, {gaussian_data.mean(0)[1]:.2f}]")

# | ### 2.3 Visualize the 2D Data
fig, ax = plt.subplots(figsize=(8, 6))
ax.scatter(gaussian_data[:, 0], gaussian_data[:, 1], alpha=0.6, s=20)
ax.set_xlabel(r"$x_1$")
ax.set_ylabel(r"$x_2$")
ax.set_title("2D Gaussian Data")
ax.grid(True, alpha=0.3)

# | ### 2.4 Define Likelihood with Parameter Transforms
# |
# | We use arctanh/tanh transform for the correlation coefficient to enforce |ρ| < 1
def gaussian_2d_loglikelihood(params):
    """Log-likelihood for 2D Gaussian with correlation."""
    mu1, mu2 = params["mu1"], params["mu2"]
    sigma1, sigma2 = params["sigma1"], params["sigma2"]
    rho_transformed = params["rho_t"]
    
    # Transform correlation coefficient: rho = tanh(rho_t)
    rho = jnp.tanh(rho_transformed)
    
    # Construct covariance matrix
    cov = jnp.array([
        [sigma1**2, rho * sigma1 * sigma2],
        [rho * sigma1 * sigma2, sigma2**2]
    ])
    
    # Check positive definiteness
    det = jnp.linalg.det(cov)
    
    # Return -inf for invalid covariance matrices
    def valid_loglik():
        mu = jnp.array([mu1, mu2])
        return jnp.sum(jax.scipy.stats.multivariate_normal.logpdf(gaussian_data, mu, cov))
    
    def invalid_loglik():
        return -jnp.inf
    
    return jax.lax.cond(det > 1e-8, valid_loglik, invalid_loglik)

# | ### 2.5 Set Up Priors for 2D Gaussian
gaussian_prior_bounds = {
    "mu1": (-3.0, 5.0),
    "mu2": (-3.0, 3.0), 
    "sigma1": (0.1, 3.0),
    "sigma2": (0.1, 3.0),
    "rho_t": (-2.0, 2.0),  # transformed correlation: rho = tanh(rho_t)
}

num_dims_2d = len(gaussian_prior_bounds)
num_inner_steps_2d = num_dims_2d * 5

# | ### 2.6 Initialize and Run Nested Sampling
rng_key, prior_key = jax.random.split(rng_key)
particles_2d, logprior_fn_2d = blackjax.ns.utils.uniform_prior(prior_key, num_live, gaussian_prior_bounds)

nested_sampler_2d = blackjax.nss(
    logprior_fn=logprior_fn_2d,
    loglikelihood_fn=gaussian_2d_loglikelihood,
    num_delete=num_delete,
    num_inner_steps=num_inner_steps_2d,
)

init_fn_2d = jax.jit(nested_sampler_2d.init)
step_fn_2d = jax.jit(nested_sampler_2d.step)

print("Running nested sampling for 2D Gaussian...")
live_2d = init_fn_2d(particles_2d)
dead_2d = []

with tqdm.tqdm(desc="Dead points", unit=" dead points") as pbar:
    while not live_2d.logZ_live - live_2d.logZ < -3:
        rng_key, subkey = jax.random.split(rng_key, 2)
        live_2d, dead_info_2d = step_fn_2d(subkey, live_2d)
        dead_2d.append(dead_info_2d)
        pbar.update(num_delete)

dead_2d = blackjax.ns.utils.finalise(live_2d, dead_2d)

# | ### 2.7 Transform Back and Analyze Results
columns_2d = ["mu1", "mu2", "sigma1", "sigma2", "rho_t"]
labels_2d = [r"$\mu_1$", r"$\mu_2$", r"$\sigma_1$", r"$\sigma_2$", r"$\rho_t$"]
data_2d = jnp.vstack([dead_2d.particles[key] for key in columns_2d]).T

gaussian_samples = NestedSamples(
    data_2d,
    logL=dead_2d.loglikelihood,
    logL_birth=dead_2d.loglikelihood_birth,
    columns=columns_2d,
    labels=labels_2d,
    logzero=jnp.nan,
)

# | Add transformed correlation coefficient
gaussian_samples["rho"] = jnp.tanh(gaussian_samples["rho_t"].values)

print(f"Log Evidence: {gaussian_samples.logZ():.2f} ± {gaussian_samples.logZ(100).std():.2f}")
print(f"True parameters: μ₁={true['mu1']:.2f}, μ₂={true['mu2']:.2f}, σ₁={true['sigma1']:.2f}, σ₂={true['sigma2']:.2f}, ρ={true['rho']:.2f}")
print(f"Posterior means: μ₁={gaussian_samples.mu1.mean():.2f}, μ₂={gaussian_samples.mu2.mean():.2f}, σ₁={gaussian_samples.sigma1.mean():.2f}, σ₂={gaussian_samples.sigma2.mean():.2f}, ρ={gaussian_samples.rho.mean():.2f}")

# | Plot posterior for key parameters with true values
key_params = ["mu1", "mu2", "sigma1", "sigma2", "rho"]
axes = gaussian_samples[key_params].plot_2d(key_params, kinds={'diagonal': 'hist_1d', 'lower': 'kde_2d'})

# Mark true values using anesthetic's axlines method
true_2d = {k: true[k] for k in key_params}
axes.axlines(true_2d, color='red', linestyle='--', alpha=0.8)
plt.suptitle("2D Gaussian: Posterior Parameter Estimates")

# | ## Part 3: Performance Comparison
# |
# | Compare BlackJAX nested sampling with NUTS (No-U-Turn Sampler) and 
# | Affine Invariant Ensemble Sampler on the line fitting problem

import time

# | ### 3.1 Define NUTS Log-Probability Function
def nuts_logprob(params_array):
    """Combined log probability for NUTS (assumes flat priors within bounds)."""
    m, c, log_sigma = params_array
    sigma = jnp.exp(log_sigma)  # positive constraint via log transform
    
    # Check bounds (flat prior)
    m_valid = (m >= -5.0) & (m <= 5.0)
    c_valid = (c >= -5.0) & (c <= 5.0)
    sigma_valid = (sigma >= 0.1) & (sigma <= 2.0)
    
    def valid_logprob():
        y_model = m * x + c
        loglik = jax.scipy.stats.multivariate_normal.logpdf(y, y_model, sigma**2)
        return loglik + log_sigma  # Add Jacobian for log transform
    
    def invalid_logprob():
        return -jnp.inf
    
    return jax.lax.cond(m_valid & c_valid & sigma_valid, valid_logprob, invalid_logprob)

# | ### 3.2 Initialize and Run NUTS Sampler
initial_position = jnp.array([1.0, 0.0, jnp.log(1.0)])  # [m, c, log_sigma]
nuts = blackjax.nuts(nuts_logprob, step_size=0.1, inverse_mass_matrix=jnp.eye(3))

rng_key, nuts_key = jax.random.split(rng_key)
nuts_state = nuts.init(initial_position)
nuts_step = jax.jit(nuts.step)

print("Running NUTS sampler...")

num_nuts_samples = 2000
nuts_start = time.time()
nuts_samples = []
nuts_states = nuts_state

for i in tqdm.tqdm(range(num_nuts_samples), desc="NUTS"):
    nuts_key, step_key = jax.random.split(nuts_key)
    nuts_states, nuts_info = nuts_step(step_key, nuts_states)
    nuts_samples.append(nuts_states.position)

nuts_time = time.time() - nuts_start
nuts_samples = jnp.stack(nuts_samples)

# | ### 3.3 Process NUTS Results  
nuts_m = nuts_samples[:, 0]
nuts_c = nuts_samples[:, 1] 
nuts_sigma = jnp.exp(nuts_samples[:, 2])

print(f"NUTS runtime: {nuts_time:.2f} seconds")
print(f"NUTS means: m={nuts_m[500:].mean():.2f}, c={nuts_c[500:].mean():.2f}, σ={nuts_sigma[500:].mean():.2f}")

# | ### 3.4 Performance Summary and Visualization
methods = ["Nested Sampling", "NUTS"]
times = [f"{ns_time:.1f} sec", f"{nuts_time:.1f} sec"]
evidence = ["✓ (Log Z available)", "✗ (Not computed)"]
parallelization = ["✓ (GPU native)", "Limited"]

print(f"{'Method':<20} {'Time':<15} {'Evidence':<15} {'GPU Parallel'}")
print("-" * 65)
for i in range(len(methods)):
    print(f"{methods[i]:<20} {times[i]:<15} {evidence[i]:<15} {parallelization[i]}")

# | ### 3.5 Posterior Comparison Plot
fig, axes = plt.subplots(1, 3, figsize=(15, 4))

# | Generate proper posterior samples from NestedSamples (not raw dead points)
# | Use the number of available samples or 1000, whichever is smaller
n_posterior_samples = min(1000, len(line_samples))
ns_posterior_samples = line_samples.sample(n_posterior_samples, replace=True)  # Sample from posterior with replacement
nuts_burnin = 500  # Remove burn-in

# | Compare marginal posteriors
axes[0].hist(ns_posterior_samples.m.values, bins=30, alpha=0.7, density=True, label='Nested Sampling')
axes[0].hist(nuts_m[nuts_burnin:], bins=30, alpha=0.7, density=True, label='NUTS')
axes[0].axvline(true['m'], color='red', linestyle='--', label='True value')
axes[0].set_xlabel('Slope (m)')
axes[0].set_ylabel('Density')
axes[0].legend()

axes[1].hist(ns_posterior_samples.c.values, bins=30, alpha=0.7, density=True, label='Nested Sampling')
axes[1].hist(nuts_c[nuts_burnin:], bins=30, alpha=0.7, density=True, label='NUTS')
axes[1].axvline(true['c'], color='red', linestyle='--', label='True value')
axes[1].set_xlabel('Intercept (c)')
axes[1].set_ylabel('Density')
axes[1].legend()

axes[2].hist(ns_posterior_samples.sigma.values, bins=30, alpha=0.7, density=True, label='Nested Sampling')
axes[2].hist(nuts_sigma[nuts_burnin:], bins=30, alpha=0.7, density=True, label='NUTS')
axes[2].axvline(true['sigma'], color='red', linestyle='--', label='True value')
axes[2].set_xlabel('Noise (σ)')
axes[2].set_ylabel('Density')
axes[2].legend()

plt.tight_layout()
plt.suptitle("Posterior Comparison: Nested Sampling vs NUTS", y=1.02)

# | ## Part 4: Building Your Own Nested Sampler
# |
# | Advanced users can build custom nested samplers using BlackJAX's low-level components.
# | This demonstrates the modular design and shows how nested sampling works under the hood.

from functools import partial
from blackjax.ns.adaptive import build_kernel, init
from blackjax.ns.base import new_state_and_info, delete_fn
from blackjax.ns.utils import repeat_kernel, finalise
from blackjax.mcmc.random_walk import build_rmh, RWState
from blackjax import SamplingAlgorithm

# | ### 4.1 Define Custom Nested MCMC Algorithm
def custom_nsmcmc(
    logprior_fn,
    loglikelihood_fn,
    num_delete=10,
    num_inner_steps=10,
):
    """
    Build a custom nested sampling MCMC algorithm from low-level components.
    
    This demonstrates how to construct a nested sampler using BlackJAX's
    modular infrastructure - useful for research and customization.
    
    Parameters
    ----------
    logprior_fn : callable
        Function that computes the log prior probability of the parameters.
    loglikelihood_fn : callable
        Function that computes the log likelihood of the parameters.
    num_delete : int
        Number of particles to delete at each step.
    num_inner_steps : int
        Number of inner MCMC steps to perform.
    
    Returns
    -------
    SamplingAlgorithm
        Custom nested sampling algorithm with init and step functions.
    """
    
    # Build the MCMC kernel for exploring within likelihood constraints
    mcmc_kernel = build_rmh()

    @repeat_kernel(num_inner_steps)
    def inner_kernel(rng_key, state, logprior_fn, loglikelihood_fn, loglikelihood_0, params):
        """Inner MCMC kernel that explores within likelihood constraint."""
        def proposal_distribution(rng_key, position):
            # Handle dictionary position structure
            if isinstance(position, dict):
                step = {}
                for key in position.keys():
                    sigma_val = params['sigma'][key] if isinstance(params['sigma'], dict) else params['sigma']
                    step[key] = sigma_val * jax.random.normal(rng_key, shape=position[key].shape)
                    rng_key, _ = jax.random.split(rng_key)  # Split key for each parameter
                return {key: position[key] + step[key] for key in position.keys()}
            else:
                # Fallback for array position
                step = params['sigma'] * jax.random.normal(rng_key, shape=position.shape) 
                return position + step

        # Convert to MCMC state format
        mcmc_state = RWState(position=state.position, logdensity=state.logprior)
        new_mcmc_state, mcmc_info = mcmc_kernel(rng_key, mcmc_state, logprior_fn, proposal_distribution)

        # Evaluate likelihood at new position
        loglikelihood = loglikelihood_fn(new_mcmc_state.position)

        # Create new nested sampling state
        new_state, info = new_state_and_info(
            position=new_mcmc_state.position,
            logprior=new_mcmc_state.logdensity,
            loglikelihood=loglikelihood,
            info=mcmc_info,
        )

        # Accept only if likelihood exceeds threshold (key constraint!)
        new_state = jax.lax.cond(
            loglikelihood > loglikelihood_0,
            lambda _: new_state,
            lambda _: state,
            operand=None,
        )

        return new_state, info

    def update_inner_kernel_params_fn(state, info, params):
        """Adapt step size based on current particle distribution."""
        # Calculate standard deviation for each parameter
        sigma_dict = {}
        for key in state.particles.keys():
            sigma_dict[key] = jnp.std(state.particles[key])
        return {'sigma': sigma_dict}

    # Build the full nested sampling kernel
    _delete_fn = partial(delete_fn, num_delete=num_delete)

    step_fn = build_kernel(
        logprior_fn,
        loglikelihood_fn,
        _delete_fn,
        inner_kernel,
        update_inner_kernel_params_fn,
    )

    init_fn = partial(
        init,
        logprior_fn=logprior_fn,
        loglikelihood_fn=loglikelihood_fn,
        update_inner_kernel_params_fn=update_inner_kernel_params_fn,
    )

    return SamplingAlgorithm(init_fn, step_fn)

# | ### 4.2 Test Custom Sampler on Simple 2D Problem
print("Testing custom nested sampler on 2D Gaussian problem...")

# Simple 2D Gaussian test case
custom_true = {'mu1': 0.5, 'mu2': -0.2, 'sigma1': 0.8, 'sigma2': 0.6}

# Generate test data
custom_mu = jnp.array([custom_true['mu1'], custom_true['mu2']])
custom_cov = jnp.diag(jnp.array([custom_true['sigma1']**2, custom_true['sigma2']**2]))

num_test_samples = 50
key, rng_key = jax.random.split(rng_key)
custom_data = jax.random.multivariate_normal(key, custom_mu, custom_cov, (num_test_samples,))

# Define likelihood and prior for custom sampler
def custom_loglikelihood(params):
    """Simple 2D Gaussian likelihood (no correlation)."""
    mu1, mu2, sigma1, sigma2 = params["mu1"], params["mu2"], params["sigma1"], params["sigma2"]
    mu = jnp.array([mu1, mu2])
    cov = jnp.diag(jnp.array([sigma1**2, sigma2**2]))
    return jnp.sum(jax.scipy.stats.multivariate_normal.logpdf(custom_data, mu, cov))

custom_prior_bounds = {
    "mu1": (-2.0, 3.0),
    "mu2": (-2.0, 2.0),
    "sigma1": (0.1, 2.0),
    "sigma2": (0.1, 2.0),
}

# | ### 4.3 Initialize and Run Custom Nested Sampler
rng_key, prior_key = jax.random.split(rng_key)
particles_custom, logprior_fn_custom = blackjax.ns.utils.uniform_prior(prior_key, num_live, custom_prior_bounds)

# Build custom sampler
custom_nested_sampler = custom_nsmcmc(
    logprior_fn=logprior_fn_custom,
    loglikelihood_fn=custom_loglikelihood,
    num_delete=num_delete,
    num_inner_steps=15,  # Slightly more steps for stability
)

# JIT compile custom sampler functions
custom_init_fn = jax.jit(custom_nested_sampler.init)
custom_step_fn = jax.jit(custom_nested_sampler.step)

print("Running custom nested sampler...")
custom_start = time.time()
custom_live = custom_init_fn(particles_custom)
custom_dead = []

with tqdm.tqdm(desc="Dead points (custom)", unit=" dead points") as pbar:
    while not custom_live.logZ_live - custom_live.logZ < -3:
        rng_key, subkey = jax.random.split(rng_key, 2)
        custom_live, custom_dead_info = custom_step_fn(subkey, custom_live)
        custom_dead.append(custom_dead_info)
        pbar.update(num_delete)

custom_dead = finalise(custom_live, custom_dead)
custom_time = time.time() - custom_start

# | ### 4.4 Process Custom Sampler Results
columns_custom = ["mu1", "mu2", "sigma1", "sigma2"]
labels_custom = [r"$\mu_1$", r"$\mu_2$", r"$\sigma_1$", r"$\sigma_2$"]
data_custom = jnp.vstack([custom_dead.particles[key] for key in columns_custom]).T

custom_samples = NestedSamples(
    data_custom,
    logL=custom_dead.loglikelihood,
    logL_birth=custom_dead.loglikelihood_birth,
    columns=columns_custom,
    labels=labels_custom,
    logzero=jnp.nan,
)

print(f"Custom sampler runtime: {custom_time:.2f} seconds")
print(f"Log Evidence: {custom_samples.logZ():.2f} ± {custom_samples.logZ(100).std():.2f}")
print(f"True parameters: μ₁={custom_true['mu1']:.2f}, μ₂={custom_true['mu2']:.2f}, σ₁={custom_true['sigma1']:.2f}, σ₂={custom_true['sigma2']:.2f}")
print(f"Posterior means: μ₁={custom_samples.mu1.mean():.2f}, μ₂={custom_samples.mu2.mean():.2f}, σ₁={custom_samples.sigma1.mean():.2f}, σ₂={custom_samples.sigma2.mean():.2f}")

# | Compare with high-level BlackJAX implementation
print("\nComparing custom implementation with high-level BlackJAX...")
standard_nested_sampler = blackjax.nss(
    logprior_fn=logprior_fn_custom,
    loglikelihood_fn=custom_loglikelihood,
    num_delete=num_delete,
    num_inner_steps=15,
)

standard_init_fn = jax.jit(standard_nested_sampler.init)
standard_step_fn = jax.jit(standard_nested_sampler.step)

rng_key, prior_key = jax.random.split(rng_key)
particles_standard, _ = blackjax.ns.utils.uniform_prior(prior_key, num_live, custom_prior_bounds)

standard_start = time.time()
standard_live = standard_init_fn(particles_standard)
standard_dead = []

with tqdm.tqdm(desc="Dead points (standard)", unit=" dead points") as pbar:
    while not standard_live.logZ_live - standard_live.logZ < -3:
        rng_key, subkey = jax.random.split(rng_key, 2)
        standard_live, standard_dead_info = standard_step_fn(subkey, standard_live)
        standard_dead.append(standard_dead_info)
        pbar.update(num_delete)

standard_dead = blackjax.ns.utils.finalise(standard_live, standard_dead)
standard_time = time.time() - standard_start

data_standard = jnp.vstack([standard_dead.particles[key] for key in columns_custom]).T
standard_samples = NestedSamples(
    data_standard,
    logL=standard_dead.loglikelihood,
    logL_birth=standard_dead.loglikelihood_birth,
    columns=columns_custom,
    labels=labels_custom,
    logzero=jnp.nan,
)

# | ### 4.5 Visualization and Comparison
print(f"\nImplementation Comparison:")
print(f"Custom sampler:   {custom_time:.2f} sec, logZ = {custom_samples.logZ():.2f}")
print(f"Standard sampler: {standard_time:.2f} sec, logZ = {standard_samples.logZ():.2f}")

# Plot comparison
fig, axes = plt.subplots(2, 2, figsize=(12, 10))
axes = axes.flatten()

for i, param in enumerate(columns_custom):
    axes[i].hist(custom_samples[param].values, bins=25, alpha=0.7, density=True, label='Custom Implementation')
    axes[i].hist(standard_samples[param].values, bins=25, alpha=0.7, density=True, label='Standard BlackJAX')
    axes[i].axvline(custom_true[param], color='red', linestyle='--', label='True value', alpha=0.8)
    axes[i].set_xlabel(labels_custom[i])
    axes[i].set_ylabel('Density')
    axes[i].legend()
    axes[i].grid(True, alpha=0.3)

plt.tight_layout()
plt.suptitle("Custom vs Standard Nested Sampling Implementation", y=1.02)

print("✓ Custom nested sampler implementation successful!")
print("This demonstrates how to build specialized samplers using BlackJAX's modular components.")

# | ## Part 5: JAX Ecosystem Integration
# |
# | Building on Viraj Pandya's JAX tutorial, we demonstrate how nested sampling integrates
# | with the broader JAX ecosystem for automatic differentiation and gradient-based inference.

import optax

# | ### 5.1 JAX-Based 2D Gaussian Inference Problem
# | 
# | Following Viraj's tutorial, we'll infer parameters of a 2D Gaussian from image data,
# | then compare gradient descent, HMC, and nested sampling approaches.

print("Setting up JAX ecosystem example with 2D Gaussian image inference...")

# Define true parameters for image-based 2D Gaussian
jax_true = {
    'mu_x': 0.1, 'mu_y': -0.1,
    'sigma_x': 0.15, 'sigma_y': 0.12,
    'rho': 0.3
}

# Create coordinate grid for 2D Gaussian evaluation
grid_size = 32  # Smaller for computational efficiency
x_grid_2d = jnp.linspace(-0.8, 0.8, grid_size)
y_grid_2d = jnp.linspace(-0.8, 0.8, grid_size)
x_meshgrid, y_meshgrid = jnp.meshgrid(x_grid_2d, y_grid_2d)
xy_points_2d = jnp.stack([x_meshgrid.ravel(), y_meshgrid.ravel()], axis=-1)

# | ### 5.2 JAX Simulator Function
@jax.jit
def jax_simulator(params, rng_key):
    """
    JAX-compiled 2D Gaussian image simulator.
    
    This demonstrates JAX's JIT compilation and automatic differentiation
    capabilities for efficient forward modeling.
    """
    mu_x, mu_y, sigma_x, sigma_y, rho = params
    
    # Construct mean and covariance matrix
    mu = jnp.array([mu_x, mu_y])
    cov = jnp.array([
        [sigma_x**2, rho * sigma_x * sigma_y],
        [rho * sigma_x * sigma_y, sigma_y**2]
    ])
    
    # Evaluate 2D Gaussian probability density on grid
    logpdf_grid = jax.scipy.stats.multivariate_normal.logpdf(xy_points_2d, mu, cov)
    pdf_grid = jnp.exp(logpdf_grid).reshape(x_meshgrid.shape)
    
    # Add noise
    noise = 0.02 * jax.random.normal(rng_key, shape=pdf_grid.shape)
    noisy_image = pdf_grid + noise
    
    return noisy_image

# Generate synthetic observed image
key, rng_key = jax.random.split(rng_key)
jax_params_true = jnp.array([jax_true['mu_x'], jax_true['mu_y'], jax_true['sigma_x'], 
                            jax_true['sigma_y'], jax_true['rho']])
observed_image = jax_simulator(jax_params_true, key)

print(f"Generated {grid_size}x{grid_size} synthetic 2D Gaussian image")

# | ### 5.3 Visualize Observed Data
fig, axes = plt.subplots(1, 2, figsize=(12, 5))
axes[0].imshow(observed_image, extent=[-0.8, 0.8, -0.8, 0.8], origin='lower', cmap='viridis')
axes[0].set_title("Observed 2D Gaussian Image")
axes[0].set_xlabel("x")
axes[0].set_ylabel("y")

# Show true contours
true_image = jax_simulator(jax_params_true, jax.random.PRNGKey(0)) - 0.02 * jax.random.normal(jax.random.PRNGKey(0), shape=observed_image.shape)
axes[1].contour(x_grid_2d, y_grid_2d, true_image, levels=8, colors='white', alpha=0.8)
axes[1].imshow(observed_image, extent=[-0.8, 0.8, -0.8, 0.8], origin='lower', cmap='viridis')
axes[1].set_title("Observed Image with True Contours")
axes[1].set_xlabel("x")
axes[1].set_ylabel("y")

plt.tight_layout()

# | ### 5.4 Define Loss Function for Gradient Descent
@jax.jit
def image_loss(params):
    """Loss function for gradient-based optimization."""
    pred_image = jax_simulator(params, jax.random.PRNGKey(42))  # Fixed key for deterministic prediction
    residuals = pred_image - observed_image
    return jnp.sum(residuals**2) / 2  # L2 loss

# | ### 5.5 Gradient Descent with Optax
print("Running gradient descent optimization...")

# Initialize parameters
init_params = jnp.array([0.0, 0.0, 0.2, 0.2, 0.0])

# Set up optimizer
learning_rate = 0.01
optimizer = optax.adam(learning_rate)
opt_state = optimizer.init(init_params)

# Gradient function
grad_fn = jax.jit(jax.grad(image_loss))

# Optimization loop
params = init_params
losses = []
param_history = []

for i in range(200):
    loss_val = image_loss(params)
    grads = grad_fn(params)
    
    updates, opt_state = optimizer.update(grads, opt_state)
    params = optax.apply_updates(params, updates)
    
    losses.append(loss_val)
    param_history.append(params)
    
    if i % 50 == 0:
        print(f"Step {i}: Loss = {loss_val:.4f}")

final_params_gd = params
param_history = jnp.stack(param_history)

print(f"Gradient descent final parameters: {final_params_gd}")
print(f"True parameters: {jax_params_true}")

# | ### 5.6 Nested Sampling on Image Data
print("Running nested sampling on image data...")

def image_loglikelihood(params_dict):
    """Log-likelihood for nested sampling on image data."""
    params_array = jnp.array([params_dict['mu_x'], params_dict['mu_y'], 
                             params_dict['sigma_x'], params_dict['sigma_y'], 
                             params_dict['rho']])
    
    # Forward model (deterministic for likelihood evaluation)
    pred_image = jax_simulator(params_array, jax.random.PRNGKey(42))
    
    # Gaussian likelihood (independent pixels)
    sigma_obs = 0.02  # Known observation noise
    loglik = jnp.sum(jax.scipy.stats.norm.logpdf(observed_image, pred_image, sigma_obs))
    
    return loglik

# Define priors for nested sampling
image_prior_bounds = {
    'mu_x': (-0.5, 0.5),
    'mu_y': (-0.5, 0.5),
    'sigma_x': (0.05, 0.3),
    'sigma_y': (0.05, 0.3),
    'rho': (-0.8, 0.8),
}

# Initialize nested sampler
rng_key, prior_key = jax.random.split(rng_key)
particles_image, logprior_fn_image = blackjax.ns.utils.uniform_prior(prior_key, num_live, image_prior_bounds)

nested_sampler_image = blackjax.nss(
    logprior_fn=logprior_fn_image,
    loglikelihood_fn=image_loglikelihood,
    num_delete=num_delete,
    num_inner_steps=25,  # More steps for this complex problem
)

# JIT compile
init_fn_image = jax.jit(nested_sampler_image.init)
step_fn_image = jax.jit(nested_sampler_image.step)

# Run nested sampling
print("Running nested sampling...")
ns_image_start = time.time()
live_image = init_fn_image(particles_image)
dead_image = []

with tqdm.tqdm(desc="Dead points (image)", unit=" dead points") as pbar:
    while not live_image.logZ_live - live_image.logZ < -3:
        rng_key, subkey = jax.random.split(rng_key, 2)
        live_image, dead_info_image = step_fn_image(subkey, live_image)
        dead_image.append(dead_info_image)
        pbar.update(num_delete)

dead_image = blackjax.ns.utils.finalise(live_image, dead_image)
ns_image_time = time.time() - ns_image_start

# | ### 5.7 Process Image Inference Results
columns_image = ['mu_x', 'mu_y', 'sigma_x', 'sigma_y', 'rho']
labels_image = [r'$\mu_x$', r'$\mu_y$', r'$\sigma_x$', r'$\sigma_y$', r'$\rho$']
data_image = jnp.vstack([dead_image.particles[key] for key in columns_image]).T

image_samples = NestedSamples(
    data_image,
    logL=dead_image.loglikelihood,
    logL_birth=dead_image.loglikelihood_birth,
    columns=columns_image,
    labels=labels_image,
    logzero=jnp.nan,
)

print(f"Image inference results:")
print(f"Nested sampling runtime: {ns_image_time:.2f} seconds")
print(f"Log Evidence: {image_samples.logZ():.2f} ± {image_samples.logZ(100).std():.2f}")
print(f"True parameters: μₓ={jax_true['mu_x']:.3f}, μᵧ={jax_true['mu_y']:.3f}, σₓ={jax_true['sigma_x']:.3f}, σᵧ={jax_true['sigma_y']:.3f}, ρ={jax_true['rho']:.3f}")
print(f"NS posterior means: μₓ={image_samples.mu_x.mean():.3f}, μᵧ={image_samples.mu_y.mean():.3f}, σₓ={image_samples.sigma_x.mean():.3f}, σᵧ={image_samples.sigma_y.mean():.3f}, ρ={image_samples.rho.mean():.3f}")
print(f"GD final estimates: μₓ={final_params_gd[0]:.3f}, μᵧ={final_params_gd[1]:.3f}, σₓ={final_params_gd[2]:.3f}, σᵧ={final_params_gd[3]:.3f}, ρ={final_params_gd[4]:.3f}")

# | ### 5.8 Comparison Visualization
fig, axes = plt.subplots(2, 3, figsize=(15, 8))

# Parameter evolution during gradient descent
param_labels = ['μₓ', 'μᵧ', 'σₓ', 'σᵧ', 'ρ']
jax_true_vals = [jax_true['mu_x'], jax_true['mu_y'], jax_true['sigma_x'], jax_true['sigma_y'], jax_true['rho']]

for i in range(5):
    row, col = i // 3, i % 3
    axes[row, col].plot(param_history[:, i], label='Gradient Descent', alpha=0.8)
    axes[row, col].axhline(jax_true_vals[i], color='red', linestyle='--', alpha=0.8, label='True Value')
    axes[row, col].set_ylabel(param_labels[i])
    axes[row, col].set_xlabel('Optimization Step')
    axes[row, col].legend()
    axes[row, col].grid(True, alpha=0.3)

# Loss evolution
axes[1, 2].plot(losses, color='blue', alpha=0.8)
axes[1, 2].set_ylabel('Loss')
axes[1, 2].set_xlabel('Optimization Step')
axes[1, 2].set_title('Gradient Descent Convergence')
axes[1, 2].grid(True, alpha=0.3)

plt.tight_layout()
plt.suptitle("JAX Ecosystem: Gradient Descent vs Nested Sampling", y=1.02)

print("✓ JAX ecosystem integration complete!")
print("This demonstrates the complementary strengths of gradient-based and nested sampling approaches.")

# | ## Part 6: Simulation-Based Inference (SBI) Integration
# |
# | We demonstrate how nested sampling integrates with modern SBI techniques,
# | specifically neural posterior estimation (NPE) using JAX and simple neural networks.

from flax import linen as nn

print("Setting up SBI integration example with neural posterior estimation...")

# | ### 6.1 SBI Training Data Generation
# |
# | Generate a large dataset of (parameters, simulations) pairs for training
# | a neural network to approximate the posterior distribution.

print("Generating SBI training dataset...")

def generate_sbi_dataset(n_samples, rng_key):
    """Generate training data for neural posterior estimation."""
    # Sample parameters from prior
    key_prior, key_sim = jax.random.split(rng_key)
    
    # SBI prior bounds (same as image inference)
    sbi_bounds = jnp.array([
        [-0.5, 0.5],  # mu_x
        [-0.5, 0.5],  # mu_y  
        [0.05, 0.3],  # sigma_x
        [0.05, 0.3],  # sigma_y
        [-0.8, 0.8],  # rho
    ])
    
    # Sample uniformly from prior
    params_sbi = jax.random.uniform(key_prior, (n_samples, 5))
    params_sbi = params_sbi * (sbi_bounds[:, 1] - sbi_bounds[:, 0]) + sbi_bounds[:, 0]
    
    # Generate simulations for each parameter set
    sim_keys = jax.random.split(key_sim, n_samples)
    
    @jax.jit
    def simulate_batch(params_batch, keys_batch):
        """Vectorized simulation function."""
        return jax.vmap(jax_simulator)(params_batch, keys_batch)
    
    # Generate simulations
    simulations = simulate_batch(params_sbi, sim_keys)
    
    return params_sbi, simulations

# Generate training dataset
n_sbi_samples = 5000  # Moderate size for workshop
key, rng_key = jax.random.split(rng_key)
sbi_params, sbi_sims = generate_sbi_dataset(n_sbi_samples, key)

print(f"Generated SBI dataset: {n_sbi_samples} parameter-simulation pairs")
print(f"Parameter shape: {sbi_params.shape}, Simulation shape: {sbi_sims.shape}")

# | ### 6.2 Neural Posterior Network
# |
# | Define a simple neural network that maps from simulations to posterior parameters.
# | This is a basic implementation of neural posterior estimation (NPE).

class NPENetwork(nn.Module):
    """Neural Posterior Estimation network."""
    hidden_dims: tuple = (64, 64)
    
    @nn.compact
    def __call__(self, x):
        # Flatten simulation data
        x = x.reshape((x.shape[0], -1))
        
        # Hidden layers
        for dim in self.hidden_dims:
            x = nn.Dense(dim)(x)
            x = nn.relu(x)
        
        # Output layer (5 parameters)
        x = nn.Dense(5)(x)
        
        return x

# | ### 6.3 Training the Neural Posterior
print("Training neural posterior network...")

def train_npe_network(network, params_data, sims_data, n_epochs=300, learning_rate=1e-3):
    """Train the neural posterior estimation network."""
    # Initialize network
    rng = jax.random.PRNGKey(42)
    network_params = network.init(rng, sims_data[:1])
    
    # Setup optimizer
    optimizer = optax.adam(learning_rate)
    opt_state = optimizer.init(network_params)
    
    # Loss function
    def mse_loss(network_params, sims_batch, params_batch):
        pred_params = network.apply(network_params, sims_batch)
        return jnp.mean((pred_params - params_batch)**2)
    
    # Training step
    @jax.jit
    def train_step(network_params, opt_state, sims_batch, params_batch):
        loss, grads = jax.value_and_grad(mse_loss)(network_params, sims_batch, params_batch)
        updates, opt_state = optimizer.update(grads, opt_state)
        network_params = optax.apply_updates(network_params, updates)
        return network_params, opt_state, loss
    
    # Training loop
    losses = []
    for epoch in range(n_epochs):
        # Simple full-batch training (could use mini-batches for larger datasets)
        network_params, opt_state, loss = train_step(network_params, opt_state, sims_data, params_data)
        losses.append(loss)
        
        if epoch % 50 == 0:
            print(f"Epoch {epoch}: Loss = {loss:.6f}")
    
    return network_params, losses

# Train the network
npe_network = NPENetwork()
npe_start = time.time()
trained_npe_params, npe_losses = train_npe_network(npe_network, sbi_params, sbi_sims)
npe_time = time.time() - npe_start

print(f"NPE training completed in {npe_time:.2f} seconds")

# | ### 6.4 SBI Posterior Inference
print("Performing SBI posterior inference on observed data...")

# Use the same observed image from Part 5
npe_posterior_params = npe_network.apply(trained_npe_params, observed_image[None, ...])
npe_prediction = npe_posterior_params[0]  # Remove batch dimension

print(f"SBI posterior prediction: μₓ={npe_prediction[0]:.3f}, μᵧ={npe_prediction[1]:.3f}, σₓ={npe_prediction[2]:.3f}, σᵧ={npe_prediction[3]:.3f}, ρ={npe_prediction[4]:.3f}")

# | ### 6.5 Generate Test Dataset for Validation
print("Validating SBI approach on test dataset...")

# Generate test data
n_test_sbi = 100
key, rng_key = jax.random.split(rng_key)
test_sbi_params, test_sbi_sims = generate_sbi_dataset(n_test_sbi, key)

# Predict on test data
test_predictions = npe_network.apply(trained_npe_params, test_sbi_sims)

# | ### 6.6 Comparison: Nested Sampling vs SBI
print("Comparing nested sampling and SBI approaches...")

# For a fair comparison, run nested sampling on a few test cases
comparison_results = []

for i in range(3):  # Compare on 3 test cases
    test_obs = test_sbi_sims[i]
    true_params = test_sbi_params[i]
    
    # SBI prediction
    sbi_pred = test_predictions[i]
    
    # Nested sampling inference  
    def test_loglikelihood(params_dict):
        params_array = jnp.array([params_dict['mu_x'], params_dict['mu_y'], 
                                 params_dict['sigma_x'], params_dict['sigma_y'], 
                                 params_dict['rho']])
        pred_image = jax_simulator(params_array, jax.random.PRNGKey(42))
        sigma_obs = 0.02
        return jnp.sum(jax.scipy.stats.norm.logpdf(test_obs, pred_image, sigma_obs))
    
    # Quick nested sampling run (fewer live points for speed)
    rng_key, prior_key = jax.random.split(rng_key)
    particles_test, logprior_fn_test = blackjax.ns.utils.uniform_prior(prior_key, 50, image_prior_bounds)
    
    nested_sampler_test = blackjax.nss(
        logprior_fn=logprior_fn_test,
        loglikelihood_fn=test_loglikelihood,
        num_delete=25,
        num_inner_steps=15,
    )
    
    init_fn_test = jax.jit(nested_sampler_test.init)
    step_fn_test = jax.jit(nested_sampler_test.step)
    
    # Run nested sampling
    ns_test_start = time.time()
    live_test = init_fn_test(particles_test)
    dead_test = []
    
    # Shorter run for comparison
    while len(dead_test) < 10:  # Just get some samples quickly
        rng_key, subkey = jax.random.split(rng_key, 2)
        live_test, dead_info_test = step_fn_test(subkey, live_test)
        dead_test.append(dead_info_test)
    
    ns_test_time = time.time() - ns_test_start
    
    # Get posterior mean from nested sampling
    dead_test = blackjax.ns.utils.finalise(live_test, dead_test)
    data_test = jnp.vstack([dead_test.particles[key] for key in columns_image]).T
    ns_mean = jnp.mean(data_test, axis=0)
    
    comparison_results.append({
        'true': true_params,
        'sbi': sbi_pred,
        'ns': ns_mean,
        'ns_time': ns_test_time
    })

# | ### 6.7 Results Visualization and Analysis
print("Generating SBI comparison results...")

fig, axes = plt.subplots(2, 3, figsize=(15, 10))

# Training loss
axes[0, 0].plot(npe_losses, alpha=0.8)
axes[0, 0].set_ylabel('MSE Loss')
axes[0, 0].set_xlabel('Epoch')
axes[0, 0].set_title('NPE Training Progress')
axes[0, 0].grid(True, alpha=0.3)

# Parameter prediction accuracy on test set
param_names_sbi = ['μₓ', 'μᵧ', 'σₓ', 'σᵧ', 'ρ']
for i in range(5):
    row = 0 if i < 3 else 1
    col = i if i < 3 else i - 3
    if row == 1 and col >= 2:
        continue
        
    axes[row, col if row == 0 else col + 1].scatter(test_sbi_params[:, i], test_predictions[:, i], alpha=0.6, s=20)
    axes[row, col if row == 0 else col + 1].plot([test_sbi_params[:, i].min(), test_sbi_params[:, i].max()], 
                                                [test_sbi_params[:, i].min(), test_sbi_params[:, i].max()], 
                                                'r--', alpha=0.8)
    axes[row, col if row == 0 else col + 1].set_xlabel(f'True {param_names_sbi[i]}')
    axes[row, col if row == 0 else col + 1].set_ylabel(f'Predicted {param_names_sbi[i]}')
    axes[row, col if row == 0 else col + 1].grid(True, alpha=0.3)

# Method comparison
methods = ['True', 'SBI (NPE)', 'Nested Sampling']
colors = ['black', 'blue', 'red']

comparison_data = jnp.array([[r['true'], r['sbi'], r['ns']] for r in comparison_results])

axes[1, 2].clear()
for i, method in enumerate(methods):
    for j in range(3):  # 3 test cases
        axes[1, 2].scatter([i] * 5, comparison_data[j, i], 
                          alpha=0.7, s=30, color=colors[i])

axes[1, 2].set_xticks(range(3))
axes[1, 2].set_xticklabels(methods)
axes[1, 2].set_ylabel('Parameter Values')
axes[1, 2].set_title('Method Comparison (3 Test Cases)')
axes[1, 2].grid(True, alpha=0.3)

plt.tight_layout()
plt.suptitle("SBI vs Nested Sampling: Neural Posterior Estimation", y=1.02)

# | ### 6.8 Performance Summary
print("\n" + "="*60)
print("SBI INTEGRATION RESULTS")
print("="*60)

# Compute accuracy metrics
sbi_errors = jnp.abs(test_predictions - test_sbi_params)
sbi_mean_error = jnp.mean(sbi_errors, axis=0)

print(f"Neural Posterior Estimation (NPE) Results:")
print(f"Training time: {npe_time:.2f} seconds ({n_sbi_samples} samples)")
print(f"Inference time per observation: ~0.001 seconds (instant)")
print(f"Mean absolute errors by parameter:")
for i, param_name in enumerate(param_names_sbi):
    print(f"  {param_name}: {sbi_mean_error[i]:.4f}")

print(f"\nComparison with Nested Sampling:")
ns_times = [r['ns_time'] for r in comparison_results]
avg_ns_time = sum(ns_times) / len(ns_times)  # Use Python mean instead of jnp.mean
print(f"NS average time per inference: {avg_ns_time:.2f} seconds")
print(f"SBI advantage: ~{avg_ns_time/0.001:.0f}x faster inference")

print(f"\nSBI Trade-offs:")
print(f"✓ Extremely fast inference once trained")
print(f"✓ Amortized: single training enables inference on any observation")
print(f"✓ Scalable to high-dimensional problems")
print(f"✗ Requires large training dataset")
print(f"✗ Point estimates only (no uncertainty quantification)")
print(f"✗ Limited to training distribution")

print(f"\nNested Sampling Trade-offs:")
print(f"✓ Full posterior uncertainty quantification")
print(f"✓ Bayesian evidence for model comparison")
print(f"✓ No training required")
print(f"✗ Slower per-observation inference")
print(f"✗ Computational cost scales with problem complexity")

print("✓ SBI integration example complete!")
print("This demonstrates how neural networks can complement traditional Bayesian methods.")

# | ## Workshop Conclusions
# |
# | This comprehensive BlackJAX nested sampling workshop demonstrates the full spectrum of modern Bayesian inference:
# |
# | ### Core Concepts Demonstrated
# | 1. **GPU-Native Performance**: BlackJAX leverages JAX for automatic differentiation and JIT compilation
# | 2. **Evidence Computation**: Nested sampling naturally provides Bayesian evidence for model comparison
# | 3. **Parameter Transforms**: Proper handling of constrained parameters (correlation coefficients, etc.)
# | 4. **Anesthetic Integration**: Professional post-processing and visualization of nested sampling results
# |
# | ### Advanced Techniques Covered
# | 5. **Sampler Comparison**: Nested sampling vs. NUTS - understanding when to use which approach
# | 6. **Custom Implementation**: Building specialized samplers using BlackJAX's modular components
# | 7. **JAX Ecosystem**: Integration with gradient descent and the broader scientific Python ecosystem
# | 8. **SBI Methods**: Neural posterior estimation and comparison with traditional Bayesian approaches
# |
# | ### Key Performance Insights
# | - **Nested Sampling**: Excellent for evidence computation, uncertainty quantification, no training required
# | - **Gradient Methods**: Fast convergence for optimization problems, good starting points for sampling
# | - **Neural SBI**: Extremely fast amortized inference, but requires training data and gives point estimates
# | - **Custom Samplers**: Research flexibility while maintaining computational efficiency
# |
# | ### Practical Recommendations
# | **For Model Comparison**: Use nested sampling for Bayesian evidence computation
# | **For Production Systems**: Consider SBI for real-time inference after offline training
# | **For Research**: Leverage BlackJAX's modular design for custom sampling strategies
# | **For Complex Problems**: Combine approaches - use gradient methods for initialization, nested sampling for uncertainty
# |
# | ### Next Steps
# | Try BlackJAX nested sampling on your own problems! Consider:
# | - Adjusting `num_live` and `num_inner_steps` for accuracy vs. speed trade-offs
# | - Implementing custom prior distributions and parameter transforms
# | - Comparing with other BlackJAX samplers (HMC, NUTS, MALA, etc.)
# | - Building custom samplers for specialized applications
# | - Integrating with SBI workflows for high-throughput inference
# | - Exploring nested sampling for model selection and hypothesis testing
# |
# | **Workshop Structure**: This tutorial offers flexible delivery options:
# | - **Core Workshop (20 minutes)**: Parts 1-3 covering essential nested sampling concepts
# | - **Full Workshop (110 minutes)**: All 6 parts including advanced research techniques
# | - **Modular Extensions**: Parts 4-6 can be used individually based on audience interests
# | 
# | Each section builds on the previous, demonstrating the evolution from basic concepts to cutting-edge research techniques.


```